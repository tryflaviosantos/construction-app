{"file_contents":{"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"pg\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1417,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"server/storage.ts":{"content":"// Database Storage - javascript_database blueprint\nimport {\n  users,\n  tenants,\n  clients,\n  sites,\n  siteAssignments,\n  timeRecords,\n  contestations,\n  tools,\n  toolTransactions,\n  leaveRequests,\n  payrollRecords,\n  notifications,\n  notificationPreferences,\n  siteDocuments,\n  chatRooms,\n  chatParticipants,\n  chatMessages,\n  type User,\n  type UpsertUser,\n  type Tenant,\n  type InsertTenant,\n  type Client,\n  type InsertClient,\n  type Site,\n  type InsertSite,\n  type SiteAssignment,\n  type InsertSiteAssignment,\n  type TimeRecord,\n  type InsertTimeRecord,\n  type Contestation,\n  type InsertContestation,\n  type Tool,\n  type InsertTool,\n  type ToolTransaction,\n  type InsertToolTransaction,\n  type LeaveRequest,\n  type InsertLeaveRequest,\n  type PayrollRecord,\n  type InsertPayrollRecord,\n  type Notification,\n  type InsertNotification,\n  type NotificationPreferences,\n  type InsertNotificationPreferences,\n  type SiteDocument,\n  type InsertSiteDocument,\n  type ChatRoom,\n  type InsertChatRoom,\n  type ChatParticipant,\n  type InsertChatParticipant,\n  type ChatMessage,\n  type InsertChatMessage,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, and, desc, gte, lte, or, isNull } from \"drizzle-orm\";\n\nexport interface IStorage {\n  // User operations (required for Replit Auth)\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  upsertUser(user: UpsertUser): Promise<User>;\n  createUser(user: UpsertUser): Promise<User>;\n  getUsersByTenant(tenantId: string): Promise<User[]>;\n  updateUser(id: string, data: Partial<UpsertUser>): Promise<User | undefined>;\n\n  // Tenant operations\n  getTenant(id: string): Promise<Tenant | undefined>;\n  getTenantByName(name: string): Promise<Tenant | undefined>;\n  getAllTenants(): Promise<Tenant[]>;\n  createTenant(data: InsertTenant): Promise<Tenant>;\n  updateTenant(id: string, data: Partial<InsertTenant>): Promise<Tenant | undefined>;\n\n  // Superadmin operations\n  getAllUsers(): Promise<User[]>;\n\n  // Client operations\n  getClient(id: string): Promise<Client | undefined>;\n  getClientsByTenant(tenantId: string): Promise<Client[]>;\n  getClientByUserId(userId: string): Promise<Client | undefined>;\n  createClient(data: InsertClient): Promise<Client>;\n  updateClient(id: string, data: Partial<InsertClient>): Promise<Client | undefined>;\n  deleteClient(id: string): Promise<boolean>;\n\n  // Site operations\n  getSite(id: string): Promise<Site | undefined>;\n  getSitesByTenant(tenantId: string): Promise<Site[]>;\n  getSitesByClient(clientId: string): Promise<Site[]>;\n  createSite(data: InsertSite): Promise<Site>;\n  updateSite(id: string, data: Partial<InsertSite>): Promise<Site | undefined>;\n  deleteSite(id: string): Promise<boolean>;\n\n  // Site Assignment operations\n  getSiteAssignment(id: string): Promise<SiteAssignment | undefined>;\n  getSiteAssignmentsByUser(userId: string): Promise<SiteAssignment[]>;\n  getSiteAssignmentsBySite(siteId: string): Promise<SiteAssignment[]>;\n  createSiteAssignment(data: InsertSiteAssignment): Promise<SiteAssignment>;\n  updateSiteAssignment(id: string, data: Partial<InsertSiteAssignment>): Promise<SiteAssignment | undefined>;\n\n  // Time Record operations\n  getTimeRecord(id: string): Promise<TimeRecord | undefined>;\n  getTimeRecordsByUser(userId: string): Promise<TimeRecord[]>;\n  getTimeRecordsBySite(siteId: string): Promise<TimeRecord[]>;\n  getTimeRecordsByTenant(tenantId: string): Promise<TimeRecord[]>;\n  getActiveTimeRecord(userId: string): Promise<TimeRecord | undefined>;\n  createTimeRecord(data: InsertTimeRecord): Promise<TimeRecord>;\n  updateTimeRecord(id: string, data: Partial<InsertTimeRecord>): Promise<TimeRecord | undefined>;\n\n  // Contestation operations\n  getContestation(id: string): Promise<Contestation | undefined>;\n  getContestationsByTimeRecord(timeRecordId: string): Promise<Contestation[]>;\n  createContestation(data: InsertContestation): Promise<Contestation>;\n  updateContestation(id: string, data: Partial<InsertContestation>): Promise<Contestation | undefined>;\n\n  // Tool operations\n  getTool(id: string): Promise<Tool | undefined>;\n  getToolsByTenant(tenantId: string): Promise<Tool[]>;\n  getToolByQrCode(qrCode: string): Promise<Tool | undefined>;\n  createTool(data: InsertTool): Promise<Tool>;\n  updateTool(id: string, data: Partial<InsertTool>): Promise<Tool | undefined>;\n  deleteTool(id: string): Promise<boolean>;\n\n  // Tool Transaction operations\n  getToolTransactionsByTool(toolId: string): Promise<ToolTransaction[]>;\n  createToolTransaction(data: InsertToolTransaction): Promise<ToolTransaction>;\n\n  // Leave Request operations\n  getLeaveRequest(id: string): Promise<LeaveRequest | undefined>;\n  getLeaveRequestsByUser(userId: string): Promise<LeaveRequest[]>;\n  getLeaveRequestsByTenant(tenantId: string): Promise<LeaveRequest[]>;\n  createLeaveRequest(data: InsertLeaveRequest): Promise<LeaveRequest>;\n  updateLeaveRequest(id: string, data: Partial<InsertLeaveRequest>): Promise<LeaveRequest | undefined>;\n\n  // Payroll operations\n  getPayrollRecord(id: string): Promise<PayrollRecord | undefined>;\n  getPayrollRecordsByUser(userId: string): Promise<PayrollRecord[]>;\n  getPayrollRecordsByTenant(tenantId: string): Promise<PayrollRecord[]>;\n  createPayrollRecord(data: InsertPayrollRecord): Promise<PayrollRecord>;\n  updatePayrollRecord(id: string, data: Partial<InsertPayrollRecord>): Promise<PayrollRecord | undefined>;\n\n  // Notification operations\n  getNotification(id: string): Promise<Notification | undefined>;\n  getNotificationsByUser(userId: string): Promise<Notification[]>;\n  getUnreadNotificationsByUser(userId: string): Promise<Notification[]>;\n  createNotification(data: InsertNotification): Promise<Notification>;\n  markNotificationRead(id: string): Promise<Notification | undefined>;\n  markAllNotificationsRead(userId: string): Promise<void>;\n\n  // Notification Preferences operations\n  getNotificationPreferences(userId: string): Promise<NotificationPreferences | undefined>;\n  upsertNotificationPreferences(data: InsertNotificationPreferences & { userId: string }): Promise<NotificationPreferences>;\n\n  // Site Document operations\n  getSiteDocument(id: string): Promise<SiteDocument | undefined>;\n  getSiteDocumentsBySite(siteId: string): Promise<SiteDocument[]>;\n  getSiteDocumentVersions(parentId: string): Promise<SiteDocument[]>;\n  createSiteDocument(data: InsertSiteDocument): Promise<SiteDocument>;\n  updateSiteDocument(id: string, data: Partial<InsertSiteDocument>): Promise<SiteDocument | undefined>;\n\n  // Chat Room operations\n  getChatRoom(id: string): Promise<ChatRoom | undefined>;\n  getChatRoomsBySite(siteId: string): Promise<ChatRoom[]>;\n  getChatRoomsByUser(userId: string): Promise<ChatRoom[]>;\n  createChatRoom(data: InsertChatRoom): Promise<ChatRoom>;\n\n  // Chat Participant operations\n  getChatParticipants(roomId: string): Promise<ChatParticipant[]>;\n  addChatParticipant(data: InsertChatParticipant): Promise<ChatParticipant>;\n  updateChatParticipantLastRead(roomId: string, userId: string): Promise<void>;\n\n  // Chat Message operations\n  getChatMessages(roomId: string, limit?: number): Promise<ChatMessage[]>;\n  createChatMessage(data: InsertChatMessage): Promise<ChatMessage>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  // User operations\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.username, username));\n    return user;\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.email, email));\n    return user;\n  }\n\n  async createUser(userData: UpsertUser): Promise<User> {\n    const [user] = await db.insert(users).values(userData).returning();\n    return user;\n  }\n\n  async upsertUser(userData: UpsertUser): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values(userData)\n      .onConflictDoUpdate({\n        target: users.id,\n        set: {\n          ...userData,\n          updatedAt: new Date(),\n        },\n      })\n      .returning();\n    return user;\n  }\n\n  async getUsersByTenant(tenantId: string): Promise<User[]> {\n    return db.select().from(users).where(eq(users.tenantId, tenantId));\n  }\n\n  async updateUser(id: string, data: Partial<UpsertUser>): Promise<User | undefined> {\n    const [user] = await db\n      .update(users)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(users.id, id))\n      .returning();\n    return user;\n  }\n\n  // Tenant operations\n  async getTenant(id: string): Promise<Tenant | undefined> {\n    const [tenant] = await db.select().from(tenants).where(eq(tenants.id, id));\n    return tenant;\n  }\n\n  async getTenantByName(name: string): Promise<Tenant | undefined> {\n    const [tenant] = await db.select().from(tenants).where(eq(tenants.name, name));\n    return tenant;\n  }\n\n  async getAllTenants(): Promise<Tenant[]> {\n    return db.select().from(tenants).orderBy(desc(tenants.createdAt));\n  }\n\n  async getAllUsers(): Promise<User[]> {\n    return db.select().from(users).orderBy(desc(users.createdAt));\n  }\n\n  async createTenant(data: InsertTenant): Promise<Tenant> {\n    const [tenant] = await db.insert(tenants).values(data).returning();\n    return tenant;\n  }\n\n  async updateTenant(id: string, data: Partial<InsertTenant>): Promise<Tenant | undefined> {\n    const [tenant] = await db\n      .update(tenants)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(tenants.id, id))\n      .returning();\n    return tenant;\n  }\n\n  // Client operations\n  async getClient(id: string): Promise<Client | undefined> {\n    const [client] = await db.select().from(clients).where(eq(clients.id, id));\n    return client;\n  }\n\n  async getClientsByTenant(tenantId: string): Promise<Client[]> {\n    return db.select().from(clients).where(eq(clients.tenantId, tenantId));\n  }\n\n  async getClientByUserId(userId: string): Promise<Client | undefined> {\n    const [client] = await db.select().from(clients).where(eq(clients.userId, userId));\n    return client;\n  }\n\n  async createClient(data: InsertClient): Promise<Client> {\n    const [client] = await db.insert(clients).values(data).returning();\n    return client;\n  }\n\n  async updateClient(id: string, data: Partial<InsertClient>): Promise<Client | undefined> {\n    const [client] = await db\n      .update(clients)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(clients.id, id))\n      .returning();\n    return client;\n  }\n\n  async deleteClient(id: string): Promise<boolean> {\n    await db.delete(clients).where(eq(clients.id, id));\n    return true;\n  }\n\n  // Site operations\n  async getSite(id: string): Promise<Site | undefined> {\n    const [site] = await db.select().from(sites).where(eq(sites.id, id));\n    return site;\n  }\n\n  async getSitesByTenant(tenantId: string): Promise<Site[]> {\n    return db.select().from(sites).where(eq(sites.tenantId, tenantId));\n  }\n\n  async getSitesByClient(clientId: string): Promise<Site[]> {\n    return db.select().from(sites).where(eq(sites.clientId, clientId));\n  }\n\n  async createSite(data: InsertSite): Promise<Site> {\n    const [site] = await db.insert(sites).values(data).returning();\n    return site;\n  }\n\n  async updateSite(id: string, data: Partial<InsertSite>): Promise<Site | undefined> {\n    const [site] = await db\n      .update(sites)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(sites.id, id))\n      .returning();\n    return site;\n  }\n\n  async deleteSite(id: string): Promise<boolean> {\n    const result = await db.delete(sites).where(eq(sites.id, id));\n    return true;\n  }\n\n  // Site Assignment operations\n  async getSiteAssignment(id: string): Promise<SiteAssignment | undefined> {\n    const [assignment] = await db.select().from(siteAssignments).where(eq(siteAssignments.id, id));\n    return assignment;\n  }\n\n  async getSiteAssignmentsByUser(userId: string): Promise<SiteAssignment[]> {\n    return db.select().from(siteAssignments).where(eq(siteAssignments.userId, userId));\n  }\n\n  async getSiteAssignmentsBySite(siteId: string): Promise<SiteAssignment[]> {\n    return db.select().from(siteAssignments).where(eq(siteAssignments.siteId, siteId));\n  }\n\n  async createSiteAssignment(data: InsertSiteAssignment): Promise<SiteAssignment> {\n    const [assignment] = await db.insert(siteAssignments).values(data).returning();\n    return assignment;\n  }\n\n  async updateSiteAssignment(id: string, data: Partial<InsertSiteAssignment>): Promise<SiteAssignment | undefined> {\n    const [assignment] = await db\n      .update(siteAssignments)\n      .set(data)\n      .where(eq(siteAssignments.id, id))\n      .returning();\n    return assignment;\n  }\n\n  // Time Record operations\n  async getTimeRecord(id: string): Promise<TimeRecord | undefined> {\n    const [record] = await db.select().from(timeRecords).where(eq(timeRecords.id, id));\n    return record;\n  }\n\n  async getTimeRecordsByUser(userId: string): Promise<TimeRecord[]> {\n    return db\n      .select()\n      .from(timeRecords)\n      .where(eq(timeRecords.userId, userId))\n      .orderBy(desc(timeRecords.checkInTime));\n  }\n\n  async getTimeRecordsBySite(siteId: string): Promise<TimeRecord[]> {\n    return db\n      .select()\n      .from(timeRecords)\n      .where(eq(timeRecords.siteId, siteId))\n      .orderBy(desc(timeRecords.checkInTime));\n  }\n\n  async getTimeRecordsByTenant(tenantId: string): Promise<TimeRecord[]> {\n    return db\n      .select()\n      .from(timeRecords)\n      .where(eq(timeRecords.tenantId, tenantId))\n      .orderBy(desc(timeRecords.checkInTime));\n  }\n\n  async getActiveTimeRecord(userId: string): Promise<TimeRecord | undefined> {\n    const [record] = await db\n      .select()\n      .from(timeRecords)\n      .where(and(eq(timeRecords.userId, userId), eq(timeRecords.checkOutTime, null as any)));\n    return record;\n  }\n\n  async createTimeRecord(data: InsertTimeRecord): Promise<TimeRecord> {\n    const [record] = await db.insert(timeRecords).values(data).returning();\n    return record;\n  }\n\n  async updateTimeRecord(id: string, data: Partial<InsertTimeRecord>): Promise<TimeRecord | undefined> {\n    const [record] = await db\n      .update(timeRecords)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(timeRecords.id, id))\n      .returning();\n    return record;\n  }\n\n  // Contestation operations\n  async getContestation(id: string): Promise<Contestation | undefined> {\n    const [contestation] = await db.select().from(contestations).where(eq(contestations.id, id));\n    return contestation;\n  }\n\n  async getContestationsByTimeRecord(timeRecordId: string): Promise<Contestation[]> {\n    return db.select().from(contestations).where(eq(contestations.timeRecordId, timeRecordId));\n  }\n\n  async createContestation(data: InsertContestation): Promise<Contestation> {\n    const [contestation] = await db.insert(contestations).values(data).returning();\n    return contestation;\n  }\n\n  async updateContestation(id: string, data: Partial<InsertContestation>): Promise<Contestation | undefined> {\n    const [contestation] = await db\n      .update(contestations)\n      .set(data)\n      .where(eq(contestations.id, id))\n      .returning();\n    return contestation;\n  }\n\n  // Tool operations\n  async getTool(id: string): Promise<Tool | undefined> {\n    const [tool] = await db.select().from(tools).where(eq(tools.id, id));\n    return tool;\n  }\n\n  async getToolsByTenant(tenantId: string): Promise<Tool[]> {\n    return db.select().from(tools).where(eq(tools.tenantId, tenantId));\n  }\n\n  async getToolByQrCode(qrCode: string): Promise<Tool | undefined> {\n    const [tool] = await db.select().from(tools).where(eq(tools.qrCode, qrCode));\n    return tool;\n  }\n\n  async createTool(data: InsertTool): Promise<Tool> {\n    const [tool] = await db.insert(tools).values(data).returning();\n    return tool;\n  }\n\n  async updateTool(id: string, data: Partial<InsertTool>): Promise<Tool | undefined> {\n    const [tool] = await db\n      .update(tools)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(tools.id, id))\n      .returning();\n    return tool;\n  }\n\n  async deleteTool(id: string): Promise<boolean> {\n    const result = await db.delete(tools).where(eq(tools.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  // Tool Transaction operations\n  async getToolTransactionsByTool(toolId: string): Promise<ToolTransaction[]> {\n    return db\n      .select()\n      .from(toolTransactions)\n      .where(eq(toolTransactions.toolId, toolId))\n      .orderBy(desc(toolTransactions.createdAt));\n  }\n\n  async createToolTransaction(data: InsertToolTransaction): Promise<ToolTransaction> {\n    const [transaction] = await db.insert(toolTransactions).values(data).returning();\n    return transaction;\n  }\n\n  // Leave Request operations\n  async getLeaveRequest(id: string): Promise<LeaveRequest | undefined> {\n    const [request] = await db.select().from(leaveRequests).where(eq(leaveRequests.id, id));\n    return request;\n  }\n\n  async getLeaveRequestsByUser(userId: string): Promise<LeaveRequest[]> {\n    return db\n      .select()\n      .from(leaveRequests)\n      .where(eq(leaveRequests.userId, userId))\n      .orderBy(desc(leaveRequests.startDate));\n  }\n\n  async getLeaveRequestsByTenant(tenantId: string): Promise<LeaveRequest[]> {\n    return db\n      .select()\n      .from(leaveRequests)\n      .where(eq(leaveRequests.tenantId, tenantId))\n      .orderBy(desc(leaveRequests.startDate));\n  }\n\n  async createLeaveRequest(data: InsertLeaveRequest): Promise<LeaveRequest> {\n    const [request] = await db.insert(leaveRequests).values(data).returning();\n    return request;\n  }\n\n  async updateLeaveRequest(id: string, data: Partial<InsertLeaveRequest>): Promise<LeaveRequest | undefined> {\n    const [request] = await db\n      .update(leaveRequests)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(leaveRequests.id, id))\n      .returning();\n    return request;\n  }\n\n  // Payroll operations\n  async getPayrollRecord(id: string): Promise<PayrollRecord | undefined> {\n    const [record] = await db.select().from(payrollRecords).where(eq(payrollRecords.id, id));\n    return record;\n  }\n\n  async getPayrollRecordsByUser(userId: string): Promise<PayrollRecord[]> {\n    return db\n      .select()\n      .from(payrollRecords)\n      .where(eq(payrollRecords.userId, userId))\n      .orderBy(desc(payrollRecords.periodStart));\n  }\n\n  async getPayrollRecordsByTenant(tenantId: string): Promise<PayrollRecord[]> {\n    return db\n      .select()\n      .from(payrollRecords)\n      .where(eq(payrollRecords.tenantId, tenantId))\n      .orderBy(desc(payrollRecords.periodStart));\n  }\n\n  async createPayrollRecord(data: InsertPayrollRecord): Promise<PayrollRecord> {\n    const [record] = await db.insert(payrollRecords).values(data).returning();\n    return record;\n  }\n\n  async updatePayrollRecord(id: string, data: Partial<InsertPayrollRecord>): Promise<PayrollRecord | undefined> {\n    const [record] = await db\n      .update(payrollRecords)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(payrollRecords.id, id))\n      .returning();\n    return record;\n  }\n\n  // Notification operations\n  async getNotification(id: string): Promise<Notification | undefined> {\n    const [notification] = await db.select().from(notifications).where(eq(notifications.id, id));\n    return notification;\n  }\n\n  async getNotificationsByUser(userId: string): Promise<Notification[]> {\n    return db.select().from(notifications).where(eq(notifications.userId, userId)).orderBy(desc(notifications.createdAt));\n  }\n\n  async getUnreadNotificationsByUser(userId: string): Promise<Notification[]> {\n    return db.select().from(notifications).where(and(eq(notifications.userId, userId), eq(notifications.isRead, false))).orderBy(desc(notifications.createdAt));\n  }\n\n  async createNotification(data: InsertNotification): Promise<Notification> {\n    const [notification] = await db.insert(notifications).values(data).returning();\n    return notification;\n  }\n\n  async markNotificationRead(id: string): Promise<Notification | undefined> {\n    const [notification] = await db.update(notifications).set({ isRead: true, readAt: new Date() }).where(eq(notifications.id, id)).returning();\n    return notification;\n  }\n\n  async markAllNotificationsRead(userId: string): Promise<void> {\n    await db.update(notifications).set({ isRead: true, readAt: new Date() }).where(eq(notifications.userId, userId));\n  }\n\n  // Notification Preferences operations\n  async getNotificationPreferences(userId: string): Promise<NotificationPreferences | undefined> {\n    const [prefs] = await db.select().from(notificationPreferences).where(eq(notificationPreferences.userId, userId));\n    return prefs;\n  }\n\n  async upsertNotificationPreferences(data: InsertNotificationPreferences & { userId: string }): Promise<NotificationPreferences> {\n    const [prefs] = await db.insert(notificationPreferences).values(data).onConflictDoUpdate({\n      target: notificationPreferences.userId,\n      set: { ...data, updatedAt: new Date() },\n    }).returning();\n    return prefs;\n  }\n\n  // Site Document operations\n  async getSiteDocument(id: string): Promise<SiteDocument | undefined> {\n    const [doc] = await db.select().from(siteDocuments).where(eq(siteDocuments.id, id));\n    return doc;\n  }\n\n  async getSiteDocumentsBySite(siteId: string): Promise<SiteDocument[]> {\n    return db.select().from(siteDocuments).where(and(eq(siteDocuments.siteId, siteId), eq(siteDocuments.isActive, true))).orderBy(desc(siteDocuments.createdAt));\n  }\n\n  async getSiteDocumentVersions(parentId: string): Promise<SiteDocument[]> {\n    return db.select().from(siteDocuments).where(eq(siteDocuments.parentDocumentId, parentId)).orderBy(desc(siteDocuments.version));\n  }\n\n  async createSiteDocument(data: InsertSiteDocument): Promise<SiteDocument> {\n    const [doc] = await db.insert(siteDocuments).values(data).returning();\n    return doc;\n  }\n\n  async updateSiteDocument(id: string, data: Partial<InsertSiteDocument>): Promise<SiteDocument | undefined> {\n    const [doc] = await db.update(siteDocuments).set({ ...data, updatedAt: new Date() }).where(eq(siteDocuments.id, id)).returning();\n    return doc;\n  }\n\n  // Chat Room operations\n  async getChatRoom(id: string): Promise<ChatRoom | undefined> {\n    const [room] = await db.select().from(chatRooms).where(eq(chatRooms.id, id));\n    return room;\n  }\n\n  async getChatRoomsBySite(siteId: string): Promise<ChatRoom[]> {\n    return db.select().from(chatRooms).where(eq(chatRooms.siteId, siteId));\n  }\n\n  async getChatRoomsByUser(userId: string): Promise<ChatRoom[]> {\n    const participantRooms = await db.select().from(chatParticipants).where(eq(chatParticipants.userId, userId));\n    if (participantRooms.length === 0) return [];\n    const roomIds = participantRooms.map(p => p.roomId);\n    return db.select().from(chatRooms).where(or(...roomIds.map(id => eq(chatRooms.id, id))));\n  }\n\n  async createChatRoom(data: InsertChatRoom): Promise<ChatRoom> {\n    const [room] = await db.insert(chatRooms).values(data).returning();\n    return room;\n  }\n\n  // Chat Participant operations\n  async getChatParticipants(roomId: string): Promise<ChatParticipant[]> {\n    return db.select().from(chatParticipants).where(eq(chatParticipants.roomId, roomId));\n  }\n\n  async addChatParticipant(data: InsertChatParticipant): Promise<ChatParticipant> {\n    const [participant] = await db.insert(chatParticipants).values(data).returning();\n    return participant;\n  }\n\n  async updateChatParticipantLastRead(roomId: string, userId: string): Promise<void> {\n    await db.update(chatParticipants).set({ lastReadAt: new Date() }).where(and(eq(chatParticipants.roomId, roomId), eq(chatParticipants.userId, userId)));\n  }\n\n  // Chat Message operations\n  async getChatMessages(roomId: string, limit: number = 50): Promise<ChatMessage[]> {\n    return db.select().from(chatMessages).where(and(eq(chatMessages.roomId, roomId), eq(chatMessages.isDeleted, false))).orderBy(desc(chatMessages.createdAt)).limit(limit);\n  }\n\n  async createChatMessage(data: InsertChatMessage): Promise<ChatMessage> {\n    const [message] = await db.insert(chatMessages).values(data).returning();\n    return message;\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":24404,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"client/src/pages/Employees.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Users,\n  Plus,\n  Search,\n  Mail,\n  Phone,\n  Clock,\n  Calendar,\n  Shield,\n} from \"lucide-react\";\nimport type { User, Site } from \"@shared/schema\";\n\nexport default function Employees() {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const [search, setSearch] = useState(\"\");\n  const [filter, setFilter] = useState(\"all\");\n  const [showAddDialog, setShowAddDialog] = useState(false);\n  const [formData, setFormData] = useState({\n    email: \"\",\n    firstName: \"\",\n    lastName: \"\",\n    phone: \"\",\n    role: \"employee\",\n    hourlyRate: \"\",\n    pin: \"\",\n  });\n\n  const { data: employees, isLoading } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const { data: sites } = useQuery<Site[]>({\n    queryKey: [\"/api/sites\"],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      return apiRequest(\"POST\", \"/api/users\", {\n        ...data,\n        hourlyRate: data.hourlyRate ? parseFloat(data.hourlyRate) : null,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      toast({ title: t(\"employees.addEmployee\"), description: \"Employee added successfully\" });\n      setShowAddDialog(false);\n      resetForm();\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to add employee\", variant: \"destructive\" });\n    },\n  });\n\n  const resetForm = () => {\n    setFormData({\n      email: \"\",\n      firstName: \"\",\n      lastName: \"\",\n      phone: \"\",\n      role: \"employee\",\n      hourlyRate: \"\",\n      pin: \"\",\n    });\n  };\n\n  const filteredEmployees = employees?.filter((emp) => {\n    const matchesSearch =\n      emp.firstName?.toLowerCase().includes(search.toLowerCase()) ||\n      emp.lastName?.toLowerCase().includes(search.toLowerCase()) ||\n      emp.email?.toLowerCase().includes(search.toLowerCase());\n    const matchesFilter = filter === \"all\" || emp.role === filter;\n    return matchesSearch && matchesFilter;\n  });\n\n  const getRoleBadge = (role: string) => {\n    const variants: Record<string, \"default\" | \"secondary\" | \"destructive\"> = {\n      admin: \"destructive\",\n      manager: \"default\",\n      employee: \"secondary\",\n    };\n    return <Badge variant={variants[role] || \"secondary\"}>{t(`employees.${role}`)}</Badge>;\n  };\n\n  const getInitials = (firstName?: string | null, lastName?: string | null) => {\n    return `${firstName?.[0] || \"\"}${lastName?.[0] || \"\"}`.toUpperCase() || \"?\";\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <h1 className=\"text-2xl font-bold\">{t(\"nav.employees\")}</h1>\n        <Button onClick={() => setShowAddDialog(true)} data-testid=\"button-add-employee\">\n          <Plus className=\"mr-2 h-4 w-4\" />\n          {t(\"employees.addEmployee\")}\n        </Button>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n              Total Employees\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{employees?.length ?? 0}</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n              {t(\"employees.admin\")}s\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {employees?.filter((e) => e.role === \"admin\").length ?? 0}\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n              {t(\"employees.manager\")}s\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {employees?.filter((e) => e.role === \"manager\").length ?? 0}\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n              {t(\"employees.employee\")}s\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {employees?.filter((e) => e.role === \"employee\").length ?? 0}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"flex flex-col sm:flex-row gap-4\">\n        <div className=\"relative flex-1\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder={t(\"common.search\")}\n            value={search}\n            onChange={(e) => setSearch(e.target.value)}\n            className=\"pl-9\"\n            data-testid=\"input-search-employees\"\n          />\n        </div>\n        <Select value={filter} onValueChange={setFilter}>\n          <SelectTrigger className=\"w-full sm:w-40\" data-testid=\"select-filter-employees\">\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"all\">All Roles</SelectItem>\n            <SelectItem value=\"admin\">{t(\"employees.admin\")}</SelectItem>\n            <SelectItem value=\"manager\">{t(\"employees.manager\")}</SelectItem>\n            <SelectItem value=\"employee\">{t(\"employees.employee\")}</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n\n      <Card>\n        <CardContent className=\"p-0\">\n          <div className=\"overflow-x-auto\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Employee</TableHead>\n                  <TableHead>{t(\"employees.role\")}</TableHead>\n                  <TableHead>Contact</TableHead>\n                  <TableHead className=\"text-right\">{t(\"employees.hourlyRate\")}</TableHead>\n                  <TableHead className=\"text-right\">{t(\"employees.vacationBalance\")}</TableHead>\n                  <TableHead>{t(\"common.status\")}</TableHead>\n                  <TableHead className=\"text-right\">{t(\"common.actions\")}</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {isLoading ? (\n                  Array.from({ length: 5 }).map((_, i) => (\n                    <TableRow key={i}>\n                      {Array.from({ length: 7 }).map((_, j) => (\n                        <TableCell key={j}>\n                          <Skeleton className=\"h-4 w-16\" />\n                        </TableCell>\n                      ))}\n                    </TableRow>\n                  ))\n                ) : filteredEmployees?.length === 0 ? (\n                  <TableRow>\n                    <TableCell colSpan={7} className=\"text-center py-8 text-muted-foreground\">\n                      No employees found\n                    </TableCell>\n                  </TableRow>\n                ) : (\n                  filteredEmployees?.map((employee) => (\n                    <TableRow key={employee.id} data-testid={`employee-row-${employee.id}`}>\n                      <TableCell>\n                        <div className=\"flex items-center gap-3\">\n                          <Avatar>\n                            <AvatarImage src={employee.profileImageUrl || undefined} />\n                            <AvatarFallback>\n                              {getInitials(employee.firstName, employee.lastName)}\n                            </AvatarFallback>\n                          </Avatar>\n                          <div>\n                            <p className=\"font-medium\">\n                              {employee.firstName} {employee.lastName}\n                            </p>\n                            <p className=\"text-sm text-muted-foreground\">{employee.email}</p>\n                          </div>\n                        </div>\n                      </TableCell>\n                      <TableCell>{getRoleBadge(employee.role)}</TableCell>\n                      <TableCell>\n                        {employee.phone && (\n                          <span className=\"text-sm text-muted-foreground\">{employee.phone}</span>\n                        )}\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        {employee.hourlyRate ? `$${employee.hourlyRate}` : \"-\"}\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        {employee.vacationDaysBalance ?? 22} {t(\"common.days\")}\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant={employee.isActive ? \"default\" : \"secondary\"}>\n                          {employee.isActive ? \"Active\" : \"Inactive\"}\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <Button size=\"sm\" variant=\"ghost\" data-testid={`button-view-employee-${employee.id}`}>\n                          {t(\"common.view\")}\n                        </Button>\n                      </TableCell>\n                    </TableRow>\n                  ))\n                )}\n              </TableBody>\n            </Table>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Dialog open={showAddDialog} onOpenChange={setShowAddDialog}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>{t(\"employees.addEmployee\")}</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"text-sm font-medium mb-2 block\">First Name</label>\n                <Input\n                  value={formData.firstName}\n                  onChange={(e) => setFormData({ ...formData, firstName: e.target.value })}\n                  placeholder=\"First Name\"\n                  data-testid=\"input-first-name\"\n                />\n              </div>\n              <div>\n                <label className=\"text-sm font-medium mb-2 block\">Last Name</label>\n                <Input\n                  value={formData.lastName}\n                  onChange={(e) => setFormData({ ...formData, lastName: e.target.value })}\n                  placeholder=\"Last Name\"\n                  data-testid=\"input-last-name\"\n                />\n              </div>\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Email</label>\n              <Input\n                type=\"email\"\n                value={formData.email}\n                onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n                placeholder=\"email@example.com\"\n                data-testid=\"input-email\"\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Phone</label>\n              <Input\n                type=\"tel\"\n                value={formData.phone}\n                onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\n                placeholder=\"+1234567890\"\n                data-testid=\"input-phone\"\n              />\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"text-sm font-medium mb-2 block\">{t(\"employees.role\")}</label>\n                <Select\n                  value={formData.role}\n                  onValueChange={(value) => setFormData({ ...formData, role: value })}\n                >\n                  <SelectTrigger data-testid=\"select-role\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"employee\">{t(\"employees.employee\")}</SelectItem>\n                    <SelectItem value=\"manager\">{t(\"employees.manager\")}</SelectItem>\n                    <SelectItem value=\"admin\">{t(\"employees.admin\")}</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div>\n                <label className=\"text-sm font-medium mb-2 block\">{t(\"employees.hourlyRate\")}</label>\n                <Input\n                  type=\"number\"\n                  value={formData.hourlyRate}\n                  onChange={(e) => setFormData({ ...formData, hourlyRate: e.target.value })}\n                  placeholder=\"0.00\"\n                  data-testid=\"input-hourly-rate\"\n                />\n              </div>\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">PIN (6 digits)</label>\n              <Input\n                type=\"password\"\n                maxLength={6}\n                value={formData.pin}\n                onChange={(e) => setFormData({ ...formData, pin: e.target.value })}\n                placeholder=\"Enter PIN\"\n                data-testid=\"input-pin\"\n              />\n            </div>\n\n            <div className=\"flex justify-end gap-2\">\n              <Button variant=\"outline\" onClick={() => setShowAddDialog(false)}>\n                {t(\"common.cancel\")}\n              </Button>\n              <Button\n                onClick={() => createMutation.mutate(formData)}\n                disabled={!formData.email || !formData.firstName || createMutation.isPending}\n                data-testid=\"button-save-employee\"\n              >\n                {t(\"common.save\")}\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":14605,"size_tokens":null},"client/src/components/AppSidebar.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { Link, useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n} from \"@/components/ui/sidebar\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  LayoutDashboard,\n  Clock,\n  Wrench,\n  Building2,\n  Users,\n  Calendar,\n  Calculator,\n  Settings,\n  LogOut,\n  HardHat,\n  FileCheck,\n  BarChart3,\n  FolderOpen,\n  MessageCircle,\n  UserCog,\n  ClipboardList,\n  CalendarCheck,\n  Building,\n  FileText,\n  CreditCard,\n  Shield,\n} from \"lucide-react\";\n\nexport function AppSidebar() {\n  const { t } = useTranslation();\n  const [location] = useLocation();\n  const { user, logout, isManager, isAdmin, isSuperAdmin, isClient } = useAuth();\n\n  // Employee/worker menu items (NOT for superadmin)\n  const mainMenuItems = [\n    { title: t(\"nav.dashboard\"), url: \"/dashboard\", icon: LayoutDashboard },\n    { title: t(\"nav.timeRecords\"), url: \"/time-tracking\", icon: Clock },\n    { title: t(\"nav.tools\"), url: \"/tools\", icon: Wrench },\n    { title: t(\"nav.leave\"), url: \"/leave\", icon: Calendar },\n  ];\n\n  // Manager-level menu items (NOT for superadmin)\n  const managerMenuItems = [\n    { title: t(\"nav.sites\"), url: \"/sites\", icon: Building2 },\n    { title: t(\"nav.employees\"), url: \"/employees\", icon: Users },\n    { title: t(\"nav.payroll\"), url: \"/payroll\", icon: Calculator },\n    { title: t(\"nav.analytics\"), url: \"/analytics\", icon: BarChart3 },\n    { title: t(\"nav.documents\"), url: \"/documents\", icon: FolderOpen },\n    { title: t(\"nav.chat\"), url: \"/chat\", icon: MessageCircle },\n  ];\n\n  // Admin-level tenant management items (NOT for superadmin - they use impersonation)\n  const adminMenuItems = [\n    { title: t(\"admin.userManagement\"), url: \"/admin/users\", icon: UserCog },\n    { title: t(\"admin.siteManagement\"), url: \"/admin/sites\", icon: Building },\n    { title: t(\"admin.clientManagement\"), url: \"/admin/clients\", icon: Users },\n    { title: t(\"admin.toolManagement\"), url: \"/admin/tools\", icon: Wrench },\n    { title: t(\"admin.timesheets\"), url: \"/admin/timesheets\", icon: ClipboardList },\n    { title: t(\"admin.leaveApprovals\"), url: \"/admin/leave\", icon: CalendarCheck },\n    { title: t(\"admin.serviceOrders\"), url: \"/admin/service-orders\", icon: FileText },\n    { title: t(\"admin.companySettings\"), url: \"/admin/company\", icon: Building2 },\n  ];\n\n  // Platform-level superadmin items ONLY\n  const superAdminMenuItems = [\n    { title: t(\"admin.tenantManagement\", \"Gesto de Empresas\"), url: \"/superadmin/tenants\", icon: Shield },\n    { title: t(\"admin.subscriptions\"), url: \"/superadmin/subscriptions\", icon: CreditCard },\n  ];\n  \n  // Check if user is a tenant admin/manager but NOT superadmin\n  const isTenantManager = isManager && !isSuperAdmin;\n  const isTenantAdmin = isAdmin && !isSuperAdmin;\n\n  const clientMenuItems = [\n    { title: t(\"client.myProjects\"), url: \"/client-portal\", icon: FileCheck },\n  ];\n\n  const getInitials = () => {\n    return `${user?.firstName?.[0] || \"\"}${user?.lastName?.[0] || \"\"}`.toUpperCase() || \"U\";\n  };\n\n  const getRoleBadge = () => {\n    if (isSuperAdmin) return <Badge variant=\"destructive\" className=\"text-xs\">{t(\"roles.superadmin\")}</Badge>;\n    if (isAdmin) return <Badge variant=\"default\" className=\"text-xs\">{t(\"roles.admin\")}</Badge>;\n    if (isManager) return <Badge variant=\"secondary\" className=\"text-xs\">{t(\"roles.manager\")}</Badge>;\n    return null;\n  };\n\n  return (\n    <Sidebar>\n      <SidebarHeader className=\"p-4\">\n        <Link href=\"/dashboard\" className=\"flex items-center gap-2\">\n          <HardHat className=\"h-8 w-8 text-primary\" />\n          <span className=\"text-xl font-bold\">ConstructTrack</span>\n        </Link>\n      </SidebarHeader>\n\n      <SidebarContent>\n        {/* Client Portal - for clients only */}\n        {isClient && (\n          <SidebarGroup>\n            <SidebarGroupLabel>{t(\"client.myProjects\")}</SidebarGroupLabel>\n            <SidebarGroupContent>\n              <SidebarMenu>\n                {clientMenuItems.map((item) => (\n                  <SidebarMenuItem key={item.title}>\n                    <SidebarMenuButton\n                      asChild\n                      isActive={location === item.url}\n                    >\n                      <Link href={item.url} data-testid={`nav-${item.url.slice(1)}`}>\n                        <item.icon className=\"h-4 w-4\" />\n                        <span>{item.title}</span>\n                      </Link>\n                    </SidebarMenuButton>\n                  </SidebarMenuItem>\n                ))}\n              </SidebarMenu>\n            </SidebarGroupContent>\n          </SidebarGroup>\n        )}\n\n        {/* SuperAdmin sees ONLY platform management */}\n        {isSuperAdmin && (\n          <SidebarGroup>\n            <SidebarGroupLabel>{t(\"admin.platformManagement\", \"Gesto da Plataforma\")}</SidebarGroupLabel>\n            <SidebarGroupContent>\n              <SidebarMenu>\n                <SidebarMenuItem>\n                  <SidebarMenuButton\n                    asChild\n                    isActive={location === \"/dashboard\"}\n                  >\n                    <Link href=\"/dashboard\" data-testid=\"nav-dashboard\">\n                      <LayoutDashboard className=\"h-4 w-4\" />\n                      <span>{t(\"nav.dashboard\")}</span>\n                    </Link>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n                {superAdminMenuItems.map((item) => (\n                  <SidebarMenuItem key={item.title}>\n                    <SidebarMenuButton\n                      asChild\n                      isActive={location === item.url || location.startsWith(item.url)}\n                    >\n                      <Link href={item.url} data-testid={`nav-${item.url.replace(/\\//g, '-').slice(1)}`}>\n                        <item.icon className=\"h-4 w-4\" />\n                        <span>{item.title}</span>\n                      </Link>\n                    </SidebarMenuButton>\n                  </SidebarMenuItem>\n                ))}\n              </SidebarMenu>\n            </SidebarGroupContent>\n          </SidebarGroup>\n        )}\n\n        {/* Regular employees see main menu */}\n        {!isClient && !isSuperAdmin && (\n          <SidebarGroup>\n            <SidebarGroupLabel>{t(\"nav.home\")}</SidebarGroupLabel>\n            <SidebarGroupContent>\n              <SidebarMenu>\n                {mainMenuItems.map((item) => (\n                  <SidebarMenuItem key={item.title}>\n                    <SidebarMenuButton\n                      asChild\n                      isActive={location === item.url}\n                    >\n                      <Link href={item.url} data-testid={`nav-${item.url.slice(1)}`}>\n                        <item.icon className=\"h-4 w-4\" />\n                        <span>{item.title}</span>\n                      </Link>\n                    </SidebarMenuButton>\n                  </SidebarMenuItem>\n                ))}\n              </SidebarMenu>\n            </SidebarGroupContent>\n          </SidebarGroup>\n        )}\n\n        {/* Tenant managers and admins see management section */}\n        {(isTenantManager || isTenantAdmin) && (\n          <SidebarGroup>\n            <SidebarGroupLabel>{t(\"nav.management\", \"Gesto\")}</SidebarGroupLabel>\n            <SidebarGroupContent>\n              <SidebarMenu>\n                {managerMenuItems.map((item) => (\n                  <SidebarMenuItem key={item.title}>\n                    <SidebarMenuButton\n                      asChild\n                      isActive={location === item.url}\n                    >\n                      <Link href={item.url} data-testid={`nav-${item.url.slice(1)}`}>\n                        <item.icon className=\"h-4 w-4\" />\n                        <span>{item.title}</span>\n                      </Link>\n                    </SidebarMenuButton>\n                  </SidebarMenuItem>\n                ))}\n              </SidebarMenu>\n            </SidebarGroupContent>\n          </SidebarGroup>\n        )}\n\n        {/* Tenant admins and managers see administration section */}\n        {(isTenantManager || isTenantAdmin) && (\n          <SidebarGroup>\n            <SidebarGroupLabel>{t(\"admin.title\")}</SidebarGroupLabel>\n            <SidebarGroupContent>\n              <SidebarMenu>\n                {adminMenuItems.map((item) => (\n                  <SidebarMenuItem key={item.title}>\n                    <SidebarMenuButton\n                      asChild\n                      isActive={location === item.url || location.startsWith(item.url)}\n                    >\n                      <Link href={item.url} data-testid={`nav-${item.url.replace(/\\//g, '-').slice(1)}`}>\n                        <item.icon className=\"h-4 w-4\" />\n                        <span>{item.title}</span>\n                      </Link>\n                    </SidebarMenuButton>\n                  </SidebarMenuItem>\n                ))}\n              </SidebarMenu>\n            </SidebarGroupContent>\n          </SidebarGroup>\n        )}\n\n        <SidebarGroup>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              <SidebarMenuItem>\n                <SidebarMenuButton\n                  asChild\n                  isActive={location === \"/settings\"}\n                >\n                  <Link href=\"/settings\" data-testid=\"nav-settings\">\n                    <Settings className=\"h-4 w-4\" />\n                    <span>{t(\"nav.settings\")}</span>\n                  </Link>\n                </SidebarMenuButton>\n              </SidebarMenuItem>\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n      </SidebarContent>\n\n      <SidebarFooter className=\"p-4\">\n        <div className=\"flex items-center gap-3\">\n          <Avatar>\n            <AvatarImage src={user?.profileImageUrl || undefined} />\n            <AvatarFallback>{getInitials()}</AvatarFallback>\n          </Avatar>\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center gap-2 flex-wrap\">\n              <p className=\"text-sm font-medium truncate\">\n                {user?.firstName} {user?.lastName}\n              </p>\n              {getRoleBadge()}\n            </div>\n            <p className=\"text-xs text-muted-foreground truncate\">{user?.email}</p>\n          </div>\n          <Button\n            size=\"icon\"\n            variant=\"ghost\"\n            onClick={() => logout()}\n            data-testid=\"button-logout\"\n          >\n            <LogOut className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </SidebarFooter>\n    </Sidebar>\n  );\n}\n","path":null,"size_bytes":10824,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/pages/Dashboard.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Link } from \"wouter\";\nimport {\n  Users,\n  Clock,\n  CheckCircle,\n  Wrench,\n  TrendingUp,\n  Calendar,\n  AlertTriangle,\n  ArrowRight,\n} from \"lucide-react\";\n\ninterface DashboardStats {\n  activeWorkers: number;\n  hoursToday: number;\n  pendingApprovals: number;\n  toolsOut: number;\n}\n\nexport default function Dashboard() {\n  const { t } = useTranslation();\n  const { user } = useAuth();\n\n  const { data: stats, isLoading } = useQuery<DashboardStats>({\n    queryKey: [\"/api/dashboard/stats\"],\n  });\n\n  const statCards = [\n    {\n      title: t(\"dashboard.activeWorkers\"),\n      value: stats?.activeWorkers ?? 0,\n      icon: Users,\n      color: \"text-blue-500\",\n      bg: \"bg-blue-500/10\",\n    },\n    {\n      title: t(\"dashboard.hoursToday\"),\n      value: stats?.hoursToday ?? 0,\n      icon: Clock,\n      color: \"text-green-500\",\n      bg: \"bg-green-500/10\",\n    },\n    {\n      title: t(\"dashboard.pendingApprovals\"),\n      value: stats?.pendingApprovals ?? 0,\n      icon: CheckCircle,\n      color: \"text-orange-500\",\n      bg: \"bg-orange-500/10\",\n    },\n    {\n      title: t(\"dashboard.toolsOut\"),\n      value: stats?.toolsOut ?? 0,\n      icon: Wrench,\n      color: \"text-purple-500\",\n      bg: \"bg-purple-500/10\",\n    },\n  ];\n\n  const quickActions = [\n    { label: t(\"time.clockIn\"), href: \"/time-tracking\", icon: Clock },\n    { label: t(\"tools.scanQr\"), href: \"/tools\", icon: Wrench },\n    { label: t(\"leave.request\"), href: \"/leave\", icon: Calendar },\n  ];\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-2xl font-bold\" data-testid=\"text-dashboard-title\">\n          {t(\"dashboard.welcome\")}, {user?.firstName || \"User\"}\n        </h1>\n        <p className=\"text-muted-foreground\">{t(\"dashboard.todayOverview\")}</p>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        {statCards.map((stat, index) => (\n          <Card key={index} data-testid={`card-stat-${index}`}>\n            <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                {stat.title}\n              </CardTitle>\n              <div className={`p-2 rounded-md ${stat.bg}`}>\n                <stat.icon className={`h-4 w-4 ${stat.color}`} />\n              </div>\n            </CardHeader>\n            <CardContent>\n              {isLoading ? (\n                <Skeleton className=\"h-8 w-16\" />\n              ) : (\n                <div className=\"text-2xl font-bold\" data-testid={`text-stat-value-${index}`}>\n                  {stat.value}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2\">\n            <CardTitle>{t(\"dashboard.quickActions\")}</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-2\">\n            {quickActions.map((action, index) => (\n              <Link key={index} href={action.href}>\n                <Button\n                  variant=\"outline\"\n                  className=\"w-full justify-between\"\n                  data-testid={`button-quick-action-${index}`}\n                >\n                  <span className=\"flex items-center gap-2\">\n                    <action.icon className=\"h-4 w-4\" />\n                    {action.label}\n                  </span>\n                  <ArrowRight className=\"h-4 w-4\" />\n                </Button>\n              </Link>\n            ))}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2\">\n            <CardTitle>{t(\"dashboard.recentActivity\")}</CardTitle>\n            <Link href=\"/time-records\">\n              <Button variant=\"ghost\" size=\"sm\" data-testid=\"button-view-all-activity\">\n                {t(\"dashboard.viewAll\")}\n              </Button>\n            </Link>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              {isLoading ? (\n                Array.from({ length: 3 }).map((_, i) => (\n                  <div key={i} className=\"flex items-center gap-3\">\n                    <Skeleton className=\"h-10 w-10 rounded-full\" />\n                    <div className=\"space-y-1 flex-1\">\n                      <Skeleton className=\"h-4 w-32\" />\n                      <Skeleton className=\"h-3 w-24\" />\n                    </div>\n                  </div>\n                ))\n              ) : (\n                <div className=\"text-sm text-muted-foreground text-center py-8\">\n                  {t(\"common.loading\")}\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":5214,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"client/src/components/LanguageSelector.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Globe } from \"lucide-react\";\n\nconst languages = [\n  { code: \"en\", name: \"English\", flag: \"GB\" },\n  { code: \"pt\", name: \"Portugus\", flag: \"PT\" },\n  { code: \"nl\", name: \"Nederlands\", flag: \"NL\" },\n  { code: \"fr\", name: \"Franais\", flag: \"FR\" },\n];\n\nexport function LanguageSelector() {\n  const { i18n } = useTranslation();\n\n  const handleChange = (value: string) => {\n    i18n.changeLanguage(value);\n    localStorage.setItem(\"language\", value);\n  };\n\n  return (\n    <Select value={i18n.language} onValueChange={handleChange}>\n      <SelectTrigger className=\"w-auto gap-2\" data-testid=\"select-language\">\n        <Globe className=\"h-4 w-4\" />\n        <SelectValue />\n      </SelectTrigger>\n      <SelectContent>\n        {languages.map((lang) => (\n          <SelectItem key={lang.code} value={lang.code} data-testid={`select-language-${lang.code}`}>\n            {lang.name}\n          </SelectItem>\n        ))}\n      </SelectContent>\n    </Select>\n  );\n}\n","path":null,"size_bytes":1124,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":547,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"client/src/pages/Leave.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  Calendar as CalendarIcon,\n  Plus,\n  Umbrella,\n  Stethoscope,\n  User,\n  CircleDollarSign,\n  Check,\n  X,\n} from \"lucide-react\";\nimport { format, differenceInDays } from \"date-fns\";\nimport type { LeaveRequest } from \"@shared/schema\";\n\nexport default function Leave() {\n  const { t } = useTranslation();\n  const { user, isManager } = useAuth();\n  const { toast } = useToast();\n  const [showRequestDialog, setShowRequestDialog] = useState(false);\n  const [leaveType, setLeaveType] = useState(\"vacation\");\n  const [startDate, setStartDate] = useState<Date | undefined>();\n  const [endDate, setEndDate] = useState<Date | undefined>();\n  const [reason, setReason] = useState(\"\");\n\n  const { data: myRequests, isLoading: loadingMy } = useQuery<LeaveRequest[]>({\n    queryKey: [\"/api/leave-requests/my\"],\n  });\n\n  const { data: teamRequests, isLoading: loadingTeam } = useQuery<LeaveRequest[]>({\n    queryKey: [\"/api/leave-requests/team\"],\n    enabled: isManager,\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: { type: string; startDate: Date; endDate: Date; reason: string }) => {\n      return apiRequest(\"POST\", \"/api/leave-requests\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/leave-requests/my\"] });\n      toast({ title: t(\"leave.request\"), description: \"Request submitted successfully\" });\n      setShowRequestDialog(false);\n      resetForm();\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to submit request\", variant: \"destructive\" });\n    },\n  });\n\n  const approveMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest(\"POST\", `/api/leave-requests/${id}/approve`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/leave-requests/team\"] });\n      toast({ title: t(\"common.approved\"), description: \"Request approved\" });\n    },\n  });\n\n  const rejectMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest(\"POST\", `/api/leave-requests/${id}/reject`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/leave-requests/team\"] });\n      toast({ title: t(\"common.rejected\"), description: \"Request rejected\" });\n    },\n  });\n\n  const resetForm = () => {\n    setLeaveType(\"vacation\");\n    setStartDate(undefined);\n    setEndDate(undefined);\n    setReason(\"\");\n  };\n\n  const leaveTypes = [\n    { value: \"vacation\", label: t(\"leave.vacation\"), icon: Umbrella },\n    { value: \"sick\", label: t(\"leave.sick\"), icon: Stethoscope },\n    { value: \"personal\", label: t(\"leave.personal\"), icon: User },\n    { value: \"unpaid\", label: t(\"leave.unpaid\"), icon: CircleDollarSign },\n  ];\n\n  const getStatusBadge = (status: string) => {\n    const variants: Record<string, \"default\" | \"secondary\" | \"destructive\"> = {\n      pending: \"secondary\",\n      approved: \"default\",\n      rejected: \"destructive\",\n    };\n    return <Badge variant={variants[status] || \"secondary\"}>{t(`common.${status}`)}</Badge>;\n  };\n\n  const getTypeIcon = (type: string) => {\n    const config = leaveTypes.find((lt) => lt.value === type);\n    const Icon = config?.icon || Umbrella;\n    return <Icon className=\"h-4 w-4\" />;\n  };\n\n  const daysCount = startDate && endDate ? differenceInDays(endDate, startDate) + 1 : 0;\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <h1 className=\"text-2xl font-bold\">{t(\"nav.leave\")}</h1>\n        <Button onClick={() => setShowRequestDialog(true)} data-testid=\"button-request-leave\">\n          <Plus className=\"mr-2 h-4 w-4\" />\n          {t(\"leave.request\")}\n        </Button>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n              {t(\"leave.balance\")}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-3xl font-bold\" data-testid=\"text-vacation-balance\">\n              {user?.vacationDaysBalance ?? 22}\n            </div>\n            <p className=\"text-sm text-muted-foreground\">{t(\"leave.daysRemaining\")}</p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n              {t(\"common.pending\")}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-3xl font-bold\">\n              {myRequests?.filter((r) => r.status === \"pending\").length ?? 0}\n            </div>\n            <p className=\"text-sm text-muted-foreground\">{t(\"leave.myRequests\")}</p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n              {t(\"common.approved\")}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-3xl font-bold\">\n              {myRequests?.filter((r) => r.status === \"approved\").length ?? 0}\n            </div>\n            <p className=\"text-sm text-muted-foreground\">{t(\"leave.myRequests\")}</p>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Tabs defaultValue=\"my\">\n        <TabsList>\n          <TabsTrigger value=\"my\">{t(\"leave.myRequests\")}</TabsTrigger>\n          {isManager && <TabsTrigger value=\"team\">{t(\"leave.teamRequests\")}</TabsTrigger>}\n        </TabsList>\n\n        <TabsContent value=\"my\" className=\"mt-4\">\n          <Card>\n            <CardContent className=\"p-0\">\n              {loadingMy ? (\n                <div className=\"p-4 space-y-4\">\n                  {Array.from({ length: 3 }).map((_, i) => (\n                    <Skeleton key={i} className=\"h-16 w-full\" />\n                  ))}\n                </div>\n              ) : myRequests?.length === 0 ? (\n                <div className=\"p-8 text-center text-muted-foreground\">\n                  No leave requests yet\n                </div>\n              ) : (\n                <div className=\"divide-y\">\n                  {myRequests?.map((request) => (\n                    <div\n                      key={request.id}\n                      className=\"p-4 flex items-center justify-between gap-4\"\n                      data-testid={`leave-request-${request.id}`}\n                    >\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"h-10 w-10 rounded-md bg-muted flex items-center justify-center\">\n                          {getTypeIcon(request.type)}\n                        </div>\n                        <div>\n                          <p className=\"font-medium\">{t(`leave.${request.type}`)}</p>\n                          <p className=\"text-sm text-muted-foreground\">\n                            {format(new Date(request.startDate), \"MMM d\")} -{\" \"}\n                            {format(new Date(request.endDate), \"MMM d, yyyy\")}\n                          </p>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"text-sm text-muted-foreground\">\n                          {request.daysCount} {t(\"common.days\")}\n                        </span>\n                        {getStatusBadge(request.status || \"pending\")}\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {isManager && (\n          <TabsContent value=\"team\" className=\"mt-4\">\n            <Card>\n              <CardContent className=\"p-0\">\n                {loadingTeam ? (\n                  <div className=\"p-4 space-y-4\">\n                    {Array.from({ length: 3 }).map((_, i) => (\n                      <Skeleton key={i} className=\"h-16 w-full\" />\n                    ))}\n                  </div>\n                ) : teamRequests?.length === 0 ? (\n                  <div className=\"p-8 text-center text-muted-foreground\">\n                    No pending team requests\n                  </div>\n                ) : (\n                  <div className=\"divide-y\">\n                    {teamRequests?.map((request) => (\n                      <div\n                        key={request.id}\n                        className=\"p-4 flex items-center justify-between gap-4\"\n                        data-testid={`team-leave-request-${request.id}`}\n                      >\n                        <div className=\"flex items-center gap-3\">\n                          <div className=\"h-10 w-10 rounded-md bg-muted flex items-center justify-center\">\n                            {getTypeIcon(request.type)}\n                          </div>\n                          <div>\n                            <p className=\"font-medium\">{t(`leave.${request.type}`)}</p>\n                            <p className=\"text-sm text-muted-foreground\">\n                              {format(new Date(request.startDate), \"MMM d\")} -{\" \"}\n                              {format(new Date(request.endDate), \"MMM d, yyyy\")}\n                            </p>\n                          </div>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          {request.status === \"pending\" ? (\n                            <>\n                              <Button\n                                size=\"sm\"\n                                onClick={() => approveMutation.mutate(request.id)}\n                                disabled={approveMutation.isPending}\n                                data-testid={`button-approve-${request.id}`}\n                              >\n                                <Check className=\"h-4 w-4\" />\n                              </Button>\n                              <Button\n                                size=\"sm\"\n                                variant=\"outline\"\n                                onClick={() => rejectMutation.mutate(request.id)}\n                                disabled={rejectMutation.isPending}\n                                data-testid={`button-reject-${request.id}`}\n                              >\n                                <X className=\"h-4 w-4\" />\n                              </Button>\n                            </>\n                          ) : (\n                            getStatusBadge(request.status || \"pending\")\n                          )}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n        )}\n      </Tabs>\n\n      <Dialog open={showRequestDialog} onOpenChange={setShowRequestDialog}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>{t(\"leave.request\")}</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Type</label>\n              <Select value={leaveType} onValueChange={setLeaveType}>\n                <SelectTrigger data-testid=\"select-leave-type\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  {leaveTypes.map((type) => (\n                    <SelectItem key={type.value} value={type.value}>\n                      <span className=\"flex items-center gap-2\">\n                        <type.icon className=\"h-4 w-4\" />\n                        {type.label}\n                      </span>\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"text-sm font-medium mb-2 block\">{t(\"leave.startDate\")}</label>\n                <Calendar\n                  mode=\"single\"\n                  selected={startDate}\n                  onSelect={setStartDate}\n                  className=\"rounded-md border\"\n                />\n              </div>\n              <div>\n                <label className=\"text-sm font-medium mb-2 block\">{t(\"leave.endDate\")}</label>\n                <Calendar\n                  mode=\"single\"\n                  selected={endDate}\n                  onSelect={setEndDate}\n                  disabled={(date) => (startDate ? date < startDate : false)}\n                  className=\"rounded-md border\"\n                />\n              </div>\n            </div>\n\n            {daysCount > 0 && (\n              <p className=\"text-sm text-muted-foreground text-center\">\n                {daysCount} {t(\"common.days\")}\n              </p>\n            )}\n\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">{t(\"leave.reason\")}</label>\n              <Textarea\n                value={reason}\n                onChange={(e) => setReason(e.target.value)}\n                placeholder={t(\"leave.reason\")}\n                data-testid=\"input-leave-reason\"\n              />\n            </div>\n\n            <div className=\"flex justify-end gap-2\">\n              <Button variant=\"outline\" onClick={() => setShowRequestDialog(false)}>\n                {t(\"common.cancel\")}\n              </Button>\n              <Button\n                onClick={() => {\n                  if (startDate && endDate) {\n                    createMutation.mutate({\n                      type: leaveType,\n                      startDate,\n                      endDate,\n                      reason,\n                    });\n                  }\n                }}\n                disabled={!startDate || !endDate || createMutation.isPending}\n                data-testid=\"button-submit-leave\"\n              >\n                {t(\"common.submit\")}\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":15004,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"shared/schema.ts":{"content":"import { sql, relations } from \"drizzle-orm\";\nimport {\n  pgTable,\n  text,\n  varchar,\n  integer,\n  boolean,\n  timestamp,\n  decimal,\n  jsonb,\n  index,\n} from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Session storage table for Replit Auth\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)],\n);\n\n// Tenants (Companies using the system)\nexport const tenants = pgTable(\"tenants\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: varchar(\"name\", { length: 255 }).notNull(),\n  logo: text(\"logo\"),\n  address: text(\"address\"),\n  phone: varchar(\"phone\", { length: 50 }),\n  email: varchar(\"email\", { length: 255 }),\n  subscriptionPlan: varchar(\"subscription_plan\", { length: 50 }).default(\"starter\"),\n  subscriptionStatus: varchar(\"subscription_status\", { length: 50 }).default(\"active\"),\n  stripeCustomerId: varchar(\"stripe_customer_id\"),\n  stripeSubscriptionId: varchar(\"stripe_subscription_id\"),\n  settings: jsonb(\"settings\").$type<{\n    geofenceRadius?: number;\n    requireSelfie?: boolean;\n    requirePin?: boolean;\n    defaultLanguage?: string;\n  }>(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Users (all user types)\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  tenantId: varchar(\"tenant_id\").references(() => tenants.id),\n  email: varchar(\"email\", { length: 255 }).unique(),\n  username: varchar(\"username\", { length: 100 }).unique(),\n  password: varchar(\"password\", { length: 255 }),\n  firstName: varchar(\"first_name\", { length: 100 }),\n  lastName: varchar(\"last_name\", { length: 100 }),\n  profileImageUrl: text(\"profile_image_url\"),\n  role: varchar(\"role\", { length: 50 }).notNull().default(\"employee\"), // superadmin, admin, manager, employee, client\n  pin: varchar(\"pin\", { length: 6 }),\n  phone: varchar(\"phone\", { length: 50 }),\n  language: varchar(\"language\", { length: 5 }).default(\"pt\"),\n  isActive: boolean(\"is_active\").default(true),\n  deviceId: varchar(\"device_id\"),\n  vacationDaysBalance: integer(\"vacation_days_balance\").default(22),\n  hourlyRate: decimal(\"hourly_rate\", { precision: 10, scale: 2 }),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Clients (construction clients)\nexport const clients = pgTable(\"clients\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  tenantId: varchar(\"tenant_id\").references(() => tenants.id).notNull(),\n  userId: varchar(\"user_id\").references(() => users.id),\n  name: varchar(\"name\", { length: 255 }).notNull(),\n  taxId: varchar(\"tax_id\", { length: 50 }),\n  address: text(\"address\"),\n  phone: varchar(\"phone\", { length: 50 }),\n  email: varchar(\"email\", { length: 255 }),\n  contactPerson: varchar(\"contact_person\", { length: 255 }),\n  type: varchar(\"type\", { length: 50 }).default(\"company\"), // residential, company\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Construction Sites (Obras)\nexport const sites = pgTable(\"sites\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  tenantId: varchar(\"tenant_id\").references(() => tenants.id).notNull(),\n  clientId: varchar(\"client_id\").references(() => clients.id).notNull(),\n  name: varchar(\"name\", { length: 255 }).notNull(),\n  address: text(\"address\").notNull(),\n  latitude: decimal(\"latitude\", { precision: 10, scale: 7 }),\n  longitude: decimal(\"longitude\", { precision: 10, scale: 7 }),\n  geofenceRadius: integer(\"geofence_radius\").default(100), // meters\n  startDate: timestamp(\"start_date\"),\n  endDate: timestamp(\"end_date\"),\n  workStartTime: varchar(\"work_start_time\", { length: 5 }).default(\"08:00\"),\n  workEndTime: varchar(\"work_end_time\", { length: 5 }).default(\"17:00\"),\n  billingType: varchar(\"billing_type\", { length: 50 }).default(\"hourly\"), // hourly, daily, fixed\n  hourlyRate: decimal(\"hourly_rate\", { precision: 10, scale: 2 }),\n  status: varchar(\"status\", { length: 50 }).default(\"active\"), // active, completed, paused\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Site Assignments (which employees work at which sites)\nexport const siteAssignments = pgTable(\"site_assignments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  siteId: varchar(\"site_id\").references(() => sites.id).notNull(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  role: varchar(\"role\", { length: 50 }).default(\"worker\"), // worker, supervisor\n  startDate: timestamp(\"start_date\").defaultNow(),\n  endDate: timestamp(\"end_date\"),\n  isActive: boolean(\"is_active\").default(true),\n});\n\n// Time Records (Ponto)\nexport const timeRecords = pgTable(\"time_records\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  tenantId: varchar(\"tenant_id\").references(() => tenants.id).notNull(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  siteId: varchar(\"site_id\").references(() => sites.id).notNull(),\n  checkInTime: timestamp(\"check_in_time\").notNull(),\n  checkOutTime: timestamp(\"check_out_time\"),\n  checkInLatitude: decimal(\"check_in_latitude\", { precision: 10, scale: 7 }),\n  checkInLongitude: decimal(\"check_in_longitude\", { precision: 10, scale: 7 }),\n  checkOutLatitude: decimal(\"check_out_latitude\", { precision: 10, scale: 7 }),\n  checkOutLongitude: decimal(\"check_out_longitude\", { precision: 10, scale: 7 }),\n  checkInPhoto: text(\"check_in_photo\"),\n  checkOutPhoto: text(\"check_out_photo\"),\n  checkInDeviceId: varchar(\"check_in_device_id\"),\n  checkOutDeviceId: varchar(\"check_out_device_id\"),\n  isOffline: boolean(\"is_offline\").default(false),\n  isWithinGeofence: boolean(\"is_within_geofence\").default(true),\n  status: varchar(\"status\", { length: 50 }).default(\"pending\"), // pending, approved, rejected, contested\n  totalHours: decimal(\"total_hours\", { precision: 5, scale: 2 }),\n  overtimeHours: decimal(\"overtime_hours\", { precision: 5, scale: 2 }),\n  breakMinutes: integer(\"break_minutes\").default(0),\n  notes: text(\"notes\"),\n  approvedBy: varchar(\"approved_by\").references(() => users.id),\n  approvedAt: timestamp(\"approved_at\"),\n  isSuspicious: boolean(\"is_suspicious\").default(false),\n  suspiciousReason: text(\"suspicious_reason\"),\n  clientValidated: boolean(\"client_validated\"),\n  clientValidatedAt: timestamp(\"client_validated_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Contestations (Client disputes)\nexport const contestations = pgTable(\"contestations\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  timeRecordId: varchar(\"time_record_id\").references(() => timeRecords.id).notNull(),\n  clientId: varchar(\"client_id\").references(() => clients.id).notNull(),\n  reason: text(\"reason\").notNull(),\n  severity: varchar(\"severity\", { length: 20 }).default(\"minor\"), // minor, significant\n  status: varchar(\"status\", { length: 50 }).default(\"pending\"), // pending, resolved, rejected\n  resolution: text(\"resolution\"),\n  resolvedBy: varchar(\"resolved_by\").references(() => users.id),\n  resolvedAt: timestamp(\"resolved_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Tools\nexport const tools = pgTable(\"tools\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  tenantId: varchar(\"tenant_id\").references(() => tenants.id).notNull(),\n  name: varchar(\"name\", { length: 255 }).notNull(),\n  category: varchar(\"category\", { length: 100 }),\n  serialNumber: varchar(\"serial_number\", { length: 100 }),\n  estimatedValue: decimal(\"estimated_value\", { precision: 10, scale: 2 }),\n  photo: text(\"photo\"),\n  qrCode: text(\"qr_code\"),\n  status: varchar(\"status\", { length: 50 }).default(\"available\"), // available, in_use, maintenance, lost, stolen\n  currentUserId: varchar(\"current_user_id\").references(() => users.id),\n  currentSiteId: varchar(\"current_site_id\").references(() => sites.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Tool Transactions\nexport const toolTransactions = pgTable(\"tool_transactions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  toolId: varchar(\"tool_id\").references(() => tools.id).notNull(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  siteId: varchar(\"site_id\").references(() => sites.id),\n  type: varchar(\"type\", { length: 50 }).notNull(), // checkout, checkin, lost, stolen, damaged\n  photo: text(\"photo\"),\n  notes: text(\"notes\"),\n  condition: varchar(\"condition\", { length: 50 }), // good, damaged\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Leave Requests (Frias e Ausncias)\nexport const leaveRequests = pgTable(\"leave_requests\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  tenantId: varchar(\"tenant_id\").references(() => tenants.id).notNull(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  type: varchar(\"type\", { length: 50 }).notNull(), // vacation, sick, personal, unpaid\n  startDate: timestamp(\"start_date\").notNull(),\n  endDate: timestamp(\"end_date\").notNull(),\n  isPartialDay: boolean(\"is_partial_day\").default(false),\n  status: varchar(\"status\", { length: 50 }).default(\"pending\"), // pending, approved, rejected, cancelled\n  reason: text(\"reason\"),\n  approvedBy: varchar(\"approved_by\").references(() => users.id),\n  approvedAt: timestamp(\"approved_at\"),\n  isPaid: boolean(\"is_paid\").default(true),\n  daysCount: integer(\"days_count\").default(1),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Payroll Records\nexport const payrollRecords = pgTable(\"payroll_records\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  tenantId: varchar(\"tenant_id\").references(() => tenants.id).notNull(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  periodStart: timestamp(\"period_start\").notNull(),\n  periodEnd: timestamp(\"period_end\").notNull(),\n  regularHours: decimal(\"regular_hours\", { precision: 6, scale: 2 }).default(\"0\"),\n  overtimeHours: decimal(\"overtime_hours\", { precision: 6, scale: 2 }).default(\"0\"),\n  nightHours: decimal(\"night_hours\", { precision: 6, scale: 2 }).default(\"0\"),\n  vacationDays: integer(\"vacation_days\").default(0),\n  sickDays: integer(\"sick_days\").default(0),\n  unpaidAbsenceDays: integer(\"unpaid_absence_days\").default(0),\n  totalAmount: decimal(\"total_amount\", { precision: 10, scale: 2 }),\n  status: varchar(\"status\", { length: 50 }).default(\"pending\"), // pending, paid, processing\n  paidAt: timestamp(\"paid_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Message Templates (for configurable notifications)\nexport const messageTemplates = pgTable(\"message_templates\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  tenantId: varchar(\"tenant_id\").references(() => tenants.id).notNull(),\n  type: varchar(\"type\", { length: 100 }).notNull(), // check_in_reminder, leave_approved, etc.\n  targetRole: varchar(\"target_role\", { length: 50 }).notNull(), // manager, employee, client\n  language: varchar(\"language\", { length: 5 }).notNull(),\n  subject: varchar(\"subject\", { length: 255 }),\n  body: text(\"body\").notNull(),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Notifications\nexport const notifications = pgTable(\"notifications\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  tenantId: varchar(\"tenant_id\").references(() => tenants.id).notNull(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  type: varchar(\"type\", { length: 100 }).notNull(), // late_arrival, tool_unreturned, contestation, leave_approved, etc.\n  title: varchar(\"title\", { length: 255 }).notNull(),\n  message: text(\"message\").notNull(),\n  data: jsonb(\"data\").$type<Record<string, unknown>>(),\n  isRead: boolean(\"is_read\").default(false),\n  readAt: timestamp(\"read_at\"),\n  priority: varchar(\"priority\", { length: 20 }).default(\"normal\"), // low, normal, high, urgent\n  channel: varchar(\"channel\", { length: 50 }).default(\"in_app\"), // in_app, push, email, sms\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// User notification preferences\nexport const notificationPreferences = pgTable(\"notification_preferences\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull().unique(),\n  emailEnabled: boolean(\"email_enabled\").default(true),\n  pushEnabled: boolean(\"push_enabled\").default(true),\n  smsEnabled: boolean(\"sms_enabled\").default(false),\n  timeReminders: boolean(\"time_reminders\").default(true),\n  lateAlerts: boolean(\"late_alerts\").default(true),\n  toolAlerts: boolean(\"tool_alerts\").default(true),\n  contestationAlerts: boolean(\"contestation_alerts\").default(true),\n  leaveAlerts: boolean(\"leave_alerts\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Site Documents (for document portal)\nexport const siteDocuments = pgTable(\"site_documents\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  tenantId: varchar(\"tenant_id\").references(() => tenants.id).notNull(),\n  siteId: varchar(\"site_id\").references(() => sites.id).notNull(),\n  name: varchar(\"name\", { length: 255 }).notNull(),\n  category: varchar(\"category\", { length: 100 }).notNull(), // plans, certificates, reports, contracts, safety\n  description: text(\"description\"),\n  fileUrl: text(\"file_url\").notNull(),\n  fileType: varchar(\"file_type\", { length: 50 }),\n  fileSize: integer(\"file_size\"),\n  version: integer(\"version\").default(1),\n  parentDocumentId: varchar(\"parent_document_id\"), // for versioning\n  uploadedBy: varchar(\"uploaded_by\").references(() => users.id).notNull(),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Chat Rooms (per site)\nexport const chatRooms = pgTable(\"chat_rooms\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  tenantId: varchar(\"tenant_id\").references(() => tenants.id).notNull(),\n  siteId: varchar(\"site_id\").references(() => sites.id).notNull(),\n  name: varchar(\"name\", { length: 255 }).notNull(),\n  type: varchar(\"type\", { length: 50 }).default(\"site\"), // site, direct, group\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Chat Room Participants\nexport const chatParticipants = pgTable(\"chat_participants\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  roomId: varchar(\"room_id\").references(() => chatRooms.id).notNull(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  role: varchar(\"role\", { length: 50 }).default(\"member\"), // admin, member\n  joinedAt: timestamp(\"joined_at\").defaultNow(),\n  lastReadAt: timestamp(\"last_read_at\"),\n});\n\n// Chat Messages\nexport const chatMessages = pgTable(\"chat_messages\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  roomId: varchar(\"room_id\").references(() => chatRooms.id).notNull(),\n  senderId: varchar(\"sender_id\").references(() => users.id).notNull(),\n  content: text(\"content\").notNull(),\n  type: varchar(\"type\", { length: 50 }).default(\"text\"), // text, image, file, system\n  attachmentUrl: text(\"attachment_url\"),\n  isEdited: boolean(\"is_edited\").default(false),\n  isDeleted: boolean(\"is_deleted\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Relations\nexport const tenantsRelations = relations(tenants, ({ many }) => ({\n  users: many(users),\n  clients: many(clients),\n  sites: many(sites),\n  tools: many(tools),\n}));\n\nexport const usersRelations = relations(users, ({ one, many }) => ({\n  tenant: one(tenants, {\n    fields: [users.tenantId],\n    references: [tenants.id],\n  }),\n  timeRecords: many(timeRecords),\n  siteAssignments: many(siteAssignments),\n  leaveRequests: many(leaveRequests),\n}));\n\nexport const clientsRelations = relations(clients, ({ one, many }) => ({\n  tenant: one(tenants, {\n    fields: [clients.tenantId],\n    references: [tenants.id],\n  }),\n  user: one(users, {\n    fields: [clients.userId],\n    references: [users.id],\n  }),\n  sites: many(sites),\n}));\n\nexport const sitesRelations = relations(sites, ({ one, many }) => ({\n  tenant: one(tenants, {\n    fields: [sites.tenantId],\n    references: [tenants.id],\n  }),\n  client: one(clients, {\n    fields: [sites.clientId],\n    references: [clients.id],\n  }),\n  timeRecords: many(timeRecords),\n  siteAssignments: many(siteAssignments),\n}));\n\nexport const timeRecordsRelations = relations(timeRecords, ({ one, many }) => ({\n  tenant: one(tenants, {\n    fields: [timeRecords.tenantId],\n    references: [tenants.id],\n  }),\n  user: one(users, {\n    fields: [timeRecords.userId],\n    references: [users.id],\n  }),\n  site: one(sites, {\n    fields: [timeRecords.siteId],\n    references: [sites.id],\n  }),\n  contestations: many(contestations),\n}));\n\nexport const toolsRelations = relations(tools, ({ one, many }) => ({\n  tenant: one(tenants, {\n    fields: [tools.tenantId],\n    references: [tenants.id],\n  }),\n  currentUser: one(users, {\n    fields: [tools.currentUserId],\n    references: [users.id],\n  }),\n  currentSite: one(sites, {\n    fields: [tools.currentSiteId],\n    references: [sites.id],\n  }),\n  transactions: many(toolTransactions),\n}));\n\n// Insert Schemas\nexport const insertTenantSchema = createInsertSchema(tenants).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertUserSchema = createInsertSchema(users).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertClientSchema = createInsertSchema(clients).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertSiteSchema = createInsertSchema(sites).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertTimeRecordSchema = createInsertSchema(timeRecords).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertContestationSchema = createInsertSchema(contestations).omit({ id: true, createdAt: true });\nexport const insertToolSchema = createInsertSchema(tools).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertToolTransactionSchema = createInsertSchema(toolTransactions).omit({ id: true, createdAt: true });\nexport const insertLeaveRequestSchema = createInsertSchema(leaveRequests).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertPayrollRecordSchema = createInsertSchema(payrollRecords).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertMessageTemplateSchema = createInsertSchema(messageTemplates).omit({ id: true, createdAt: true });\nexport const insertSiteAssignmentSchema = createInsertSchema(siteAssignments).omit({ id: true });\nexport const insertNotificationSchema = createInsertSchema(notifications).omit({ id: true, createdAt: true });\nexport const insertNotificationPreferencesSchema = createInsertSchema(notificationPreferences).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertSiteDocumentSchema = createInsertSchema(siteDocuments).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertChatRoomSchema = createInsertSchema(chatRooms).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertChatParticipantSchema = createInsertSchema(chatParticipants).omit({ id: true, joinedAt: true });\nexport const insertChatMessageSchema = createInsertSchema(chatMessages).omit({ id: true, createdAt: true, updatedAt: true });\n\n// Types\nexport type Tenant = typeof tenants.$inferSelect;\nexport type InsertTenant = z.infer<typeof insertTenantSchema>;\nexport type User = typeof users.$inferSelect;\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type UpsertUser = typeof users.$inferInsert;\nexport type Client = typeof clients.$inferSelect;\nexport type InsertClient = z.infer<typeof insertClientSchema>;\nexport type Site = typeof sites.$inferSelect;\nexport type InsertSite = z.infer<typeof insertSiteSchema>;\nexport type TimeRecord = typeof timeRecords.$inferSelect;\nexport type InsertTimeRecord = z.infer<typeof insertTimeRecordSchema>;\nexport type Contestation = typeof contestations.$inferSelect;\nexport type InsertContestation = z.infer<typeof insertContestationSchema>;\nexport type Tool = typeof tools.$inferSelect;\nexport type InsertTool = z.infer<typeof insertToolSchema>;\nexport type ToolTransaction = typeof toolTransactions.$inferSelect;\nexport type InsertToolTransaction = z.infer<typeof insertToolTransactionSchema>;\nexport type LeaveRequest = typeof leaveRequests.$inferSelect;\nexport type InsertLeaveRequest = z.infer<typeof insertLeaveRequestSchema>;\nexport type PayrollRecord = typeof payrollRecords.$inferSelect;\nexport type InsertPayrollRecord = z.infer<typeof insertPayrollRecordSchema>;\nexport type MessageTemplate = typeof messageTemplates.$inferSelect;\nexport type InsertMessageTemplate = z.infer<typeof insertMessageTemplateSchema>;\nexport type SiteAssignment = typeof siteAssignments.$inferSelect;\nexport type InsertSiteAssignment = z.infer<typeof insertSiteAssignmentSchema>;\nexport type Notification = typeof notifications.$inferSelect;\nexport type InsertNotification = z.infer<typeof insertNotificationSchema>;\nexport type NotificationPreferences = typeof notificationPreferences.$inferSelect;\nexport type InsertNotificationPreferences = z.infer<typeof insertNotificationPreferencesSchema>;\nexport type SiteDocument = typeof siteDocuments.$inferSelect;\nexport type InsertSiteDocument = z.infer<typeof insertSiteDocumentSchema>;\nexport type ChatRoom = typeof chatRooms.$inferSelect;\nexport type InsertChatRoom = z.infer<typeof insertChatRoomSchema>;\nexport type ChatParticipant = typeof chatParticipants.$inferSelect;\nexport type InsertChatParticipant = z.infer<typeof insertChatParticipantSchema>;\nexport type ChatMessage = typeof chatMessages.$inferSelect;\nexport type InsertChatMessage = z.infer<typeof insertChatMessageSchema>;\n","path":null,"size_bytes":22442,"size_tokens":null},"client/src/lib/i18n.ts":{"content":"import i18n from 'i18next';\nimport { initReactI18next } from 'react-i18next';\n\nconst resources = {\n  en: {\n    translation: {\n      // Common\n      common: {\n        loading: 'Loading...',\n        save: 'Save',\n        cancel: 'Cancel',\n        delete: 'Delete',\n        edit: 'Edit',\n        add: 'Add',\n        search: 'Search',\n        filter: 'Filter',\n        export: 'Export',\n        back: 'Back',\n        next: 'Next',\n        submit: 'Submit',\n        confirm: 'Confirm',\n        close: 'Close',\n        yes: 'Yes',\n        no: 'No',\n        actions: 'Actions',\n        status: 'Status',\n        date: 'Date',\n        time: 'Time',\n        total: 'Total',\n        details: 'Details',\n        view: 'View',\n        approve: 'Approve',\n        reject: 'Reject',\n        pending: 'Pending',\n        approved: 'Approved',\n        rejected: 'Rejected',\n        hours: 'Hours',\n        minutes: 'Minutes',\n        days: 'Days',\n      },\n      // Navigation\n      nav: {\n        home: 'Home',\n        dashboard: 'Dashboard',\n        sites: 'Sites',\n        employees: 'Employees',\n        clients: 'Clients',\n        tools: 'Tools',\n        timeRecords: 'Time Records',\n        leave: 'Leave',\n        payroll: 'Payroll',\n        settings: 'Settings',\n        reports: 'Reports',\n        profile: 'Profile',\n        logout: 'Log Out',\n        login: 'Log In',\n        analytics: 'Analytics',\n        documents: 'Documents',\n        chat: 'Chat',\n      },\n      // Landing Page\n      landing: {\n        hero: {\n          title: 'Construction Site Management Made Simple',\n          subtitle: 'Track time, manage tools, and streamline payroll with our comprehensive solution for construction companies.',\n          cta: 'Start Free Trial',\n          demo: 'Watch Demo',\n        },\n        features: {\n          title: 'Everything You Need',\n          subtitle: 'Powerful features designed for the construction industry',\n          gps: {\n            title: 'GPS Time Tracking',\n            description: 'Verify employee presence with geofenced check-ins and photo evidence.',\n          },\n          tools: {\n            title: 'Tool Management',\n            description: 'Track equipment with QR codes and prevent loss or theft.',\n          },\n          client: {\n            title: 'Client Portal',\n            description: 'Let clients validate hours worked and resolve disputes transparently.',\n          },\n          payroll: {\n            title: 'Simple Payroll',\n            description: 'Calculate hours, overtime, and generate payment reports effortlessly.',\n          },\n          antifraud: {\n            title: 'Anti-Fraud Protection',\n            description: 'Prevent buddy punching with selfies, PIN codes, and device binding.',\n          },\n          multilang: {\n            title: 'Multi-Language',\n            description: 'Available in English, Portuguese, Dutch, and French.',\n          },\n        },\n        pricing: {\n          title: 'Simple, Transparent Pricing',\n          subtitle: 'Choose the plan that fits your business',\n          monthly: 'Monthly',\n          yearly: 'Yearly',\n          starter: {\n            name: 'Starter',\n            price: '29',\n            description: 'Perfect for small teams',\n            features: ['Up to 10 employees', 'GPS time tracking', 'Basic reports', 'Email support'],\n          },\n          professional: {\n            name: 'Professional',\n            price: '79',\n            description: 'For growing companies',\n            features: ['Up to 50 employees', 'Tool management', 'Client portal', 'Advanced reports', 'Priority support'],\n            popular: 'Most Popular',\n          },\n          enterprise: {\n            name: 'Enterprise',\n            price: '199',\n            description: 'For large organizations',\n            features: ['Unlimited employees', 'Custom integrations', 'Dedicated support', 'API access', 'Multi-site management'],\n          },\n          perMonth: '/month',\n          getStarted: 'Get Started',\n          contactSales: 'Contact Sales',\n        },\n        testimonials: {\n          title: 'Trusted by Construction Companies',\n          subtitle: 'See what our customers have to say',\n        },\n        faq: {\n          title: 'Frequently Asked Questions',\n          q1: 'How does the GPS tracking work?',\n          a1: 'Employees check in using their mobile phone. The app captures their GPS location and optionally a selfie, ensuring they are at the work site.',\n          q2: 'Can clients access the system?',\n          a2: 'Yes! Clients have their own portal where they can view hours worked, validate records, and submit contestations if needed.',\n          q3: 'Is there a free trial?',\n          a3: 'Yes, we offer a 14-day free trial with full access to all features. No credit card required.',\n          q4: 'How is payroll calculated?',\n          a4: 'The system automatically tracks regular hours, overtime, and absences. You can export reports or integrate with your existing payroll system.',\n        },\n        cta: {\n          title: 'Ready to Streamline Your Operations?',\n          subtitle: 'Join hundreds of construction companies already using our platform.',\n          button: 'Start Your Free Trial',\n        },\n        footer: {\n          product: 'Product',\n          company: 'Company',\n          resources: 'Resources',\n          contact: 'Contact',\n          features: 'Features',\n          pricing: 'Pricing',\n          about: 'About Us',\n          blog: 'Blog',\n          help: 'Help Center',\n          api: 'API Docs',\n          privacy: 'Privacy Policy',\n          terms: 'Terms of Service',\n          copyright: ' 2024 ConstructTrack. All rights reserved.',\n        },\n      },\n      // Dashboard\n      dashboard: {\n        welcome: 'Welcome back',\n        todayOverview: \"Today's Overview\",\n        activeWorkers: 'Active Workers',\n        hoursToday: 'Hours Today',\n        pendingApprovals: 'Pending Approvals',\n        toolsOut: 'Tools Checked Out',\n        recentActivity: 'Recent Activity',\n        quickActions: 'Quick Actions',\n        viewAll: 'View All',\n      },\n      // Time Tracking\n      time: {\n        clockIn: 'Clock In',\n        clockOut: 'Clock Out',\n        currentlyWorking: 'Currently Working',\n        notClockedIn: 'Not Clocked In',\n        startBreak: 'Start Break',\n        endBreak: 'End Break',\n        onBreak: 'On Break',\n        hoursWorked: 'Hours Worked',\n        overtime: 'Overtime',\n        location: 'Location',\n        photo: 'Photo',\n        withinGeofence: 'Within site area',\n        outsideGeofence: 'Outside site area',\n        selectSite: 'Select Site',\n        confirmCheckIn: 'Confirm Check-In',\n        confirmCheckOut: 'Confirm Check-Out',\n        takeSelfie: 'Take Selfie',\n        enterPin: 'Enter your PIN',\n        offlineMode: 'Offline Mode - Will sync when connected',\n      },\n      // Tools\n      tools: {\n        inventory: 'Tool Inventory',\n        available: 'Available',\n        inUse: 'In Use',\n        maintenance: 'Maintenance',\n        lost: 'Lost',\n        stolen: 'Stolen',\n        checkout: 'Check Out',\n        checkin: 'Check In',\n        scanQr: 'Scan QR Code',\n        assignedTo: 'Assigned To',\n        history: 'History',\n        reportIssue: 'Report Issue',\n        condition: 'Condition',\n        good: 'Good',\n        damaged: 'Damaged',\n      },\n      // Leave\n      leave: {\n        request: 'Request Leave',\n        vacation: 'Vacation',\n        sick: 'Sick Leave',\n        personal: 'Personal',\n        unpaid: 'Unpaid Leave',\n        balance: 'Balance',\n        daysRemaining: 'Days Remaining',\n        startDate: 'Start Date',\n        endDate: 'End Date',\n        reason: 'Reason',\n        myRequests: 'My Requests',\n        teamRequests: 'Team Requests',\n      },\n      // Payroll\n      payroll: {\n        period: 'Pay Period',\n        regularHours: 'Regular Hours',\n        overtimeHours: 'Overtime Hours',\n        nightHours: 'Night Hours',\n        vacationDays: 'Vacation Days',\n        sickDays: 'Sick Days',\n        unpaidDays: 'Unpaid Days',\n        totalAmount: 'Total Amount',\n        paid: 'Paid',\n        processing: 'Processing',\n        markAsPaid: 'Mark as Paid',\n      },\n      // Client Portal\n      client: {\n        myProjects: 'My Projects',\n        hoursThisMonth: 'Hours This Month',\n        pendingValidation: 'Pending Validation',\n        totalCost: 'Total Cost',\n        validateHours: 'Validate Hours',\n        contest: 'Contest',\n        contestReason: 'Reason for Contestation',\n        viewEvidence: 'View Evidence',\n        approveAll: 'Approve All',\n      },\n      // Settings\n      settings: {\n        company: 'Company Settings',\n        profile: 'Profile',\n        notifications: 'Notifications',\n        language: 'Language',\n        security: 'Security',\n        billing: 'Billing',\n        geofence: 'Geofence Radius',\n        requireSelfie: 'Require Selfie',\n        requirePin: 'Require PIN',\n      },\n      // Sites\n      sites: {\n        addSite: 'Add Site',\n        editSite: 'Edit Site',\n        siteName: 'Site Name',\n        address: 'Address',\n        client: 'Client',\n        workers: 'Workers',\n        workHours: 'Work Hours',\n        billingType: 'Billing Type',\n        hourly: 'Hourly',\n        daily: 'Daily',\n        fixed: 'Fixed Price',\n        active: 'Active',\n        completed: 'Completed',\n        paused: 'Paused',\n      },\n      // Employees\n      employees: {\n        addEmployee: 'Add Employee',\n        role: 'Role',\n        admin: 'Administrator',\n        manager: 'Manager',\n        employee: 'Employee',\n        hourlyRate: 'Hourly Rate',\n        assignToSite: 'Assign to Site',\n        vacationBalance: 'Vacation Balance',\n      },\n      notifications: {\n        title: 'Notifications',\n        markAllRead: 'Mark all read',\n        empty: 'No notifications',\n        viewAll: 'View all notifications',\n        preferences: {\n          title: 'Notification Preferences',\n          email: 'Email Notifications',\n          push: 'Push Notifications',\n          sms: 'SMS Notifications',\n          timeReminders: 'Time Reminders',\n          lateAlerts: 'Late Arrival Alerts',\n          toolAlerts: 'Tool Alerts',\n          contestationAlerts: 'Contestation Alerts',\n          leaveAlerts: 'Leave Request Alerts',\n          updateSuccess: 'Preferences updated successfully',\n          updateError: 'Failed to update preferences',\n        },\n      },\n      analytics: {\n        title: 'Analytics',\n        subtitle: 'Insights and reports for your construction business',\n        productivity: 'Productivity',\n        totalHours: 'Total Hours',\n        activeSites: 'Active Sites',\n        totalTools: 'Total Tools',\n        employeeCount: 'Employees',\n        hoursTrend: 'Hours Trend (Last 30 Days)',\n        hoursBySite: 'Hours by Site',\n        regularHours: 'Regular Hours',\n        overtimeHours: 'Overtime Hours',\n        toolStatus: 'Tool Status Distribution',\n        toolsByCategory: 'Tools by Category',\n        count: 'Count',\n        payrollTrend: 'Payroll Trend (Last 6 Months)',\n        totalPaid: 'Total Paid',\n        totalPending: 'Total Pending',\n        amount: 'Amount',\n        noData: 'No data available',\n      },\n      documents: {\n        title: 'Documents',\n        subtitle: 'Manage site plans, certificates, and project documents',\n        upload: 'Upload',\n        uploadDocument: 'Upload Document',\n        selectSite: 'Select Site',\n        allSites: 'All Sites',\n        category: 'Category',\n        allCategories: 'All Categories',\n        description: 'Description',\n        descriptionPlaceholder: 'Enter a description for this document...',\n        file: 'File',\n        download: 'Download',\n        versions: 'Versions',\n        versionHistory: 'Version History',\n        currentVersion: 'Current Version',\n        noVersions: 'No previous versions',\n        noDocuments: 'No documents found',\n        uploadSuccess: 'Document uploaded successfully',\n        uploadError: 'Failed to upload document',\n        deleteSuccess: 'Document deleted successfully',\n        deleteError: 'Failed to delete document',\n        categories: {\n          plans: 'Plans',\n          certificates: 'Certificates',\n          reports: 'Reports',\n          contracts: 'Contracts',\n          safety: 'Safety',\n        },\n      },\n      chat: {\n        title: 'Chat',\n        subtitle: 'Real-time messaging with your team',\n        selectSite: 'Select a site',\n        noRooms: 'No chat rooms yet',\n        selectSiteToStart: 'Select a site to start a conversation',\n        siteChat: 'Site Chat',\n        online: 'Online',\n        noMessages: 'No messages yet',\n        startConversation: 'Send a message to start the conversation',\n        selectRoom: 'Select a chat room',\n        selectRoomDescription: 'Choose a site from the left to start chatting',\n        typeMessage: 'Type a message...',\n        unknownUser: 'Unknown User',\n        sendError: 'Failed to send message',\n      },\n      pwa: {\n        title: 'Install App',\n        description: 'Install ConstructTrack on your phone for quick access',\n        install: 'Install',\n        iosDescription: 'To install on iPhone/iPad:',\n        iosStep1: 'Tap',\n        iosShareButton: '(Share)',\n        iosStep2: 'Choose',\n        iosAddToHome: \"'Add to Home Screen'\",\n        iosStep3: \"Confirm by tapping 'Add'\",\n        understood: 'Got it',\n        androidInstructions: \"Use the browser menu and select 'Install app' or 'Add to home screen'\",\n      },\n      access: {\n        denied: 'Access Denied',\n        noPermission: 'You do not have permission to access this page.',\n        goToDashboard: 'Go to Dashboard',\n      },\n      admin: {\n        title: 'Administration',\n        userManagement: 'User Management',\n        siteManagement: 'Site Management',\n        clientManagement: 'Client Management',\n        toolManagement: 'Tool Management',\n        timesheets: 'Timesheets',\n        leaveApprovals: 'Leave Approvals',\n        companySettings: 'Company Settings',\n        serviceOrders: 'Service Orders',\n        subscriptions: 'Subscriptions',\n        addUser: 'Add User',\n        addSite: 'Add Site',\n        addClient: 'Add Client',\n        addTool: 'Add Tool',\n      },\n      roles: {\n        superadmin: 'Super Admin',\n        admin: 'Administrator',\n        manager: 'Manager',\n        employee: 'Employee',\n        client: 'Client',\n      },\n    },\n  },\n  pt: {\n    translation: {\n      common: {\n        loading: 'A carregar...',\n        save: 'Guardar',\n        cancel: 'Cancelar',\n        delete: 'Eliminar',\n        edit: 'Editar',\n        add: 'Adicionar',\n        search: 'Pesquisar',\n        filter: 'Filtrar',\n        export: 'Exportar',\n        back: 'Voltar',\n        next: 'Prximo',\n        submit: 'Submeter',\n        confirm: 'Confirmar',\n        close: 'Fechar',\n        yes: 'Sim',\n        no: 'No',\n        actions: 'Aes',\n        status: 'Estado',\n        date: 'Data',\n        time: 'Hora',\n        total: 'Total',\n        details: 'Detalhes',\n        view: 'Ver',\n        approve: 'Aprovar',\n        reject: 'Rejeitar',\n        pending: 'Pendente',\n        approved: 'Aprovado',\n        rejected: 'Rejeitado',\n        hours: 'Horas',\n        minutes: 'Minutos',\n        days: 'Dias',\n      },\n      nav: {\n        home: 'Incio',\n        dashboard: 'Painel',\n        sites: 'Obras',\n        employees: 'Funcionrios',\n        clients: 'Clientes',\n        tools: 'Ferramentas',\n        timeRecords: 'Registos de Ponto',\n        leave: 'Frias',\n        payroll: 'Folha de Pagamento',\n        settings: 'Definies',\n        reports: 'Relatrios',\n        profile: 'Perfil',\n        logout: 'Terminar Sesso',\n        login: 'Iniciar Sesso',\n        analytics: 'Anlises',\n        documents: 'Documentos',\n        chat: 'Chat',\n      },\n      landing: {\n        hero: {\n          title: 'Gesto de Obras Simplificada',\n          subtitle: 'Controle horas, gerencie ferramentas e simplifique a folha de pagamento com a nossa soluo completa para empresas de construo.',\n          cta: 'Comear Teste Grtis',\n          demo: 'Ver Demonstrao',\n        },\n        features: {\n          title: 'Tudo o Que Precisa',\n          subtitle: 'Funcionalidades poderosas para a indstria da construo',\n          gps: {\n            title: 'Registo com GPS',\n            description: 'Verifique a presena dos funcionrios com check-in geolocalizado e foto.',\n          },\n          tools: {\n            title: 'Gesto de Ferramentas',\n            description: 'Controle equipamentos com QR codes e previna perdas ou roubos.',\n          },\n          client: {\n            title: 'Portal do Cliente',\n            description: 'Permita que clientes validem horas e resolvam disputas de forma transparente.',\n          },\n          payroll: {\n            title: 'Folha Simplificada',\n            description: 'Calcule horas, extras e gere relatrios de pagamento sem esforo.',\n          },\n          antifraud: {\n            title: 'Proteo Antifraude',\n            description: 'Previna fraudes com selfies, cdigos PIN e vinculao de dispositivos.',\n          },\n          multilang: {\n            title: 'Multi-Idiomas',\n            description: 'Disponvel em Portugus, Ingls, Holands e Francs.',\n          },\n        },\n        pricing: {\n          title: 'Preos Simples e Transparentes',\n          subtitle: 'Escolha o plano ideal para o seu negcio',\n          monthly: 'Mensal',\n          yearly: 'Anual',\n          starter: {\n            name: 'Iniciante',\n            price: '29',\n            description: 'Perfeito para pequenas equipas',\n            features: ['At 10 funcionrios', 'Registo com GPS', 'Relatrios bsicos', 'Suporte por email'],\n          },\n          professional: {\n            name: 'Profissional',\n            price: '79',\n            description: 'Para empresas em crescimento',\n            features: ['At 50 funcionrios', 'Gesto de ferramentas', 'Portal do cliente', 'Relatrios avanados', 'Suporte prioritrio'],\n            popular: 'Mais Popular',\n          },\n          enterprise: {\n            name: 'Empresarial',\n            price: '199',\n            description: 'Para grandes organizaes',\n            features: ['Funcionrios ilimitados', 'Integraes personalizadas', 'Suporte dedicado', 'Acesso API', 'Gesto multi-obras'],\n          },\n          perMonth: '/ms',\n          getStarted: 'Comear',\n          contactSales: 'Contactar Vendas',\n        },\n        testimonials: {\n          title: 'Confiado por Empresas de Construo',\n          subtitle: 'Veja o que os nossos clientes dizem',\n        },\n        faq: {\n          title: 'Perguntas Frequentes',\n          q1: 'Como funciona o rastreamento GPS?',\n          a1: 'Os funcionrios fazem check-in pelo telemvel. A app captura a localizao GPS e opcionalmente uma selfie, garantindo a presena na obra.',\n          q2: 'Os clientes podem aceder ao sistema?',\n          a2: 'Sim! Os clientes tm o seu prprio portal onde podem ver horas trabalhadas, validar registos e submeter contestaes.',\n          q3: 'Existe um perodo de teste grtis?',\n          a3: 'Sim, oferecemos 14 dias de teste grtis com acesso completo. Sem necessidade de carto de crdito.',\n          q4: 'Como  calculada a folha de pagamento?',\n          a4: 'O sistema rastreia automaticamente horas normais, extras e ausncias. Pode exportar relatrios ou integrar com o seu sistema existente.',\n        },\n        cta: {\n          title: 'Pronto para Otimizar as Suas Operaes?',\n          subtitle: 'Junte-se a centenas de empresas de construo que j usam a nossa plataforma.',\n          button: 'Comear Teste Grtis',\n        },\n        footer: {\n          product: 'Produto',\n          company: 'Empresa',\n          resources: 'Recursos',\n          contact: 'Contacto',\n          features: 'Funcionalidades',\n          pricing: 'Preos',\n          about: 'Sobre Ns',\n          blog: 'Blog',\n          help: 'Centro de Ajuda',\n          api: 'Documentao API',\n          privacy: 'Poltica de Privacidade',\n          terms: 'Termos de Servio',\n          copyright: ' 2024 ConstructTrack. Todos os direitos reservados.',\n        },\n      },\n      dashboard: {\n        welcome: 'Bem-vindo de volta',\n        todayOverview: 'Resumo de Hoje',\n        activeWorkers: 'Trabalhadores Ativos',\n        hoursToday: 'Horas Hoje',\n        pendingApprovals: 'Aprovaes Pendentes',\n        toolsOut: 'Ferramentas Emprestadas',\n        recentActivity: 'Atividade Recente',\n        quickActions: 'Aes Rpidas',\n        viewAll: 'Ver Tudo',\n      },\n      time: {\n        clockIn: 'Entrada',\n        clockOut: 'Sada',\n        currentlyWorking: 'A Trabalhar',\n        notClockedIn: 'Sem Registo',\n        startBreak: 'Iniciar Pausa',\n        endBreak: 'Terminar Pausa',\n        onBreak: 'Em Pausa',\n        hoursWorked: 'Horas Trabalhadas',\n        overtime: 'Horas Extra',\n        location: 'Localizao',\n        photo: 'Foto',\n        withinGeofence: 'Dentro da rea da obra',\n        outsideGeofence: 'Fora da rea da obra',\n        selectSite: 'Selecionar Obra',\n        confirmCheckIn: 'Confirmar Entrada',\n        confirmCheckOut: 'Confirmar Sada',\n        takeSelfie: 'Tirar Selfie',\n        enterPin: 'Introduza o seu PIN',\n        offlineMode: 'Modo Offline - Sincroniza quando conectar',\n      },\n      tools: {\n        inventory: 'Inventrio de Ferramentas',\n        available: 'Disponvel',\n        inUse: 'Em Uso',\n        maintenance: 'Manuteno',\n        lost: 'Perdida',\n        stolen: 'Roubada',\n        checkout: 'Emprestar',\n        checkin: 'Devolver',\n        scanQr: 'Ler QR Code',\n        assignedTo: 'Atribuda a',\n        history: 'Histrico',\n        reportIssue: 'Reportar Problema',\n        condition: 'Condio',\n        good: 'Bom',\n        damaged: 'Danificado',\n      },\n      leave: {\n        request: 'Pedir Frias',\n        vacation: 'Frias',\n        sick: 'Doena',\n        personal: 'Pessoal',\n        unpaid: 'No Remunerado',\n        balance: 'Saldo',\n        daysRemaining: 'Dias Restantes',\n        startDate: 'Data Incio',\n        endDate: 'Data Fim',\n        reason: 'Motivo',\n        myRequests: 'Meus Pedidos',\n        teamRequests: 'Pedidos da Equipa',\n      },\n      payroll: {\n        period: 'Perodo',\n        regularHours: 'Horas Normais',\n        overtimeHours: 'Horas Extra',\n        nightHours: 'Horas Noturnas',\n        vacationDays: 'Dias de Frias',\n        sickDays: 'Dias de Doena',\n        unpaidDays: 'Dias No Pagos',\n        totalAmount: 'Valor Total',\n        paid: 'Pago',\n        processing: 'A Processar',\n        markAsPaid: 'Marcar como Pago',\n      },\n      client: {\n        myProjects: 'Meus Projetos',\n        hoursThisMonth: 'Horas Este Ms',\n        pendingValidation: 'Validao Pendente',\n        totalCost: 'Custo Total',\n        validateHours: 'Validar Horas',\n        contest: 'Contestar',\n        contestReason: 'Motivo da Contestao',\n        viewEvidence: 'Ver Evidncias',\n        approveAll: 'Aprovar Todos',\n      },\n      settings: {\n        company: 'Definies da Empresa',\n        profile: 'Perfil',\n        notifications: 'Notificaes',\n        language: 'Idioma',\n        security: 'Segurana',\n        billing: 'Faturao',\n        geofence: 'Raio de Geofencing',\n        requireSelfie: 'Exigir Selfie',\n        requirePin: 'Exigir PIN',\n      },\n      sites: {\n        addSite: 'Adicionar Obra',\n        editSite: 'Editar Obra',\n        siteName: 'Nome da Obra',\n        address: 'Morada',\n        client: 'Cliente',\n        workers: 'Trabalhadores',\n        workHours: 'Horrio de Trabalho',\n        billingType: 'Tipo de Faturao',\n        hourly: 'Por Hora',\n        daily: 'Dirio',\n        fixed: 'Preo Fixo',\n        active: 'Ativa',\n        completed: 'Concluda',\n        paused: 'Pausada',\n      },\n      employees: {\n        addEmployee: 'Adicionar Funcionrio',\n        role: 'Funo',\n        admin: 'Administrador',\n        manager: 'Gestor',\n        employee: 'Funcionrio',\n        hourlyRate: 'Valor/Hora',\n        assignToSite: 'Atribuir a Obra',\n        vacationBalance: 'Saldo de Frias',\n      },\n      notifications: {\n        title: 'Notificaes',\n        markAllRead: 'Marcar todas como lidas',\n        empty: 'Sem notificaes',\n        viewAll: 'Ver todas as notificaes',\n        preferences: {\n          title: 'Preferncias de Notificaes',\n          email: 'Notificaes por Email',\n          push: 'Notificaes Push',\n          sms: 'Notificaes SMS',\n          timeReminders: 'Lembretes de Horrio',\n          lateAlerts: 'Alertas de Atrasos',\n          toolAlerts: 'Alertas de Ferramentas',\n          contestationAlerts: 'Alertas de Contestaes',\n          leaveAlerts: 'Alertas de Pedidos de Frias',\n          updateSuccess: 'Preferncias atualizadas com sucesso',\n          updateError: 'Falha ao atualizar preferncias',\n        },\n      },\n      analytics: {\n        title: 'Anlises',\n        subtitle: 'Insights e relatrios para o seu negcio de construo',\n        productivity: 'Produtividade',\n        totalHours: 'Horas Totais',\n        activeSites: 'Obras Ativas',\n        totalTools: 'Total de Ferramentas',\n        employeeCount: 'Funcionrios',\n        hoursTrend: 'Tendncia de Horas (ltimos 30 Dias)',\n        hoursBySite: 'Horas por Obra',\n        regularHours: 'Horas Normais',\n        overtimeHours: 'Horas Extra',\n        toolStatus: 'Distribuio de Estado das Ferramentas',\n        toolsByCategory: 'Ferramentas por Categoria',\n        count: 'Quantidade',\n        payrollTrend: 'Tendncia de Folha (ltimos 6 Meses)',\n        totalPaid: 'Total Pago',\n        totalPending: 'Total Pendente',\n        amount: 'Valor',\n        noData: 'Sem dados disponveis',\n      },\n      documents: {\n        title: 'Documentos',\n        subtitle: 'Gerir planos, certificados e documentos de projetos',\n        upload: 'Carregar',\n        uploadDocument: 'Carregar Documento',\n        selectSite: 'Selecionar Obra',\n        allSites: 'Todas as Obras',\n        category: 'Categoria',\n        allCategories: 'Todas as Categorias',\n        description: 'Descrio',\n        descriptionPlaceholder: 'Introduza uma descrio para este documento...',\n        file: 'Ficheiro',\n        download: 'Transferir',\n        versions: 'Verses',\n        versionHistory: 'Histrico de Verses',\n        currentVersion: 'Verso Atual',\n        noVersions: 'Sem verses anteriores',\n        noDocuments: 'Nenhum documento encontrado',\n        uploadSuccess: 'Documento carregado com sucesso',\n        uploadError: 'Falha ao carregar documento',\n        deleteSuccess: 'Documento eliminado com sucesso',\n        deleteError: 'Falha ao eliminar documento',\n        categories: {\n          plans: 'Plantas',\n          certificates: 'Certificados',\n          reports: 'Relatrios',\n          contracts: 'Contratos',\n          safety: 'Segurana',\n        },\n      },\n      chat: {\n        title: 'Chat',\n        subtitle: 'Mensagens em tempo real com a sua equipa',\n        selectSite: 'Selecionar uma obra',\n        noRooms: 'Ainda sem salas de chat',\n        selectSiteToStart: 'Selecione uma obra para iniciar uma conversa',\n        siteChat: 'Chat da Obra',\n        online: 'Online',\n        noMessages: 'Ainda sem mensagens',\n        startConversation: 'Envie uma mensagem para iniciar a conversa',\n        selectRoom: 'Selecione uma sala de chat',\n        selectRoomDescription: 'Escolha uma obra  esquerda para comear a conversar',\n        typeMessage: 'Escreva uma mensagem...',\n        unknownUser: 'Utilizador Desconhecido',\n        sendError: 'Falha ao enviar mensagem',\n      },\n      pwa: {\n        title: 'Instalar App',\n        description: 'Instale o ConstructTrack no seu telemvel para acesso rpido',\n        install: 'Instalar',\n        iosDescription: 'Para instalar no iPhone/iPad:',\n        iosStep1: 'Toque em',\n        iosShareButton: '(Partilhar)',\n        iosStep2: 'Escolha',\n        iosAddToHome: \"'Adicionar ao Ecr Inicial'\",\n        iosStep3: \"Confirme tocando em 'Adicionar'\",\n        understood: 'Entendi',\n        androidInstructions: \"Use o menu do navegador e selecione 'Instalar app' ou 'Adicionar  tela inicial'\",\n      },\n      access: {\n        denied: 'Acesso Negado',\n        noPermission: 'No tem permisso para aceder a esta pgina.',\n        goToDashboard: 'Voltar ao Painel',\n      },\n      admin: {\n        title: 'Administrao',\n        userManagement: 'Gesto de Utilizadores',\n        siteManagement: 'Gesto de Obras',\n        clientManagement: 'Gesto de Clientes',\n        toolManagement: 'Gesto de Ferramentas',\n        timesheets: 'Folhas de Ponto',\n        leaveApprovals: 'Aprovar Frias',\n        companySettings: 'Definies da Empresa',\n        serviceOrders: 'Ordens de Servio',\n        subscriptions: 'Subscries',\n        addUser: 'Adicionar Utilizador',\n        addSite: 'Adicionar Obra',\n        addClient: 'Adicionar Cliente',\n        addTool: 'Adicionar Ferramenta',\n      },\n      roles: {\n        superadmin: 'Super Admin',\n        admin: 'Administrador',\n        manager: 'Gestor',\n        employee: 'Funcionrio',\n        client: 'Cliente',\n      },\n    },\n  },\n  nl: {\n    translation: {\n      common: {\n        loading: 'Laden...',\n        save: 'Opslaan',\n        cancel: 'Annuleren',\n        delete: 'Verwijderen',\n        edit: 'Bewerken',\n        add: 'Toevoegen',\n        search: 'Zoeken',\n        filter: 'Filter',\n        export: 'Exporteren',\n        back: 'Terug',\n        next: 'Volgende',\n        submit: 'Verzenden',\n        confirm: 'Bevestigen',\n        close: 'Sluiten',\n        yes: 'Ja',\n        no: 'Nee',\n        actions: 'Acties',\n        status: 'Status',\n        date: 'Datum',\n        time: 'Tijd',\n        total: 'Totaal',\n        details: 'Details',\n        view: 'Bekijken',\n        approve: 'Goedkeuren',\n        reject: 'Afwijzen',\n        pending: 'In afwachting',\n        approved: 'Goedgekeurd',\n        rejected: 'Afgewezen',\n        hours: 'Uren',\n        minutes: 'Minuten',\n        days: 'Dagen',\n      },\n      nav: {\n        home: 'Home',\n        dashboard: 'Dashboard',\n        sites: 'Bouwplaatsen',\n        employees: 'Medewerkers',\n        clients: 'Klanten',\n        tools: 'Gereedschap',\n        timeRecords: 'Tijdregistratie',\n        leave: 'Verlof',\n        payroll: 'Salarisadministratie',\n        settings: 'Instellingen',\n        reports: 'Rapporten',\n        profile: 'Profiel',\n        logout: 'Uitloggen',\n        login: 'Inloggen',\n        analytics: 'Analyses',\n        documents: 'Documenten',\n        chat: 'Chat',\n      },\n      landing: {\n        hero: {\n          title: 'Bouwplaatsbeheer Eenvoudig Gemaakt',\n          subtitle: 'Registreer tijd, beheer gereedschap en stroomlijn de salarisadministratie met onze complete oplossing voor bouwbedrijven.',\n          cta: 'Start Gratis Proefperiode',\n          demo: 'Bekijk Demo',\n        },\n        features: {\n          title: 'Alles Wat U Nodig Heeft',\n          subtitle: 'Krachtige functies ontworpen voor de bouwsector',\n          gps: {\n            title: 'GPS Tijdregistratie',\n            description: 'Verifieer aanwezigheid van medewerkers met geofenced check-ins en foto-bewijs.',\n          },\n          tools: {\n            title: 'Gereedschapbeheer',\n            description: 'Volg apparatuur met QR-codes en voorkom verlies of diefstal.',\n          },\n          client: {\n            title: 'Klantenportaal',\n            description: 'Laat klanten gewerkte uren valideren en geschillen transparant oplossen.',\n          },\n          payroll: {\n            title: 'Eenvoudige Salarisadministratie',\n            description: 'Bereken uren, overuren en genereer moeiteloos betalingsrapporten.',\n          },\n          antifraud: {\n            title: 'Anti-Fraude Bescherming',\n            description: 'Voorkom buddy punching met selfies, PIN-codes en apparaatbinding.',\n          },\n          multilang: {\n            title: 'Meertalig',\n            description: 'Beschikbaar in Nederlands, Engels, Portugees en Frans.',\n          },\n        },\n        pricing: {\n          title: 'Eenvoudige, Transparante Prijzen',\n          subtitle: 'Kies het plan dat bij uw bedrijf past',\n          monthly: 'Maandelijks',\n          yearly: 'Jaarlijks',\n          starter: {\n            name: 'Starter',\n            price: '29',\n            description: 'Perfect voor kleine teams',\n            features: ['Tot 10 medewerkers', 'GPS tijdregistratie', 'Basisrapporten', 'E-mailondersteuning'],\n          },\n          professional: {\n            name: 'Professioneel',\n            price: '79',\n            description: 'Voor groeiende bedrijven',\n            features: ['Tot 50 medewerkers', 'Gereedschapbeheer', 'Klantenportaal', 'Geavanceerde rapporten', 'Prioriteitsondersteuning'],\n            popular: 'Meest Populair',\n          },\n          enterprise: {\n            name: 'Enterprise',\n            price: '199',\n            description: 'Voor grote organisaties',\n            features: ['Onbeperkt medewerkers', 'Aangepaste integraties', 'Toegewijde ondersteuning', 'API-toegang', 'Multi-site beheer'],\n          },\n          perMonth: '/maand',\n          getStarted: 'Aan de slag',\n          contactSales: 'Neem Contact Op',\n        },\n        testimonials: {\n          title: 'Vertrouwd door Bouwbedrijven',\n          subtitle: 'Zie wat onze klanten zeggen',\n        },\n        faq: {\n          title: 'Veelgestelde Vragen',\n          q1: 'Hoe werkt de GPS-tracking?',\n          a1: 'Medewerkers checken in met hun mobiele telefoon. De app legt hun GPS-locatie vast en optioneel een selfie, waardoor hun aanwezigheid op de bouwplaats wordt gegarandeerd.',\n          q2: 'Kunnen klanten toegang krijgen tot het systeem?',\n          a2: 'Ja! Klanten hebben hun eigen portaal waar ze gewerkte uren kunnen bekijken, records kunnen valideren en indien nodig bezwaren kunnen indienen.',\n          q3: 'Is er een gratis proefperiode?',\n          a3: 'Ja, we bieden een gratis proefperiode van 14 dagen met volledige toegang tot alle functies. Geen creditcard vereist.',\n          q4: 'Hoe wordt de salarisadministratie berekend?',\n          a4: 'Het systeem houdt automatisch reguliere uren, overuren en afwezigheden bij. U kunt rapporten exporteren of integreren met uw bestaande salarissysteem.',\n        },\n        cta: {\n          title: 'Klaar om Uw Operaties te Stroomlijnen?',\n          subtitle: 'Sluit u aan bij honderden bouwbedrijven die al ons platform gebruiken.',\n          button: 'Start Uw Gratis Proefperiode',\n        },\n        footer: {\n          product: 'Product',\n          company: 'Bedrijf',\n          resources: 'Bronnen',\n          contact: 'Contact',\n          features: 'Functies',\n          pricing: 'Prijzen',\n          about: 'Over Ons',\n          blog: 'Blog',\n          help: 'Helpcentrum',\n          api: 'API Documentatie',\n          privacy: 'Privacybeleid',\n          terms: 'Servicevoorwaarden',\n          copyright: ' 2024 ConstructTrack. Alle rechten voorbehouden.',\n        },\n      },\n      dashboard: {\n        welcome: 'Welkom terug',\n        todayOverview: 'Overzicht Vandaag',\n        activeWorkers: 'Actieve Medewerkers',\n        hoursToday: 'Uren Vandaag',\n        pendingApprovals: 'Wachtende Goedkeuringen',\n        toolsOut: 'Uitgeleend Gereedschap',\n        recentActivity: 'Recente Activiteit',\n        quickActions: 'Snelle Acties',\n        viewAll: 'Alles Bekijken',\n      },\n      time: {\n        clockIn: 'Inklokken',\n        clockOut: 'Uitklokken',\n        currentlyWorking: 'Aan het Werk',\n        notClockedIn: 'Niet Ingeklokt',\n        startBreak: 'Start Pauze',\n        endBreak: 'Einde Pauze',\n        onBreak: 'Op Pauze',\n        hoursWorked: 'Gewerkte Uren',\n        overtime: 'Overuren',\n        location: 'Locatie',\n        photo: 'Foto',\n        withinGeofence: 'Binnen bouwplaatsgebied',\n        outsideGeofence: 'Buiten bouwplaatsgebied',\n        selectSite: 'Selecteer Bouwplaats',\n        confirmCheckIn: 'Bevestig Inklokken',\n        confirmCheckOut: 'Bevestig Uitklokken',\n        takeSelfie: 'Neem Selfie',\n        enterPin: 'Voer uw PIN in',\n        offlineMode: 'Offline Modus - Synchroniseert wanneer verbonden',\n      },\n      tools: {\n        inventory: 'Gereedschapinventaris',\n        available: 'Beschikbaar',\n        inUse: 'In Gebruik',\n        maintenance: 'Onderhoud',\n        lost: 'Verloren',\n        stolen: 'Gestolen',\n        checkout: 'Uitchecken',\n        checkin: 'Inchecken',\n        scanQr: 'Scan QR-code',\n        assignedTo: 'Toegewezen aan',\n        history: 'Geschiedenis',\n        reportIssue: 'Meld Probleem',\n        condition: 'Conditie',\n        good: 'Goed',\n        damaged: 'Beschadigd',\n      },\n      leave: {\n        request: 'Verlof Aanvragen',\n        vacation: 'Vakantie',\n        sick: 'Ziekteverlof',\n        personal: 'Persoonlijk',\n        unpaid: 'Onbetaald Verlof',\n        balance: 'Saldo',\n        daysRemaining: 'Resterende Dagen',\n        startDate: 'Startdatum',\n        endDate: 'Einddatum',\n        reason: 'Reden',\n        myRequests: 'Mijn Aanvragen',\n        teamRequests: 'Teamaanvragen',\n      },\n      payroll: {\n        period: 'Salarisperiode',\n        regularHours: 'Reguliere Uren',\n        overtimeHours: 'Overuren',\n        nightHours: 'Nachturen',\n        vacationDays: 'Vakantiedagen',\n        sickDays: 'Ziektedagen',\n        unpaidDays: 'Onbetaalde Dagen',\n        totalAmount: 'Totaalbedrag',\n        paid: 'Betaald',\n        processing: 'Verwerken',\n        markAsPaid: 'Markeer als Betaald',\n      },\n      client: {\n        myProjects: 'Mijn Projecten',\n        hoursThisMonth: 'Uren Deze Maand',\n        pendingValidation: 'Wachtende Validatie',\n        totalCost: 'Totale Kosten',\n        validateHours: 'Valideer Uren',\n        contest: 'Bezwaar',\n        contestReason: 'Reden voor Bezwaar',\n        viewEvidence: 'Bekijk Bewijs',\n        approveAll: 'Alles Goedkeuren',\n      },\n      settings: {\n        company: 'Bedrijfsinstellingen',\n        profile: 'Profiel',\n        notifications: 'Meldingen',\n        language: 'Taal',\n        security: 'Beveiliging',\n        billing: 'Facturering',\n        geofence: 'Geofence Radius',\n        requireSelfie: 'Selfie Vereisen',\n        requirePin: 'PIN Vereisen',\n      },\n      sites: {\n        addSite: 'Bouwplaats Toevoegen',\n        editSite: 'Bouwplaats Bewerken',\n        siteName: 'Naam Bouwplaats',\n        address: 'Adres',\n        client: 'Klant',\n        workers: 'Medewerkers',\n        workHours: 'Werktijden',\n        billingType: 'Factuurtype',\n        hourly: 'Per Uur',\n        daily: 'Per Dag',\n        fixed: 'Vaste Prijs',\n        active: 'Actief',\n        completed: 'Voltooid',\n        paused: 'Gepauzeerd',\n      },\n      employees: {\n        addEmployee: 'Medewerker Toevoegen',\n        role: 'Rol',\n        admin: 'Beheerder',\n        manager: 'Manager',\n        employee: 'Medewerker',\n        hourlyRate: 'Uurtarief',\n        assignToSite: 'Toewijzen aan Bouwplaats',\n        vacationBalance: 'Vakantiesaldo',\n      },\n      notifications: {\n        title: 'Meldingen',\n        markAllRead: 'Alles als gelezen markeren',\n        empty: 'Geen meldingen',\n        viewAll: 'Alle meldingen bekijken',\n        preferences: {\n          title: 'Meldingsvoorkeuren',\n          email: 'E-mailmeldingen',\n          push: 'Push-meldingen',\n          sms: 'SMS-meldingen',\n          timeReminders: 'Tijdherinneringen',\n          lateAlerts: 'Late Aankomst Waarschuwingen',\n          toolAlerts: 'Gereedschapswaarschuwingen',\n          contestationAlerts: 'Betwistingswaarschuwingen',\n          leaveAlerts: 'Verlofaanvraagwaarschuwingen',\n          updateSuccess: 'Voorkeuren succesvol bijgewerkt',\n          updateError: 'Voorkeuren bijwerken mislukt',\n        },\n      },\n      analytics: {\n        title: 'Analyses',\n        subtitle: 'Inzichten en rapporten voor uw bouwbedrijf',\n        productivity: 'Productiviteit',\n        totalHours: 'Totale Uren',\n        activeSites: 'Actieve Bouwplaatsen',\n        totalTools: 'Totaal Gereedschap',\n        employeeCount: 'Medewerkers',\n        hoursTrend: 'Urentrend (Laatste 30 Dagen)',\n        hoursBySite: 'Uren per Bouwplaats',\n        regularHours: 'Reguliere Uren',\n        overtimeHours: 'Overuren',\n        toolStatus: 'Gereedschapstatus Verdeling',\n        toolsByCategory: 'Gereedschap per Categorie',\n        count: 'Aantal',\n        payrollTrend: 'Salaristrend (Laatste 6 Maanden)',\n        totalPaid: 'Totaal Betaald',\n        totalPending: 'Totaal Openstaand',\n        amount: 'Bedrag',\n        noData: 'Geen gegevens beschikbaar',\n      },\n      documents: {\n        title: 'Documenten',\n        subtitle: 'Beheer bouwplannen, certificaten en projectdocumenten',\n        upload: 'Uploaden',\n        uploadDocument: 'Document Uploaden',\n        selectSite: 'Selecteer Bouwplaats',\n        allSites: 'Alle Bouwplaatsen',\n        category: 'Categorie',\n        allCategories: 'Alle Categorien',\n        description: 'Beschrijving',\n        descriptionPlaceholder: 'Voer een beschrijving in voor dit document...',\n        file: 'Bestand',\n        download: 'Downloaden',\n        versions: 'Versies',\n        versionHistory: 'Versiegeschiedenis',\n        currentVersion: 'Huidige Versie',\n        noVersions: 'Geen eerdere versies',\n        noDocuments: 'Geen documenten gevonden',\n        uploadSuccess: 'Document succesvol gepload',\n        uploadError: 'Document uploaden mislukt',\n        deleteSuccess: 'Document succesvol verwijderd',\n        deleteError: 'Document verwijderen mislukt',\n        categories: {\n          plans: 'Bouwtekeningen',\n          certificates: 'Certificaten',\n          reports: 'Rapporten',\n          contracts: 'Contracten',\n          safety: 'Veiligheid',\n        },\n      },\n      chat: {\n        title: 'Chat',\n        subtitle: 'Realtime berichten met uw team',\n        selectSite: 'Selecteer een bouwplaats',\n        noRooms: 'Nog geen chatrooms',\n        selectSiteToStart: 'Selecteer een bouwplaats om een gesprek te starten',\n        siteChat: 'Bouwplaats Chat',\n        online: 'Online',\n        noMessages: 'Nog geen berichten',\n        startConversation: 'Stuur een bericht om het gesprek te starten',\n        selectRoom: 'Selecteer een chatroom',\n        selectRoomDescription: 'Kies links een bouwplaats om te beginnen met chatten',\n        typeMessage: 'Typ een bericht...',\n        unknownUser: 'Onbekende Gebruiker',\n        sendError: 'Bericht verzenden mislukt',\n      },\n      pwa: {\n        title: 'App Installeren',\n        description: 'Installeer ConstructTrack op uw telefoon voor snelle toegang',\n        install: 'Installeren',\n        iosDescription: 'Om te installeren op iPhone/iPad:',\n        iosStep1: 'Tik op',\n        iosShareButton: '(Delen)',\n        iosStep2: 'Kies',\n        iosAddToHome: \"'Zet op beginscherm'\",\n        iosStep3: \"Bevestig door op 'Voeg toe' te tikken\",\n        understood: 'Begrepen',\n        androidInstructions: \"Gebruik het browsermenu en selecteer 'App installeren' of 'Toevoegen aan startscherm'\",\n      },\n      access: {\n        denied: 'Toegang Geweigerd',\n        noPermission: 'U heeft geen toestemming om deze pagina te bekijken.',\n        goToDashboard: 'Ga naar Dashboard',\n      },\n      admin: {\n        title: 'Administratie',\n        userManagement: 'Gebruikersbeheer',\n        siteManagement: 'Bouwplaatsbeheer',\n        clientManagement: 'Klantenbeheer',\n        toolManagement: 'Gereedschapsbeheer',\n        timesheets: 'Urenstaten',\n        leaveApprovals: 'Verlofgoedkeuringen',\n        companySettings: 'Bedrijfsinstellingen',\n        serviceOrders: 'Serviceorders',\n        subscriptions: 'Abonnementen',\n        addUser: 'Gebruiker Toevoegen',\n        addSite: 'Bouwplaats Toevoegen',\n        addClient: 'Klant Toevoegen',\n        addTool: 'Gereedschap Toevoegen',\n      },\n      roles: {\n        superadmin: 'Super Admin',\n        admin: 'Beheerder',\n        manager: 'Manager',\n        employee: 'Werknemer',\n        client: 'Klant',\n      },\n    },\n  },\n  fr: {\n    translation: {\n      common: {\n        loading: 'Chargement...',\n        save: 'Enregistrer',\n        cancel: 'Annuler',\n        delete: 'Supprimer',\n        edit: 'Modifier',\n        add: 'Ajouter',\n        search: 'Rechercher',\n        filter: 'Filtrer',\n        export: 'Exporter',\n        back: 'Retour',\n        next: 'Suivant',\n        submit: 'Soumettre',\n        confirm: 'Confirmer',\n        close: 'Fermer',\n        yes: 'Oui',\n        no: 'Non',\n        actions: 'Actions',\n        status: 'Statut',\n        date: 'Date',\n        time: 'Heure',\n        total: 'Total',\n        details: 'Dtails',\n        view: 'Voir',\n        approve: 'Approuver',\n        reject: 'Rejeter',\n        pending: 'En attente',\n        approved: 'Approuv',\n        rejected: 'Rejet',\n        hours: 'Heures',\n        minutes: 'Minutes',\n        days: 'Jours',\n      },\n      nav: {\n        home: 'Accueil',\n        dashboard: 'Tableau de bord',\n        sites: 'Chantiers',\n        employees: 'Employs',\n        clients: 'Clients',\n        tools: 'Outils',\n        timeRecords: 'Pointages',\n        leave: 'Congs',\n        payroll: 'Paie',\n        settings: 'Paramtres',\n        reports: 'Rapports',\n        profile: 'Profil',\n        logout: 'Dconnexion',\n        login: 'Connexion',\n        analytics: 'Analytique',\n        documents: 'Documents',\n        chat: 'Chat',\n      },\n      landing: {\n        hero: {\n          title: 'Gestion de Chantier Simplifie',\n          subtitle: 'Suivez le temps, grez les outils et simplifiez la paie avec notre solution complte pour les entreprises de construction.',\n          cta: 'Essai Gratuit',\n          demo: 'Voir la Dmo',\n        },\n        features: {\n          title: 'Tout Ce Dont Vous Avez Besoin',\n          subtitle: 'Des fonctionnalits puissantes conues pour le secteur de la construction',\n          gps: {\n            title: 'Suivi GPS',\n            description: \"Vrifiez la prsence des employs avec des pointages golocaliss et des photos.\",\n          },\n          tools: {\n            title: 'Gestion des Outils',\n            description: 'Suivez les quipements avec des codes QR et prvenez les pertes ou vols.',\n          },\n          client: {\n            title: 'Portail Client',\n            description: 'Permettez aux clients de valider les heures et de rsoudre les litiges de manire transparente.',\n          },\n          payroll: {\n            title: 'Paie Simplifie',\n            description: 'Calculez les heures, les heures supplmentaires et gnrez des rapports de paiement facilement.',\n          },\n          antifraud: {\n            title: 'Protection Anti-Fraude',\n            description: 'Prvenez la fraude avec des selfies, des codes PIN et la liaison des appareils.',\n          },\n          multilang: {\n            title: 'Multilingue',\n            description: 'Disponible en franais, anglais, portugais et nerlandais.',\n          },\n        },\n        pricing: {\n          title: 'Tarifs Simples et Transparents',\n          subtitle: \"Choisissez le plan qui convient  votre entreprise\",\n          monthly: 'Mensuel',\n          yearly: 'Annuel',\n          starter: {\n            name: 'Starter',\n            price: '29',\n            description: 'Parfait pour les petites quipes',\n            features: [\"Jusqu' 10 employs\", 'Suivi GPS', 'Rapports de base', 'Support par email'],\n          },\n          professional: {\n            name: 'Professionnel',\n            price: '79',\n            description: 'Pour les entreprises en croissance',\n            features: [\"Jusqu' 50 employs\", 'Gestion des outils', 'Portail client', 'Rapports avancs', 'Support prioritaire'],\n            popular: 'Le Plus Populaire',\n          },\n          enterprise: {\n            name: 'Entreprise',\n            price: '199',\n            description: 'Pour les grandes organisations',\n            features: ['Employs illimits', 'Intgrations personnalises', 'Support ddi', 'Accs API', 'Gestion multi-sites'],\n          },\n          perMonth: '/mois',\n          getStarted: 'Commencer',\n          contactSales: 'Contacter les Ventes',\n        },\n        testimonials: {\n          title: 'Approuv par les Entreprises de Construction',\n          subtitle: 'Dcouvrez ce que nos clients disent',\n        },\n        faq: {\n          title: 'Questions Frquentes',\n          q1: 'Comment fonctionne le suivi GPS ?',\n          a1: \"Les employs pointent avec leur tlphone mobile. L'application capture leur position GPS et optionnellement un selfie, garantissant leur prsence sur le chantier.\",\n          q2: 'Les clients peuvent-ils accder au systme ?',\n          a2: 'Oui ! Les clients ont leur propre portail o ils peuvent consulter les heures travailles, valider les enregistrements et soumettre des contestations si ncessaire.',\n          q3: \"Y a-t-il un essai gratuit ?\",\n          a3: \"Oui, nous offrons un essai gratuit de 14 jours avec accs complet  toutes les fonctionnalits. Aucune carte de crdit requise.\",\n          q4: 'Comment la paie est-elle calcule ?',\n          a4: \"Le systme suit automatiquement les heures rgulires, les heures supplmentaires et les absences. Vous pouvez exporter des rapports ou intgrer avec votre systme de paie existant.\",\n        },\n        cta: {\n          title: 'Prt  Optimiser Vos Oprations ?',\n          subtitle: \"Rejoignez des centaines d'entreprises de construction qui utilisent dj notre plateforme.\",\n          button: 'Commencer Votre Essai Gratuit',\n        },\n        footer: {\n          product: 'Produit',\n          company: 'Entreprise',\n          resources: 'Ressources',\n          contact: 'Contact',\n          features: 'Fonctionnalits',\n          pricing: 'Tarifs',\n          about: ' Propos',\n          blog: 'Blog',\n          help: \"Centre d'Aide\",\n          api: 'Documentation API',\n          privacy: 'Politique de Confidentialit',\n          terms: \"Conditions d'Utilisation\",\n          copyright: ' 2024 ConstructTrack. Tous droits rservs.',\n        },\n      },\n      dashboard: {\n        welcome: 'Bon retour',\n        todayOverview: \"Aperu d'Aujourd'hui\",\n        activeWorkers: 'Travailleurs Actifs',\n        hoursToday: \"Heures Aujourd'hui\",\n        pendingApprovals: 'Approbations en Attente',\n        toolsOut: 'Outils Emprunts',\n        recentActivity: 'Activit Rcente',\n        quickActions: 'Actions Rapides',\n        viewAll: 'Voir Tout',\n      },\n      time: {\n        clockIn: 'Pointer Entre',\n        clockOut: 'Pointer Sortie',\n        currentlyWorking: 'En Travail',\n        notClockedIn: 'Non Point',\n        startBreak: 'Dbut Pause',\n        endBreak: 'Fin Pause',\n        onBreak: 'En Pause',\n        hoursWorked: 'Heures Travailles',\n        overtime: 'Heures Supplmentaires',\n        location: 'Localisation',\n        photo: 'Photo',\n        withinGeofence: 'Dans la zone du chantier',\n        outsideGeofence: 'Hors de la zone du chantier',\n        selectSite: 'Slectionner Chantier',\n        confirmCheckIn: \"Confirmer l'Entre\",\n        confirmCheckOut: 'Confirmer la Sortie',\n        takeSelfie: 'Prendre un Selfie',\n        enterPin: 'Entrez votre PIN',\n        offlineMode: 'Mode Hors Ligne - Synchronisation  la connexion',\n      },\n      tools: {\n        inventory: 'Inventaire des Outils',\n        available: 'Disponible',\n        inUse: 'En Utilisation',\n        maintenance: 'Maintenance',\n        lost: 'Perdu',\n        stolen: 'Vol',\n        checkout: 'Emprunter',\n        checkin: 'Retourner',\n        scanQr: 'Scanner QR Code',\n        assignedTo: 'Attribu ',\n        history: 'Historique',\n        reportIssue: 'Signaler un Problme',\n        condition: 'tat',\n        good: 'Bon',\n        damaged: 'Endommag',\n      },\n      leave: {\n        request: 'Demander un Cong',\n        vacation: 'Vacances',\n        sick: 'Maladie',\n        personal: 'Personnel',\n        unpaid: 'Non Pay',\n        balance: 'Solde',\n        daysRemaining: 'Jours Restants',\n        startDate: 'Date de Dbut',\n        endDate: 'Date de Fin',\n        reason: 'Motif',\n        myRequests: 'Mes Demandes',\n        teamRequests: \"Demandes de l'quipe\",\n      },\n      payroll: {\n        period: 'Priode de Paie',\n        regularHours: 'Heures Normales',\n        overtimeHours: 'Heures Supplmentaires',\n        nightHours: 'Heures de Nuit',\n        vacationDays: 'Jours de Vacances',\n        sickDays: 'Jours de Maladie',\n        unpaidDays: 'Jours Non Pays',\n        totalAmount: 'Montant Total',\n        paid: 'Pay',\n        processing: 'En Traitement',\n        markAsPaid: 'Marquer comme Pay',\n      },\n      client: {\n        myProjects: 'Mes Projets',\n        hoursThisMonth: 'Heures Ce Mois',\n        pendingValidation: 'Validation en Attente',\n        totalCost: 'Cot Total',\n        validateHours: 'Valider les Heures',\n        contest: 'Contester',\n        contestReason: 'Motif de la Contestation',\n        viewEvidence: 'Voir les Preuves',\n        approveAll: 'Approuver Tout',\n      },\n      settings: {\n        company: \"Paramtres de l'Entreprise\",\n        profile: 'Profil',\n        notifications: 'Notifications',\n        language: 'Langue',\n        security: 'Scurit',\n        billing: 'Facturation',\n        geofence: 'Rayon de Gofencing',\n        requireSelfie: 'Exiger un Selfie',\n        requirePin: 'Exiger un PIN',\n      },\n      sites: {\n        addSite: 'Ajouter un Chantier',\n        editSite: 'Modifier le Chantier',\n        siteName: 'Nom du Chantier',\n        address: 'Adresse',\n        client: 'Client',\n        workers: 'Travailleurs',\n        workHours: 'Heures de Travail',\n        billingType: 'Type de Facturation',\n        hourly: 'Par Heure',\n        daily: 'Par Jour',\n        fixed: 'Prix Fixe',\n        active: 'Actif',\n        completed: 'Termin',\n        paused: 'En Pause',\n      },\n      employees: {\n        addEmployee: 'Ajouter un Employ',\n        role: 'Rle',\n        admin: 'Administrateur',\n        manager: 'Responsable',\n        employee: 'Employ',\n        hourlyRate: 'Taux Horaire',\n        assignToSite: 'Attribuer au Chantier',\n        vacationBalance: 'Solde de Vacances',\n      },\n      notifications: {\n        title: 'Notifications',\n        markAllRead: 'Tout marquer comme lu',\n        empty: 'Aucune notification',\n        viewAll: 'Voir toutes les notifications',\n        preferences: {\n          title: 'Prfrences de Notification',\n          email: 'Notifications par Email',\n          push: 'Notifications Push',\n          sms: 'Notifications SMS',\n          timeReminders: 'Rappels de Temps',\n          lateAlerts: 'Alertes de Retard',\n          toolAlerts: 'Alertes Outils',\n          contestationAlerts: 'Alertes de Contestation',\n          leaveAlerts: 'Alertes de Demande de Cong',\n          updateSuccess: 'Prfrences mises  jour avec succs',\n          updateError: 'chec de la mise  jour des prfrences',\n        },\n      },\n      analytics: {\n        title: 'Analytique',\n        subtitle: 'Insights et rapports pour votre entreprise de construction',\n        productivity: 'Productivit',\n        totalHours: 'Heures Totales',\n        activeSites: 'Chantiers Actifs',\n        totalTools: 'Total Outils',\n        employeeCount: 'Employs',\n        hoursTrend: 'Tendance des Heures (30 Derniers Jours)',\n        hoursBySite: 'Heures par Chantier',\n        regularHours: 'Heures Normales',\n        overtimeHours: 'Heures Supplmentaires',\n        toolStatus: 'Distribution du Statut des Outils',\n        toolsByCategory: 'Outils par Catgorie',\n        count: 'Nombre',\n        payrollTrend: 'Tendance de Paie (6 Derniers Mois)',\n        totalPaid: 'Total Pay',\n        totalPending: 'Total en Attente',\n        amount: 'Montant',\n        noData: 'Aucune donne disponible',\n      },\n      documents: {\n        title: 'Documents',\n        subtitle: 'Grer les plans, certificats et documents de projet',\n        upload: 'Tlcharger',\n        uploadDocument: 'Tlcharger un Document',\n        selectSite: 'Slectionner le Chantier',\n        allSites: 'Tous les Chantiers',\n        category: 'Catgorie',\n        allCategories: 'Toutes les Catgories',\n        description: 'Description',\n        descriptionPlaceholder: 'Entrez une description pour ce document...',\n        file: 'Fichier',\n        download: 'Tlcharger',\n        versions: 'Versions',\n        versionHistory: 'Historique des Versions',\n        currentVersion: 'Version Actuelle',\n        noVersions: 'Aucune version prcdente',\n        noDocuments: 'Aucun document trouv',\n        uploadSuccess: 'Document tlcharg avec succs',\n        uploadError: 'chec du tlchargement du document',\n        deleteSuccess: 'Document supprim avec succs',\n        deleteError: 'chec de la suppression du document',\n        categories: {\n          plans: 'Plans',\n          certificates: 'Certificats',\n          reports: 'Rapports',\n          contracts: 'Contrats',\n          safety: 'Scurit',\n        },\n      },\n      chat: {\n        title: 'Chat',\n        subtitle: 'Messagerie en temps rel avec votre quipe',\n        selectSite: 'Slectionner un chantier',\n        noRooms: 'Pas encore de salons de chat',\n        selectSiteToStart: 'Slectionnez un chantier pour dmarrer une conversation',\n        siteChat: 'Chat du Chantier',\n        online: 'En ligne',\n        noMessages: 'Pas encore de messages',\n        startConversation: 'Envoyez un message pour dmarrer la conversation',\n        selectRoom: 'Slectionner un salon de chat',\n        selectRoomDescription: 'Choisissez un chantier  gauche pour commencer  discuter',\n        typeMessage: 'Tapez un message...',\n        unknownUser: 'Utilisateur Inconnu',\n        sendError: \"chec de l'envoi du message\",\n      },\n      pwa: {\n        title: 'Installer l\\'App',\n        description: 'Installez ConstructTrack sur votre tlphone pour un accs rapide',\n        install: 'Installer',\n        iosDescription: 'Pour installer sur iPhone/iPad:',\n        iosStep1: 'Appuyez sur',\n        iosShareButton: '(Partager)',\n        iosStep2: 'Choisissez',\n        iosAddToHome: \"'Sur l'cran d'accueil'\",\n        iosStep3: \"Confirmez en appuyant sur 'Ajouter'\",\n        understood: 'Compris',\n        androidInstructions: \"Utilisez le menu du navigateur et slectionnez 'Installer l'app' ou 'Ajouter  l'cran d'accueil'\",\n      },\n      access: {\n        denied: 'Accs Refus',\n        noPermission: \"Vous n'avez pas la permission d'accder  cette page.\",\n        goToDashboard: 'Aller au Tableau de Bord',\n      },\n      admin: {\n        title: 'Administration',\n        userManagement: 'Gestion des Utilisateurs',\n        siteManagement: 'Gestion des Chantiers',\n        clientManagement: 'Gestion des Clients',\n        toolManagement: 'Gestion des Outils',\n        timesheets: 'Feuilles de Temps',\n        leaveApprovals: 'Approbation des Congs',\n        companySettings: \"Paramtres de l'Entreprise\",\n        serviceOrders: 'Ordres de Service',\n        subscriptions: 'Abonnements',\n        addUser: 'Ajouter Utilisateur',\n        addSite: 'Ajouter Chantier',\n        addClient: 'Ajouter Client',\n        addTool: 'Ajouter Outil',\n      },\n      roles: {\n        superadmin: 'Super Admin',\n        admin: 'Administrateur',\n        manager: 'Responsable',\n        employee: 'Employ',\n        client: 'Client',\n      },\n    },\n  },\n};\n\nconst savedLanguage = typeof window !== 'undefined' ? localStorage.getItem('language') : null;\n\ni18n\n  .use(initReactI18next)\n  .init({\n    resources,\n    lng: savedLanguage || 'pt',\n    fallbackLng: 'en',\n    interpolation: {\n      escapeValue: false,\n    },\n  });\n\nexport default i18n;\n","path":null,"size_bytes":60216,"size_tokens":null},"client/src/pages/Payroll.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Calculator,\n  Download,\n  DollarSign,\n  Clock,\n  Moon,\n  Umbrella,\n  Check,\n} from \"lucide-react\";\nimport { format, startOfMonth, endOfMonth, subMonths } from \"date-fns\";\nimport type { PayrollRecord } from \"@shared/schema\";\n\nexport default function Payroll() {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const [selectedPeriod, setSelectedPeriod] = useState(\"current\");\n\n  const { data: payrollRecords, isLoading } = useQuery<PayrollRecord[]>({\n    queryKey: [\"/api/payroll\", selectedPeriod],\n  });\n\n  const markPaidMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest(\"POST\", `/api/payroll/${id}/mark-paid`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/payroll\"] });\n      toast({ title: t(\"payroll.paid\"), description: \"Payment recorded\" });\n    },\n  });\n\n  const exportMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"GET\", `/api/payroll/export?period=${selectedPeriod}`);\n      return response;\n    },\n    onSuccess: () => {\n      toast({ title: t(\"common.export\"), description: \"Export ready for download\" });\n    },\n  });\n\n  const getStatusBadge = (status: string) => {\n    const variants: Record<string, \"default\" | \"secondary\" | \"destructive\"> = {\n      pending: \"secondary\",\n      paid: \"default\",\n      processing: \"secondary\",\n    };\n    return <Badge variant={variants[status] || \"secondary\"}>{t(`payroll.${status}`)}</Badge>;\n  };\n\n  const periods = [\n    { value: \"current\", label: format(new Date(), \"MMMM yyyy\") },\n    { value: \"previous\", label: format(subMonths(new Date(), 1), \"MMMM yyyy\") },\n    { value: \"two_months_ago\", label: format(subMonths(new Date(), 2), \"MMMM yyyy\") },\n  ];\n\n  const totalAmount = payrollRecords?.reduce(\n    (sum, record) => sum + parseFloat(record.totalAmount || \"0\"),\n    0\n  ) ?? 0;\n\n  const totalRegularHours = payrollRecords?.reduce(\n    (sum, record) => sum + parseFloat(record.regularHours || \"0\"),\n    0\n  ) ?? 0;\n\n  const totalOvertimeHours = payrollRecords?.reduce(\n    (sum, record) => sum + parseFloat(record.overtimeHours || \"0\"),\n    0\n  ) ?? 0;\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <h1 className=\"text-2xl font-bold\">{t(\"nav.payroll\")}</h1>\n        <div className=\"flex items-center gap-2\">\n          <Select value={selectedPeriod} onValueChange={setSelectedPeriod}>\n            <SelectTrigger className=\"w-48\" data-testid=\"select-payroll-period\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              {periods.map((period) => (\n                <SelectItem key={period.value} value={period.value}>\n                  {period.label}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n          <Button\n            variant=\"outline\"\n            onClick={() => exportMutation.mutate()}\n            disabled={exportMutation.isPending}\n            data-testid=\"button-export-payroll\"\n          >\n            <Download className=\"mr-2 h-4 w-4\" />\n            {t(\"common.export\")}\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n              <DollarSign className=\"h-4 w-4\" />\n              {t(\"payroll.totalAmount\")}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <Skeleton className=\"h-8 w-24\" />\n            ) : (\n              <div className=\"text-2xl font-bold\" data-testid=\"text-total-amount\">\n                ${totalAmount.toFixed(2)}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n              <Clock className=\"h-4 w-4\" />\n              {t(\"payroll.regularHours\")}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <Skeleton className=\"h-8 w-24\" />\n            ) : (\n              <div className=\"text-2xl font-bold\">{totalRegularHours.toFixed(1)}h</div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n              <Moon className=\"h-4 w-4\" />\n              {t(\"payroll.overtimeHours\")}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <Skeleton className=\"h-8 w-24\" />\n            ) : (\n              <div className=\"text-2xl font-bold\">{totalOvertimeHours.toFixed(1)}h</div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n              <Umbrella className=\"h-4 w-4\" />\n              {t(\"payroll.vacationDays\")}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <Skeleton className=\"h-8 w-24\" />\n            ) : (\n              <div className=\"text-2xl font-bold\">\n                {payrollRecords?.reduce((sum, r) => sum + (r.vacationDays || 0), 0) ?? 0}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>{t(\"payroll.period\")}</CardTitle>\n        </CardHeader>\n        <CardContent className=\"p-0\">\n          <div className=\"overflow-x-auto\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Employee</TableHead>\n                  <TableHead className=\"text-right\">{t(\"payroll.regularHours\")}</TableHead>\n                  <TableHead className=\"text-right\">{t(\"payroll.overtimeHours\")}</TableHead>\n                  <TableHead className=\"text-right\">{t(\"payroll.nightHours\")}</TableHead>\n                  <TableHead className=\"text-right\">{t(\"payroll.vacationDays\")}</TableHead>\n                  <TableHead className=\"text-right\">{t(\"payroll.sickDays\")}</TableHead>\n                  <TableHead className=\"text-right\">{t(\"payroll.totalAmount\")}</TableHead>\n                  <TableHead>{t(\"common.status\")}</TableHead>\n                  <TableHead className=\"text-right\">{t(\"common.actions\")}</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {isLoading ? (\n                  Array.from({ length: 5 }).map((_, i) => (\n                    <TableRow key={i}>\n                      {Array.from({ length: 9 }).map((_, j) => (\n                        <TableCell key={j}>\n                          <Skeleton className=\"h-4 w-16\" />\n                        </TableCell>\n                      ))}\n                    </TableRow>\n                  ))\n                ) : payrollRecords?.length === 0 ? (\n                  <TableRow>\n                    <TableCell colSpan={9} className=\"text-center py-8 text-muted-foreground\">\n                      No payroll records for this period\n                    </TableCell>\n                  </TableRow>\n                ) : (\n                  payrollRecords?.map((record) => (\n                    <TableRow key={record.id} data-testid={`payroll-row-${record.id}`}>\n                      <TableCell className=\"font-medium\">{record.userId}</TableCell>\n                      <TableCell className=\"text-right\">{record.regularHours}h</TableCell>\n                      <TableCell className=\"text-right\">{record.overtimeHours}h</TableCell>\n                      <TableCell className=\"text-right\">{record.nightHours}h</TableCell>\n                      <TableCell className=\"text-right\">{record.vacationDays}</TableCell>\n                      <TableCell className=\"text-right\">{record.sickDays}</TableCell>\n                      <TableCell className=\"text-right font-semibold\">\n                        ${parseFloat(record.totalAmount || \"0\").toFixed(2)}\n                      </TableCell>\n                      <TableCell>{getStatusBadge(record.status || \"pending\")}</TableCell>\n                      <TableCell className=\"text-right\">\n                        {record.status !== \"paid\" && (\n                          <Button\n                            size=\"sm\"\n                            variant=\"outline\"\n                            onClick={() => markPaidMutation.mutate(record.id)}\n                            disabled={markPaidMutation.isPending}\n                            data-testid={`button-mark-paid-${record.id}`}\n                          >\n                            <Check className=\"mr-1 h-3 w-3\" />\n                            {t(\"payroll.markAsPaid\")}\n                          </Button>\n                        )}\n                      </TableCell>\n                    </TableRow>\n                  ))\n                )}\n              </TableBody>\n            </Table>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":10031,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":4050,"size_tokens":null},"server/objectAcl.ts":{"content":"// Object ACL for protected file uploads - javascript_object_storage blueprint\nimport { File } from \"@google-cloud/storage\";\n\nconst ACL_POLICY_METADATA_KEY = \"custom:aclPolicy\";\n\nexport enum ObjectAccessGroupType {}\n\nexport interface ObjectAccessGroup {\n  type: ObjectAccessGroupType;\n  id: string;\n}\n\nexport enum ObjectPermission {\n  READ = \"read\",\n  WRITE = \"write\",\n}\n\nexport interface ObjectAclRule {\n  group: ObjectAccessGroup;\n  permission: ObjectPermission;\n}\n\nexport interface ObjectAclPolicy {\n  owner: string;\n  visibility: \"public\" | \"private\";\n  aclRules?: Array<ObjectAclRule>;\n}\n\nfunction isPermissionAllowed(\n  requested: ObjectPermission,\n  granted: ObjectPermission,\n): boolean {\n  if (requested === ObjectPermission.READ) {\n    return [ObjectPermission.READ, ObjectPermission.WRITE].includes(granted);\n  }\n  return granted === ObjectPermission.WRITE;\n}\n\nabstract class BaseObjectAccessGroup implements ObjectAccessGroup {\n  constructor(\n    public readonly type: ObjectAccessGroupType,\n    public readonly id: string,\n  ) {}\n\n  public abstract hasMember(userId: string): Promise<boolean>;\n}\n\nfunction createObjectAccessGroup(\n  group: ObjectAccessGroup,\n): BaseObjectAccessGroup {\n  switch (group.type) {\n    default:\n      throw new Error(`Unknown access group type: ${group.type}`);\n  }\n}\n\nexport async function setObjectAclPolicy(\n  objectFile: File,\n  aclPolicy: ObjectAclPolicy,\n): Promise<void> {\n  const [exists] = await objectFile.exists();\n  if (!exists) {\n    throw new Error(`Object not found: ${objectFile.name}`);\n  }\n\n  await objectFile.setMetadata({\n    metadata: {\n      [ACL_POLICY_METADATA_KEY]: JSON.stringify(aclPolicy),\n    },\n  });\n}\n\nexport async function getObjectAclPolicy(\n  objectFile: File,\n): Promise<ObjectAclPolicy | null> {\n  const [metadata] = await objectFile.getMetadata();\n  const aclPolicy = metadata?.metadata?.[ACL_POLICY_METADATA_KEY];\n  if (!aclPolicy) {\n    return null;\n  }\n  return JSON.parse(aclPolicy as string);\n}\n\nexport async function canAccessObject({\n  userId,\n  objectFile,\n  requestedPermission,\n}: {\n  userId?: string;\n  objectFile: File;\n  requestedPermission: ObjectPermission;\n}): Promise<boolean> {\n  const aclPolicy = await getObjectAclPolicy(objectFile);\n  if (!aclPolicy) {\n    return false;\n  }\n\n  if (\n    aclPolicy.visibility === \"public\" &&\n    requestedPermission === ObjectPermission.READ\n  ) {\n    return true;\n  }\n\n  if (!userId) {\n    return false;\n  }\n\n  if (aclPolicy.owner === userId) {\n    return true;\n  }\n\n  for (const rule of aclPolicy.aclRules || []) {\n    const accessGroup = createObjectAccessGroup(rule.group);\n    if (\n      (await accessGroup.hasMember(userId)) &&\n      isPermissionAllowed(requestedPermission, rule.permission)\n    ) {\n      return true;\n    }\n  }\n\n  return false;\n}\n","path":null,"size_bytes":2786,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n  --opaque-button-border-intensity: -8;\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n  --background: 0 0% 100%;\n  --foreground: 25 15% 15%;\n  --border: 30 8% 92%;\n  --card: 30 5% 98%;\n  --card-foreground: 25 15% 15%;\n  --card-border: 30 6% 95%;\n  --sidebar: 30 6% 96%;\n  --sidebar-foreground: 25 18% 12%;\n  --sidebar-border: 30 7% 93%;\n  --sidebar-primary: 18 100% 60%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 30 8% 91%;\n  --sidebar-accent-foreground: 25 18% 12%;\n  --sidebar-ring: 18 95% 55%;\n  --popover: 30 6% 94%;\n  --popover-foreground: 25 18% 12%;\n  --popover-border: 30 7% 91%;\n  --primary: 18 100% 55%;\n  --primary-foreground: 0 0% 100%;\n  --secondary: 30 10% 90%;\n  --secondary-foreground: 25 20% 10%;\n  --muted: 30 8% 92%;\n  --muted-foreground: 25 12% 35%;\n  --accent: 30 12% 93%;\n  --accent-foreground: 25 18% 12%;\n  --destructive: 0 84% 45%;\n  --destructive-foreground: 0 0% 100%;\n  --input: 30 10% 75%;\n  --ring: 18 95% 55%;\n  --chart-1: 18 100% 45%;\n  --chart-2: 25 75% 35%;\n  --chart-3: 200 70% 40%;\n  --chart-4: 280 65% 45%;\n  --chart-5: 140 60% 38%;\n  --font-sans: Open Sans, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --radius: .5rem;\n  --shadow-2xs: 0px 2px 0px 0px hsl(25 10% 20% / 0.02);\n  --shadow-xs: 0px 2px 0px 0px hsl(25 10% 20% / 0.04);\n  --shadow-sm: 0px 2px 0px 0px hsl(25 10% 20% / 0.05), 0px 1px 2px -1px hsl(25 10% 20% / 0.08);\n  --shadow: 0px 2px 0px 0px hsl(25 10% 20% / 0.06), 0px 1px 2px -1px hsl(25 10% 20% / 0.10);\n  --shadow-md: 0px 2px 0px 0px hsl(25 10% 20% / 0.07), 0px 2px 4px -1px hsl(25 10% 20% / 0.12);\n  --shadow-lg: 0px 2px 0px 0px hsl(25 10% 20% / 0.08), 0px 4px 6px -1px hsl(25 10% 20% / 0.15);\n  --shadow-xl: 0px 2px 0px 0px hsl(25 10% 20% / 0.10), 0px 8px 10px -1px hsl(25 10% 20% / 0.18);\n  --shadow-2xl: 0px 2px 0px 0px hsl(25 10% 20% / 0.15);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n  --opaque-button-border-intensity: 9;\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n  --background: 25 8% 8%;\n  --foreground: 30 5% 95%;\n  --border: 25 6% 18%;\n  --card: 25 7% 10%;\n  --card-foreground: 30 5% 95%;\n  --card-border: 25 7% 13%;\n  --sidebar: 25 8% 12%;\n  --sidebar-foreground: 30 8% 92%;\n  --sidebar-border: 25 8% 15%;\n  --sidebar-primary: 18 100% 60%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 25 10% 16%;\n  --sidebar-accent-foreground: 30 8% 92%;\n  --sidebar-ring: 18 95% 55%;\n  --popover: 25 9% 14%;\n  --popover-foreground: 30 8% 92%;\n  --popover-border: 25 9% 17%;\n  --primary: 18 100% 55%;\n  --primary-foreground: 0 0% 100%;\n  --secondary: 25 12% 18%;\n  --secondary-foreground: 30 10% 95%;\n  --muted: 25 10% 16%;\n  --muted-foreground: 30 8% 65%;\n  --accent: 25 11% 15%;\n  --accent-foreground: 30 8% 92%;\n  --destructive: 0 84% 45%;\n  --destructive-foreground: 0 0% 100%;\n  --input: 25 12% 30%;\n  --ring: 18 95% 55%;\n  --chart-1: 18 100% 65%;\n  --chart-2: 25 80% 60%;\n  --chart-3: 200 75% 60%;\n  --chart-4: 280 70% 65%;\n  --chart-5: 140 65% 58%;\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.15);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.20);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.25), 0px 1px 2px -1px hsl(0 0% 0% / 0.30);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.30), 0px 1px 2px -1px hsl(0 0% 0% / 0.35);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.35), 0px 2px 4px -1px hsl(0 0% 0% / 0.40);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.40), 0px 4px 6px -1px hsl(0 0% 0% / 0.45);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.45), 0px 8px 10px -1px hsl(0 0% 0% / 0.50);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.55);\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n","path":null,"size_bytes":10632,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { WebSocketServer, WebSocket } from \"ws\";\nimport bcrypt from \"bcrypt\";\nimport { storage } from \"./storage\";\nimport { setupAuth, isAuthenticated } from \"./replitAuth\";\nimport { ObjectStorageService, ObjectNotFoundError } from \"./objectStorage\";\nimport { ObjectPermission } from \"./objectAcl\";\nimport {\n  insertTimeRecordSchema,\n  insertToolSchema,\n  insertToolTransactionSchema,\n  insertLeaveRequestSchema,\n  insertSiteSchema,\n  insertClientSchema,\n  insertContestationSchema,\n  insertSiteAssignmentSchema,\n} from \"@shared/schema\";\n\n// Store connected WebSocket clients by room\nconst chatClients = new Map<string, Map<string, WebSocket>>();\n\nfunction broadcastToRoom(roomId: string, message: any, excludeUserId?: string) {\n  const roomClients = chatClients.get(roomId);\n  if (!roomClients) return;\n  \n  const messageStr = JSON.stringify(message);\n  roomClients.forEach((ws, odId) => {\n    if (excludeUserId && odId === excludeUserId) return;\n    if (ws.readyState === WebSocket.OPEN) {\n      ws.send(messageStr);\n    }\n  });\n}\n\nexport async function registerRoutes(\n  httpServer: Server,\n  app: Express\n): Promise<Server> {\n  // Setup Replit Auth\n  await setupAuth(app);\n\n  // Local Auth - Register (creates tenant and sets user as admin)\n  app.post(\"/api/auth/register\", async (req: any, res) => {\n    try {\n      const { username, password, email, firstName, lastName, companyName, subscriptionPlan } = req.body;\n      \n      if (!username || !password) {\n        return res.status(400).json({ message: \"Username and password are required\" });\n      }\n      \n      if (!companyName) {\n        return res.status(400).json({ message: \"Company name is required\" });\n      }\n      \n      const existingUser = await storage.getUserByUsername(username);\n      if (existingUser) {\n        return res.status(400).json({ message: \"Username already exists\" });\n      }\n      \n      if (email) {\n        const existingEmail = await storage.getUserByEmail(email);\n        if (existingEmail) {\n          return res.status(400).json({ message: \"Email already exists\" });\n        }\n      }\n      \n      // Check if company name already exists\n      const existingTenant = await storage.getTenantByName(companyName);\n      if (existingTenant) {\n        return res.status(400).json({ message: \"A company with this name already exists\" });\n      }\n      \n      // Create the tenant first\n      const tenant = await storage.createTenant({\n        name: companyName,\n        email: email || \"\",\n        subscriptionPlan: subscriptionPlan || \"basic\",\n        subscriptionStatus: \"active\",\n      });\n      \n      // Create the user as admin of the new tenant\n      const hashedPassword = await bcrypt.hash(password, 10);\n      const user = await storage.createUser({\n        username,\n        password: hashedPassword,\n        email,\n        firstName,\n        lastName,\n        role: \"admin\",\n        tenantId: tenant.id,\n        isActive: true,\n      });\n      \n      req.login({ claims: { sub: user.id }, localAuth: true }, (err: any) => {\n        if (err) {\n          return res.status(500).json({ message: \"Failed to login after registration\" });\n        }\n        const { password: _, ...userWithoutPassword } = user;\n        res.json({ ...userWithoutPassword, tenant });\n      });\n    } catch (error) {\n      console.error(\"Error registering user:\", error);\n      res.status(500).json({ message: \"Failed to register user\" });\n    }\n  });\n\n  // Local Auth - Login\n  app.post(\"/api/auth/local-login\", async (req: any, res) => {\n    try {\n      const { username, password } = req.body;\n      \n      if (!username || !password) {\n        return res.status(400).json({ message: \"Username and password are required\" });\n      }\n      \n      const user = await storage.getUserByUsername(username);\n      if (!user || !user.password) {\n        return res.status(401).json({ message: \"Invalid username or password\" });\n      }\n      \n      const isValidPassword = await bcrypt.compare(password, user.password);\n      if (!isValidPassword) {\n        return res.status(401).json({ message: \"Invalid username or password\" });\n      }\n      \n      if (!user.isActive) {\n        return res.status(403).json({ message: \"Account is disabled\" });\n      }\n      \n      req.login({ claims: { sub: user.id }, localAuth: true }, (err: any) => {\n        if (err) {\n          return res.status(500).json({ message: \"Failed to login\" });\n        }\n        const { password: _, ...userWithoutPassword } = user;\n        res.json(userWithoutPassword);\n      });\n    } catch (error) {\n      console.error(\"Error logging in:\", error);\n      res.status(500).json({ message: \"Failed to login\" });\n    }\n  });\n\n  // Local Auth - Logout\n  app.post(\"/api/auth/local-logout\", (req: any, res) => {\n    req.logout((err: any) => {\n      if (err) {\n        return res.status(500).json({ message: \"Failed to logout\" });\n      }\n      req.session.destroy((err: any) => {\n        if (err) {\n          console.error(\"Error destroying session:\", err);\n        }\n        res.clearCookie(\"connect.sid\");\n        res.json({ success: true });\n      });\n    });\n  });\n\n  // Seed route - create default test users for development\n  app.post(\"/api/seed/users\", async (req: any, res) => {\n    try {\n      // First create a default tenant if none exists\n      let tenant = await storage.getTenantByName(\"ConstructTrack Demo\");\n      if (!tenant) {\n        tenant = await storage.createTenant({\n          name: \"ConstructTrack Demo\",\n          email: \"demo@constructtrack.com\",\n          phone: \"+1234567890\",\n          address: \"123 Construction Ave\",\n          subscriptionPlan: \"professional\",\n          subscriptionStatus: \"active\",\n        });\n      }\n\n      const testUsers = [\n        { username: \"superadmin\", password: \"superadmin123\", role: \"superadmin\", firstName: \"Super\", lastName: \"Admin\", email: \"superadmin@constructtrack.com\" },\n        { username: \"admin\", password: \"admin123\", role: \"admin\", firstName: \"Admin\", lastName: \"User\", email: \"admin@constructtrack.com\" },\n        { username: \"manager\", password: \"manager123\", role: \"manager\", firstName: \"Manager\", lastName: \"User\", email: \"manager@constructtrack.com\" },\n        { username: \"employee\", password: \"employee123\", role: \"employee\", firstName: \"Employee\", lastName: \"User\", email: \"employee@constructtrack.com\" },\n        { username: \"client\", password: \"client123\", role: \"client\", firstName: \"Client\", lastName: \"User\", email: \"client@constructtrack.com\" },\n      ];\n\n      const createdUsers = [];\n      for (const userData of testUsers) {\n        let user = await storage.getUserByUsername(userData.username);\n        if (!user) {\n          const hashedPassword = await bcrypt.hash(userData.password, 10);\n          user = await storage.createUser({\n            username: userData.username,\n            password: hashedPassword,\n            role: userData.role,\n            firstName: userData.firstName,\n            lastName: userData.lastName,\n            email: userData.email,\n            tenantId: userData.role !== \"superadmin\" ? tenant.id : undefined,\n            isActive: true,\n          });\n          createdUsers.push({ username: userData.username, role: userData.role, created: true });\n        } else {\n          createdUsers.push({ username: userData.username, role: userData.role, created: false, message: \"already exists\" });\n        }\n      }\n\n      res.json({ message: \"Seed completed\", tenant: { id: tenant.id, name: tenant.name }, users: createdUsers });\n    } catch (error) {\n      console.error(\"Error seeding users:\", error);\n      res.status(500).json({ message: \"Failed to seed users\", error: String(error) });\n    }\n  });\n\n  // Helper to get effective tenantId (impersonated or user's own)\n  const getEffectiveTenantId = (req: any, user: { role: string; tenantId?: string | null }): string | null => {\n    // If superadmin and impersonating, use impersonated tenant\n    if (user.role === \"superadmin\" && req.session?.impersonatedTenantId) {\n      return req.session.impersonatedTenantId;\n    }\n    return user.tenantId || null;\n  };\n\n  // Auth routes - supports both Replit Auth and local auth\n  app.get(\"/api/auth/user\", async (req: any, res) => {\n    if (!req.isAuthenticated() || !req.user?.claims?.sub) {\n      return res.status(401).json({ message: \"Unauthorized\" });\n    }\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      if (user) {\n        const { password: _, ...userWithoutPassword } = user;\n        \n        // Include impersonation info for superadmins\n        const impersonation = user.role === \"superadmin\" && req.session.impersonatedTenantId ? {\n          isImpersonating: true,\n          impersonatedTenantId: req.session.impersonatedTenantId,\n          impersonatedTenantName: req.session.impersonatedTenantName,\n        } : null;\n        \n        res.json({\n          ...userWithoutPassword,\n          impersonation,\n        });\n      } else {\n        res.status(404).json({ message: \"User not found\" });\n      }\n    } catch (error) {\n      console.error(\"Error fetching user:\", error);\n      res.status(500).json({ message: \"Failed to fetch user\" });\n    }\n  });\n\n  // Analytics routes\n  app.get(\"/api/analytics/hours-by-site\", isAuthenticated, async (req: any, res) => {\n    try {\n      const user = await storage.getUser(req.user.claims.sub);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      const effectiveTenantId = getEffectiveTenantId(req, user);\n      if (!effectiveTenantId) {\n        return res.status(400).json({ message: \"No tenant context\" });\n      }\n      \n      const sites = await storage.getSitesByTenant(effectiveTenantId);\n      const timeRecords = await storage.getTimeRecordsByTenant(effectiveTenantId);\n      \n      const hoursBySite = sites.map(site => {\n        const siteRecords = timeRecords.filter(r => r.siteId === site.id);\n        const totalHours = siteRecords.reduce((sum, r) => sum + parseFloat(r.totalHours || \"0\"), 0);\n        const overtimeHours = siteRecords.reduce((sum, r) => sum + parseFloat(r.overtimeHours || \"0\"), 0);\n        return {\n          siteId: site.id,\n          siteName: site.name,\n          totalHours: Math.round(totalHours * 10) / 10,\n          overtimeHours: Math.round(overtimeHours * 10) / 10,\n          recordCount: siteRecords.length,\n        };\n      });\n      \n      res.json(hoursBySite);\n    } catch (error) {\n      console.error(\"Error fetching hours by site:\", error);\n      res.status(500).json({ message: \"Failed to fetch analytics\" });\n    }\n  });\n\n  app.get(\"/api/analytics/hours-trend\", isAuthenticated, async (req: any, res) => {\n    try {\n      const user = await storage.getUser(req.user.claims.sub);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      const effectiveTenantId = getEffectiveTenantId(req, user);\n      if (!effectiveTenantId) {\n        return res.status(400).json({ message: \"No tenant context\" });\n      }\n      \n      const timeRecords = await storage.getTimeRecordsByTenant(effectiveTenantId);\n      const days = parseInt(req.query.days as string) || 30;\n      const now = new Date();\n      \n      const trendData: { date: string; hours: number; overtime: number }[] = [];\n      \n      for (let i = days - 1; i >= 0; i--) {\n        const date = new Date(now);\n        date.setDate(date.getDate() - i);\n        date.setHours(0, 0, 0, 0);\n        const nextDate = new Date(date);\n        nextDate.setDate(nextDate.getDate() + 1);\n        \n        const dayRecords = timeRecords.filter(r => {\n          const checkIn = new Date(r.checkInTime);\n          return checkIn >= date && checkIn < nextDate;\n        });\n        \n        const hours = dayRecords.reduce((sum, r) => sum + parseFloat(r.totalHours || \"0\"), 0);\n        const overtime = dayRecords.reduce((sum, r) => sum + parseFloat(r.overtimeHours || \"0\"), 0);\n        \n        trendData.push({\n          date: date.toISOString().split('T')[0],\n          hours: Math.round(hours * 10) / 10,\n          overtime: Math.round(overtime * 10) / 10,\n        });\n      }\n      \n      res.json(trendData);\n    } catch (error) {\n      console.error(\"Error fetching hours trend:\", error);\n      res.status(500).json({ message: \"Failed to fetch analytics\" });\n    }\n  });\n\n  app.get(\"/api/analytics/tool-usage\", isAuthenticated, async (req: any, res) => {\n    try {\n      const user = await storage.getUser(req.user.claims.sub);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      const effectiveTenantId = getEffectiveTenantId(req, user);\n      if (!effectiveTenantId) {\n        return res.status(400).json({ message: \"No tenant context\" });\n      }\n      \n      const tools = await storage.getToolsByTenant(effectiveTenantId);\n      \n      const statusCounts = {\n        available: tools.filter(t => t.status === \"available\").length,\n        in_use: tools.filter(t => t.status === \"in_use\").length,\n        maintenance: tools.filter(t => t.status === \"maintenance\").length,\n        lost: tools.filter(t => t.status === \"lost\").length,\n        stolen: tools.filter(t => t.status === \"stolen\").length,\n      };\n      \n      const toolsByCategory: Record<string, number> = {};\n      tools.forEach(tool => {\n        const category = tool.category || \"Other\";\n        toolsByCategory[category] = (toolsByCategory[category] || 0) + 1;\n      });\n      \n      res.json({\n        total: tools.length,\n        statusCounts,\n        byCategory: Object.entries(toolsByCategory).map(([name, value]) => ({ name, value })),\n      });\n    } catch (error) {\n      console.error(\"Error fetching tool usage:\", error);\n      res.status(500).json({ message: \"Failed to fetch analytics\" });\n    }\n  });\n\n  app.get(\"/api/analytics/payroll-summary\", isAuthenticated, async (req: any, res) => {\n    try {\n      const user = await storage.getUser(req.user.claims.sub);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      const effectiveTenantId = getEffectiveTenantId(req, user);\n      if (!effectiveTenantId) {\n        return res.status(400).json({ message: \"No tenant context\" });\n      }\n      \n      const payrollRecords = await storage.getPayrollRecordsByTenant(effectiveTenantId);\n      const users = await storage.getUsersByTenant(effectiveTenantId);\n      \n      const summary = {\n        totalPaid: payrollRecords\n          .filter(p => p.status === \"paid\")\n          .reduce((sum, p) => sum + parseFloat(p.totalAmount || \"0\"), 0),\n        totalPending: payrollRecords\n          .filter(p => p.status === \"pending\" || p.status === \"processing\")\n          .reduce((sum, p) => sum + parseFloat(p.totalAmount || \"0\"), 0),\n        totalRegularHours: payrollRecords.reduce((sum, p) => sum + parseFloat(p.regularHours || \"0\"), 0),\n        totalOvertimeHours: payrollRecords.reduce((sum, p) => sum + parseFloat(p.overtimeHours || \"0\"), 0),\n        employeeCount: users.filter(u => u.role === \"employee\").length,\n        recordCount: payrollRecords.length,\n      };\n      \n      // Monthly breakdown for the last 6 months\n      const monthlyData: { month: string; amount: number; hours: number }[] = [];\n      const now = new Date();\n      \n      for (let i = 5; i >= 0; i--) {\n        const date = new Date(now.getFullYear(), now.getMonth() - i, 1);\n        const monthStr = date.toISOString().slice(0, 7);\n        \n        const monthRecords = payrollRecords.filter(p => {\n          const period = p.periodStart ? new Date(p.periodStart) : null;\n          return period && period.toISOString().slice(0, 7) === monthStr;\n        });\n        \n        monthlyData.push({\n          month: monthStr,\n          amount: Math.round(monthRecords.reduce((sum, p) => sum + parseFloat(p.totalAmount || \"0\"), 0) * 100) / 100,\n          hours: Math.round(monthRecords.reduce((sum, p) => sum + parseFloat(p.regularHours || \"0\") + parseFloat(p.overtimeHours || \"0\"), 0) * 10) / 10,\n        });\n      }\n      \n      res.json({ ...summary, monthlyData });\n    } catch (error) {\n      console.error(\"Error fetching payroll summary:\", error);\n      res.status(500).json({ message: \"Failed to fetch analytics\" });\n    }\n  });\n\n  // Service Order Calculator\n  app.get(\"/api/service-orders/calculate\", isAuthenticated, async (req: any, res) => {\n    // Helper to safely parse numeric values, returning 0 for NaN/null/undefined\n    const safeParseFloat = (value: any): number => {\n      if (value === null || value === undefined) return 0;\n      const parsed = parseFloat(String(value).replace(',', '.'));\n      return isNaN(parsed) ? 0 : parsed;\n    };\n    \n    try {\n      const user = await storage.getUser(req.user.claims.sub);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      const effectiveTenantId = getEffectiveTenantId(req, user);\n      if (!effectiveTenantId) {\n        return res.status(400).json({ message: \"No tenant context\" });\n      }\n      \n      // Only managers, admins, and superadmins can access\n      if (user.role !== \"admin\" && user.role !== \"manager\" && user.role !== \"superadmin\") {\n        return res.status(403).json({ message: \"Insufficient permissions\" });\n      }\n      \n      const { startDate, endDate, siteId, clientId } = req.query;\n      \n      if (!startDate || !endDate) {\n        return res.status(400).json({ message: \"Start and end dates are required\" });\n      }\n      \n      const start = new Date(startDate as string);\n      const end = new Date(endDate as string);\n      \n      // Validate dates\n      if (isNaN(start.getTime()) || isNaN(end.getTime())) {\n        return res.status(400).json({ message: \"Invalid date format\" });\n      }\n      if (start > end) {\n        return res.status(400).json({ message: \"Start date must be before end date\" });\n      }\n      \n      end.setHours(23, 59, 59, 999);\n      \n      const sites = await storage.getSitesByTenant(effectiveTenantId);\n      const clients = await storage.getClientsByTenant(effectiveTenantId);\n      const timeRecords = await storage.getTimeRecordsByTenant(effectiveTenantId);\n      const users = await storage.getUsersByTenant(effectiveTenantId);\n      \n      // Filter sites - empty string or \"all\" means no filter\n      let filteredSites = sites;\n      if (siteId && siteId !== \"all\" && siteId !== \"\") {\n        filteredSites = filteredSites.filter(s => s.id === siteId);\n      }\n      if (clientId && clientId !== \"all\" && clientId !== \"\") {\n        filteredSites = filteredSites.filter(s => s.clientId === clientId);\n      }\n      \n      const serviceOrders = [];\n      \n      for (const site of filteredSites) {\n        // Filter time records for this site within the date range\n        const siteRecords = timeRecords.filter(record => {\n          if (record.siteId !== site.id) return false;\n          const checkIn = new Date(record.checkInTime);\n          return checkIn >= start && checkIn <= end;\n        });\n        \n        if (siteRecords.length === 0) continue;\n        \n        const approvedRecords = siteRecords.filter(r => r.status === \"approved\");\n        const pendingRecords = siteRecords.filter(r => r.status === \"pending\");\n        \n        let totalHours = 0;\n        let overtimeHours = 0;\n        const workerSet = new Set<string>();\n        const workDaysSet = new Set<string>();\n        \n        // Only calculate from approved records\n        for (const record of approvedRecords) {\n          totalHours += safeParseFloat(record.totalHours);\n          overtimeHours += safeParseFloat(record.overtimeHours);\n          workerSet.add(record.userId);\n          const checkInDate = new Date(record.checkInTime);\n          workDaysSet.add(`${checkInDate.getFullYear()}-${checkInDate.getMonth()}-${checkInDate.getDate()}`);\n        }\n        \n        const regularHours = Math.max(0, totalHours - overtimeHours);\n        const hourlyRate = safeParseFloat(site.hourlyRate);\n        const overtimeMultiplier = 1.5;\n        \n        let regularCost = 0;\n        let overtimeCost = 0;\n        \n        if (site.billingType === \"hourly\") {\n          regularCost = regularHours * hourlyRate;\n          overtimeCost = overtimeHours * hourlyRate * overtimeMultiplier;\n        } else if (site.billingType === \"daily\") {\n          // Daily rate: hourlyRate is the daily rate in this case\n          const dailyRate = hourlyRate;\n          regularCost = workDaysSet.size * dailyRate;\n          overtimeCost = overtimeHours * (dailyRate / 8) * overtimeMultiplier;\n        } else if (site.billingType === \"fixed\") {\n          // Fixed: hourlyRate represents the fixed project rate, no overtime calculation\n          regularCost = hourlyRate;\n          overtimeCost = 0;\n        }\n        \n        const client = clients.find(c => c.id === site.clientId);\n        const workerNames = Array.from(workerSet).map(userId => {\n          const u = users.find(usr => usr.id === userId);\n          return u ? `${u.firstName || \"\"} ${u.lastName || \"\"}`.trim() || u.email || userId : userId;\n        });\n        \n        serviceOrders.push({\n          siteId: site.id,\n          siteName: site.name,\n          clientId: site.clientId,\n          clientName: client?.name || \"Unknown\",\n          billingType: site.billingType || \"hourly\",\n          hourlyRate,\n          totalHours: Math.round(totalHours * 100) / 100,\n          overtimeHours: Math.round(overtimeHours * 100) / 100,\n          regularHours: Math.round(regularHours * 100) / 100,\n          approvedRecords: approvedRecords.length,\n          pendingRecords: pendingRecords.length,\n          regularCost: Math.round(regularCost * 100) / 100,\n          overtimeCost: Math.round(overtimeCost * 100) / 100,\n          totalCost: Math.round((regularCost + overtimeCost) * 100) / 100,\n          workers: workerNames,\n          workerIds: Array.from(workerSet),\n          workDays: workDaysSet.size,\n        });\n      }\n      \n      // Sort by total cost descending\n      serviceOrders.sort((a, b) => b.totalCost - a.totalCost);\n      \n      // Calculate totals\n      const totals = serviceOrders.reduce(\n        (acc, order) => ({\n          totalHours: acc.totalHours + order.totalHours,\n          overtimeHours: acc.overtimeHours + order.overtimeHours,\n          totalCost: acc.totalCost + order.totalCost,\n          approvedRecords: acc.approvedRecords + order.approvedRecords,\n          pendingRecords: acc.pendingRecords + order.pendingRecords,\n        }),\n        { totalHours: 0, overtimeHours: 0, totalCost: 0, approvedRecords: 0, pendingRecords: 0 }\n      );\n      \n      res.json({\n        orders: serviceOrders,\n        totals: {\n          totalHours: Math.round(totals.totalHours * 100) / 100,\n          overtimeHours: Math.round(totals.overtimeHours * 100) / 100,\n          totalCost: Math.round(totals.totalCost * 100) / 100,\n          approvedRecords: totals.approvedRecords,\n          pendingRecords: totals.pendingRecords,\n        },\n        period: { startDate, endDate },\n        overtimeMultiplier: 1.5,\n      });\n    } catch (error) {\n      console.error(\"Error calculating service orders:\", error);\n      res.status(500).json({ message: \"Failed to calculate service orders\" });\n    }\n  });\n\n  // Dashboard stats\n  app.get(\"/api/dashboard/stats\", isAuthenticated, async (req: any, res) => {\n    try {\n      const user = await storage.getUser(req.user.claims.sub);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      const effectiveTenantId = getEffectiveTenantId(req, user);\n      if (!effectiveTenantId) {\n        return res.status(400).json({ message: \"No tenant context\" });\n      }\n      \n      const timeRecords = await storage.getTimeRecordsByTenant(effectiveTenantId);\n      const tools = await storage.getToolsByTenant(effectiveTenantId);\n      \n      const today = new Date();\n      today.setHours(0, 0, 0, 0);\n      \n      const activeWorkers = timeRecords.filter(r => \n        r.checkInTime && !r.checkOutTime\n      ).length;\n      \n      const todayRecords = timeRecords.filter(r => {\n        const checkIn = new Date(r.checkInTime);\n        return checkIn >= today;\n      });\n      \n      const hoursToday = todayRecords.reduce((sum, r) => {\n        return sum + parseFloat(r.totalHours || \"0\");\n      }, 0);\n      \n      const pendingApprovals = timeRecords.filter(r => r.status === \"pending\").length;\n      const toolsOut = tools.filter(t => t.status === \"in_use\").length;\n      \n      res.json({\n        activeWorkers,\n        hoursToday: Math.round(hoursToday * 10) / 10,\n        pendingApprovals,\n        toolsOut,\n      });\n    } catch (error) {\n      console.error(\"Error fetching dashboard stats:\", error);\n      res.status(500).json({ message: \"Failed to fetch stats\" });\n    }\n  });\n\n  // Tenant/Company routes\n  app.get(\"/api/tenant\", isAuthenticated, async (req: any, res) => {\n    try {\n      const user = await storage.getUser(req.user.claims.sub);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      const effectiveTenantId = getEffectiveTenantId(req, user);\n      if (!effectiveTenantId) {\n        return res.status(400).json({ message: \"No tenant context\" });\n      }\n      const tenant = await storage.getTenant(effectiveTenantId);\n      if (!tenant) {\n        return res.status(404).json({ message: \"Tenant not found\" });\n      }\n      res.json(tenant);\n    } catch (error) {\n      console.error(\"Error fetching tenant:\", error);\n      res.status(500).json({ message: \"Failed to fetch tenant\" });\n    }\n  });\n\n  app.patch(\"/api/tenant\", isAuthenticated, async (req: any, res) => {\n    try {\n      const user = await storage.getUser(req.user.claims.sub);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      const effectiveTenantId = getEffectiveTenantId(req, user);\n      if (!effectiveTenantId) {\n        return res.status(400).json({ message: \"No tenant context\" });\n      }\n      // Only admins, managers, and impersonating superadmins can update tenant settings\n      if (user.role !== \"admin\" && user.role !== \"manager\" && user.role !== \"superadmin\") {\n        return res.status(403).json({ message: \"Insufficient permissions\" });\n      }\n      const tenant = await storage.updateTenant(effectiveTenantId, req.body);\n      res.json(tenant);\n    } catch (error) {\n      console.error(\"Error updating tenant:\", error);\n      res.status(500).json({ message: \"Failed to update tenant\" });\n    }\n  });\n\n  // User routes\n  app.get(\"/api/users\", isAuthenticated, async (req: any, res) => {\n    try {\n      const user = await storage.getUser(req.user.claims.sub);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      const effectiveTenantId = getEffectiveTenantId(req, user);\n      if (!effectiveTenantId) {\n        return res.status(400).json({ message: \"No tenant context\" });\n      }\n      const users = await storage.getUsersByTenant(effectiveTenantId);\n      res.json(users);\n    } catch (error) {\n      console.error(\"Error fetching users:\", error);\n      res.status(500).json({ message: \"Failed to fetch users\" });\n    }\n  });\n\n  app.patch(\"/api/users/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const user = await storage.updateUser(req.params.id, req.body);\n      res.json(user);\n    } catch (error) {\n      console.error(\"Error updating user:\", error);\n      res.status(500).json({ message: \"Failed to update user\" });\n    }\n  });\n\n  // Sites routes\n  app.get(\"/api/sites\", isAuthenticated, async (req: any, res) => {\n    try {\n      const user = await storage.getUser(req.user.claims.sub);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      const effectiveTenantId = getEffectiveTenantId(req, user);\n      if (!effectiveTenantId) {\n        return res.status(400).json({ message: \"No tenant context\" });\n      }\n      const sites = await storage.getSitesByTenant(effectiveTenantId);\n      res.json(sites);\n    } catch (error) {\n      console.error(\"Error fetching sites:\", error);\n      res.status(500).json({ message: \"Failed to fetch sites\" });\n    }\n  });\n\n  app.get(\"/api/sites/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const site = await storage.getSite(req.params.id);\n      res.json(site);\n    } catch (error) {\n      console.error(\"Error fetching site:\", error);\n      res.status(500).json({ message: \"Failed to fetch site\" });\n    }\n  });\n\n  app.post(\"/api/sites\", isAuthenticated, async (req: any, res) => {\n    try {\n      const user = await storage.getUser(req.user.claims.sub);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      const effectiveTenantId = getEffectiveTenantId(req, user);\n      if (!effectiveTenantId) {\n        return res.status(400).json({ message: \"No tenant context\" });\n      }\n      // Sanitize empty/whitespace strings to null for numeric fields\n      const sanitizedBody = { ...req.body };\n      const numericFields = ['hourlyRate', 'latitude', 'longitude', 'geofenceRadius'];\n      for (const field of numericFields) {\n        const val = sanitizedBody[field];\n        if (val === '' || val === undefined || (typeof val === 'string' && val.trim() === '')) {\n          sanitizedBody[field] = null;\n        }\n      }\n      const data = insertSiteSchema.parse({ ...sanitizedBody, tenantId: effectiveTenantId });\n      const site = await storage.createSite(data);\n      res.json(site);\n    } catch (error) {\n      console.error(\"Error creating site:\", error);\n      res.status(500).json({ message: \"Failed to create site\" });\n    }\n  });\n\n  app.patch(\"/api/sites/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      // Sanitize empty/whitespace strings to null for numeric fields\n      const sanitizedBody = { ...req.body };\n      const numericFields = ['hourlyRate', 'latitude', 'longitude', 'geofenceRadius'];\n      for (const field of numericFields) {\n        const val = sanitizedBody[field];\n        if (val === '' || (typeof val === 'string' && val.trim() === '')) {\n          sanitizedBody[field] = null;\n        }\n      }\n      const site = await storage.updateSite(req.params.id, sanitizedBody);\n      res.json(site);\n    } catch (error) {\n      console.error(\"Error updating site:\", error);\n      res.status(500).json({ message: \"Failed to update site\" });\n    }\n  });\n\n  app.delete(\"/api/sites/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      await storage.deleteSite(req.params.id);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting site:\", error);\n      res.status(500).json({ message: \"Failed to delete site\" });\n    }\n  });\n\n  // Site Assignments\n  app.get(\"/api/sites/:siteId/assignments\", isAuthenticated, async (req: any, res) => {\n    try {\n      const assignments = await storage.getSiteAssignmentsBySite(req.params.siteId);\n      res.json(assignments);\n    } catch (error) {\n      console.error(\"Error fetching assignments:\", error);\n      res.status(500).json({ message: \"Failed to fetch assignments\" });\n    }\n  });\n\n  app.post(\"/api/site-assignments\", isAuthenticated, async (req: any, res) => {\n    try {\n      const data = insertSiteAssignmentSchema.parse(req.body);\n      const assignment = await storage.createSiteAssignment(data);\n      res.json(assignment);\n    } catch (error) {\n      console.error(\"Error creating assignment:\", error);\n      res.status(500).json({ message: \"Failed to create assignment\" });\n    }\n  });\n\n  app.get(\"/api/my-assignments\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const assignments = await storage.getSiteAssignmentsByUser(userId);\n      res.json(assignments);\n    } catch (error) {\n      console.error(\"Error fetching assignments:\", error);\n      res.status(500).json({ message: \"Failed to fetch assignments\" });\n    }\n  });\n\n  // Clients routes\n  app.get(\"/api/clients\", isAuthenticated, async (req: any, res) => {\n    try {\n      const user = await storage.getUser(req.user.claims.sub);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      const effectiveTenantId = getEffectiveTenantId(req, user);\n      if (!effectiveTenantId) {\n        return res.status(400).json({ message: \"No tenant context\" });\n      }\n      const clients = await storage.getClientsByTenant(effectiveTenantId);\n      res.json(clients);\n    } catch (error) {\n      console.error(\"Error fetching clients:\", error);\n      res.status(500).json({ message: \"Failed to fetch clients\" });\n    }\n  });\n\n  app.post(\"/api/clients\", isAuthenticated, async (req: any, res) => {\n    try {\n      const user = await storage.getUser(req.user.claims.sub);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      const effectiveTenantId = getEffectiveTenantId(req, user);\n      if (!effectiveTenantId) {\n        return res.status(400).json({ message: \"No tenant context\" });\n      }\n      console.log(\"Creating client with body:\", req.body, \"tenantId:\", effectiveTenantId);\n      const data = insertClientSchema.parse({ ...req.body, tenantId: effectiveTenantId });\n      const client = await storage.createClient(data);\n      res.json(client);\n    } catch (error: any) {\n      console.error(\"Error creating client:\", error);\n      if (error.name === 'ZodError') {\n        return res.status(400).json({ message: \"Validation error\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to create client\", error: error.message });\n    }\n  });\n\n  app.patch(\"/api/clients/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const client = await storage.updateClient(req.params.id, req.body);\n      res.json(client);\n    } catch (error) {\n      console.error(\"Error updating client:\", error);\n      res.status(500).json({ message: \"Failed to update client\" });\n    }\n  });\n\n  app.delete(\"/api/clients/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      await storage.deleteClient(req.params.id);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting client:\", error);\n      res.status(500).json({ message: \"Failed to delete client\" });\n    }\n  });\n\n  // Time Records routes\n  app.get(\"/api/time-records\", isAuthenticated, async (req: any, res) => {\n    try {\n      const user = await storage.getUser(req.user.claims.sub);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      const effectiveTenantId = getEffectiveTenantId(req, user);\n      if (!effectiveTenantId) {\n        return res.status(400).json({ message: \"No tenant context\" });\n      }\n      const records = await storage.getTimeRecordsByTenant(effectiveTenantId);\n      res.json(records);\n    } catch (error) {\n      console.error(\"Error fetching time records:\", error);\n      res.status(500).json({ message: \"Failed to fetch time records\" });\n    }\n  });\n\n  app.get(\"/api/time-records/my\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const records = await storage.getTimeRecordsByUser(userId);\n      res.json(records);\n    } catch (error) {\n      console.error(\"Error fetching time records:\", error);\n      res.status(500).json({ message: \"Failed to fetch time records\" });\n    }\n  });\n\n  app.get(\"/api/time-records/active\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const record = await storage.getActiveTimeRecord(userId);\n      res.json(record || null);\n    } catch (error) {\n      console.error(\"Error fetching active record:\", error);\n      res.status(500).json({ message: \"Failed to fetch active record\" });\n    }\n  });\n\n  app.get(\"/api/time-records/site/:siteId\", isAuthenticated, async (req: any, res) => {\n    try {\n      const records = await storage.getTimeRecordsBySite(req.params.siteId);\n      res.json(records);\n    } catch (error) {\n      console.error(\"Error fetching time records:\", error);\n      res.status(500).json({ message: \"Failed to fetch time records\" });\n    }\n  });\n\n  app.post(\"/api/time-records/check-in\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      const effectiveTenantId = getEffectiveTenantId(req, user);\n      if (!effectiveTenantId) {\n        return res.status(400).json({ message: \"No tenant context\" });\n      }\n\n      // Check if already checked in\n      const activeRecord = await storage.getActiveTimeRecord(userId);\n      if (activeRecord) {\n        return res.status(400).json({ message: \"Already checked in\" });\n      }\n\n      // Validate geofence if site coordinates provided\n      const { siteId, latitude, longitude, photo, deviceId } = req.body;\n      const site = await storage.getSite(siteId);\n      if (!site) {\n        return res.status(400).json({ message: \"Site not found\" });\n      }\n\n      let isWithinGeofence = true;\n      let isSuspicious = false;\n      let suspiciousReason = \"\";\n\n      if (site.latitude && site.longitude && latitude && longitude) {\n        const distance = calculateDistance(\n          parseFloat(site.latitude),\n          parseFloat(site.longitude),\n          latitude,\n          longitude\n        );\n        isWithinGeofence = distance <= (site.geofenceRadius || 100);\n        if (!isWithinGeofence) {\n          isSuspicious = true;\n          suspiciousReason = `Check-in outside geofence (${Math.round(distance)}m from site)`;\n        }\n      }\n\n      const record = await storage.createTimeRecord({\n        tenantId: effectiveTenantId,\n        userId,\n        siteId,\n        checkInTime: new Date(),\n        checkInLatitude: latitude?.toString(),\n        checkInLongitude: longitude?.toString(),\n        checkInPhoto: photo,\n        checkInDeviceId: deviceId,\n        isWithinGeofence,\n        isSuspicious,\n        suspiciousReason,\n        status: \"pending\",\n      });\n\n      res.json(record);\n    } catch (error) {\n      console.error(\"Error checking in:\", error);\n      res.status(500).json({ message: \"Failed to check in\" });\n    }\n  });\n\n  app.post(\"/api/time-records/:id/check-out\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { latitude, longitude, photo, deviceId } = req.body;\n      const record = await storage.getTimeRecord(req.params.id);\n      \n      if (!record) {\n        return res.status(404).json({ message: \"Record not found\" });\n      }\n      if (record.checkOutTime) {\n        return res.status(400).json({ message: \"Already checked out\" });\n      }\n\n      const checkOutTime = new Date();\n      const totalMs = checkOutTime.getTime() - new Date(record.checkInTime).getTime();\n      const totalHours = (totalMs / 1000 / 60 / 60).toFixed(2);\n      const overtimeHours = Math.max(0, parseFloat(totalHours) - 8).toFixed(2);\n\n      const updated = await storage.updateTimeRecord(req.params.id, {\n        checkOutTime,\n        checkOutLatitude: latitude?.toString(),\n        checkOutLongitude: longitude?.toString(),\n        checkOutPhoto: photo,\n        checkOutDeviceId: deviceId,\n        totalHours,\n        overtimeHours,\n      });\n\n      res.json(updated);\n    } catch (error) {\n      console.error(\"Error checking out:\", error);\n      res.status(500).json({ message: \"Failed to check out\" });\n    }\n  });\n\n  app.patch(\"/api/time-records/:id/approve\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const record = await storage.updateTimeRecord(req.params.id, {\n        status: \"approved\",\n        approvedBy: userId,\n        approvedAt: new Date(),\n      });\n      res.json(record);\n    } catch (error) {\n      console.error(\"Error approving record:\", error);\n      res.status(500).json({ message: \"Failed to approve record\" });\n    }\n  });\n\n  app.patch(\"/api/time-records/:id/reject\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const record = await storage.updateTimeRecord(req.params.id, {\n        status: \"rejected\",\n        approvedBy: userId,\n        approvedAt: new Date(),\n        notes: req.body.reason,\n      });\n      res.json(record);\n    } catch (error) {\n      console.error(\"Error rejecting record:\", error);\n      res.status(500).json({ message: \"Failed to reject record\" });\n    }\n  });\n\n  // Client Portal - Time records validation\n  app.patch(\"/api/time-records/:id/client-validate\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { validated } = req.body;\n      const record = await storage.updateTimeRecord(req.params.id, {\n        clientValidated: validated,\n        clientValidatedAt: new Date(),\n      });\n      res.json(record);\n    } catch (error) {\n      console.error(\"Error validating record:\", error);\n      res.status(500).json({ message: \"Failed to validate record\" });\n    }\n  });\n\n  // Contestations routes\n  app.post(\"/api/contestations\", isAuthenticated, async (req: any, res) => {\n    try {\n      const data = insertContestationSchema.parse(req.body);\n      const contestation = await storage.createContestation(data);\n      // Update time record status\n      await storage.updateTimeRecord(req.body.timeRecordId, { status: \"contested\" });\n      res.json(contestation);\n    } catch (error) {\n      console.error(\"Error creating contestation:\", error);\n      res.status(500).json({ message: \"Failed to create contestation\" });\n    }\n  });\n\n  app.patch(\"/api/contestations/:id/resolve\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const contestation = await storage.updateContestation(req.params.id, {\n        status: req.body.status,\n        resolution: req.body.resolution,\n        resolvedBy: userId,\n        resolvedAt: new Date(),\n      });\n      res.json(contestation);\n    } catch (error) {\n      console.error(\"Error resolving contestation:\", error);\n      res.status(500).json({ message: \"Failed to resolve contestation\" });\n    }\n  });\n\n  // Tools routes\n  app.get(\"/api/tools\", isAuthenticated, async (req: any, res) => {\n    try {\n      const user = await storage.getUser(req.user.claims.sub);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      const effectiveTenantId = getEffectiveTenantId(req, user);\n      if (!effectiveTenantId) {\n        return res.status(400).json({ message: \"No tenant context\" });\n      }\n      const tools = await storage.getToolsByTenant(effectiveTenantId);\n      res.json(tools);\n    } catch (error) {\n      console.error(\"Error fetching tools:\", error);\n      res.status(500).json({ message: \"Failed to fetch tools\" });\n    }\n  });\n\n  app.get(\"/api/tools/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const tool = await storage.getTool(req.params.id);\n      res.json(tool);\n    } catch (error) {\n      console.error(\"Error fetching tool:\", error);\n      res.status(500).json({ message: \"Failed to fetch tool\" });\n    }\n  });\n\n  app.get(\"/api/tools/qr/:qrCode\", isAuthenticated, async (req: any, res) => {\n    try {\n      const tool = await storage.getToolByQrCode(req.params.qrCode);\n      res.json(tool);\n    } catch (error) {\n      console.error(\"Error fetching tool:\", error);\n      res.status(500).json({ message: \"Failed to fetch tool\" });\n    }\n  });\n\n  app.post(\"/api/tools\", isAuthenticated, async (req: any, res) => {\n    try {\n      const user = await storage.getUser(req.user.claims.sub);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      const effectiveTenantId = getEffectiveTenantId(req, user);\n      if (!effectiveTenantId) {\n        return res.status(400).json({ message: \"No tenant context\" });\n      }\n      // Only managers and above can create tools\n      const managerRoles = [\"manager\", \"admin\", \"superadmin\"];\n      if (!managerRoles.includes(user.role)) {\n        return res.status(403).json({ message: \"Only managers can create tools\" });\n      }\n      const data = insertToolSchema.parse({ ...req.body, tenantId: effectiveTenantId });\n      const tool = await storage.createTool(data);\n      res.json(tool);\n    } catch (error) {\n      console.error(\"Error creating tool:\", error);\n      res.status(500).json({ message: \"Failed to create tool\" });\n    }\n  });\n\n  app.patch(\"/api/tools/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const user = await storage.getUser(req.user.claims.sub);\n      // Only managers and above can update tools\n      const managerRoles = [\"manager\", \"admin\", \"superadmin\"];\n      if (!user || !managerRoles.includes(user.role)) {\n        return res.status(403).json({ message: \"Only managers can update tools\" });\n      }\n      const tool = await storage.updateTool(req.params.id, req.body);\n      res.json(tool);\n    } catch (error) {\n      console.error(\"Error updating tool:\", error);\n      res.status(500).json({ message: \"Failed to update tool\" });\n    }\n  });\n\n  app.delete(\"/api/tools/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const user = await storage.getUser(req.user.claims.sub);\n      // Only managers and above can delete tools\n      const managerRoles = [\"manager\", \"admin\", \"superadmin\"];\n      if (!user || !managerRoles.includes(user.role)) {\n        return res.status(403).json({ message: \"Only managers can delete tools\" });\n      }\n      const success = await storage.deleteTool(req.params.id);\n      if (!success) {\n        return res.status(404).json({ message: \"Tool not found\" });\n      }\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting tool:\", error);\n      res.status(500).json({ message: \"Failed to delete tool\" });\n    }\n  });\n\n  // Tool Transactions (checkout/checkin)\n  app.post(\"/api/tools/:id/checkout\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const tool = await storage.getTool(req.params.id);\n      if (!tool) {\n        return res.status(404).json({ message: \"Tool not found\" });\n      }\n      if (tool.status !== \"available\") {\n        return res.status(400).json({ message: \"Tool not available\" });\n      }\n\n      const transaction = await storage.createToolTransaction({\n        toolId: req.params.id,\n        userId,\n        siteId: req.body.siteId,\n        type: \"checkout\",\n        photo: req.body.photo,\n        notes: req.body.notes,\n        condition: req.body.condition || \"good\",\n      });\n\n      await storage.updateTool(req.params.id, {\n        status: \"in_use\",\n        currentUserId: userId,\n        currentSiteId: req.body.siteId,\n      });\n\n      res.json(transaction);\n    } catch (error) {\n      console.error(\"Error checking out tool:\", error);\n      res.status(500).json({ message: \"Failed to checkout tool\" });\n    }\n  });\n\n  app.post(\"/api/tools/:id/checkin\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const tool = await storage.getTool(req.params.id);\n      if (!tool) {\n        return res.status(404).json({ message: \"Tool not found\" });\n      }\n\n      const transaction = await storage.createToolTransaction({\n        toolId: req.params.id,\n        userId,\n        siteId: req.body.siteId,\n        type: \"checkin\",\n        photo: req.body.photo,\n        notes: req.body.notes,\n        condition: req.body.condition || \"good\",\n      });\n\n      await storage.updateTool(req.params.id, {\n        status: req.body.condition === \"damaged\" ? \"maintenance\" : \"available\",\n        currentUserId: null,\n        currentSiteId: null,\n      });\n\n      res.json(transaction);\n    } catch (error) {\n      console.error(\"Error checking in tool:\", error);\n      res.status(500).json({ message: \"Failed to checkin tool\" });\n    }\n  });\n\n  app.get(\"/api/tools/:id/transactions\", isAuthenticated, async (req: any, res) => {\n    try {\n      const transactions = await storage.getToolTransactionsByTool(req.params.id);\n      res.json(transactions);\n    } catch (error) {\n      console.error(\"Error fetching transactions:\", error);\n      res.status(500).json({ message: \"Failed to fetch transactions\" });\n    }\n  });\n\n  // Leave Requests routes\n  app.get(\"/api/leave-requests/my\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const requests = await storage.getLeaveRequestsByUser(userId);\n      res.json(requests);\n    } catch (error) {\n      console.error(\"Error fetching leave requests:\", error);\n      res.status(500).json({ message: \"Failed to fetch leave requests\" });\n    }\n  });\n\n  app.get(\"/api/leave-requests/team\", isAuthenticated, async (req: any, res) => {\n    try {\n      const user = await storage.getUser(req.user.claims.sub);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      const effectiveTenantId = getEffectiveTenantId(req, user);\n      if (!effectiveTenantId) {\n        return res.status(400).json({ message: \"No tenant context\" });\n      }\n      const requests = await storage.getLeaveRequestsByTenant(effectiveTenantId);\n      res.json(requests);\n    } catch (error) {\n      console.error(\"Error fetching leave requests:\", error);\n      res.status(500).json({ message: \"Failed to fetch leave requests\" });\n    }\n  });\n\n  app.post(\"/api/leave-requests\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      const effectiveTenantId = getEffectiveTenantId(req, user);\n      if (!effectiveTenantId) {\n        return res.status(400).json({ message: \"No tenant context\" });\n      }\n      const data = insertLeaveRequestSchema.parse({\n        ...req.body,\n        tenantId: effectiveTenantId,\n        userId,\n      });\n      const request = await storage.createLeaveRequest(data);\n      res.json(request);\n    } catch (error) {\n      console.error(\"Error creating leave request:\", error);\n      res.status(500).json({ message: \"Failed to create leave request\" });\n    }\n  });\n\n  app.post(\"/api/leave-requests/:id/approve\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const request = await storage.updateLeaveRequest(req.params.id, {\n        status: \"approved\",\n        approvedBy: userId,\n        approvedAt: new Date(),\n      });\n      res.json(request);\n    } catch (error) {\n      console.error(\"Error approving request:\", error);\n      res.status(500).json({ message: \"Failed to approve request\" });\n    }\n  });\n\n  app.post(\"/api/leave-requests/:id/reject\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const request = await storage.updateLeaveRequest(req.params.id, {\n        status: \"rejected\",\n        approvedBy: userId,\n        approvedAt: new Date(),\n      });\n      res.json(request);\n    } catch (error) {\n      console.error(\"Error rejecting request:\", error);\n      res.status(500).json({ message: \"Failed to reject request\" });\n    }\n  });\n\n  // Payroll routes\n  app.get(\"/api/payroll\", isAuthenticated, async (req: any, res) => {\n    try {\n      const user = await storage.getUser(req.user.claims.sub);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      const effectiveTenantId = getEffectiveTenantId(req, user);\n      if (!effectiveTenantId) {\n        return res.status(400).json({ message: \"No tenant context\" });\n      }\n      const records = await storage.getPayrollRecordsByTenant(effectiveTenantId);\n      res.json(records);\n    } catch (error) {\n      console.error(\"Error fetching payroll:\", error);\n      res.status(500).json({ message: \"Failed to fetch payroll\" });\n    }\n  });\n\n  app.get(\"/api/payroll/my\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const records = await storage.getPayrollRecordsByUser(userId);\n      res.json(records);\n    } catch (error) {\n      console.error(\"Error fetching payroll:\", error);\n      res.status(500).json({ message: \"Failed to fetch payroll\" });\n    }\n  });\n\n  // Object Storage routes\n  app.get(\"/public-objects/:filePath(*)\", async (req, res) => {\n    const filePath = req.params.filePath;\n    const objectStorageService = new ObjectStorageService();\n    try {\n      const file = await objectStorageService.searchPublicObject(filePath);\n      if (!file) {\n        return res.status(404).json({ error: \"File not found\" });\n      }\n      objectStorageService.downloadObject(file, res);\n    } catch (error) {\n      console.error(\"Error searching for public object:\", error);\n      return res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  app.get(\"/objects/:objectPath(*)\", isAuthenticated, async (req: any, res) => {\n    const userId = req.user?.claims?.sub;\n    const objectStorageService = new ObjectStorageService();\n    try {\n      const objectFile = await objectStorageService.getObjectEntityFile(req.path);\n      const canAccess = await objectStorageService.canAccessObjectEntity({\n        objectFile,\n        userId: userId,\n        requestedPermission: ObjectPermission.READ,\n      });\n      if (!canAccess) {\n        return res.sendStatus(401);\n      }\n      objectStorageService.downloadObject(objectFile, res);\n    } catch (error) {\n      console.error(\"Error checking object access:\", error);\n      if (error instanceof ObjectNotFoundError) {\n        return res.sendStatus(404);\n      }\n      return res.sendStatus(500);\n    }\n  });\n\n  app.post(\"/api/objects/upload\", isAuthenticated, async (req, res) => {\n    const objectStorageService = new ObjectStorageService();\n    try {\n      const uploadURL = await objectStorageService.getObjectEntityUploadURL();\n      res.json({ uploadURL });\n    } catch (error) {\n      console.error(\"Error getting upload URL:\", error);\n      res.status(500).json({ error: \"Failed to get upload URL\" });\n    }\n  });\n\n  app.put(\"/api/photos\", isAuthenticated, async (req: any, res) => {\n    if (!req.body.photoURL) {\n      return res.status(400).json({ error: \"photoURL is required\" });\n    }\n    const userId = req.user?.claims?.sub;\n    try {\n      const objectStorageService = new ObjectStorageService();\n      const objectPath = await objectStorageService.trySetObjectEntityAclPolicy(\n        req.body.photoURL,\n        {\n          owner: userId,\n          visibility: \"public\",\n        }\n      );\n      res.status(200).json({ objectPath });\n    } catch (error) {\n      console.error(\"Error setting photo:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // ============ NOTIFICATION ROUTES ============\n\n  // Get user's notifications\n  app.get(\"/api/notifications\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const notifications = await storage.getNotificationsByUser(userId);\n      res.json(notifications);\n    } catch (error) {\n      console.error(\"Error fetching notifications:\", error);\n      res.status(500).json({ message: \"Failed to fetch notifications\" });\n    }\n  });\n\n  // Get unread notifications count\n  app.get(\"/api/notifications/unread\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const notifications = await storage.getUnreadNotificationsByUser(userId);\n      res.json({ count: notifications.length, notifications });\n    } catch (error) {\n      console.error(\"Error fetching unread notifications:\", error);\n      res.status(500).json({ message: \"Failed to fetch unread notifications\" });\n    }\n  });\n\n  // Mark notification as read\n  app.patch(\"/api/notifications/:id/read\", isAuthenticated, async (req: any, res) => {\n    try {\n      const notification = await storage.markNotificationRead(req.params.id);\n      res.json(notification);\n    } catch (error) {\n      console.error(\"Error marking notification read:\", error);\n      res.status(500).json({ message: \"Failed to mark notification read\" });\n    }\n  });\n\n  // Mark all notifications as read\n  app.post(\"/api/notifications/mark-all-read\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      await storage.markAllNotificationsRead(userId);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error marking all notifications read:\", error);\n      res.status(500).json({ message: \"Failed to mark all notifications read\" });\n    }\n  });\n\n  // Get notification preferences\n  app.get(\"/api/notification-preferences\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      let prefs = await storage.getNotificationPreferences(userId);\n      if (!prefs) {\n        prefs = await storage.upsertNotificationPreferences({ userId });\n      }\n      res.json(prefs);\n    } catch (error) {\n      console.error(\"Error fetching notification preferences:\", error);\n      res.status(500).json({ message: \"Failed to fetch notification preferences\" });\n    }\n  });\n\n  // Update notification preferences\n  app.put(\"/api/notification-preferences\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const prefs = await storage.upsertNotificationPreferences({ userId, ...req.body });\n      res.json(prefs);\n    } catch (error) {\n      console.error(\"Error updating notification preferences:\", error);\n      res.status(500).json({ message: \"Failed to update notification preferences\" });\n    }\n  });\n\n  // ============ DOCUMENT PORTAL ROUTES ============\n\n  // Get documents for a site\n  app.get(\"/api/sites/:siteId/documents\", isAuthenticated, async (req: any, res) => {\n    try {\n      const documents = await storage.getSiteDocumentsBySite(req.params.siteId);\n      res.json(documents);\n    } catch (error) {\n      console.error(\"Error fetching documents:\", error);\n      res.status(500).json({ message: \"Failed to fetch documents\" });\n    }\n  });\n\n  // Upload a document\n  app.post(\"/api/sites/:siteId/documents\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      const document = await storage.createSiteDocument({\n        tenantId: user?.tenantId || \"\",\n        siteId: req.params.siteId,\n        uploadedBy: userId,\n        ...req.body,\n      });\n      res.status(201).json(document);\n    } catch (error) {\n      console.error(\"Error creating document:\", error);\n      res.status(500).json({ message: \"Failed to create document\" });\n    }\n  });\n\n  // Get document versions\n  app.get(\"/api/documents/:id/versions\", isAuthenticated, async (req: any, res) => {\n    try {\n      const versions = await storage.getSiteDocumentVersions(req.params.id);\n      res.json(versions);\n    } catch (error) {\n      console.error(\"Error fetching document versions:\", error);\n      res.status(500).json({ message: \"Failed to fetch document versions\" });\n    }\n  });\n\n  // Update a document (create new version)\n  app.put(\"/api/documents/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const existingDoc = await storage.getSiteDocument(req.params.id);\n      if (!existingDoc) {\n        return res.status(404).json({ message: \"Document not found\" });\n      }\n      // Create new version\n      const newDoc = await storage.createSiteDocument({\n        tenantId: existingDoc.tenantId,\n        siteId: existingDoc.siteId,\n        uploadedBy: userId,\n        name: req.body.name || existingDoc.name,\n        category: req.body.category || existingDoc.category,\n        description: req.body.description,\n        fileUrl: req.body.fileUrl,\n        fileType: req.body.fileType,\n        fileSize: req.body.fileSize,\n        version: (existingDoc.version || 1) + 1,\n        parentDocumentId: existingDoc.parentDocumentId || existingDoc.id,\n      });\n      // Deactivate old version\n      await storage.updateSiteDocument(existingDoc.id, { isActive: false });\n      res.json(newDoc);\n    } catch (error) {\n      console.error(\"Error updating document:\", error);\n      res.status(500).json({ message: \"Failed to update document\" });\n    }\n  });\n\n  // Delete a document (soft delete)\n  app.delete(\"/api/documents/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      await storage.updateSiteDocument(req.params.id, { isActive: false });\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting document:\", error);\n      res.status(500).json({ message: \"Failed to delete document\" });\n    }\n  });\n\n  // ============ CHAT ROUTES ============\n\n  // Get chat rooms for user\n  app.get(\"/api/chat/rooms\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const rooms = await storage.getChatRoomsByUser(userId);\n      res.json(rooms);\n    } catch (error) {\n      console.error(\"Error fetching chat rooms:\", error);\n      res.status(500).json({ message: \"Failed to fetch chat rooms\" });\n    }\n  });\n\n  // Get chat rooms for a site\n  app.get(\"/api/sites/:siteId/chat\", isAuthenticated, async (req: any, res) => {\n    try {\n      const rooms = await storage.getChatRoomsBySite(req.params.siteId);\n      res.json(rooms);\n    } catch (error) {\n      console.error(\"Error fetching site chat rooms:\", error);\n      res.status(500).json({ message: \"Failed to fetch chat rooms\" });\n    }\n  });\n\n  // Create or get chat room for site\n  app.post(\"/api/sites/:siteId/chat\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      const site = await storage.getSite(req.params.siteId);\n      if (!site) {\n        return res.status(404).json({ message: \"Site not found\" });\n      }\n      // Check if room already exists\n      const existingRooms = await storage.getChatRoomsBySite(req.params.siteId);\n      if (existingRooms.length > 0) {\n        // Add user as participant if not already\n        const participants = await storage.getChatParticipants(existingRooms[0].id);\n        if (!participants.find(p => p.userId === userId)) {\n          await storage.addChatParticipant({ roomId: existingRooms[0].id, userId, role: \"member\" });\n        }\n        return res.json(existingRooms[0]);\n      }\n      // Create new room\n      const room = await storage.createChatRoom({\n        tenantId: user?.tenantId || site.tenantId,\n        siteId: req.params.siteId,\n        name: site.name,\n        type: \"site\",\n      });\n      // Add creator as admin\n      await storage.addChatParticipant({ roomId: room.id, userId, role: \"admin\" });\n      res.status(201).json(room);\n    } catch (error) {\n      console.error(\"Error creating chat room:\", error);\n      res.status(500).json({ message: \"Failed to create chat room\" });\n    }\n  });\n\n  // Get messages for a room\n  app.get(\"/api/chat/rooms/:roomId/messages\", isAuthenticated, async (req: any, res) => {\n    try {\n      const limit = parseInt(req.query.limit) || 50;\n      const messages = await storage.getChatMessages(req.params.roomId, limit);\n      res.json(messages);\n    } catch (error) {\n      console.error(\"Error fetching messages:\", error);\n      res.status(500).json({ message: \"Failed to fetch messages\" });\n    }\n  });\n\n  // Send a message\n  app.post(\"/api/chat/rooms/:roomId/messages\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      const message = await storage.createChatMessage({\n        roomId: req.params.roomId,\n        senderId: userId,\n        content: req.body.content,\n        type: req.body.type || \"text\",\n        attachmentUrl: req.body.attachmentUrl,\n      });\n      // Update last read for sender\n      await storage.updateChatParticipantLastRead(req.params.roomId, userId);\n      \n      // Broadcast to room via WebSocket\n      broadcastToRoom(req.params.roomId, {\n        type: \"new_message\",\n        message: {\n          ...message,\n          sender: user ? { id: user.id, firstName: user.firstName, lastName: user.lastName, profileImageUrl: user.profileImageUrl } : null,\n        },\n      });\n      \n      res.status(201).json(message);\n    } catch (error) {\n      console.error(\"Error sending message:\", error);\n      res.status(500).json({ message: \"Failed to send message\" });\n    }\n  });\n\n  // Get room participants\n  app.get(\"/api/chat/rooms/:roomId/participants\", isAuthenticated, async (req: any, res) => {\n    try {\n      const participants = await storage.getChatParticipants(req.params.roomId);\n      res.json(participants);\n    } catch (error) {\n      console.error(\"Error fetching participants:\", error);\n      res.status(500).json({ message: \"Failed to fetch participants\" });\n    }\n  });\n\n  // Mark messages as read\n  app.post(\"/api/chat/rooms/:roomId/read\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      await storage.updateChatParticipantLastRead(req.params.roomId, userId);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error marking messages read:\", error);\n      res.status(500).json({ message: \"Failed to mark messages read\" });\n    }\n  });\n\n  // ============ SUPERADMIN ROUTES ============\n  \n  // Helper to check superadmin role\n  const isSuperAdmin = async (req: any): Promise<boolean> => {\n    if (!req.user?.claims?.sub) return false;\n    const user = await storage.getUser(req.user.claims.sub);\n    return user?.role === \"superadmin\";\n  };\n\n  // Get all tenants (superadmin only)\n  app.get(\"/api/superadmin/tenants\", isAuthenticated, async (req: any, res) => {\n    try {\n      if (!await isSuperAdmin(req)) {\n        return res.status(403).json({ message: \"Superadmin access required\" });\n      }\n      \n      const allTenants = await storage.getAllTenants();\n      const allUsers = await storage.getAllUsers();\n      \n      // Enrich tenants with user counts\n      const enrichedTenants = allTenants.map(tenant => {\n        const tenantUsers = allUsers.filter(u => u.tenantId === tenant.id);\n        return {\n          ...tenant,\n          userCount: tenantUsers.length,\n          adminCount: tenantUsers.filter(u => u.role === \"admin\").length,\n          managerCount: tenantUsers.filter(u => u.role === \"manager\").length,\n          employeeCount: tenantUsers.filter(u => u.role === \"employee\").length,\n        };\n      });\n      \n      res.json(enrichedTenants);\n    } catch (error) {\n      console.error(\"Error fetching tenants:\", error);\n      res.status(500).json({ message: \"Failed to fetch tenants\" });\n    }\n  });\n\n  // Create tenant (superadmin only)\n  app.post(\"/api/superadmin/tenants\", isAuthenticated, async (req: any, res) => {\n    try {\n      if (!await isSuperAdmin(req)) {\n        return res.status(403).json({ message: \"Superadmin access required\" });\n      }\n      \n      const { name, email, phone, address, subscriptionPlan, subscriptionStatus, adminEmail, adminPassword, adminFirstName, adminLastName } = req.body;\n      \n      if (!name) {\n        return res.status(400).json({ message: \"Tenant name is required\" });\n      }\n      \n      // Create the tenant\n      const tenant = await storage.createTenant({\n        name,\n        email,\n        phone,\n        address,\n        subscriptionPlan: subscriptionPlan || \"starter\",\n        subscriptionStatus: subscriptionStatus || \"active\",\n      });\n      \n      // If admin credentials provided, create an admin user for this tenant\n      if (adminEmail && adminPassword) {\n        const hashedPassword = await bcrypt.hash(adminPassword, 10);\n        await storage.createUser({\n          username: adminEmail,\n          email: adminEmail,\n          password: hashedPassword,\n          firstName: adminFirstName || \"Admin\",\n          lastName: adminLastName || \"\",\n          role: \"admin\",\n          tenantId: tenant.id,\n          isActive: true,\n        });\n      }\n      \n      res.json(tenant);\n    } catch (error) {\n      console.error(\"Error creating tenant:\", error);\n      res.status(500).json({ message: \"Failed to create tenant\" });\n    }\n  });\n\n  // Update tenant (superadmin only)\n  app.patch(\"/api/superadmin/tenants/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      if (!await isSuperAdmin(req)) {\n        return res.status(403).json({ message: \"Superadmin access required\" });\n      }\n      \n      const tenant = await storage.updateTenant(req.params.id, req.body);\n      res.json(tenant);\n    } catch (error) {\n      console.error(\"Error updating tenant:\", error);\n      res.status(500).json({ message: \"Failed to update tenant\" });\n    }\n  });\n\n  // Create user for a tenant (superadmin only)\n  app.post(\"/api/superadmin/users\", isAuthenticated, async (req: any, res) => {\n    try {\n      if (!await isSuperAdmin(req)) {\n        return res.status(403).json({ message: \"Superadmin access required\" });\n      }\n      \n      const { email, password, firstName, lastName, role, tenantId } = req.body;\n      \n      if (!email || !password) {\n        return res.status(400).json({ message: \"Email and password are required\" });\n      }\n      \n      if (!tenantId && role !== \"superadmin\") {\n        return res.status(400).json({ message: \"Tenant is required for non-superadmin users\" });\n      }\n      \n      const existingUser = await storage.getUserByEmail(email);\n      if (existingUser) {\n        return res.status(400).json({ message: \"Email already exists\" });\n      }\n      \n      const hashedPassword = await bcrypt.hash(password, 10);\n      const user = await storage.createUser({\n        username: email,\n        email,\n        password: hashedPassword,\n        firstName: firstName || \"\",\n        lastName: lastName || \"\",\n        role: role || \"employee\",\n        tenantId: role === \"superadmin\" ? undefined : tenantId,\n        isActive: true,\n      });\n      \n      const { password: _, ...userWithoutPassword } = user;\n      res.json(userWithoutPassword);\n    } catch (error) {\n      console.error(\"Error creating user:\", error);\n      res.status(500).json({ message: \"Failed to create user\" });\n    }\n  });\n\n  // Get all users across all tenants (superadmin only)\n  app.get(\"/api/superadmin/users\", isAuthenticated, async (req: any, res) => {\n    try {\n      if (!await isSuperAdmin(req)) {\n        return res.status(403).json({ message: \"Superadmin access required\" });\n      }\n      \n      const allUsers = await storage.getAllUsers();\n      const allTenants = await storage.getAllTenants();\n      \n      // Enrich users with tenant names\n      const enrichedUsers = allUsers.map(user => {\n        const tenant = allTenants.find(t => t.id === user.tenantId);\n        return {\n          ...user,\n          tenantName: tenant?.name || \"No Tenant\",\n        };\n      });\n      \n      res.json(enrichedUsers);\n    } catch (error) {\n      console.error(\"Error fetching users:\", error);\n      res.status(500).json({ message: \"Failed to fetch users\" });\n    }\n  });\n\n  // Impersonate a tenant (superadmin only)\n  // This allows superadmin to temporarily act as if they belong to a specific tenant\n  app.post(\"/api/superadmin/impersonate/:tenantId\", isAuthenticated, async (req: any, res) => {\n    try {\n      if (!await isSuperAdmin(req)) {\n        return res.status(403).json({ message: \"Superadmin access required\" });\n      }\n      \n      const tenantId = req.params.tenantId;\n      const tenant = await storage.getTenant(tenantId);\n      \n      if (!tenant) {\n        return res.status(404).json({ message: \"Tenant not found\" });\n      }\n      \n      // Store impersonation info in session\n      req.session.impersonatedTenantId = tenantId;\n      req.session.impersonatedTenantName = tenant.name;\n      \n      res.json({ \n        success: true, \n        tenantId: tenant.id,\n        tenantName: tenant.name,\n        message: `Now impersonating ${tenant.name}` \n      });\n    } catch (error) {\n      console.error(\"Error starting impersonation:\", error);\n      res.status(500).json({ message: \"Failed to start impersonation\" });\n    }\n  });\n\n  // Stop impersonating (superadmin only)\n  app.post(\"/api/superadmin/stop-impersonate\", isAuthenticated, async (req: any, res) => {\n    try {\n      if (!await isSuperAdmin(req)) {\n        return res.status(403).json({ message: \"Superadmin access required\" });\n      }\n      \n      // Clear impersonation info from session\n      delete req.session.impersonatedTenantId;\n      delete req.session.impersonatedTenantName;\n      \n      res.json({ success: true, message: \"Stopped impersonation\" });\n    } catch (error) {\n      console.error(\"Error stopping impersonation:\", error);\n      res.status(500).json({ message: \"Failed to stop impersonation\" });\n    }\n  });\n\n  // Get current impersonation status\n  app.get(\"/api/superadmin/impersonation-status\", isAuthenticated, async (req: any, res) => {\n    try {\n      if (!await isSuperAdmin(req)) {\n        return res.status(403).json({ message: \"Superadmin access required\" });\n      }\n      \n      const impersonatedTenantId = req.session.impersonatedTenantId;\n      const impersonatedTenantName = req.session.impersonatedTenantName;\n      \n      res.json({\n        isImpersonating: !!impersonatedTenantId,\n        tenantId: impersonatedTenantId || null,\n        tenantName: impersonatedTenantName || null,\n      });\n    } catch (error) {\n      console.error(\"Error fetching impersonation status:\", error);\n      res.status(500).json({ message: \"Failed to fetch impersonation status\" });\n    }\n  });\n\n  // Platform-wide stats (superadmin only)\n  app.get(\"/api/superadmin/stats\", isAuthenticated, async (req: any, res) => {\n    try {\n      if (!await isSuperAdmin(req)) {\n        return res.status(403).json({ message: \"Superadmin access required\" });\n      }\n      \n      const allTenants = await storage.getAllTenants();\n      const allUsers = await storage.getAllUsers();\n      \n      const stats = {\n        totalTenants: allTenants.length,\n        activeTenants: allTenants.filter(t => t.subscriptionStatus === \"active\").length,\n        trialTenants: allTenants.filter(t => t.subscriptionStatus === \"trial\").length,\n        suspendedTenants: allTenants.filter(t => t.subscriptionStatus === \"suspended\" || t.subscriptionStatus === \"cancelled\").length,\n        totalUsers: allUsers.length,\n        usersByRole: {\n          superadmin: allUsers.filter(u => u.role === \"superadmin\").length,\n          admin: allUsers.filter(u => u.role === \"admin\").length,\n          manager: allUsers.filter(u => u.role === \"manager\").length,\n          employee: allUsers.filter(u => u.role === \"employee\").length,\n          client: allUsers.filter(u => u.role === \"client\").length,\n        },\n        subscriptionsByPlan: {\n          starter: allTenants.filter(t => t.subscriptionPlan === \"starter\").length,\n          professional: allTenants.filter(t => t.subscriptionPlan === \"professional\").length,\n          enterprise: allTenants.filter(t => t.subscriptionPlan === \"enterprise\").length,\n        },\n      };\n      \n      res.json(stats);\n    } catch (error) {\n      console.error(\"Error fetching platform stats:\", error);\n      res.status(500).json({ message: \"Failed to fetch stats\" });\n    }\n  });\n\n  // ============ WEBSOCKET SETUP ============\n  const wss = new WebSocketServer({ server: httpServer, path: \"/ws/chat\" });\n\n  wss.on(\"connection\", (ws: WebSocket) => {\n    let currentUserId: string | null = null;\n    let currentRoomId: string | null = null;\n\n    ws.on(\"message\", async (data: Buffer) => {\n      try {\n        const message = JSON.parse(data.toString());\n\n        if (message.type === \"join\") {\n          const { roomId, odId } = message;\n          currentUserId = odId;\n          currentRoomId = roomId;\n\n          // Add client to room\n          if (!chatClients.has(roomId)) {\n            chatClients.set(roomId, new Map());\n          }\n          chatClients.get(roomId)!.set(odId, ws);\n\n          // Notify others that user joined\n          const user = await storage.getUser(odId);\n          broadcastToRoom(roomId, {\n            type: \"user_joined\",\n            user: user ? { id: user.id, firstName: user.firstName, lastName: user.lastName } : { id: odId },\n          }, odId);\n        }\n\n        if (message.type === \"typing\" && currentRoomId && currentUserId) {\n          broadcastToRoom(currentRoomId, {\n            type: \"typing\",\n            odId: currentUserId,\n          }, currentUserId);\n        }\n      } catch (error) {\n        console.error(\"WebSocket message error:\", error);\n      }\n    });\n\n    ws.on(\"close\", () => {\n      if (currentRoomId && currentUserId) {\n        const roomClients = chatClients.get(currentRoomId);\n        if (roomClients) {\n          roomClients.delete(currentUserId);\n          if (roomClients.size === 0) {\n            chatClients.delete(currentRoomId);\n          }\n        }\n        broadcastToRoom(currentRoomId, {\n          type: \"user_left\",\n          odId: currentUserId,\n        });\n      }\n    });\n  });\n\n  return httpServer;\n}\n\n// Utility function to calculate distance between two coordinates\nfunction calculateDistance(lat1: number, lon1: number, lat2: number, lon2: number): number {\n  const R = 6371e3; // Earth's radius in meters\n  const phi1 = (lat1 * Math.PI) / 180;\n  const phi2 = (lat2 * Math.PI) / 180;\n  const deltaPhi = ((lat2 - lat1) * Math.PI) / 180;\n  const deltaLambda = ((lon2 - lon1) * Math.PI) / 180;\n\n  const a =\n    Math.sin(deltaPhi / 2) * Math.sin(deltaPhi / 2) +\n    Math.cos(phi1) * Math.cos(phi2) * Math.sin(deltaLambda / 2) * Math.sin(deltaLambda / 2);\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n  return R * c;\n}\n","path":null,"size_bytes":78015,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1080,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"client/src/components/ThemeToggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useTheme } from \"./ThemeProvider\";\n\nexport function ThemeToggle() {\n  const { resolvedTheme, setTheme } = useTheme();\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={() => setTheme(resolvedTheme === \"dark\" ? \"light\" : \"dark\")}\n      data-testid=\"button-theme-toggle\"\n    >\n      {resolvedTheme === \"dark\" ? (\n        <Sun className=\"h-4 w-4\" />\n      ) : (\n        <Moon className=\"h-4 w-4\" />\n      )}\n    </Button>\n  );\n}\n","path":null,"size_bytes":555,"size_tokens":null},"client/src/hooks/useAuth.ts":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest, getQueryFn } from \"@/lib/queryClient\";\nimport type { User } from \"@shared/schema\";\n\nexport type UserRole = \"superadmin\" | \"admin\" | \"manager\" | \"employee\" | \"client\";\n\ninterface ImpersonationInfo {\n  isImpersonating: boolean;\n  impersonatedTenantId: string;\n  impersonatedTenantName: string;\n}\n\ninterface AuthUser extends User {\n  tenant?: {\n    id: string;\n    name: string;\n    subscriptionPlan: string;\n  };\n  impersonation?: ImpersonationInfo | null;\n}\n\nconst ROLE_HIERARCHY: Record<UserRole, number> = {\n  superadmin: 100,\n  admin: 80,\n  manager: 60,\n  employee: 40,\n  client: 20,\n};\n\nexport function useAuth() {\n  const { data: user, isLoading, error } = useQuery<AuthUser | null>({\n    queryKey: [\"/api/auth/user\"],\n    queryFn: getQueryFn({ on401: \"returnNull\" }),\n    retry: false,\n    staleTime: 5 * 60 * 1000,\n  });\n\n  const loginMutation = useMutation({\n    mutationFn: async () => {\n      window.location.href = \"/api/login\";\n    },\n  });\n\n  const localLoginMutation = useMutation({\n    mutationFn: async (credentials: { username: string; password: string }) => {\n      const response = await apiRequest(\"POST\", \"/api/auth/local-login\", credentials);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n    },\n  });\n\n  const logoutMutation = useMutation({\n    mutationFn: async () => {\n      try {\n        const response = await apiRequest(\"POST\", \"/api/auth/local-logout\");\n        if (response.ok) {\n          queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n          window.location.href = \"/\";\n          return;\n        }\n      } catch {\n        // Local logout failed, try OIDC logout (GET redirect)\n      }\n      // For OIDC users, redirect to logout endpoint\n      window.location.href = \"/api/logout\";\n    },\n  });\n\n  const impersonateMutation = useMutation({\n    mutationFn: async (tenantId: string) => {\n      const response = await apiRequest(\"POST\", `/api/superadmin/impersonate/${tenantId}`);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n    },\n  });\n\n  const stopImpersonationMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"POST\", \"/api/superadmin/stop-impersonate\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n    },\n  });\n\n  const userRole = (user?.role as UserRole) || \"employee\";\n\n  const hasRole = (requiredRole: UserRole): boolean => {\n    if (!user) return false;\n    return ROLE_HIERARCHY[userRole] >= ROLE_HIERARCHY[requiredRole];\n  };\n\n  const hasAnyRole = (roles: UserRole[]): boolean => {\n    if (!user) return false;\n    return roles.some((role) => userRole === role);\n  };\n\n  const canManageUsers = hasRole(\"manager\");\n  const canManageSites = hasRole(\"manager\");\n  const canManageTools = hasRole(\"manager\");\n  const canApproveLeave = hasRole(\"manager\");\n  const canViewPayroll = hasRole(\"manager\");\n  const canManageClients = hasRole(\"manager\");\n  const canConfigureCompany = hasRole(\"admin\");\n  const canManageSubscriptions = hasRole(\"superadmin\");\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated: !!user,\n    isSuperAdmin: userRole === \"superadmin\",\n    isAdmin: userRole === \"admin\" || userRole === \"superadmin\",\n    isManager: hasRole(\"manager\"),\n    isEmployee: userRole === \"employee\",\n    isClient: userRole === \"client\",\n    hasRole,\n    hasAnyRole,\n    canManageUsers,\n    canManageSites,\n    canManageTools,\n    canApproveLeave,\n    canViewPayroll,\n    canManageClients,\n    canConfigureCompany,\n    canManageSubscriptions,\n    login: loginMutation.mutate,\n    localLogin: localLoginMutation.mutate,\n    localLoginAsync: localLoginMutation.mutateAsync,\n    isLocalLoginPending: localLoginMutation.isPending,\n    logout: logoutMutation.mutate,\n    isLogoutPending: logoutMutation.isPending,\n    error,\n    // Impersonation\n    isImpersonating: user?.impersonation?.isImpersonating ?? false,\n    impersonatedTenantId: user?.impersonation?.impersonatedTenantId ?? null,\n    impersonatedTenantName: user?.impersonation?.impersonatedTenantName ?? null,\n    impersonate: impersonateMutation.mutate,\n    impersonateAsync: impersonateMutation.mutateAsync,\n    isImpersonatePending: impersonateMutation.isPending,\n    stopImpersonation: stopImpersonationMutation.mutate,\n    stopImpersonationAsync: stopImpersonationMutation.mutateAsync,\n    isStopImpersonationPending: stopImpersonationMutation.isPending,\n  };\n}\n","path":null,"size_bytes":4681,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"replit.md":{"content":"# Construction Management System\n\n## Overview\n\nThis is a construction workforce management system designed to solve critical problems in the construction industry: time tracking fraud, disputes over worked hours, tool accountability, and payroll complexity. The system provides GPS-verified time tracking with photo evidence, tool check-in/out management, leave requests, client transparency portals, and automated payroll processing.\n\nThe application serves multiple user roles: construction workers who clock in/out at job sites, managers who oversee teams and approve requests, clients who verify billed hours, and administrators who configure company-wide settings.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n\n**Framework**: React 18+ with TypeScript, using Wouter for client-side routing instead of React Router.\n\n**UI Component Library**: Shadcn/ui with Radix UI primitives. The design system uses the \"new-york\" style variant with a neutral base color and CSS variables for theming. All components follow a consistent spacing scale (2, 4, 8, 12, 16, 20, 24) and use Tailwind CSS for styling.\n\n**State Management**: TanStack Query (React Query) for server state management with a custom query client configuration. No global state management library is used - server state is cached and synchronized via React Query, while local UI state is managed with React hooks.\n\n**Internationalization**: i18next for multi-language support (English, Portuguese, Dutch, French). Language preference is stored in localStorage and applied globally.\n\n**Theming**: Custom theme provider supporting light/dark/system modes with CSS custom properties. Theme preference persists in localStorage.\n\n**Build Tool**: Vite for development and production builds, with custom alias configuration for imports (@/, @shared/, @assets/).\n\n### Backend Architecture\n\n**Runtime**: Node.js with Express server framework.\n\n**Language**: TypeScript throughout, compiled to CommonJS for production (dist/index.cjs).\n\n**API Pattern**: RESTful HTTP endpoints under `/api/*` namespace. All routes defined in `server/routes.ts` and registered via `registerRoutes()` function.\n\n**Authentication**: Replit Auth (OpenID Connect) integrated via Passport.js strategy. Session-based authentication with PostgreSQL session store. Users are identified by OIDC subject claim and stored in the users table.\n\n**Session Management**: Express-session with connect-pg-simple for PostgreSQL-backed sessions. Sessions expire after 7 days with httpOnly, secure cookies.\n\n**Request Handling**: JSON body parsing with raw body capture for webhook validation. Request/response logging middleware with duration tracking.\n\n### Database Architecture\n\n**ORM**: Drizzle ORM with PostgreSQL dialect.\n\n**Schema Design**: Multi-tenant architecture with the following core entities:\n- **tenants**: Company/organization records with subscription and Stripe integration\n- **users**: All user types (admin, manager, employee, client) with role-based access\n- **sites**: Construction job sites linked to clients\n- **siteAssignments**: Many-to-many relationship between users and sites\n- **timeRecords**: Clock in/out events with GPS coordinates, photos, and fraud detection metadata\n- **tools**: Tool inventory with QR codes and status tracking\n- **toolTransactions**: Check-in/check-out history for tools\n- **leaveRequests**: Vacation/sick leave with approval workflow\n- **payrollRecords**: Calculated payroll with regular/overtime hours\n- **contestations**: Client disputes of time records\n- **sessions**: PostgreSQL-backed session storage\n\n**Migration Strategy**: Drizzle Kit for schema migrations. Schema defined in `shared/schema.ts` and migrations output to `./migrations/`.\n\n**Data Access Layer**: Storage abstraction in `server/storage.ts` implementing `IStorage` interface. All database operations go through this layer for testability and consistency.\n\n### File Storage Architecture\n\n**Provider**: Google Cloud Storage via Replit's object storage sidecar (localhost:1106).\n\n**Access Control**: Custom ACL system (`server/objectAcl.ts`) supporting:\n- Public vs private visibility\n- Owner-based permissions\n- Group-based access rules (READ/WRITE)\n- Per-object policy metadata\n\n**Service Layer**: `ObjectStorageService` class handles file operations with permission checking. Public objects searchable via configurable path prefixes.\n\n**Use Cases**: Profile images, time-tracking selfies, tool photos, payroll exports.\n\n### Anti-Fraud Mechanisms\n\n**GPS Verification**: Time records capture latitude/longitude and validate against site geofence radius (configurable per-tenant).\n\n**Photo Evidence**: Optional selfie capture on clock-in/out to prevent buddy punching.\n\n**PIN Codes**: Optional secondary authentication factor for time tracking actions.\n\n**Offline Detection**: Client-side online/offline status tracking to flag potentially fraudulent offline submissions.\n\n**Metadata Capture**: Device information, IP address, and user agent stored with time records.\n\n### Role-Based Access Control\n\n**Roles**: admin, manager, employee, client\n\n**Permissions**:\n- **Employees**: Clock in/out, request leave, check tools in/out, view own records\n- **Managers**: All employee permissions plus approve/reject requests, manage sites, view team data\n- **Admins**: All manager permissions plus tenant configuration, user management, billing\n- **Clients**: Read-only access to their sites' time records and payroll, ability to contest hours\n\n**Implementation**: Role checking via `useAuth` hook on frontend and `isAuthenticated` middleware + role checks on backend routes.\n\n## External Dependencies\n\n### Third-Party Services\n\n**Replit Auth**: OIDC-based authentication provider. Handles user login flow, token management, and session refresh. Configuration via environment variables (ISSUER_URL, REPL_ID, SESSION_SECRET).\n\n**Google Cloud Storage**: Object storage for uploaded files (photos, documents). Accessed via Replit sidecar with external account credentials.\n\n**Stripe**: Payment processing for subscription billing (referenced in tenant schema but implementation not visible in provided files). Tenant records store stripeCustomerId and stripeSubscriptionId.\n\n**PostgreSQL**: Primary database accessed via DATABASE_URL environment variable. Required for application startup.\n\n### Key NPM Packages\n\n**UI Components**: @radix-ui/* primitives (20+ component packages), lucide-react for icons\n\n**Forms**: react-hook-form with @hookform/resolvers for validation\n\n**File Uploads**: @uppy/core, @uppy/dashboard, @uppy/aws-s3, @uppy/react for file upload UI and S3 integration\n\n**Date Handling**: date-fns for date manipulation and formatting\n\n**Validation**: zod for schema validation, drizzle-zod for database schema validation\n\n**Authentication**: passport, passport-local, express-session, connect-pg-simple\n\n**Utilities**: nanoid for ID generation, memoizee for function memoization\n\n### Environment Variables\n\n**Required**:\n- `DATABASE_URL`: PostgreSQL connection string\n- `SESSION_SECRET`: Express session encryption key\n- `REPL_ID`: Replit deployment identifier for OIDC\n\n**Optional**:\n- `ISSUER_URL`: OIDC issuer URL (defaults to https://replit.com/oidc)\n- `PUBLIC_OBJECT_SEARCH_PATHS`: Comma-separated public object prefixes\n- `NODE_ENV`: development/production mode flag","path":null,"size_bytes":7399,"size_tokens":null},"client/src/pages/TimeTracking.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { useState, useEffect, useRef } from \"react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Clock, MapPin, Camera, Check, X, Wifi, WifiOff, AlertTriangle } from \"lucide-react\";\nimport type { Site, TimeRecord } from \"@shared/schema\";\n\nexport default function TimeTracking() {\n  const { t } = useTranslation();\n  const { user } = useAuth();\n  const { toast } = useToast();\n\n  const [selectedSite, setSelectedSite] = useState<string>(\"\");\n  const [location, setLocation] = useState<{ lat: number; lng: number } | null>(null);\n  const [locationError, setLocationError] = useState<string>(\"\");\n  const [isOnline, setIsOnline] = useState(navigator.onLine);\n  const [showPinDialog, setShowPinDialog] = useState(false);\n  const [pin, setPin] = useState(\"\");\n  const [actionType, setActionType] = useState<\"in\" | \"out\">(\"in\");\n  const [capturedPhoto, setCapturedPhoto] = useState<string | null>(null);\n  const [showCamera, setShowCamera] = useState(false);\n  const videoRef = useRef<HTMLVideoElement>(null);\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n\n  const { data: sites } = useQuery<Site[]>({\n    queryKey: [\"/api/sites\"],\n  });\n\n  const { data: currentRecord } = useQuery<TimeRecord | null>({\n    queryKey: [\"/api/time-records/active\"],\n  });\n\n  const isClockedIn = !!currentRecord && !currentRecord.checkOutTime;\n\n  useEffect(() => {\n    const handleOnline = () => setIsOnline(true);\n    const handleOffline = () => setIsOnline(false);\n    window.addEventListener(\"online\", handleOnline);\n    window.addEventListener(\"offline\", handleOffline);\n    return () => {\n      window.removeEventListener(\"online\", handleOnline);\n      window.removeEventListener(\"offline\", handleOffline);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition(\n        (pos) => {\n          setLocation({ lat: pos.coords.latitude, lng: pos.coords.longitude });\n          setLocationError(\"\");\n        },\n        (err) => {\n          setLocationError(err.message);\n        },\n        { enableHighAccuracy: true }\n      );\n    }\n  }, []);\n\n  const clockInMutation = useMutation({\n    mutationFn: async (data: { siteId: string; lat: number; lng: number; photo?: string; pin?: string }) => {\n      return apiRequest(\"POST\", \"/api/time-records/check-in\", {\n        siteId: data.siteId,\n        latitude: data.lat,\n        longitude: data.lng,\n        photo: data.photo,\n        deviceId: navigator.userAgent,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/time-records/active\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/time-records/my\"] });\n      toast({ title: t(\"time.clockIn\"), description: \"Successfully clocked in\" });\n      setShowPinDialog(false);\n      setPin(\"\");\n      setCapturedPhoto(null);\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to clock in\", variant: \"destructive\" });\n    },\n  });\n\n  const clockOutMutation = useMutation({\n    mutationFn: async (data: { recordId: string; lat: number; lng: number; photo?: string; pin?: string }) => {\n      return apiRequest(\"POST\", `/api/time-records/${data.recordId}/check-out`, {\n        latitude: data.lat,\n        longitude: data.lng,\n        photo: data.photo,\n        deviceId: navigator.userAgent,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/time-records/active\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/time-records/my\"] });\n      toast({ title: t(\"time.clockOut\"), description: \"Successfully clocked out\" });\n      setShowPinDialog(false);\n      setPin(\"\");\n      setCapturedPhoto(null);\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to clock out\", variant: \"destructive\" });\n    },\n  });\n\n  const handleClockAction = (type: \"in\" | \"out\") => {\n    setActionType(type);\n    setShowCamera(true);\n  };\n\n  const startCamera = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: \"user\" } });\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n      }\n    } catch (err) {\n      toast({ title: \"Camera Error\", description: \"Could not access camera\", variant: \"destructive\" });\n    }\n  };\n\n  const capturePhoto = () => {\n    if (videoRef.current && canvasRef.current) {\n      const ctx = canvasRef.current.getContext(\"2d\");\n      if (ctx) {\n        canvasRef.current.width = videoRef.current.videoWidth;\n        canvasRef.current.height = videoRef.current.videoHeight;\n        ctx.drawImage(videoRef.current, 0, 0);\n        const photo = canvasRef.current.toDataURL(\"image/jpeg\", 0.8);\n        setCapturedPhoto(photo);\n        const stream = videoRef.current.srcObject as MediaStream;\n        stream?.getTracks().forEach((track) => track.stop());\n        setShowCamera(false);\n        setShowPinDialog(true);\n      }\n    }\n  };\n\n  const submitAction = () => {\n    if (!location) {\n      toast({ title: \"Error\", description: \"Location required\", variant: \"destructive\" });\n      return;\n    }\n\n    if (actionType === \"in\") {\n      if (!selectedSite) {\n        toast({ title: \"Error\", description: t(\"time.selectSite\"), variant: \"destructive\" });\n        return;\n      }\n      clockInMutation.mutate({\n        siteId: selectedSite,\n        lat: location.lat,\n        lng: location.lng,\n        photo: capturedPhoto || undefined,\n        pin: pin || undefined,\n      });\n    } else {\n      if (!currentRecord) {\n        toast({ title: \"Error\", description: \"No active record found\", variant: \"destructive\" });\n        return;\n      }\n      clockOutMutation.mutate({\n        recordId: currentRecord.id,\n        lat: location.lat,\n        lng: location.lng,\n        photo: capturedPhoto || undefined,\n        pin: pin || undefined,\n      });\n    }\n  };\n\n  useEffect(() => {\n    if (showCamera) {\n      startCamera();\n    }\n  }, [showCamera]);\n\n  const elapsedTime = currentRecord?.checkInTime\n    ? Math.floor((Date.now() - new Date(currentRecord.checkInTime).getTime()) / 1000)\n    : 0;\n  const hours = Math.floor(elapsedTime / 3600);\n  const minutes = Math.floor((elapsedTime % 3600) / 60);\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <h1 className=\"text-2xl font-bold\">{t(\"nav.timeRecords\")}</h1>\n        <Badge variant={isOnline ? \"default\" : \"secondary\"}>\n          {isOnline ? <Wifi className=\"h-3 w-3 mr-1\" /> : <WifiOff className=\"h-3 w-3 mr-1\" />}\n          {isOnline ? \"Online\" : t(\"time.offlineMode\")}\n        </Badge>\n      </div>\n\n      <Card className=\"max-w-md mx-auto\">\n        <CardHeader className=\"text-center\">\n          <div className={`mx-auto w-24 h-24 rounded-full flex items-center justify-center ${\n            isClockedIn ? \"bg-green-500/20\" : \"bg-muted\"\n          }`}>\n            <Clock className={`h-12 w-12 ${isClockedIn ? \"text-green-500\" : \"text-muted-foreground\"}`} />\n          </div>\n          <CardTitle className=\"mt-4\">\n            {isClockedIn ? t(\"time.currentlyWorking\") : t(\"time.notClockedIn\")}\n          </CardTitle>\n          {isClockedIn && (\n            <p className=\"text-3xl font-mono mt-2\" data-testid=\"text-elapsed-time\">\n              {String(hours).padStart(2, \"0\")}:{String(minutes).padStart(2, \"0\")}\n            </p>\n          )}\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n            <MapPin className=\"h-4 w-4\" />\n            {location ? (\n              <span className=\"text-green-600\">{t(\"time.withinGeofence\")}</span>\n            ) : locationError ? (\n              <span className=\"text-red-600\">{locationError}</span>\n            ) : (\n              <span>{t(\"common.loading\")}</span>\n            )}\n          </div>\n\n          {!isClockedIn && (\n            <Select value={selectedSite} onValueChange={setSelectedSite}>\n              <SelectTrigger data-testid=\"select-site\">\n                <SelectValue placeholder={t(\"time.selectSite\")} />\n              </SelectTrigger>\n              <SelectContent>\n                {sites?.map((site) => (\n                  <SelectItem key={site.id} value={site.id}>\n                    {site.name}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          )}\n\n          <Button\n            className=\"w-full\"\n            size=\"lg\"\n            variant={isClockedIn ? \"destructive\" : \"default\"}\n            onClick={() => handleClockAction(isClockedIn ? \"out\" : \"in\")}\n            disabled={clockInMutation.isPending || clockOutMutation.isPending}\n            data-testid={isClockedIn ? \"button-clock-out\" : \"button-clock-in\"}\n          >\n            {isClockedIn ? t(\"time.clockOut\") : t(\"time.clockIn\")}\n          </Button>\n        </CardContent>\n      </Card>\n\n      <Dialog open={showCamera} onOpenChange={setShowCamera}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>{t(\"time.takeSelfie\")}</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"relative aspect-square bg-black rounded-md overflow-hidden\">\n              <video\n                ref={videoRef}\n                autoPlay\n                playsInline\n                muted\n                className=\"w-full h-full object-cover\"\n              />\n            </div>\n            <canvas ref={canvasRef} className=\"hidden\" />\n            <Button onClick={capturePhoto} className=\"w-full\" data-testid=\"button-capture-photo\">\n              <Camera className=\"mr-2 h-4 w-4\" />\n              {t(\"time.takeSelfie\")}\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={showPinDialog} onOpenChange={setShowPinDialog}>\n        <DialogContent className=\"max-w-sm\">\n          <DialogHeader>\n            <DialogTitle>\n              {actionType === \"in\" ? t(\"time.confirmCheckIn\") : t(\"time.confirmCheckOut\")}\n            </DialogTitle>\n            <DialogDescription>{t(\"time.enterPin\")}</DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            {capturedPhoto && (\n              <img src={capturedPhoto} alt=\"Selfie\" className=\"w-32 h-32 mx-auto rounded-full object-cover\" />\n            )}\n            <Input\n              type=\"password\"\n              maxLength={6}\n              placeholder=\"PIN\"\n              value={pin}\n              onChange={(e) => setPin(e.target.value)}\n              className=\"text-center text-2xl tracking-widest\"\n              data-testid=\"input-pin\"\n            />\n            <div className=\"flex gap-2\">\n              <Button variant=\"outline\" className=\"flex-1\" onClick={() => setShowPinDialog(false)}>\n                {t(\"common.cancel\")}\n              </Button>\n              <Button\n                className=\"flex-1\"\n                onClick={submitAction}\n                disabled={clockInMutation.isPending || clockOutMutation.isPending}\n                data-testid=\"button-confirm-action\"\n              >\n                {t(\"common.confirm\")}\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":11954,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"client/src/components/ThemeProvider.tsx":{"content":"import { createContext, useContext, useEffect, useState } from \"react\";\n\ntype Theme = \"dark\" | \"light\" | \"system\";\n\ninterface ThemeContextValue {\n  theme: Theme;\n  setTheme: (theme: Theme) => void;\n  resolvedTheme: \"dark\" | \"light\";\n}\n\nconst ThemeContext = createContext<ThemeContextValue | undefined>(undefined);\n\nexport function ThemeProvider({ children }: { children: React.ReactNode }) {\n  const [theme, setTheme] = useState<Theme>(() => {\n    if (typeof window !== \"undefined\") {\n      return (localStorage.getItem(\"theme\") as Theme) || \"system\";\n    }\n    return \"system\";\n  });\n\n  const [resolvedTheme, setResolvedTheme] = useState<\"dark\" | \"light\">(\"light\");\n\n  useEffect(() => {\n    const root = document.documentElement;\n    const systemTheme = window.matchMedia(\"(prefers-color-scheme: dark)\").matches ? \"dark\" : \"light\";\n    const resolved = theme === \"system\" ? systemTheme : theme;\n    \n    root.classList.remove(\"light\", \"dark\");\n    root.classList.add(resolved);\n    setResolvedTheme(resolved);\n    localStorage.setItem(\"theme\", theme);\n  }, [theme]);\n\n  useEffect(() => {\n    const mediaQuery = window.matchMedia(\"(prefers-color-scheme: dark)\");\n    const handleChange = () => {\n      if (theme === \"system\") {\n        const resolved = mediaQuery.matches ? \"dark\" : \"light\";\n        document.documentElement.classList.remove(\"light\", \"dark\");\n        document.documentElement.classList.add(resolved);\n        setResolvedTheme(resolved);\n      }\n    };\n    mediaQuery.addEventListener(\"change\", handleChange);\n    return () => mediaQuery.removeEventListener(\"change\", handleChange);\n  }, [theme]);\n\n  return (\n    <ThemeContext.Provider value={{ theme, setTheme, resolvedTheme }}>\n      {children}\n    </ThemeContext.Provider>\n  );\n}\n\nexport function useTheme() {\n  const context = useContext(ThemeContext);\n  if (!context) {\n    throw new Error(\"useTheme must be used within a ThemeProvider\");\n  }\n  return context;\n}\n","path":null,"size_bytes":1935,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"server/db.ts":{"content":"import { drizzle } from \"drizzle-orm/node-postgres\";\nimport pg from \"pg\";\nimport * as schema from \"@shared/schema\";\n\nconst { Pool } = pg;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle(pool, { schema });\n","path":null,"size_bytes":395,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"server/objectStorage.ts":{"content":"// Object Storage Service - javascript_object_storage blueprint\nimport { Storage, File } from \"@google-cloud/storage\";\nimport { Response } from \"express\";\nimport { randomUUID } from \"crypto\";\nimport {\n  ObjectAclPolicy,\n  ObjectPermission,\n  canAccessObject,\n  getObjectAclPolicy,\n  setObjectAclPolicy,\n} from \"./objectAcl\";\n\nconst REPLIT_SIDECAR_ENDPOINT = \"http://127.0.0.1:1106\";\n\nexport const objectStorageClient = new Storage({\n  credentials: {\n    audience: \"replit\",\n    subject_token_type: \"access_token\",\n    token_url: `${REPLIT_SIDECAR_ENDPOINT}/token`,\n    type: \"external_account\",\n    credential_source: {\n      url: `${REPLIT_SIDECAR_ENDPOINT}/credential`,\n      format: {\n        type: \"json\",\n        subject_token_field_name: \"access_token\",\n      },\n    },\n    universe_domain: \"googleapis.com\",\n  },\n  projectId: \"\",\n});\n\nexport class ObjectNotFoundError extends Error {\n  constructor() {\n    super(\"Object not found\");\n    this.name = \"ObjectNotFoundError\";\n    Object.setPrototypeOf(this, ObjectNotFoundError.prototype);\n  }\n}\n\nexport class ObjectStorageService {\n  constructor() {}\n\n  getPublicObjectSearchPaths(): Array<string> {\n    const pathsStr = process.env.PUBLIC_OBJECT_SEARCH_PATHS || \"\";\n    const paths = Array.from(\n      new Set(\n        pathsStr\n          .split(\",\")\n          .map((path) => path.trim())\n          .filter((path) => path.length > 0)\n      )\n    );\n    if (paths.length === 0) {\n      throw new Error(\n        \"PUBLIC_OBJECT_SEARCH_PATHS not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PUBLIC_OBJECT_SEARCH_PATHS env var (comma-separated paths).\"\n      );\n    }\n    return paths;\n  }\n\n  getPrivateObjectDir(): string {\n    const dir = process.env.PRIVATE_OBJECT_DIR || \"\";\n    if (!dir) {\n      throw new Error(\n        \"PRIVATE_OBJECT_DIR not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PRIVATE_OBJECT_DIR env var.\"\n      );\n    }\n    return dir;\n  }\n\n  async searchPublicObject(filePath: string): Promise<File | null> {\n    for (const searchPath of this.getPublicObjectSearchPaths()) {\n      const fullPath = `${searchPath}/${filePath}`;\n      const { bucketName, objectName } = parseObjectPath(fullPath);\n      const bucket = objectStorageClient.bucket(bucketName);\n      const file = bucket.file(objectName);\n      const [exists] = await file.exists();\n      if (exists) {\n        return file;\n      }\n    }\n    return null;\n  }\n\n  async downloadObject(file: File, res: Response, cacheTtlSec: number = 3600) {\n    try {\n      const [metadata] = await file.getMetadata();\n      const aclPolicy = await getObjectAclPolicy(file);\n      const isPublic = aclPolicy?.visibility === \"public\";\n      res.set({\n        \"Content-Type\": metadata.contentType || \"application/octet-stream\",\n        \"Content-Length\": metadata.size,\n        \"Cache-Control\": `${isPublic ? \"public\" : \"private\"}, max-age=${cacheTtlSec}`,\n      });\n\n      const stream = file.createReadStream();\n      stream.on(\"error\", (err) => {\n        console.error(\"Stream error:\", err);\n        if (!res.headersSent) {\n          res.status(500).json({ error: \"Error streaming file\" });\n        }\n      });\n      stream.pipe(res);\n    } catch (error) {\n      console.error(\"Error downloading file:\", error);\n      if (!res.headersSent) {\n        res.status(500).json({ error: \"Error downloading file\" });\n      }\n    }\n  }\n\n  async getObjectEntityUploadURL(): Promise<string> {\n    const privateObjectDir = this.getPrivateObjectDir();\n    if (!privateObjectDir) {\n      throw new Error(\n        \"PRIVATE_OBJECT_DIR not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PRIVATE_OBJECT_DIR env var.\"\n      );\n    }\n\n    const objectId = randomUUID();\n    const fullPath = `${privateObjectDir}/uploads/${objectId}`;\n    const { bucketName, objectName } = parseObjectPath(fullPath);\n\n    return signObjectURL({\n      bucketName,\n      objectName,\n      method: \"PUT\",\n      ttlSec: 900,\n    });\n  }\n\n  async getObjectEntityFile(objectPath: string): Promise<File> {\n    if (!objectPath.startsWith(\"/objects/\")) {\n      throw new ObjectNotFoundError();\n    }\n\n    const parts = objectPath.slice(1).split(\"/\");\n    if (parts.length < 2) {\n      throw new ObjectNotFoundError();\n    }\n\n    const entityId = parts.slice(1).join(\"/\");\n    let entityDir = this.getPrivateObjectDir();\n    if (!entityDir.endsWith(\"/\")) {\n      entityDir = `${entityDir}/`;\n    }\n    const objectEntityPath = `${entityDir}${entityId}`;\n    const { bucketName, objectName } = parseObjectPath(objectEntityPath);\n    const bucket = objectStorageClient.bucket(bucketName);\n    const objectFile = bucket.file(objectName);\n    const [exists] = await objectFile.exists();\n    if (!exists) {\n      throw new ObjectNotFoundError();\n    }\n    return objectFile;\n  }\n\n  normalizeObjectEntityPath(rawPath: string): string {\n    if (!rawPath.startsWith(\"https://storage.googleapis.com/\")) {\n      return rawPath;\n    }\n\n    const url = new URL(rawPath);\n    const rawObjectPath = url.pathname;\n\n    let objectEntityDir = this.getPrivateObjectDir();\n    if (!objectEntityDir.endsWith(\"/\")) {\n      objectEntityDir = `${objectEntityDir}/`;\n    }\n\n    if (!rawObjectPath.startsWith(objectEntityDir)) {\n      return rawObjectPath;\n    }\n\n    const entityId = rawObjectPath.slice(objectEntityDir.length);\n    return `/objects/${entityId}`;\n  }\n\n  async trySetObjectEntityAclPolicy(\n    rawPath: string,\n    aclPolicy: ObjectAclPolicy\n  ): Promise<string> {\n    const normalizedPath = this.normalizeObjectEntityPath(rawPath);\n    if (!normalizedPath.startsWith(\"/\")) {\n      return normalizedPath;\n    }\n\n    const objectFile = await this.getObjectEntityFile(normalizedPath);\n    await setObjectAclPolicy(objectFile, aclPolicy);\n    return normalizedPath;\n  }\n\n  async canAccessObjectEntity({\n    userId,\n    objectFile,\n    requestedPermission,\n  }: {\n    userId?: string;\n    objectFile: File;\n    requestedPermission?: ObjectPermission;\n  }): Promise<boolean> {\n    return canAccessObject({\n      userId,\n      objectFile,\n      requestedPermission: requestedPermission ?? ObjectPermission.READ,\n    });\n  }\n}\n\nfunction parseObjectPath(path: string): {\n  bucketName: string;\n  objectName: string;\n} {\n  if (!path.startsWith(\"/\")) {\n    path = `/${path}`;\n  }\n  const pathParts = path.split(\"/\");\n  if (pathParts.length < 3) {\n    throw new Error(\"Invalid path: must contain at least a bucket name\");\n  }\n\n  const bucketName = pathParts[1];\n  const objectName = pathParts.slice(2).join(\"/\");\n\n  return {\n    bucketName,\n    objectName,\n  };\n}\n\nasync function signObjectURL({\n  bucketName,\n  objectName,\n  method,\n  ttlSec,\n}: {\n  bucketName: string;\n  objectName: string;\n  method: \"GET\" | \"PUT\" | \"DELETE\" | \"HEAD\";\n  ttlSec: number;\n}): Promise<string> {\n  const request = {\n    bucket_name: bucketName,\n    object_name: objectName,\n    method,\n    expires_at: new Date(Date.now() + ttlSec * 1000).toISOString(),\n  };\n  const response = await fetch(\n    `${REPLIT_SIDECAR_ENDPOINT}/object-storage/signed-object-url`,\n    {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(request),\n    }\n  );\n  if (!response.ok) {\n    throw new Error(\n      `Failed to sign object URL, errorcode: ${response.status}, ` +\n        `make sure you're running on Replit`\n    );\n  }\n\n  const { signed_url: signedURL } = await response.json();\n  return signedURL;\n}\n","path":null,"size_bytes":7451,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\n\nconst app = express();\nconst httpServer = createServer(app);\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\napp.use(\n  express.json({\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false }));\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  await registerRoutes(httpServer, app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":2560,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/pages/Settings.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { LanguageSelector } from \"@/components/LanguageSelector\";\nimport { ThemeToggle } from \"@/components/ThemeToggle\";\nimport { useTheme } from \"@/components/ThemeProvider\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { NotificationPreferences } from \"@shared/schema\";\n\ntype NotificationPreferenceBooleans = \n  | \"emailEnabled\" \n  | \"pushEnabled\" \n  | \"smsEnabled\" \n  | \"timeReminders\" \n  | \"lateAlerts\" \n  | \"toolAlerts\" \n  | \"contestationAlerts\" \n  | \"leaveAlerts\";\nimport {\n  User,\n  Building,\n  Bell,\n  Shield,\n  CreditCard,\n  Globe,\n  Moon,\n  MapPin,\n  Camera,\n  Key,\n  Loader2,\n} from \"lucide-react\";\n\nexport default function Settings() {\n  const { t } = useTranslation();\n  const { user, isManager } = useAuth();\n  const { theme, setTheme } = useTheme();\n  const { toast } = useToast();\n\n  const { data: notificationPrefs, isLoading: prefsLoading } = useQuery<NotificationPreferences>({\n    queryKey: [\"/api/notification-preferences\"],\n  });\n\n  const updatePrefsMutation = useMutation({\n    mutationFn: async (updates: Partial<Record<NotificationPreferenceBooleans, boolean>>) => {\n      await apiRequest(\"PUT\", \"/api/notification-preferences\", updates);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notification-preferences\"] });\n      toast({\n        title: t(\"common.save\"),\n        description: t(\"notifications.preferences.updateSuccess\"),\n      });\n    },\n    onError: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notification-preferences\"] });\n      toast({\n        title: t(\"common.error\"),\n        description: t(\"notifications.preferences.updateError\"),\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handlePreferenceChange = (key: NotificationPreferenceBooleans, value: boolean) => {\n    updatePrefsMutation.mutate({ [key]: value });\n  };\n\n  const getInitials = () => {\n    return `${user?.firstName?.[0] || \"\"}${user?.lastName?.[0] || \"\"}`.toUpperCase() || \"U\";\n  };\n\n  return (\n    <div className=\"space-y-6 max-w-4xl\">\n      <h1 className=\"text-2xl font-bold\">{t(\"nav.settings\")}</h1>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <User className=\"h-5 w-5\" />\n            {t(\"settings.profile\")}\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"flex items-center gap-4\">\n            <Avatar className=\"h-20 w-20\">\n              <AvatarImage src={user?.profileImageUrl || undefined} />\n              <AvatarFallback className=\"text-2xl\">{getInitials()}</AvatarFallback>\n            </Avatar>\n            <div>\n              <p className=\"font-semibold text-lg\">\n                {user?.firstName} {user?.lastName}\n              </p>\n              <p className=\"text-muted-foreground\">{user?.email}</p>\n              <Button variant=\"outline\" size=\"sm\" className=\"mt-2\" data-testid=\"button-change-photo\">\n                <Camera className=\"mr-2 h-4 w-4\" />\n                Change Photo\n              </Button>\n            </div>\n          </div>\n\n          <Separator />\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div>\n              <Label>First Name</Label>\n              <Input\n                defaultValue={user?.firstName || \"\"}\n                className=\"mt-1\"\n                data-testid=\"input-settings-firstname\"\n              />\n            </div>\n            <div>\n              <Label>Last Name</Label>\n              <Input\n                defaultValue={user?.lastName || \"\"}\n                className=\"mt-1\"\n                data-testid=\"input-settings-lastname\"\n              />\n            </div>\n            <div>\n              <Label>Email</Label>\n              <Input\n                type=\"email\"\n                defaultValue={user?.email || \"\"}\n                className=\"mt-1\"\n                data-testid=\"input-settings-email\"\n              />\n            </div>\n            <div>\n              <Label>Phone</Label>\n              <Input\n                type=\"tel\"\n                defaultValue={user?.phone || \"\"}\n                className=\"mt-1\"\n                data-testid=\"input-settings-phone\"\n              />\n            </div>\n          </div>\n\n          <Button data-testid=\"button-save-profile\">{t(\"common.save\")}</Button>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Globe className=\"h-5 w-5\" />\n            {t(\"settings.language\")} & Theme\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <Label>{t(\"settings.language\")}</Label>\n              <p className=\"text-sm text-muted-foreground\">\n                Choose your preferred language\n              </p>\n            </div>\n            <LanguageSelector />\n          </div>\n\n          <Separator />\n\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <Label>Theme</Label>\n              <p className=\"text-sm text-muted-foreground\">\n                Switch between light and dark mode\n              </p>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-sm text-muted-foreground\">\n                {theme === \"dark\" ? \"Dark\" : \"Light\"}\n              </span>\n              <ThemeToggle />\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Shield className=\"h-5 w-5\" />\n            {t(\"settings.security\")}\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <Label>Change PIN</Label>\n              <p className=\"text-sm text-muted-foreground\">\n                Update your 6-digit PIN for time tracking\n              </p>\n            </div>\n            <Button variant=\"outline\" data-testid=\"button-change-pin\">\n              <Key className=\"mr-2 h-4 w-4\" />\n              Change PIN\n            </Button>\n          </div>\n\n          <Separator />\n\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <Label>Two-Factor Authentication</Label>\n              <p className=\"text-sm text-muted-foreground\">\n                Add an extra layer of security\n              </p>\n            </div>\n            <Switch data-testid=\"switch-2fa\" />\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Bell className=\"h-5 w-5\" />\n            {t(\"settings.notifications\")}\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          {prefsLoading ? (\n            <div className=\"flex items-center justify-center py-8\">\n              <Loader2 className=\"h-6 w-6 animate-spin\" />\n            </div>\n          ) : (\n            <>\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <Label>{t(\"notifications.preferences.email\")}</Label>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Receive updates via email\n                  </p>\n                </div>\n                <Switch\n                  checked={notificationPrefs?.emailEnabled ?? true}\n                  onCheckedChange={(checked) => handlePreferenceChange(\"emailEnabled\", checked)}\n                  disabled={updatePrefsMutation.isPending}\n                  data-testid=\"switch-email-notifications\"\n                />\n              </div>\n\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <Label>{t(\"notifications.preferences.push\")}</Label>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Receive push notifications on your device\n                  </p>\n                </div>\n                <Switch\n                  checked={notificationPrefs?.pushEnabled ?? true}\n                  onCheckedChange={(checked) => handlePreferenceChange(\"pushEnabled\", checked)}\n                  disabled={updatePrefsMutation.isPending}\n                  data-testid=\"switch-push-notifications\"\n                />\n              </div>\n\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <Label>{t(\"notifications.preferences.sms\")}</Label>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Receive SMS notifications\n                  </p>\n                </div>\n                <Switch\n                  checked={notificationPrefs?.smsEnabled ?? false}\n                  onCheckedChange={(checked) => handlePreferenceChange(\"smsEnabled\", checked)}\n                  disabled={updatePrefsMutation.isPending}\n                  data-testid=\"switch-sms-notifications\"\n                />\n              </div>\n\n              <Separator />\n\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <Label>{t(\"notifications.preferences.timeReminders\")}</Label>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Get reminded to clock in/out\n                  </p>\n                </div>\n                <Switch\n                  checked={notificationPrefs?.timeReminders ?? true}\n                  onCheckedChange={(checked) => handlePreferenceChange(\"timeReminders\", checked)}\n                  disabled={updatePrefsMutation.isPending}\n                  data-testid=\"switch-time-reminders\"\n                />\n              </div>\n\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <Label>{t(\"notifications.preferences.lateAlerts\")}</Label>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Get alerts for late arrivals\n                  </p>\n                </div>\n                <Switch\n                  checked={notificationPrefs?.lateAlerts ?? true}\n                  onCheckedChange={(checked) => handlePreferenceChange(\"lateAlerts\", checked)}\n                  disabled={updatePrefsMutation.isPending}\n                  data-testid=\"switch-late-alerts\"\n                />\n              </div>\n\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <Label>{t(\"notifications.preferences.toolAlerts\")}</Label>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Alerts for unreturned tools\n                  </p>\n                </div>\n                <Switch\n                  checked={notificationPrefs?.toolAlerts ?? true}\n                  onCheckedChange={(checked) => handlePreferenceChange(\"toolAlerts\", checked)}\n                  disabled={updatePrefsMutation.isPending}\n                  data-testid=\"switch-tool-alerts\"\n                />\n              </div>\n\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <Label>{t(\"notifications.preferences.contestationAlerts\")}</Label>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Alerts for client contestations\n                  </p>\n                </div>\n                <Switch\n                  checked={notificationPrefs?.contestationAlerts ?? true}\n                  onCheckedChange={(checked) => handlePreferenceChange(\"contestationAlerts\", checked)}\n                  disabled={updatePrefsMutation.isPending}\n                  data-testid=\"switch-contestation-alerts\"\n                />\n              </div>\n\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <Label>{t(\"notifications.preferences.leaveAlerts\")}</Label>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Alerts for leave request updates\n                  </p>\n                </div>\n                <Switch\n                  checked={notificationPrefs?.leaveAlerts ?? true}\n                  onCheckedChange={(checked) => handlePreferenceChange(\"leaveAlerts\", checked)}\n                  disabled={updatePrefsMutation.isPending}\n                  data-testid=\"switch-leave-alerts\"\n                />\n              </div>\n            </>\n          )}\n        </CardContent>\n      </Card>\n\n      {isManager && (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Building className=\"h-5 w-5\" />\n              {t(\"settings.company\")}\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <Label>Company Name</Label>\n                <Input className=\"mt-1\" data-testid=\"input-company-name\" />\n              </div>\n              <div>\n                <Label>Company Email</Label>\n                <Input type=\"email\" className=\"mt-1\" data-testid=\"input-company-email\" />\n              </div>\n            </div>\n\n            <Separator />\n\n            <div className=\"space-y-4\">\n              <h4 className=\"font-medium\">Time Tracking Settings</h4>\n\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <Label>{t(\"settings.requireSelfie\")}</Label>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Require selfie for clock in/out\n                  </p>\n                </div>\n                <Switch defaultChecked data-testid=\"switch-require-selfie\" />\n              </div>\n\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <Label>{t(\"settings.requirePin\")}</Label>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Require PIN verification\n                  </p>\n                </div>\n                <Switch defaultChecked data-testid=\"switch-require-pin\" />\n              </div>\n\n              <div>\n                <Label>{t(\"settings.geofence\")} (meters)</Label>\n                <Input\n                  type=\"number\"\n                  defaultValue=\"100\"\n                  className=\"mt-1 w-32\"\n                  data-testid=\"input-geofence-radius\"\n                />\n              </div>\n            </div>\n\n            <Button data-testid=\"button-save-company\">{t(\"common.save\")}</Button>\n          </CardContent>\n        </Card>\n      )}\n\n      {isManager && (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <CreditCard className=\"h-5 w-5\" />\n              {t(\"settings.billing\")}\n            </CardTitle>\n            <CardDescription>\n              Manage your subscription and payment methods\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"p-4 bg-muted rounded-md\">\n              <div className=\"flex items-center justify-between mb-2\">\n                <span className=\"font-medium\">Current Plan</span>\n                <span className=\"text-primary font-semibold\">Professional</span>\n              </div>\n              <p className=\"text-sm text-muted-foreground\">\n                $79/month - Up to 50 employees\n              </p>\n            </div>\n            <Button variant=\"outline\" className=\"mt-4\" data-testid=\"button-manage-subscription\">\n              Manage Subscription\n            </Button>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":16424,"size_tokens":null},"client/src/pages/Landing.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { LanguageSelector } from \"@/components/LanguageSelector\";\nimport { ThemeToggle } from \"@/components/ThemeToggle\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport {\n  MapPin,\n  Wrench,\n  Users,\n  Calculator,\n  Shield,\n  Globe,\n  Check,\n  ChevronDown,\n  HardHat,\n  Clock,\n  Camera,\n} from \"lucide-react\";\nimport { useState } from \"react\";\nimport {\n  Accordion,\n  AccordionContent,\n  AccordionItem,\n  AccordionTrigger,\n} from \"@/components/ui/accordion\";\n\nexport default function Landing() {\n  const { t } = useTranslation();\n  const { isAuthenticated } = useAuth();\n  const [billingPeriod, setBillingPeriod] = useState<\"monthly\" | \"yearly\">(\"monthly\");\n\n  const features = [\n    { icon: MapPin, key: \"gps\" },\n    { icon: Wrench, key: \"tools\" },\n    { icon: Users, key: \"client\" },\n    { icon: Calculator, key: \"payroll\" },\n    { icon: Shield, key: \"antifraud\" },\n    { icon: Globe, key: \"multilang\" },\n  ];\n\n  const plans = [\n    {\n      key: \"starter\",\n      price: billingPeriod === \"yearly\" ? \"24\" : \"29\",\n      cta: \"getStarted\",\n      featured: false,\n    },\n    {\n      key: \"professional\",\n      price: billingPeriod === \"yearly\" ? \"65\" : \"79\",\n      cta: \"getStarted\",\n      featured: true,\n    },\n    {\n      key: \"enterprise\",\n      price: billingPeriod === \"yearly\" ? \"165\" : \"199\",\n      cta: \"contactSales\",\n      featured: false,\n    },\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <header className=\"sticky top-0 z-50 border-b bg-background/95 backdrop-blur\">\n        <div className=\"container mx-auto flex h-16 items-center justify-between gap-4 px-4\">\n          <Link href=\"/\" className=\"flex items-center gap-2 flex-shrink-0\">\n            <HardHat className=\"h-8 w-8 text-primary\" />\n            <span className=\"text-xl font-bold hidden sm:inline\">ConstructTrack</span>\n          </Link>\n          <nav className=\"hidden md:flex items-center gap-6\">\n            <a href=\"#features\" className=\"text-sm text-muted-foreground hover:text-foreground\">\n              {t(\"landing.footer.features\")}\n            </a>\n            <a href=\"#pricing\" className=\"text-sm text-muted-foreground hover:text-foreground\">\n              {t(\"landing.footer.pricing\")}\n            </a>\n            <a href=\"#faq\" className=\"text-sm text-muted-foreground hover:text-foreground\">\n              FAQ\n            </a>\n          </nav>\n          <div className=\"flex items-center gap-1 sm:gap-2 flex-shrink-0\">\n            <LanguageSelector />\n            <ThemeToggle />\n            {isAuthenticated ? (\n              <Link href=\"/dashboard\">\n                <Button data-testid=\"button-dashboard\">{t(\"nav.dashboard\")}</Button>\n              </Link>\n            ) : (\n              <Link href=\"/login\">\n                <Button data-testid=\"button-login\">\n                  {t(\"nav.login\")}\n                </Button>\n              </Link>\n            )}\n          </div>\n        </div>\n      </header>\n\n      <section className=\"relative min-h-[90vh] flex items-center justify-center overflow-hidden\">\n        <div className=\"absolute inset-0 bg-gradient-to-br from-primary/10 via-background to-background\" />\n        <div className=\"absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0zNiAxOGMzLjMxNCAwIDYgMi42ODYgNiA2cy0yLjY4NiA2LTYgNi02LTIuNjg2LTYtNiAyLjY4Ni02IDYtNiIgc3Ryb2tlPSIjRkY2QjM1IiBzdHJva2Utb3BhY2l0eT0iLjEiLz48L2c+PC9zdmc+')] opacity-30\" />\n        <div className=\"container relative z-10 mx-auto px-4 text-center\">\n          <Badge variant=\"secondary\" className=\"mb-6\">\n            <Clock className=\"mr-1 h-3 w-3\" />\n            {t(\"landing.faq.a3\").split(\".\")[0]}\n          </Badge>\n          <h1 className=\"text-4xl md:text-5xl lg:text-6xl font-bold tracking-tight mb-6 max-w-4xl mx-auto\">\n            {t(\"landing.hero.title\")}\n          </h1>\n          <p className=\"text-lg md:text-xl text-muted-foreground mb-8 max-w-2xl mx-auto\">\n            {t(\"landing.hero.subtitle\")}\n          </p>\n          <div className=\"flex flex-col sm:flex-row items-center justify-center gap-4\">\n            <Link href=\"/login\">\n              <Button size=\"lg\" data-testid=\"button-hero-cta\">\n                {t(\"landing.hero.cta\")}\n              </Button>\n            </Link>\n            <Button size=\"lg\" variant=\"outline\" data-testid=\"button-hero-demo\">\n              <Camera className=\"mr-2 h-4 w-4\" />\n              {t(\"landing.hero.demo\")}\n            </Button>\n          </div>\n          <p className=\"mt-6 text-sm text-muted-foreground\">\n            {t(\"landing.testimonials.title\")}\n          </p>\n        </div>\n      </section>\n\n      <section id=\"features\" className=\"py-20 md:py-32 bg-muted/30\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"text-center mb-16\">\n            <h2 className=\"text-3xl md:text-4xl font-bold mb-4\">\n              {t(\"landing.features.title\")}\n            </h2>\n            <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\n              {t(\"landing.features.subtitle\")}\n            </p>\n          </div>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {features.map(({ icon: Icon, key }) => (\n              <Card key={key} className=\"hover-elevate\" data-testid={`card-feature-${key}`}>\n                <CardHeader>\n                  <div className=\"h-12 w-12 rounded-md bg-primary/10 flex items-center justify-center mb-4\">\n                    <Icon className=\"h-6 w-6 text-primary\" />\n                  </div>\n                  <CardTitle>{t(`landing.features.${key}.title`)}</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <p className=\"text-muted-foreground\">\n                    {t(`landing.features.${key}.description`)}\n                  </p>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      <section id=\"pricing\" className=\"py-20 md:py-32\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"text-center mb-16\">\n            <h2 className=\"text-3xl md:text-4xl font-bold mb-4\">\n              {t(\"landing.pricing.title\")}\n            </h2>\n            <p className=\"text-lg text-muted-foreground mb-8\">\n              {t(\"landing.pricing.subtitle\")}\n            </p>\n            <div className=\"inline-flex items-center gap-2 p-1 bg-muted rounded-md\">\n              <Button\n                variant={billingPeriod === \"monthly\" ? \"default\" : \"ghost\"}\n                size=\"sm\"\n                onClick={() => setBillingPeriod(\"monthly\")}\n                data-testid=\"button-billing-monthly\"\n              >\n                {t(\"landing.pricing.monthly\")}\n              </Button>\n              <Button\n                variant={billingPeriod === \"yearly\" ? \"default\" : \"ghost\"}\n                size=\"sm\"\n                onClick={() => setBillingPeriod(\"yearly\")}\n                data-testid=\"button-billing-yearly\"\n              >\n                {t(\"landing.pricing.yearly\")}\n              </Button>\n            </div>\n          </div>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 max-w-5xl mx-auto\">\n            {plans.map((plan) => (\n              <Card\n                key={plan.key}\n                className={plan.featured ? \"border-primary relative\" : \"\"}\n                data-testid={`card-plan-${plan.key}`}\n              >\n                {plan.featured && (\n                  <Badge className=\"absolute -top-3 left-1/2 -translate-x-1/2\">\n                    {t(\"landing.pricing.professional.popular\")}\n                  </Badge>\n                )}\n                <CardHeader className=\"text-center\">\n                  <CardTitle>{t(`landing.pricing.${plan.key}.name`)}</CardTitle>\n                  <CardDescription>{t(`landing.pricing.${plan.key}.description`)}</CardDescription>\n                  <div className=\"mt-4\">\n                    <span className=\"text-4xl font-bold\">${plan.price}</span>\n                    <span className=\"text-muted-foreground\">{t(\"landing.pricing.perMonth\")}</span>\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <ul className=\"space-y-3 mb-6\">\n                    {(t(`landing.pricing.${plan.key}.features`, { returnObjects: true }) as string[]).map(\n                      (feature, i) => (\n                        <li key={i} className=\"flex items-center gap-2\">\n                          <Check className=\"h-4 w-4 text-primary flex-shrink-0\" />\n                          <span className=\"text-sm\">{feature}</span>\n                        </li>\n                      )\n                    )}\n                  </ul>\n                  <Link href=\"/login\">\n                    <Button\n                      className=\"w-full\"\n                      variant={plan.featured ? \"default\" : \"outline\"}\n                      data-testid={`button-plan-${plan.key}`}\n                    >\n                      {t(`landing.pricing.${plan.cta}`)}\n                    </Button>\n                  </Link>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      <section id=\"faq\" className=\"py-20 md:py-32 bg-muted/30\">\n        <div className=\"container mx-auto px-4 max-w-3xl\">\n          <h2 className=\"text-3xl md:text-4xl font-bold text-center mb-12\">\n            {t(\"landing.faq.title\")}\n          </h2>\n          <Accordion type=\"single\" collapsible className=\"w-full\">\n            {[1, 2, 3, 4].map((num) => (\n              <AccordionItem key={num} value={`item-${num}`}>\n                <AccordionTrigger data-testid={`faq-trigger-${num}`}>\n                  {t(`landing.faq.q${num}`)}\n                </AccordionTrigger>\n                <AccordionContent>{t(`landing.faq.a${num}`)}</AccordionContent>\n              </AccordionItem>\n            ))}\n          </Accordion>\n        </div>\n      </section>\n\n      <section className=\"py-20 md:py-32 bg-primary text-primary-foreground\">\n        <div className=\"container mx-auto px-4 text-center\">\n          <h2 className=\"text-3xl md:text-4xl font-bold mb-4\">\n            {t(\"landing.cta.title\")}\n          </h2>\n          <p className=\"text-lg opacity-90 mb-8 max-w-2xl mx-auto\">\n            {t(\"landing.cta.subtitle\")}\n          </p>\n          <Link href=\"/login\">\n            <Button\n              size=\"lg\"\n              variant=\"secondary\"\n              data-testid=\"button-cta-final\"\n            >\n              {t(\"landing.cta.button\")}\n            </Button>\n          </Link>\n        </div>\n      </section>\n\n      <footer className=\"border-t py-12\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-8 mb-8\">\n            <div>\n              <h4 className=\"font-semibold mb-4\">{t(\"landing.footer.product\")}</h4>\n              <ul className=\"space-y-2 text-sm text-muted-foreground\">\n                <li><a href=\"#features\" className=\"hover:text-foreground\">{t(\"landing.footer.features\")}</a></li>\n                <li><a href=\"#pricing\" className=\"hover:text-foreground\">{t(\"landing.footer.pricing\")}</a></li>\n              </ul>\n            </div>\n            <div>\n              <h4 className=\"font-semibold mb-4\">{t(\"landing.footer.company\")}</h4>\n              <ul className=\"space-y-2 text-sm text-muted-foreground\">\n                <li><a href=\"#\" className=\"hover:text-foreground\">{t(\"landing.footer.about\")}</a></li>\n                <li><a href=\"#\" className=\"hover:text-foreground\">{t(\"landing.footer.blog\")}</a></li>\n              </ul>\n            </div>\n            <div>\n              <h4 className=\"font-semibold mb-4\">{t(\"landing.footer.resources\")}</h4>\n              <ul className=\"space-y-2 text-sm text-muted-foreground\">\n                <li><a href=\"#\" className=\"hover:text-foreground\">{t(\"landing.footer.help\")}</a></li>\n                <li><a href=\"#\" className=\"hover:text-foreground\">{t(\"landing.footer.api\")}</a></li>\n              </ul>\n            </div>\n            <div>\n              <h4 className=\"font-semibold mb-4\">{t(\"landing.footer.contact\")}</h4>\n              <ul className=\"space-y-2 text-sm text-muted-foreground\">\n                <li><a href=\"#\" className=\"hover:text-foreground\">{t(\"landing.footer.privacy\")}</a></li>\n                <li><a href=\"#\" className=\"hover:text-foreground\">{t(\"landing.footer.terms\")}</a></li>\n              </ul>\n            </div>\n          </div>\n          <div className=\"flex flex-col md:flex-row items-center justify-between gap-4 pt-8 border-t\">\n            <div className=\"flex items-center gap-2\">\n              <HardHat className=\"h-6 w-6 text-primary\" />\n              <span className=\"font-semibold\">ConstructTrack</span>\n            </div>\n            <p className=\"text-sm text-muted-foreground\">\n              {t(\"landing.footer.copyright\")}\n            </p>\n          </div>\n        </div>\n      </footer>\n    </div>\n  );\n}\n","path":null,"size_bytes":13347,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"design_guidelines.md":{"content":"# Design Guidelines: Construction Management System\n\n## Design Approach\n\n**Reference-Based Hybrid**: Drawing inspiration from Linear (clean dashboard aesthetics), Notion (information hierarchy), and Stripe (professional restraint) while maintaining construction industry authenticity. The system balances professionalism for client-facing portals with practical utility for field workers.\n\n## Typography System\n\n**Font Stack**: \n- Primary: Inter (via Google Fonts CDN) - for UI, dashboards, data-heavy screens\n- Secondary: Outfit (via Google Fonts CDN) - for marketing site, headings, brand elements\n\n**Hierarchy**:\n- H1: text-5xl font-bold (marketing heroes), text-4xl font-bold (app headers)\n- H2: text-3xl font-semibold (section headers)\n- H3: text-2xl font-semibold (card headers, panel titles)\n- H4: text-xl font-medium (subsections)\n- Body Large: text-lg (landing page copy, important descriptions)\n- Body: text-base (standard UI text, forms, tables)\n- Small: text-sm (metadata, timestamps, helper text)\n- Tiny: text-xs (labels, badges, fine print)\n\n## Layout & Spacing System\n\n**Tailwind Primitives**: Use spacing units of 2, 4, 8, 12, 16, 20, 24 for consistency\n- Micro spacing (inline elements): space-x-2, gap-2\n- Component padding: p-4, p-6, p-8\n- Section spacing: py-12 (mobile), py-20 (tablet), py-32 (desktop)\n- Container widths: max-w-7xl (dashboards), max-w-6xl (content), max-w-prose (text)\n\n**Grid Systems**:\n- Dashboard layouts: 12-column grid with lg:grid-cols-12\n- Card grids: grid-cols-1 md:grid-cols-2 lg:grid-cols-3\n- Data tables: Full-width with horizontal scroll on mobile\n\n## Component Library\n\n### Corporate Marketing Site\n\n**Hero Section**: \n- Full viewport height (min-h-screen) with large construction site hero image\n- Centered content overlay with backdrop-blur on CTA container\n- H1 + subtitle + dual CTA (primary + secondary)\n- Trust indicators below CTAs: \"Trusted by 500+ construction companies\" with small company logos\n\n**Features Grid**:\n- 3-column layout (grid-cols-1 md:grid-cols-3)\n- Each feature card: icon (top), title (H3), description, \"Learn more\" link\n- Alternating visual sections with screenshot mockups and feature lists\n\n**Pricing Plans** (3 tiers):\n- Cards with: plan name, price (large text-4xl), billing period, feature list with checkmarks, CTA button\n- Middle tier highlighted with border emphasis and \"Most Popular\" badge\n- Annual/monthly toggle above cards\n\n**Footer**: \n- 4-column grid: Product links, Company info, Resources, Contact\n- Newsletter signup form (email + submit)\n- Social media icons, language selector dropdown\n- Company address and phone at bottom\n\n### Worker Mobile App (PWA)\n\n**Time Tracking Interface**:\n- Large status card at top showing current state: \"Not Clocked In\" / \"Working\" with duration timer\n- Prominent CTA button (full-width on mobile): \"Clock In\" / \"Clock Out\"\n- Recent activity timeline below with timestamps, locations, and thumbnail photos\n- Bottom navigation: Home, Hours, Tools, Profile\n\n**Clock In/Out Flow**:\n- Full-screen camera view for selfie capture\n- GPS indicator showing location accuracy\n- Site selection dropdown (if multiple sites)\n- Confirmation screen showing: photo preview, location on map snippet, timestamp, site name\n\n**Hours Summary**:\n- Calendar view with color-coded days\n- Weekly total card with breakdown: regular hours, overtime, breaks\n- Expandable daily entries showing detailed check-in/out with photos and GPS\n\n### Client Portal\n\n**Dashboard Overview**:\n- KPI cards in grid: Total Hours This Month, Active Workers, Pending Validations, Total Cost\n- Site selector dropdown in header\n- Recent activity feed with validation status indicators\n\n**Hour Validation Interface**:\n- Table layout with columns: Date, Worker, Check-In, Check-Out, Total Hours, Evidence, Actions\n- Expandable rows showing: GPS map, check-in/out photos, location accuracy\n- Bulk action controls: \"Approve Selected\" / \"Contest Selected\"\n- Filter/search bar above table\n\n**Contestation Modal**:\n- Side panel or centered modal\n- Shows full evidence: photos, map, timestamps\n- Textarea for contestation reason\n- Severity selector: Minor discrepancy / Significant issue\n- Submit/Cancel buttons\n\n### Manager Dashboard\n\n**Main Dashboard**:\n- Sidebar navigation (collapsible on mobile): Dashboard, Workers, Sites, Tools, Reports, Settings\n- Top bar: Company logo/name, site switcher, notifications bell, profile dropdown\n- Widget-based layout: Attendance Today, Pending Approvals, Tool Status, Recent Alerts\n\n**Worker Management**:\n- Data table with search/filter controls\n- Columns: Photo, Name, Role, Current Site, Status, Hours This Week, Actions\n- Quick actions dropdown per row: View Details, Edit, Manage Access\n- \"Add Worker\" CTA button (top right)\n\n**Approval Queue**:\n- Card-based layout for pending items\n- Each card shows: worker photo, timestamp, location snippet, reason (if late/early)\n- Evidence thumbnails (click to expand)\n- Approve/Reject/Request Info buttons\n- Filter tabs: All, Late Arrivals, Early Departures, Contestations, Anomalies\n\n### Tool Management\n\n**Tool Inventory**:\n- Grid of tool cards with photos, QR code thumbnail, status badge, assigned worker (if checked out)\n- Filtering: All, Available, In Use, Maintenance, Lost/Stolen\n- \"Add Tool\" and \"Generate QR Codes\" CTAs\n\n**Check-Out Interface** (Mobile):\n- QR code scanner (full camera view)\n- After scan: Tool details card, worker confirmation, site assignment, submit\n\n**Tool History Modal**:\n- Timeline view of all transactions: check-outs, returns, incidents\n- Each entry: timestamp, worker, site, photos (if incident), status change\n\n## Images & Visual Assets\n\n**Hero Image**: Large, high-quality construction site photo showing active work, modern equipment, workers collaborating. Full viewport width, positioned with object-cover.\n\n**Marketing Sections**: \n- Feature sections alternate between left/right image placements\n- Use authentic construction imagery: workers using tablets/phones on site, safety equipment, machinery, building progress\n- Screenshots of app interfaces in device mockups (phones, tablets)\n\n**Dashboard Backgrounds**: \n- Subtle texture overlays (concrete, blueprint patterns) at very low opacity for branded sections\n- Avoid busy backgrounds in data-heavy areas\n\n**Icons**: Heroicons via CDN for UI elements, construction-specific icons for features (hard hat, tools, clock, location pin, camera)\n\n**Worker/Company Photos**: Circular avatars (rounded-full), 40x40px (small), 64x64px (medium), 128x128px (large)\n\n## Multi-Language & Localization\n\n**Language Selector**: \n- Dropdown in top navigation (both marketing and app)\n- Flag icons + language codes: EN, PT, NL, FR\n- Persists selection in localStorage\n\n**Text Layout Considerations**:\n- Allow flexible widths for labels (some languages 30% longer)\n- Avoid fixed-width containers for text content\n- Use min-width instead of width for buttons with text\n\n**Date/Time Formatting**: \n- Display using locale-appropriate formats\n- Show timezone clearly for time tracking features\n\n## Mobile-First PWA Considerations\n\n**Touch Targets**: Minimum 44x44px for all interactive elements, 56x56px for primary CTAs\n\n**Bottom Navigation**: Fixed position, 4-5 primary actions, icons + labels\n\n**Forms**: \n- Full-width inputs on mobile (w-full)\n- Adequate spacing between fields (space-y-4)\n- Large submit buttons (h-12 minimum)\n- Inline validation with clear error messages below fields\n\n**Camera Integration**: Full-screen camera view with minimal UI overlay for selfie capture\n\n**Offline Indicator**: Persistent banner at top when offline, showing sync status\n\n## Responsive Breakpoints\n\n- Mobile: base (< 768px) - single column, stacked navigation\n- Tablet: md (768px+) - 2 columns where appropriate, collapsible sidebar\n- Desktop: lg (1024px+) - full multi-column layouts, persistent sidebar\n- Wide: xl (1280px+) - max content width with centered containers","path":null,"size_bytes":7902,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\nif ('serviceWorker' in navigator) {\n  window.addEventListener('load', () => {\n    navigator.serviceWorker.register('/sw.js')\n      .then((registration) => {\n        console.log('SW registered:', registration.scope);\n      })\n      .catch((error) => {\n        console.log('SW registration failed:', error);\n      });\n  });\n}\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":482,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { SidebarProvider, SidebarTrigger } from \"@/components/ui/sidebar\";\nimport { ThemeProvider } from \"@/components/ThemeProvider\";\nimport { ThemeToggle } from \"@/components/ThemeToggle\";\nimport { LanguageSelector } from \"@/components/LanguageSelector\";\nimport { NotificationBell } from \"@/components/NotificationBell\";\nimport { AppSidebar } from \"@/components/AppSidebar\";\nimport { ImpersonationBanner } from \"@/components/ImpersonationBanner\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { PWAInstallPrompt } from \"@/components/PWAInstallPrompt\";\nimport NotFound from \"@/pages/not-found\";\nimport Landing from \"@/pages/Landing\";\nimport Login from \"@/pages/Login\";\nimport Dashboard from \"@/pages/Dashboard\";\nimport TimeTracking from \"@/pages/TimeTracking\";\nimport Tools from \"@/pages/Tools\";\nimport Leave from \"@/pages/Leave\";\nimport Payroll from \"@/pages/Payroll\";\nimport Sites from \"@/pages/Sites\";\nimport Employees from \"@/pages/Employees\";\nimport ClientPortal from \"@/pages/ClientPortal\";\nimport Settings from \"@/pages/Settings\";\nimport Analytics from \"@/pages/Analytics\";\nimport Documents from \"@/pages/Documents\";\nimport Chat from \"@/pages/Chat\";\nimport UserManagement from \"@/pages/admin/UserManagement\";\nimport SiteManagement from \"@/pages/admin/SiteManagement\";\nimport ClientManagement from \"@/pages/admin/ClientManagement\";\nimport ToolManagement from \"@/pages/admin/ToolManagement\";\nimport TimesheetApprovals from \"@/pages/admin/TimesheetApprovals\";\nimport LeaveApprovals from \"@/pages/admin/LeaveApprovals\";\nimport ServiceOrders from \"@/pages/admin/ServiceOrders\";\nimport CompanySettings from \"@/pages/admin/CompanySettings\";\nimport Subscriptions from \"@/pages/superadmin/Subscriptions\";\nimport TenantManagement from \"@/pages/superadmin/TenantManagement\";\nimport \"@/lib/i18n\";\n\nfunction AuthenticatedApp() {\n  const style = {\n    \"--sidebar-width\": \"16rem\",\n    \"--sidebar-width-icon\": \"3rem\",\n  };\n\n  return (\n    <SidebarProvider style={style as React.CSSProperties}>\n      <div className=\"flex h-screen w-full\">\n        <AppSidebar />\n        <div className=\"flex flex-col flex-1 overflow-hidden\">\n          <div className=\"sticky top-0 z-50\">\n            <ImpersonationBanner />\n            <header className=\"flex items-center justify-between gap-2 p-2 border-b bg-background\">\n              <SidebarTrigger data-testid=\"button-sidebar-toggle\" />\n              <div className=\"flex items-center gap-2 flex-wrap\">\n                <NotificationBell />\n                <LanguageSelector />\n                <ThemeToggle />\n              </div>\n            </header>\n          </div>\n          <main className=\"flex-1 overflow-auto\">\n            <Switch>\n              <Route path=\"/dashboard\" component={Dashboard} />\n              <Route path=\"/time-tracking\" component={TimeTracking} />\n              <Route path=\"/tools\" component={Tools} />\n              <Route path=\"/leave\" component={Leave} />\n              <Route path=\"/payroll\" component={Payroll} />\n              <Route path=\"/sites\" component={Sites} />\n              <Route path=\"/employees\" component={Employees} />\n              <Route path=\"/client-portal\" component={ClientPortal} />\n              <Route path=\"/analytics\" component={Analytics} />\n              <Route path=\"/documents\" component={Documents} />\n              <Route path=\"/chat\" component={Chat} />\n              <Route path=\"/settings\" component={Settings} />\n              <Route path=\"/admin/users\" component={UserManagement} />\n              <Route path=\"/admin/sites\" component={SiteManagement} />\n              <Route path=\"/admin/clients\" component={ClientManagement} />\n              <Route path=\"/admin/tools\" component={ToolManagement} />\n              <Route path=\"/admin/timesheets\" component={TimesheetApprovals} />\n              <Route path=\"/admin/leave\" component={LeaveApprovals} />\n              <Route path=\"/admin/service-orders\" component={ServiceOrders} />\n              <Route path=\"/admin/company\" component={CompanySettings} />\n              <Route path=\"/superadmin/subscriptions\" component={Subscriptions} />\n              <Route path=\"/superadmin/tenants\" component={TenantManagement} />\n              <Route component={Dashboard} />\n            </Switch>\n          </main>\n        </div>\n      </div>\n    </SidebarProvider>\n  );\n}\n\nfunction Router() {\n  const { user, isLoading } = useAuth();\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-screen\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <Switch>\n      <Route path=\"/\">\n        {user ? <AuthenticatedApp /> : <Landing />}\n      </Route>\n      <Route path=\"/login\">\n        {user ? <AuthenticatedApp /> : <Login />}\n      </Route>\n      <Route path=\"/dashboard\">{user ? <AuthenticatedApp /> : <Landing />}</Route>\n      <Route path=\"/time-tracking\">{user ? <AuthenticatedApp /> : <Landing />}</Route>\n      <Route path=\"/tools\">{user ? <AuthenticatedApp /> : <Landing />}</Route>\n      <Route path=\"/leave\">{user ? <AuthenticatedApp /> : <Landing />}</Route>\n      <Route path=\"/payroll\">{user ? <AuthenticatedApp /> : <Landing />}</Route>\n      <Route path=\"/sites\">{user ? <AuthenticatedApp /> : <Landing />}</Route>\n      <Route path=\"/employees\">{user ? <AuthenticatedApp /> : <Landing />}</Route>\n      <Route path=\"/client-portal\">{user ? <AuthenticatedApp /> : <Landing />}</Route>\n      <Route path=\"/analytics\">{user ? <AuthenticatedApp /> : <Landing />}</Route>\n      <Route path=\"/documents\">{user ? <AuthenticatedApp /> : <Landing />}</Route>\n      <Route path=\"/settings\">{user ? <AuthenticatedApp /> : <Landing />}</Route>\n      <Route path=\"/admin/users\">{user ? <AuthenticatedApp /> : <Landing />}</Route>\n      <Route path=\"/admin/sites\">{user ? <AuthenticatedApp /> : <Landing />}</Route>\n      <Route path=\"/admin/clients\">{user ? <AuthenticatedApp /> : <Landing />}</Route>\n      <Route path=\"/admin/tools\">{user ? <AuthenticatedApp /> : <Landing />}</Route>\n      <Route path=\"/admin/timesheets\">{user ? <AuthenticatedApp /> : <Landing />}</Route>\n      <Route path=\"/admin/leave\">{user ? <AuthenticatedApp /> : <Landing />}</Route>\n      <Route path=\"/admin/service-orders\">{user ? <AuthenticatedApp /> : <Landing />}</Route>\n      <Route path=\"/admin/company\">{user ? <AuthenticatedApp /> : <Landing />}</Route>\n      <Route path=\"/superadmin/subscriptions\">{user ? <AuthenticatedApp /> : <Landing />}</Route>\n      <Route path=\"/superadmin/tenants\">{user ? <AuthenticatedApp /> : <Landing />}</Route>\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <ThemeProvider>\n      <QueryClientProvider client={queryClient}>\n        <TooltipProvider>\n          <Router />\n          <Toaster />\n          <PWAInstallPrompt />\n        </TooltipProvider>\n      </QueryClientProvider>\n    </ThemeProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":7216,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/pages/ClientPortal.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Clock,\n  DollarSign,\n  AlertCircle,\n  Check,\n  X,\n  Eye,\n  Building2,\n  MapPin,\n  Camera,\n} from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport type { TimeRecord, Site } from \"@shared/schema\";\n\ninterface TimeRecordWithDetails extends TimeRecord {\n  user?: { firstName: string; lastName: string };\n  site?: { name: string };\n}\n\nexport default function ClientPortal() {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const [selectedSite, setSelectedSite] = useState<string>(\"all\");\n  const [showContestDialog, setShowContestDialog] = useState(false);\n  const [showEvidenceDialog, setShowEvidenceDialog] = useState(false);\n  const [selectedRecord, setSelectedRecord] = useState<TimeRecordWithDetails | null>(null);\n  const [contestReason, setContestReason] = useState(\"\");\n  const [contestSeverity, setContestSeverity] = useState(\"minor\");\n\n  const { data: mySites } = useQuery<Site[]>({\n    queryKey: [\"/api/client/sites\"],\n  });\n\n  const { data: timeRecords, isLoading } = useQuery<TimeRecordWithDetails[]>({\n    queryKey: [\"/api/client/time-records\", selectedSite],\n  });\n\n  const { data: stats } = useQuery<{\n    hoursThisMonth: number;\n    pendingValidation: number;\n    totalCost: number;\n  }>({\n    queryKey: [\"/api/client/stats\"],\n  });\n\n  const validateMutation = useMutation({\n    mutationFn: async (recordId: string) => {\n      return apiRequest(\"POST\", `/api/client/time-records/${recordId}/validate`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/client/time-records\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/client/stats\"] });\n      toast({ title: t(\"common.approved\"), description: \"Hours validated\" });\n    },\n  });\n\n  const contestMutation = useMutation({\n    mutationFn: async (data: { recordId: string; reason: string; severity: string }) => {\n      return apiRequest(\"POST\", `/api/client/time-records/${data.recordId}/contest`, {\n        reason: data.reason,\n        severity: data.severity,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/client/time-records\"] });\n      toast({ title: t(\"client.contest\"), description: \"Contestation submitted\" });\n      setShowContestDialog(false);\n      setContestReason(\"\");\n    },\n  });\n\n  const validateAllMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest(\"POST\", \"/api/client/time-records/validate-all\", {\n        siteId: selectedSite === \"all\" ? undefined : selectedSite,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/client/time-records\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/client/stats\"] });\n      toast({ title: t(\"client.approveAll\"), description: \"All pending hours validated\" });\n    },\n  });\n\n  const pendingRecords = timeRecords?.filter((r) => !r.clientValidated);\n\n  const getStatusBadge = (record: TimeRecordWithDetails) => {\n    if (record.status === \"contested\") {\n      return <Badge variant=\"destructive\">{t(\"client.contest\")}</Badge>;\n    }\n    if (record.clientValidated) {\n      return <Badge variant=\"default\">{t(\"common.approved\")}</Badge>;\n    }\n    return <Badge variant=\"secondary\">{t(\"common.pending\")}</Badge>;\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <h1 className=\"text-2xl font-bold\">{t(\"client.myProjects\")}</h1>\n        <Select value={selectedSite} onValueChange={setSelectedSite}>\n          <SelectTrigger className=\"w-48\" data-testid=\"select-client-site\">\n            <SelectValue placeholder=\"All Sites\" />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"all\">All Sites</SelectItem>\n            {mySites?.map((site) => (\n              <SelectItem key={site.id} value={site.id}>\n                {site.name}\n              </SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n              <Clock className=\"h-4 w-4\" />\n              {t(\"client.hoursThisMonth\")}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <Skeleton className=\"h-8 w-24\" />\n            ) : (\n              <div className=\"text-2xl font-bold\" data-testid=\"text-hours-this-month\">\n                {stats?.hoursThisMonth?.toFixed(1) ?? 0}h\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n              <AlertCircle className=\"h-4 w-4\" />\n              {t(\"client.pendingValidation\")}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <Skeleton className=\"h-8 w-24\" />\n            ) : (\n              <div className=\"text-2xl font-bold\" data-testid=\"text-pending-validation\">\n                {stats?.pendingValidation ?? 0}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n              <DollarSign className=\"h-4 w-4\" />\n              {t(\"client.totalCost\")}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <Skeleton className=\"h-8 w-24\" />\n            ) : (\n              <div className=\"text-2xl font-bold\" data-testid=\"text-total-cost\">\n                ${stats?.totalCost?.toFixed(2) ?? 0}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader className=\"flex flex-row items-center justify-between gap-4\">\n          <div>\n            <CardTitle>{t(\"client.validateHours\")}</CardTitle>\n            <CardDescription>\n              {pendingRecords?.length ?? 0} records pending validation\n            </CardDescription>\n          </div>\n          {(pendingRecords?.length ?? 0) > 0 && (\n            <Button\n              onClick={() => validateAllMutation.mutate()}\n              disabled={validateAllMutation.isPending}\n              data-testid=\"button-approve-all\"\n            >\n              <Check className=\"mr-2 h-4 w-4\" />\n              {t(\"client.approveAll\")}\n            </Button>\n          )}\n        </CardHeader>\n        <CardContent className=\"p-0\">\n          <div className=\"overflow-x-auto\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>{t(\"common.date\")}</TableHead>\n                  <TableHead>Worker</TableHead>\n                  <TableHead>Site</TableHead>\n                  <TableHead>{t(\"time.clockIn\")}</TableHead>\n                  <TableHead>{t(\"time.clockOut\")}</TableHead>\n                  <TableHead className=\"text-right\">{t(\"common.total\")}</TableHead>\n                  <TableHead>Evidence</TableHead>\n                  <TableHead>{t(\"common.status\")}</TableHead>\n                  <TableHead className=\"text-right\">{t(\"common.actions\")}</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {isLoading ? (\n                  Array.from({ length: 5 }).map((_, i) => (\n                    <TableRow key={i}>\n                      {Array.from({ length: 9 }).map((_, j) => (\n                        <TableCell key={j}>\n                          <Skeleton className=\"h-4 w-16\" />\n                        </TableCell>\n                      ))}\n                    </TableRow>\n                  ))\n                ) : timeRecords?.length === 0 ? (\n                  <TableRow>\n                    <TableCell colSpan={9} className=\"text-center py-8 text-muted-foreground\">\n                      No time records found\n                    </TableCell>\n                  </TableRow>\n                ) : (\n                  timeRecords?.map((record) => (\n                    <TableRow key={record.id} data-testid={`time-record-row-${record.id}`}>\n                      <TableCell>\n                        {format(new Date(record.checkInTime), \"MMM d, yyyy\")}\n                      </TableCell>\n                      <TableCell>\n                        {record.user?.firstName} {record.user?.lastName}\n                      </TableCell>\n                      <TableCell>{record.site?.name}</TableCell>\n                      <TableCell>\n                        {format(new Date(record.checkInTime), \"HH:mm\")}\n                      </TableCell>\n                      <TableCell>\n                        {record.checkOutTime\n                          ? format(new Date(record.checkOutTime), \"HH:mm\")\n                          : \"-\"}\n                      </TableCell>\n                      <TableCell className=\"text-right font-medium\">\n                        {record.totalHours}h\n                      </TableCell>\n                      <TableCell>\n                        <Button\n                          size=\"sm\"\n                          variant=\"ghost\"\n                          onClick={() => {\n                            setSelectedRecord(record);\n                            setShowEvidenceDialog(true);\n                          }}\n                          data-testid={`button-view-evidence-${record.id}`}\n                        >\n                          <Eye className=\"h-4 w-4\" />\n                        </Button>\n                      </TableCell>\n                      <TableCell>{getStatusBadge(record)}</TableCell>\n                      <TableCell className=\"text-right\">\n                        {!record.clientValidated && record.status !== \"contested\" && (\n                          <div className=\"flex justify-end gap-1\">\n                            <Button\n                              size=\"sm\"\n                              onClick={() => validateMutation.mutate(record.id)}\n                              disabled={validateMutation.isPending}\n                              data-testid={`button-validate-${record.id}`}\n                            >\n                              <Check className=\"h-4 w-4\" />\n                            </Button>\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              onClick={() => {\n                                setSelectedRecord(record);\n                                setShowContestDialog(true);\n                              }}\n                              data-testid={`button-contest-${record.id}`}\n                            >\n                              <X className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n                        )}\n                      </TableCell>\n                    </TableRow>\n                  ))\n                )}\n              </TableBody>\n            </Table>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Dialog open={showEvidenceDialog} onOpenChange={setShowEvidenceDialog}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>{t(\"client.viewEvidence\")}</DialogTitle>\n          </DialogHeader>\n          {selectedRecord && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm\">{t(\"time.clockIn\")}</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-2\">\n                      <p className=\"text-lg font-semibold\">\n                        {format(new Date(selectedRecord.checkInTime), \"HH:mm\")}\n                      </p>\n                      {selectedRecord.checkInPhoto ? (\n                        <img\n                          src={selectedRecord.checkInPhoto}\n                          alt=\"Check-in photo\"\n                          className=\"w-full aspect-square object-cover rounded-md\"\n                        />\n                      ) : (\n                        <div className=\"w-full aspect-square bg-muted rounded-md flex items-center justify-center\">\n                          <Camera className=\"h-8 w-8 text-muted-foreground\" />\n                        </div>\n                      )}\n                      <div className=\"flex items-center gap-1 text-sm text-muted-foreground\">\n                        <MapPin className=\"h-3 w-3\" />\n                        {selectedRecord.isWithinGeofence ? (\n                          <span className=\"text-green-600\">{t(\"time.withinGeofence\")}</span>\n                        ) : (\n                          <span className=\"text-red-600\">{t(\"time.outsideGeofence\")}</span>\n                        )}\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm\">{t(\"time.clockOut\")}</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-2\">\n                      <p className=\"text-lg font-semibold\">\n                        {selectedRecord.checkOutTime\n                          ? format(new Date(selectedRecord.checkOutTime), \"HH:mm\")\n                          : \"In Progress\"}\n                      </p>\n                      {selectedRecord.checkOutPhoto ? (\n                        <img\n                          src={selectedRecord.checkOutPhoto}\n                          alt=\"Check-out photo\"\n                          className=\"w-full aspect-square object-cover rounded-md\"\n                        />\n                      ) : (\n                        <div className=\"w-full aspect-square bg-muted rounded-md flex items-center justify-center\">\n                          <Camera className=\"h-8 w-8 text-muted-foreground\" />\n                        </div>\n                      )}\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n\n              <div className=\"flex items-center justify-between p-4 bg-muted rounded-md\">\n                <span className=\"font-medium\">{t(\"time.hoursWorked\")}</span>\n                <span className=\"text-xl font-bold\">{selectedRecord.totalHours}h</span>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={showContestDialog} onOpenChange={setShowContestDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>{t(\"client.contest\")}</DialogTitle>\n            <DialogDescription>\n              {t(\"client.contestReason\")}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Severity</label>\n              <Select value={contestSeverity} onValueChange={setContestSeverity}>\n                <SelectTrigger data-testid=\"select-contest-severity\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"minor\">Minor discrepancy</SelectItem>\n                  <SelectItem value=\"significant\">Significant issue</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">{t(\"leave.reason\")}</label>\n              <Textarea\n                value={contestReason}\n                onChange={(e) => setContestReason(e.target.value)}\n                placeholder={t(\"client.contestReason\")}\n                rows={4}\n                data-testid=\"input-contest-reason\"\n              />\n            </div>\n\n            <div className=\"flex justify-end gap-2\">\n              <Button variant=\"outline\" onClick={() => setShowContestDialog(false)}>\n                {t(\"common.cancel\")}\n              </Button>\n              <Button\n                variant=\"destructive\"\n                onClick={() => {\n                  if (selectedRecord) {\n                    contestMutation.mutate({\n                      recordId: selectedRecord.id,\n                      reason: contestReason,\n                      severity: contestSeverity,\n                    });\n                  }\n                }}\n                disabled={!contestReason || contestMutation.isPending}\n                data-testid=\"button-submit-contest\"\n              >\n                {t(\"common.submit\")}\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":17966,"size_tokens":null},"server/replitAuth.ts":{"content":"// Replit Auth integration - javascript_log_in_with_replit blueprint\nimport * as client from \"openid-client\";\nimport { Strategy, type VerifyFunction } from \"openid-client/passport\";\n\nimport passport from \"passport\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport memoize from \"memoizee\";\nimport connectPg from \"connect-pg-simple\";\nimport { storage } from \"./storage\";\n\nconst getOidcConfig = memoize(\n  async () => {\n    return await client.discovery(\n      new URL(process.env.ISSUER_URL ?? \"https://replit.com/oidc\"),\n      process.env.REPL_ID!\n    );\n  },\n  { maxAge: 3600 * 1000 }\n);\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  return session({\n    secret: process.env.SESSION_SECRET!,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: true,\n      maxAge: sessionTtl,\n    },\n  });\n}\n\nfunction updateUserSession(\n  user: any,\n  tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers\n) {\n  user.claims = tokens.claims();\n  user.access_token = tokens.access_token;\n  user.refresh_token = tokens.refresh_token;\n  user.expires_at = user.claims?.exp;\n}\n\nasync function upsertUser(claims: any) {\n  await storage.upsertUser({\n    id: claims[\"sub\"],\n    email: claims[\"email\"],\n    firstName: claims[\"first_name\"],\n    lastName: claims[\"last_name\"],\n    profileImageUrl: claims[\"profile_image_url\"],\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  const config = await getOidcConfig();\n\n  const verify: VerifyFunction = async (\n    tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers,\n    verified: passport.AuthenticateCallback\n  ) => {\n    const user = {};\n    updateUserSession(user, tokens);\n    await upsertUser(tokens.claims());\n    verified(null, user);\n  };\n\n  const registeredStrategies = new Set<string>();\n\n  const ensureStrategy = (domain: string) => {\n    const strategyName = `replitauth:${domain}`;\n    if (!registeredStrategies.has(strategyName)) {\n      const strategy = new Strategy(\n        {\n          name: strategyName,\n          config,\n          scope: \"openid email profile offline_access\",\n          callbackURL: `https://${domain}/api/callback`,\n        },\n        verify,\n      );\n      passport.use(strategy);\n      registeredStrategies.add(strategyName);\n    }\n  };\n\n  passport.serializeUser((user: Express.User, cb) => cb(null, user));\n  passport.deserializeUser((user: Express.User, cb) => cb(null, user));\n\n  app.get(\"/api/login\", (req, res, next) => {\n    ensureStrategy(req.hostname);\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      prompt: \"login consent\",\n      scope: [\"openid\", \"email\", \"profile\", \"offline_access\"],\n    })(req, res, next);\n  });\n\n  app.get(\"/api/callback\", (req, res, next) => {\n    ensureStrategy(req.hostname);\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      successReturnToOrRedirect: \"/\",\n      failureRedirect: \"/api/login\",\n    })(req, res, next);\n  });\n\n  app.get(\"/api/logout\", (req, res) => {\n    req.logout(() => {\n      res.redirect(\n        client.buildEndSessionUrl(config, {\n          client_id: process.env.REPL_ID!,\n          post_logout_redirect_uri: `${req.protocol}://${req.hostname}`,\n        }).href\n      );\n    });\n  });\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  const user = req.user as any;\n\n  if (!req.isAuthenticated() || !user?.claims?.sub) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  // Local auth users don't have expires_at - they're always valid while session exists\n  if (user.localAuth) {\n    return next();\n  }\n\n  // OIDC users - check token expiration\n  if (!user.expires_at) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  if (now <= user.expires_at) {\n    return next();\n  }\n\n  const refreshToken = user.refresh_token;\n  if (!refreshToken) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n\n  try {\n    const config = await getOidcConfig();\n    const tokenResponse = await client.refreshTokenGrant(config, refreshToken);\n    updateUserSession(user, tokenResponse);\n    return next();\n  } catch (error) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n};\n","path":null,"size_bytes":4707,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/pages/Sites.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Building2,\n  MapPin,\n  Users,\n  Clock,\n  Plus,\n  Search,\n  Calendar,\n  DollarSign,\n} from \"lucide-react\";\nimport type { Site, Client } from \"@shared/schema\";\n\nexport default function Sites() {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const [search, setSearch] = useState(\"\");\n  const [filter, setFilter] = useState(\"all\");\n  const [showAddDialog, setShowAddDialog] = useState(false);\n  const [formData, setFormData] = useState({\n    name: \"\",\n    address: \"\",\n    clientId: \"\",\n    billingType: \"hourly\",\n    hourlyRate: \"\",\n    workStartTime: \"08:00\",\n    workEndTime: \"17:00\",\n    geofenceRadius: \"100\",\n  });\n\n  const { data: sites, isLoading } = useQuery<Site[]>({\n    queryKey: [\"/api/sites\"],\n  });\n\n  const { data: clients } = useQuery<Client[]>({\n    queryKey: [\"/api/clients\"],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      return apiRequest(\"POST\", \"/api/sites\", {\n        ...data,\n        hourlyRate: data.hourlyRate ? parseFloat(data.hourlyRate) : null,\n        geofenceRadius: parseInt(data.geofenceRadius),\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/sites\"] });\n      toast({ title: t(\"sites.addSite\"), description: \"Site created successfully\" });\n      setShowAddDialog(false);\n      resetForm();\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to create site\", variant: \"destructive\" });\n    },\n  });\n\n  const resetForm = () => {\n    setFormData({\n      name: \"\",\n      address: \"\",\n      clientId: \"\",\n      billingType: \"hourly\",\n      hourlyRate: \"\",\n      workStartTime: \"08:00\",\n      workEndTime: \"17:00\",\n      geofenceRadius: \"100\",\n    });\n  };\n\n  const filteredSites = sites?.filter((site) => {\n    const matchesSearch = site.name.toLowerCase().includes(search.toLowerCase()) ||\n      site.address?.toLowerCase().includes(search.toLowerCase());\n    const matchesFilter = filter === \"all\" || site.status === filter;\n    return matchesSearch && matchesFilter;\n  });\n\n  const getStatusBadge = (status: string) => {\n    const variants: Record<string, \"default\" | \"secondary\" | \"destructive\"> = {\n      active: \"default\",\n      completed: \"secondary\",\n      paused: \"secondary\",\n    };\n    return <Badge variant={variants[status] || \"secondary\"}>{t(`sites.${status}`)}</Badge>;\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <h1 className=\"text-2xl font-bold\">{t(\"nav.sites\")}</h1>\n        <Button onClick={() => setShowAddDialog(true)} data-testid=\"button-add-site\">\n          <Plus className=\"mr-2 h-4 w-4\" />\n          {t(\"sites.addSite\")}\n        </Button>\n      </div>\n\n      <div className=\"flex flex-col sm:flex-row gap-4\">\n        <div className=\"relative flex-1\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder={t(\"common.search\")}\n            value={search}\n            onChange={(e) => setSearch(e.target.value)}\n            className=\"pl-9\"\n            data-testid=\"input-search-sites\"\n          />\n        </div>\n        <Select value={filter} onValueChange={setFilter}>\n          <SelectTrigger className=\"w-full sm:w-40\" data-testid=\"select-filter-sites\">\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"all\">{t(\"common.status\")}: All</SelectItem>\n            <SelectItem value=\"active\">{t(\"sites.active\")}</SelectItem>\n            <SelectItem value=\"completed\">{t(\"sites.completed\")}</SelectItem>\n            <SelectItem value=\"paused\">{t(\"sites.paused\")}</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n\n      {isLoading ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {Array.from({ length: 6 }).map((_, i) => (\n            <Card key={i}>\n              <CardContent className=\"p-6\">\n                <Skeleton className=\"h-6 w-3/4 mb-4\" />\n                <Skeleton className=\"h-4 w-full mb-2\" />\n                <Skeleton className=\"h-4 w-2/3\" />\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : filteredSites?.length === 0 ? (\n        <Card>\n          <CardContent className=\"p-12 text-center\">\n            <Building2 className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\n            <p className=\"text-muted-foreground\">No sites found</p>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {filteredSites?.map((site) => (\n            <Card key={site.id} className=\"hover-elevate\" data-testid={`card-site-${site.id}`}>\n              <CardHeader className=\"pb-2\">\n                <div className=\"flex items-start justify-between gap-2\">\n                  <CardTitle className=\"text-lg\">{site.name}</CardTitle>\n                  {getStatusBadge(site.status || \"active\")}\n                </div>\n                <CardDescription className=\"flex items-center gap-1\">\n                  <MapPin className=\"h-3 w-3\" />\n                  {site.address}\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2 text-sm\">\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-muted-foreground flex items-center gap-1\">\n                      <Clock className=\"h-3 w-3\" />\n                      {t(\"sites.workHours\")}\n                    </span>\n                    <span>{site.workStartTime} - {site.workEndTime}</span>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-muted-foreground flex items-center gap-1\">\n                      <DollarSign className=\"h-3 w-3\" />\n                      {t(\"sites.billingType\")}\n                    </span>\n                    <span>{t(`sites.${site.billingType}`)}</span>\n                  </div>\n                  {site.hourlyRate && (\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"text-muted-foreground\">Rate</span>\n                      <span>${site.hourlyRate}/hr</span>\n                    </div>\n                  )}\n                </div>\n                <div className=\"flex gap-2 mt-4\">\n                  <Button variant=\"outline\" size=\"sm\" className=\"flex-1\" data-testid={`button-view-site-${site.id}`}>\n                    {t(\"common.view\")}\n                  </Button>\n                  <Button variant=\"outline\" size=\"sm\" className=\"flex-1\" data-testid={`button-edit-site-${site.id}`}>\n                    {t(\"common.edit\")}\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n\n      <Dialog open={showAddDialog} onOpenChange={setShowAddDialog}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>{t(\"sites.addSite\")}</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">{t(\"sites.siteName\")}</label>\n              <Input\n                value={formData.name}\n                onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                placeholder={t(\"sites.siteName\")}\n                data-testid=\"input-site-name\"\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">{t(\"sites.address\")}</label>\n              <Textarea\n                value={formData.address}\n                onChange={(e) => setFormData({ ...formData, address: e.target.value })}\n                placeholder={t(\"sites.address\")}\n                data-testid=\"input-site-address\"\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">{t(\"sites.client\")}</label>\n              <Select\n                value={formData.clientId}\n                onValueChange={(value) => setFormData({ ...formData, clientId: value })}\n              >\n                <SelectTrigger data-testid=\"select-site-client\">\n                  <SelectValue placeholder={t(\"sites.client\")} />\n                </SelectTrigger>\n                <SelectContent>\n                  {clients?.map((client) => (\n                    <SelectItem key={client.id} value={client.id}>\n                      {client.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"text-sm font-medium mb-2 block\">{t(\"sites.billingType\")}</label>\n                <Select\n                  value={formData.billingType}\n                  onValueChange={(value) => setFormData({ ...formData, billingType: value })}\n                >\n                  <SelectTrigger data-testid=\"select-billing-type\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"hourly\">{t(\"sites.hourly\")}</SelectItem>\n                    <SelectItem value=\"daily\">{t(\"sites.daily\")}</SelectItem>\n                    <SelectItem value=\"fixed\">{t(\"sites.fixed\")}</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div>\n                <label className=\"text-sm font-medium mb-2 block\">Rate</label>\n                <Input\n                  type=\"number\"\n                  value={formData.hourlyRate}\n                  onChange={(e) => setFormData({ ...formData, hourlyRate: e.target.value })}\n                  placeholder=\"0.00\"\n                  data-testid=\"input-hourly-rate\"\n                />\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"text-sm font-medium mb-2 block\">Start Time</label>\n                <Input\n                  type=\"time\"\n                  value={formData.workStartTime}\n                  onChange={(e) => setFormData({ ...formData, workStartTime: e.target.value })}\n                  data-testid=\"input-start-time\"\n                />\n              </div>\n              <div>\n                <label className=\"text-sm font-medium mb-2 block\">End Time</label>\n                <Input\n                  type=\"time\"\n                  value={formData.workEndTime}\n                  onChange={(e) => setFormData({ ...formData, workEndTime: e.target.value })}\n                  data-testid=\"input-end-time\"\n                />\n              </div>\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Geofence Radius (meters)</label>\n              <Input\n                type=\"number\"\n                value={formData.geofenceRadius}\n                onChange={(e) => setFormData({ ...formData, geofenceRadius: e.target.value })}\n                placeholder=\"100\"\n                data-testid=\"input-geofence-radius\"\n              />\n            </div>\n\n            <div className=\"flex justify-end gap-2\">\n              <Button variant=\"outline\" onClick={() => setShowAddDialog(false)}>\n                {t(\"common.cancel\")}\n              </Button>\n              <Button\n                onClick={() => createMutation.mutate(formData)}\n                disabled={!formData.name || !formData.address || createMutation.isPending}\n                data-testid=\"button-save-site\"\n              >\n                {t(\"common.save\")}\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":12735,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1534,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"client/src/pages/Tools.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  Wrench,\n  QrCode,\n  Search,\n  Plus,\n  Package,\n  AlertTriangle,\n  CheckCircle,\n  XCircle,\n  History,\n} from \"lucide-react\";\nimport type { Tool, Site } from \"@shared/schema\";\n\nexport default function Tools() {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const [search, setSearch] = useState(\"\");\n  const [filter, setFilter] = useState(\"all\");\n  const [showAddDialog, setShowAddDialog] = useState(false);\n  const [showCheckoutDialog, setShowCheckoutDialog] = useState(false);\n  const [selectedTool, setSelectedTool] = useState<Tool | null>(null);\n  const [selectedSite, setSelectedSite] = useState(\"\");\n  const [condition, setCondition] = useState(\"good\");\n  const [notes, setNotes] = useState(\"\");\n\n  const { data: tools, isLoading } = useQuery<Tool[]>({\n    queryKey: [\"/api/tools\"],\n  });\n\n  const { data: sites } = useQuery<Site[]>({\n    queryKey: [\"/api/sites\"],\n  });\n\n  const filteredTools = tools?.filter((tool) => {\n    const matchesSearch = tool.name.toLowerCase().includes(search.toLowerCase()) ||\n      tool.serialNumber?.toLowerCase().includes(search.toLowerCase());\n    const matchesFilter = filter === \"all\" || tool.status === filter;\n    return matchesSearch && matchesFilter;\n  });\n\n  const checkoutMutation = useMutation({\n    mutationFn: async (data: { toolId: string; siteId: string; condition: string; notes?: string }) => {\n      return apiRequest(\"POST\", `/api/tools/${data.toolId}/checkout`, {\n        siteId: data.siteId,\n        condition: data.condition,\n        notes: data.notes,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/tools\"] });\n      toast({ title: t(\"tools.checkout\"), description: \"Tool checked out successfully\" });\n      setShowCheckoutDialog(false);\n      resetCheckoutForm();\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to checkout tool\", variant: \"destructive\" });\n    },\n  });\n\n  const checkinMutation = useMutation({\n    mutationFn: async (data: { toolId: string; siteId: string; condition: string; notes?: string }) => {\n      return apiRequest(\"POST\", `/api/tools/${data.toolId}/checkin`, {\n        siteId: data.siteId,\n        condition: data.condition,\n        notes: data.notes,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/tools\"] });\n      toast({ title: t(\"tools.checkin\"), description: \"Tool returned successfully\" });\n      setShowCheckoutDialog(false);\n      resetCheckoutForm();\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to checkin tool\", variant: \"destructive\" });\n    },\n  });\n\n  const resetCheckoutForm = () => {\n    setSelectedTool(null);\n    setSelectedSite(\"\");\n    setCondition(\"good\");\n    setNotes(\"\");\n  };\n\n  const handleCheckout = (tool: Tool) => {\n    setSelectedTool(tool);\n    setShowCheckoutDialog(true);\n  };\n\n  const handleCheckin = (tool: Tool) => {\n    setSelectedTool(tool);\n    setShowCheckoutDialog(true);\n  };\n\n  const submitCheckout = () => {\n    if (!selectedTool || !selectedSite) {\n      toast({ title: \"Error\", description: \"Please select a site\", variant: \"destructive\" });\n      return;\n    }\n    checkoutMutation.mutate({\n      toolId: selectedTool.id,\n      siteId: selectedSite,\n      condition,\n      notes: notes || undefined,\n    });\n  };\n\n  const submitCheckin = () => {\n    if (!selectedTool) return;\n    const siteId = selectedTool.currentSiteId || selectedSite;\n    if (!siteId) {\n      toast({ title: \"Error\", description: \"Please select a site\", variant: \"destructive\" });\n      return;\n    }\n    checkinMutation.mutate({\n      toolId: selectedTool.id,\n      siteId,\n      condition,\n      notes: notes || undefined,\n    });\n  };\n\n  const getStatusBadge = (status: string) => {\n    const variants: Record<string, { variant: \"default\" | \"secondary\" | \"destructive\"; icon: typeof CheckCircle }> = {\n      available: { variant: \"default\", icon: CheckCircle },\n      in_use: { variant: \"secondary\", icon: Package },\n      maintenance: { variant: \"secondary\", icon: AlertTriangle },\n      lost: { variant: \"destructive\", icon: XCircle },\n      stolen: { variant: \"destructive\", icon: XCircle },\n    };\n    const config = variants[status] || variants.available;\n    return (\n      <Badge variant={config.variant} className=\"gap-1\">\n        <config.icon className=\"h-3 w-3\" />\n        {t(`tools.${status}`)}\n      </Badge>\n    );\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <h1 className=\"text-2xl font-bold\">{t(\"tools.inventory\")}</h1>\n        <div className=\"flex items-center gap-2\">\n          <Button variant=\"outline\" data-testid=\"button-scan-qr\">\n            <QrCode className=\"mr-2 h-4 w-4\" />\n            {t(\"tools.scanQr\")}\n          </Button>\n          <Button onClick={() => setShowAddDialog(true)} data-testid=\"button-add-tool\">\n            <Plus className=\"mr-2 h-4 w-4\" />\n            {t(\"common.add\")}\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"flex flex-col sm:flex-row gap-4\">\n        <div className=\"relative flex-1\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder={t(\"common.search\")}\n            value={search}\n            onChange={(e) => setSearch(e.target.value)}\n            className=\"pl-9\"\n            data-testid=\"input-search-tools\"\n          />\n        </div>\n        <Select value={filter} onValueChange={setFilter}>\n          <SelectTrigger className=\"w-full sm:w-40\" data-testid=\"select-filter-tools\">\n            <SelectValue placeholder={t(\"common.filter\")} />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"all\">{t(\"common.status\")}: All</SelectItem>\n            <SelectItem value=\"available\">{t(\"tools.available\")}</SelectItem>\n            <SelectItem value=\"in_use\">{t(\"tools.inUse\")}</SelectItem>\n            <SelectItem value=\"maintenance\">{t(\"tools.maintenance\")}</SelectItem>\n            <SelectItem value=\"lost\">{t(\"tools.lost\")}</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n\n      <Tabs defaultValue=\"grid\">\n        <TabsList>\n          <TabsTrigger value=\"grid\">Grid</TabsTrigger>\n          <TabsTrigger value=\"list\">List</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"grid\" className=\"mt-4\">\n          {isLoading ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n              {Array.from({ length: 6 }).map((_, i) => (\n                <Card key={i}>\n                  <CardContent className=\"p-4\">\n                    <Skeleton className=\"h-32 w-full mb-4\" />\n                    <Skeleton className=\"h-4 w-3/4 mb-2\" />\n                    <Skeleton className=\"h-4 w-1/2\" />\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n              {filteredTools?.map((tool) => (\n                <Card key={tool.id} className=\"hover-elevate\" data-testid={`card-tool-${tool.id}`}>\n                  <CardContent className=\"p-4\">\n                    <div className=\"aspect-square bg-muted rounded-md mb-4 flex items-center justify-center\">\n                      {tool.photo ? (\n                        <img src={tool.photo} alt={tool.name} className=\"w-full h-full object-cover rounded-md\" />\n                      ) : (\n                        <Wrench className=\"h-16 w-16 text-muted-foreground\" />\n                      )}\n                    </div>\n                    <div className=\"space-y-2\">\n                      <div className=\"flex items-start justify-between gap-2\">\n                        <h3 className=\"font-semibold\">{tool.name}</h3>\n                        {getStatusBadge(tool.status || \"available\")}\n                      </div>\n                      {tool.serialNumber && (\n                        <p className=\"text-sm text-muted-foreground\">SN: {tool.serialNumber}</p>\n                      )}\n                      {tool.category && (\n                        <Badge variant=\"outline\" size=\"sm\">{tool.category}</Badge>\n                      )}\n                      <div className=\"flex gap-2 pt-2\">\n                        {tool.status === \"available\" ? (\n                          <Button\n                            size=\"sm\"\n                            className=\"flex-1\"\n                            onClick={() => handleCheckout(tool)}\n                            disabled={checkoutMutation.isPending}\n                            data-testid={`button-checkout-${tool.id}`}\n                          >\n                            {t(\"tools.checkout\")}\n                          </Button>\n                        ) : tool.status === \"in_use\" ? (\n                          <Button\n                            size=\"sm\"\n                            variant=\"outline\"\n                            className=\"flex-1\"\n                            onClick={() => handleCheckin(tool)}\n                            disabled={checkinMutation.isPending}\n                            data-testid={`button-checkin-${tool.id}`}\n                          >\n                            {t(\"tools.checkin\")}\n                          </Button>\n                        ) : null}\n                        <Button size=\"sm\" variant=\"ghost\" data-testid={`button-history-${tool.id}`}>\n                          <History className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"list\" className=\"mt-4\">\n          <Card>\n            <CardContent className=\"p-0\">\n              <div className=\"overflow-x-auto\">\n                <table className=\"w-full\">\n                  <thead className=\"border-b bg-muted/50\">\n                    <tr>\n                      <th className=\"text-left p-4 font-medium\">Name</th>\n                      <th className=\"text-left p-4 font-medium\">Category</th>\n                      <th className=\"text-left p-4 font-medium\">{t(\"common.status\")}</th>\n                      <th className=\"text-left p-4 font-medium\">{t(\"tools.assignedTo\")}</th>\n                      <th className=\"text-right p-4 font-medium\">{t(\"common.actions\")}</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {filteredTools?.map((tool) => (\n                      <tr key={tool.id} className=\"border-b\">\n                        <td className=\"p-4\">{tool.name}</td>\n                        <td className=\"p-4\">{tool.category || \"-\"}</td>\n                        <td className=\"p-4\">{getStatusBadge(tool.status || \"available\")}</td>\n                        <td className=\"p-4\">{tool.currentUserId || \"-\"}</td>\n                        <td className=\"p-4 text-right\">\n                          <Button size=\"sm\" variant=\"ghost\">\n                            {t(\"common.view\")}\n                          </Button>\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n\n      <Dialog open={showAddDialog} onOpenChange={setShowAddDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>{t(\"common.add\")} Tool</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <Input placeholder=\"Tool Name\" data-testid=\"input-tool-name\" />\n            <Input placeholder=\"Serial Number\" data-testid=\"input-tool-serial\" />\n            <Select>\n              <SelectTrigger data-testid=\"select-tool-category\">\n                <SelectValue placeholder=\"Category\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"power\">Power Tools</SelectItem>\n                <SelectItem value=\"hand\">Hand Tools</SelectItem>\n                <SelectItem value=\"safety\">Safety Equipment</SelectItem>\n                <SelectItem value=\"measuring\">Measuring Tools</SelectItem>\n              </SelectContent>\n            </Select>\n            <div className=\"flex justify-end gap-2\">\n              <Button variant=\"outline\" onClick={() => setShowAddDialog(false)}>\n                {t(\"common.cancel\")}\n              </Button>\n              <Button data-testid=\"button-save-tool\">{t(\"common.save\")}</Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={showCheckoutDialog} onOpenChange={(open) => { if (!open) { setShowCheckoutDialog(false); resetCheckoutForm(); } else { setShowCheckoutDialog(true); } }}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>\n              {selectedTool?.status === \"available\" ? t(\"tools.checkout\") : t(\"tools.checkin\")} - {selectedTool?.name}\n            </DialogTitle>\n            <DialogDescription>\n              {selectedTool?.status === \"available\" \n                ? \"Select a site and confirm the tool condition\" \n                : \"Confirm the tool condition upon return\"}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            {(selectedTool?.status === \"available\" || !selectedTool?.currentSiteId) && (\n              <Select value={selectedSite} onValueChange={setSelectedSite}>\n                <SelectTrigger data-testid=\"select-checkout-site\">\n                  <SelectValue placeholder=\"Select Site\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {sites?.map((site) => (\n                    <SelectItem key={site.id} value={site.id}>{site.name}</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            )}\n            <Select value={condition} onValueChange={setCondition}>\n              <SelectTrigger data-testid=\"select-tool-condition\">\n                <SelectValue placeholder=\"Condition\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"good\">Good</SelectItem>\n                <SelectItem value=\"fair\">Fair</SelectItem>\n                <SelectItem value=\"damaged\">Damaged</SelectItem>\n              </SelectContent>\n            </Select>\n            <Input \n              placeholder=\"Notes (optional)\" \n              value={notes}\n              onChange={(e) => setNotes(e.target.value)}\n              data-testid=\"input-tool-notes\"\n            />\n            <div className=\"flex justify-end gap-2\">\n              <Button variant=\"outline\" onClick={() => { setShowCheckoutDialog(false); resetCheckoutForm(); }}>\n                {t(\"common.cancel\")}\n              </Button>\n              <Button \n                onClick={selectedTool?.status === \"available\" ? submitCheckout : submitCheckin}\n                disabled={checkoutMutation.isPending || checkinMutation.isPending}\n                data-testid=\"button-confirm-tool-action\"\n              >\n                {t(\"common.confirm\")}\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":16209,"size_tokens":null},"client/src/components/NotificationBell.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useTranslation } from \"react-i18next\";\nimport { Bell, Check, CheckCheck, X } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport type { Notification } from \"@shared/schema\";\n\nfunction getNotificationIcon(type: string) {\n  switch (type) {\n    case \"late_arrival\":\n      return \"clock\";\n    case \"tool_unreturned\":\n      return \"wrench\";\n    case \"contestation\":\n      return \"alert-triangle\";\n    case \"leave_approved\":\n    case \"leave_rejected\":\n      return \"calendar\";\n    default:\n      return \"bell\";\n  }\n}\n\nfunction getPriorityColor(priority: string) {\n  switch (priority) {\n    case \"urgent\":\n      return \"bg-destructive text-destructive-foreground\";\n    case \"high\":\n      return \"bg-orange-500 text-white dark:bg-orange-600\";\n    case \"normal\":\n      return \"bg-primary text-primary-foreground\";\n    case \"low\":\n      return \"bg-muted text-muted-foreground\";\n    default:\n      return \"bg-primary text-primary-foreground\";\n  }\n}\n\nexport function NotificationBell() {\n  const { t } = useTranslation();\n  const [open, setOpen] = useState(false);\n\n  const { data: notifications = [], isLoading } = useQuery<Notification[]>({\n    queryKey: [\"/api/notifications\"],\n    refetchInterval: 30000,\n  });\n\n  const { data: unreadData } = useQuery<{ count: number }>({\n    queryKey: [\"/api/notifications/unread\"],\n    refetchInterval: 30000,\n  });\n\n  const markReadMutation = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(\"PATCH\", `/api/notifications/${id}/read`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications/unread\"] });\n    },\n  });\n\n  const markAllReadMutation = useMutation({\n    mutationFn: async () => {\n      await apiRequest(\"POST\", \"/api/notifications/mark-all-read\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications/unread\"] });\n    },\n  });\n\n  const unreadCount = unreadData?.count || 0;\n  const recentNotifications = notifications.slice(0, 10);\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild>\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          className=\"relative\"\n          data-testid=\"button-notification-bell\"\n        >\n          <Bell className=\"h-5 w-5\" />\n          {unreadCount > 0 && (\n            <span\n              className=\"absolute -top-1 -right-1 h-5 w-5 rounded-full bg-destructive text-destructive-foreground text-xs flex items-center justify-center\"\n              data-testid=\"notification-count\"\n            >\n              {unreadCount > 9 ? \"9+\" : unreadCount}\n            </span>\n          )}\n        </Button>\n      </PopoverTrigger>\n      <PopoverContent className=\"w-80 p-0\" align=\"end\">\n        <div className=\"flex items-center justify-between gap-2 p-3 border-b\">\n          <h4 className=\"font-semibold\">{t(\"notifications.title\")}</h4>\n          {unreadCount > 0 && (\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => markAllReadMutation.mutate()}\n              disabled={markAllReadMutation.isPending}\n              data-testid=\"button-mark-all-read\"\n            >\n              <CheckCheck className=\"h-4 w-4 mr-1\" />\n              {t(\"notifications.markAllRead\")}\n            </Button>\n          )}\n        </div>\n        <ScrollArea className=\"h-80\">\n          {isLoading ? (\n            <div className=\"flex items-center justify-center h-20\">\n              <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-primary\"></div>\n            </div>\n          ) : recentNotifications.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center h-32 text-muted-foreground\">\n              <Bell className=\"h-8 w-8 mb-2 opacity-50\" />\n              <p>{t(\"notifications.empty\")}</p>\n            </div>\n          ) : (\n            <div className=\"divide-y\">\n              {recentNotifications.map((notification) => (\n                <div\n                  key={notification.id}\n                  className={`p-3 hover-elevate cursor-pointer ${\n                    !notification.isRead ? \"bg-muted/50\" : \"\"\n                  }`}\n                  onClick={() => {\n                    if (!notification.isRead) {\n                      markReadMutation.mutate(notification.id);\n                    }\n                  }}\n                  data-testid={`notification-item-${notification.id}`}\n                >\n                  <div className=\"flex items-start gap-3\">\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center gap-2 mb-1\">\n                        <p className=\"font-medium text-sm truncate\">\n                          {notification.title}\n                        </p>\n                        {notification.priority && notification.priority !== \"normal\" && (\n                          <Badge\n                            variant=\"secondary\"\n                            className={`text-xs ${getPriorityColor(notification.priority)}`}\n                          >\n                            {notification.priority}\n                          </Badge>\n                        )}\n                      </div>\n                      <p className=\"text-sm text-muted-foreground line-clamp-2\">\n                        {notification.message}\n                      </p>\n                      <p className=\"text-xs text-muted-foreground mt-1\">\n                        {notification.createdAt &&\n                          formatDistanceToNow(new Date(notification.createdAt), {\n                            addSuffix: true,\n                          })}\n                      </p>\n                    </div>\n                    {!notification.isRead && (\n                      <div className=\"w-2 h-2 rounded-full bg-primary flex-shrink-0 mt-2\" />\n                    )}\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </ScrollArea>\n        {recentNotifications.length > 0 && (\n          <>\n            <Separator />\n            <div className=\"p-2\">\n              <Button\n                variant=\"ghost\"\n                className=\"w-full\"\n                size=\"sm\"\n                data-testid=\"button-view-all-notifications\"\n              >\n                {t(\"notifications.viewAll\")}\n              </Button>\n            </div>\n          </>\n        )}\n      </PopoverContent>\n    </Popover>\n  );\n}\n","path":null,"size_bytes":7081,"size_tokens":null},"client/src/pages/Analytics.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  BarChart,\n  Bar,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  Legend,\n  ResponsiveContainer,\n  LineChart,\n  Line,\n  PieChart,\n  Pie,\n  Cell,\n  AreaChart,\n  Area,\n} from \"recharts\";\nimport {\n  TrendingUp,\n  Clock,\n  Wrench,\n  DollarSign,\n  Building2,\n  Users,\n} from \"lucide-react\";\n\ninterface HoursBySite {\n  siteId: string;\n  siteName: string;\n  totalHours: number;\n  overtimeHours: number;\n  recordCount: number;\n}\n\ninterface HoursTrend {\n  date: string;\n  hours: number;\n  overtime: number;\n}\n\ninterface ToolUsage {\n  total: number;\n  statusCounts: {\n    available: number;\n    in_use: number;\n    maintenance: number;\n    lost: number;\n    stolen: number;\n  };\n  byCategory: { name: string; value: number }[];\n}\n\ninterface PayrollSummary {\n  totalPaid: number;\n  totalPending: number;\n  totalRegularHours: number;\n  totalOvertimeHours: number;\n  employeeCount: number;\n  recordCount: number;\n  monthlyData: { month: string; amount: number; hours: number }[];\n}\n\nconst COLORS = [\"hsl(var(--chart-1))\", \"hsl(var(--chart-2))\", \"hsl(var(--chart-3))\", \"hsl(var(--chart-4))\", \"hsl(var(--chart-5))\"];\n\nexport default function Analytics() {\n  const { t } = useTranslation();\n\n  const { data: hoursBySite, isLoading: loadingHoursBySite } = useQuery<HoursBySite[]>({\n    queryKey: [\"/api/analytics/hours-by-site\"],\n  });\n\n  const { data: hoursTrend, isLoading: loadingHoursTrend } = useQuery<HoursTrend[]>({\n    queryKey: [\"/api/analytics/hours-trend\"],\n  });\n\n  const { data: toolUsage, isLoading: loadingToolUsage } = useQuery<ToolUsage>({\n    queryKey: [\"/api/analytics/tool-usage\"],\n  });\n\n  const { data: payrollSummary, isLoading: loadingPayroll } = useQuery<PayrollSummary>({\n    queryKey: [\"/api/analytics/payroll-summary\"],\n  });\n\n  const toolStatusData = toolUsage ? [\n    { name: t(\"tools.available\"), value: toolUsage.statusCounts.available },\n    { name: t(\"tools.inUse\"), value: toolUsage.statusCounts.in_use },\n    { name: t(\"tools.maintenance\"), value: toolUsage.statusCounts.maintenance },\n    { name: t(\"tools.lost\"), value: toolUsage.statusCounts.lost },\n    { name: t(\"tools.stolen\"), value: toolUsage.statusCounts.stolen },\n  ].filter(item => item.value > 0) : [];\n\n  const summaryCards = [\n    {\n      title: t(\"analytics.totalHours\"),\n      value: hoursBySite?.reduce((sum, s) => sum + s.totalHours, 0).toFixed(1) || \"0\",\n      icon: Clock,\n      color: \"text-blue-500\",\n      bg: \"bg-blue-500/10\",\n    },\n    {\n      title: t(\"analytics.activeSites\"),\n      value: hoursBySite?.length || 0,\n      icon: Building2,\n      color: \"text-green-500\",\n      bg: \"bg-green-500/10\",\n    },\n    {\n      title: t(\"analytics.totalTools\"),\n      value: toolUsage?.total || 0,\n      icon: Wrench,\n      color: \"text-orange-500\",\n      bg: \"bg-orange-500/10\",\n    },\n    {\n      title: t(\"analytics.employeeCount\"),\n      value: payrollSummary?.employeeCount || 0,\n      icon: Users,\n      color: \"text-purple-500\",\n      bg: \"bg-purple-500/10\",\n    },\n  ];\n\n  const isLoading = loadingHoursBySite || loadingHoursTrend || loadingToolUsage || loadingPayroll;\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div>\n        <h1 className=\"text-2xl font-bold\" data-testid=\"text-analytics-title\">\n          {t(\"analytics.title\")}\n        </h1>\n        <p className=\"text-muted-foreground\">{t(\"analytics.subtitle\")}</p>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        {summaryCards.map((stat, index) => (\n          <Card key={index} data-testid={`card-analytics-stat-${index}`}>\n            <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                {stat.title}\n              </CardTitle>\n              <div className={`p-2 rounded-md ${stat.bg}`}>\n                <stat.icon className={`h-4 w-4 ${stat.color}`} />\n              </div>\n            </CardHeader>\n            <CardContent>\n              {isLoading ? (\n                <Skeleton className=\"h-8 w-16\" />\n              ) : (\n                <div className=\"text-2xl font-bold\" data-testid={`text-analytics-value-${index}`}>\n                  {stat.value}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      <Tabs defaultValue=\"productivity\" className=\"space-y-4\">\n        <TabsList data-testid=\"tabs-analytics\">\n          <TabsTrigger value=\"productivity\" data-testid=\"tab-productivity\">\n            {t(\"analytics.productivity\")}\n          </TabsTrigger>\n          <TabsTrigger value=\"tools\" data-testid=\"tab-tools\">\n            {t(\"nav.tools\")}\n          </TabsTrigger>\n          <TabsTrigger value=\"payroll\" data-testid=\"tab-payroll\">\n            {t(\"nav.payroll\")}\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"productivity\" className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <TrendingUp className=\"h-5 w-5\" />\n                  {t(\"analytics.hoursTrend\")}\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                {loadingHoursTrend ? (\n                  <Skeleton className=\"h-[300px] w-full\" />\n                ) : hoursTrend && hoursTrend.length > 0 ? (\n                  <ResponsiveContainer width=\"100%\" height={300}>\n                    <AreaChart data={hoursTrend}>\n                      <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                      <XAxis \n                        dataKey=\"date\" \n                        className=\"text-xs\"\n                        tickFormatter={(value) => {\n                          const date = new Date(value);\n                          return `${date.getMonth() + 1}/${date.getDate()}`;\n                        }}\n                      />\n                      <YAxis className=\"text-xs\" />\n                      <Tooltip \n                        contentStyle={{ \n                          backgroundColor: \"hsl(var(--card))\", \n                          border: \"1px solid hsl(var(--border))\",\n                          borderRadius: \"var(--radius)\",\n                        }}\n                        labelFormatter={(value) => new Date(value).toLocaleDateString()}\n                      />\n                      <Legend />\n                      <Area\n                        type=\"monotone\"\n                        dataKey=\"hours\"\n                        name={t(\"analytics.regularHours\")}\n                        stroke=\"hsl(var(--chart-1))\"\n                        fill=\"hsl(var(--chart-1))\"\n                        fillOpacity={0.3}\n                      />\n                      <Area\n                        type=\"monotone\"\n                        dataKey=\"overtime\"\n                        name={t(\"analytics.overtimeHours\")}\n                        stroke=\"hsl(var(--chart-2))\"\n                        fill=\"hsl(var(--chart-2))\"\n                        fillOpacity={0.3}\n                      />\n                    </AreaChart>\n                  </ResponsiveContainer>\n                ) : (\n                  <div className=\"h-[300px] flex items-center justify-center text-muted-foreground\">\n                    {t(\"analytics.noData\")}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Building2 className=\"h-5 w-5\" />\n                  {t(\"analytics.hoursBySite\")}\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                {loadingHoursBySite ? (\n                  <Skeleton className=\"h-[300px] w-full\" />\n                ) : hoursBySite && hoursBySite.length > 0 ? (\n                  <ResponsiveContainer width=\"100%\" height={300}>\n                    <BarChart data={hoursBySite} layout=\"vertical\">\n                      <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                      <XAxis type=\"number\" className=\"text-xs\" />\n                      <YAxis \n                        dataKey=\"siteName\" \n                        type=\"category\" \n                        className=\"text-xs\"\n                        width={100}\n                        tickFormatter={(value) => value.length > 12 ? `${value.slice(0, 12)}...` : value}\n                      />\n                      <Tooltip \n                        contentStyle={{ \n                          backgroundColor: \"hsl(var(--card))\", \n                          border: \"1px solid hsl(var(--border))\",\n                          borderRadius: \"var(--radius)\",\n                        }}\n                      />\n                      <Legend />\n                      <Bar \n                        dataKey=\"totalHours\" \n                        name={t(\"analytics.regularHours\")} \n                        fill=\"hsl(var(--chart-1))\" \n                        radius={[0, 4, 4, 0]}\n                      />\n                      <Bar \n                        dataKey=\"overtimeHours\" \n                        name={t(\"analytics.overtimeHours\")} \n                        fill=\"hsl(var(--chart-2))\" \n                        radius={[0, 4, 4, 0]}\n                      />\n                    </BarChart>\n                  </ResponsiveContainer>\n                ) : (\n                  <div className=\"h-[300px] flex items-center justify-center text-muted-foreground\">\n                    {t(\"analytics.noData\")}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"tools\" className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Wrench className=\"h-5 w-5\" />\n                  {t(\"analytics.toolStatus\")}\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                {loadingToolUsage ? (\n                  <Skeleton className=\"h-[300px] w-full\" />\n                ) : toolStatusData.length > 0 ? (\n                  <ResponsiveContainer width=\"100%\" height={300}>\n                    <PieChart>\n                      <Pie\n                        data={toolStatusData}\n                        cx=\"50%\"\n                        cy=\"50%\"\n                        labelLine={false}\n                        label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}\n                        outerRadius={100}\n                        fill=\"#8884d8\"\n                        dataKey=\"value\"\n                      >\n                        {toolStatusData.map((_, index) => (\n                          <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\n                        ))}\n                      </Pie>\n                      <Tooltip \n                        contentStyle={{ \n                          backgroundColor: \"hsl(var(--card))\", \n                          border: \"1px solid hsl(var(--border))\",\n                          borderRadius: \"var(--radius)\",\n                        }}\n                      />\n                    </PieChart>\n                  </ResponsiveContainer>\n                ) : (\n                  <div className=\"h-[300px] flex items-center justify-center text-muted-foreground\">\n                    {t(\"analytics.noData\")}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Wrench className=\"h-5 w-5\" />\n                  {t(\"analytics.toolsByCategory\")}\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                {loadingToolUsage ? (\n                  <Skeleton className=\"h-[300px] w-full\" />\n                ) : toolUsage?.byCategory && toolUsage.byCategory.length > 0 ? (\n                  <ResponsiveContainer width=\"100%\" height={300}>\n                    <BarChart data={toolUsage.byCategory}>\n                      <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                      <XAxis dataKey=\"name\" className=\"text-xs\" />\n                      <YAxis className=\"text-xs\" />\n                      <Tooltip \n                        contentStyle={{ \n                          backgroundColor: \"hsl(var(--card))\", \n                          border: \"1px solid hsl(var(--border))\",\n                          borderRadius: \"var(--radius)\",\n                        }}\n                      />\n                      <Bar \n                        dataKey=\"value\" \n                        name={t(\"analytics.count\")} \n                        fill=\"hsl(var(--chart-3))\" \n                        radius={[4, 4, 0, 0]}\n                      />\n                    </BarChart>\n                  </ResponsiveContainer>\n                ) : (\n                  <div className=\"h-[300px] flex items-center justify-center text-muted-foreground\">\n                    {t(\"analytics.noData\")}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"payroll\" className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n                <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                  {t(\"analytics.totalPaid\")}\n                </CardTitle>\n                <DollarSign className=\"h-4 w-4 text-green-500\" />\n              </CardHeader>\n              <CardContent>\n                {loadingPayroll ? (\n                  <Skeleton className=\"h-8 w-20\" />\n                ) : (\n                  <div className=\"text-2xl font-bold text-green-600\" data-testid=\"text-total-paid\">\n                    ${payrollSummary?.totalPaid.toFixed(2) || \"0.00\"}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n                <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                  {t(\"analytics.totalPending\")}\n                </CardTitle>\n                <DollarSign className=\"h-4 w-4 text-orange-500\" />\n              </CardHeader>\n              <CardContent>\n                {loadingPayroll ? (\n                  <Skeleton className=\"h-8 w-20\" />\n                ) : (\n                  <div className=\"text-2xl font-bold text-orange-600\" data-testid=\"text-total-pending\">\n                    ${payrollSummary?.totalPending.toFixed(2) || \"0.00\"}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n                <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                  {t(\"analytics.regularHours\")}\n                </CardTitle>\n                <Clock className=\"h-4 w-4 text-blue-500\" />\n              </CardHeader>\n              <CardContent>\n                {loadingPayroll ? (\n                  <Skeleton className=\"h-8 w-20\" />\n                ) : (\n                  <div className=\"text-2xl font-bold\" data-testid=\"text-regular-hours\">\n                    {payrollSummary?.totalRegularHours.toFixed(1) || \"0\"}h\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n                <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                  {t(\"analytics.overtimeHours\")}\n                </CardTitle>\n                <Clock className=\"h-4 w-4 text-purple-500\" />\n              </CardHeader>\n              <CardContent>\n                {loadingPayroll ? (\n                  <Skeleton className=\"h-8 w-20\" />\n                ) : (\n                  <div className=\"text-2xl font-bold\" data-testid=\"text-overtime-hours\">\n                    {payrollSummary?.totalOvertimeHours.toFixed(1) || \"0\"}h\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <DollarSign className=\"h-5 w-5\" />\n                {t(\"analytics.payrollTrend\")}\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {loadingPayroll ? (\n                <Skeleton className=\"h-[300px] w-full\" />\n              ) : payrollSummary?.monthlyData && payrollSummary.monthlyData.length > 0 ? (\n                <ResponsiveContainer width=\"100%\" height={300}>\n                  <LineChart data={payrollSummary.monthlyData}>\n                    <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                    <XAxis \n                      dataKey=\"month\" \n                      className=\"text-xs\"\n                      tickFormatter={(value) => {\n                        const [year, month] = value.split('-');\n                        return `${month}/${year.slice(2)}`;\n                      }}\n                    />\n                    <YAxis yAxisId=\"left\" className=\"text-xs\" />\n                    <YAxis yAxisId=\"right\" orientation=\"right\" className=\"text-xs\" />\n                    <Tooltip \n                      contentStyle={{ \n                        backgroundColor: \"hsl(var(--card))\", \n                        border: \"1px solid hsl(var(--border))\",\n                        borderRadius: \"var(--radius)\",\n                      }}\n                      formatter={(value, name) => {\n                        if (name === t(\"analytics.amount\")) return [`$${Number(value).toFixed(2)}`, name];\n                        return [value, name];\n                      }}\n                    />\n                    <Legend />\n                    <Line\n                      yAxisId=\"left\"\n                      type=\"monotone\"\n                      dataKey=\"amount\"\n                      name={t(\"analytics.amount\")}\n                      stroke=\"hsl(var(--chart-1))\"\n                      strokeWidth={2}\n                      dot={{ fill: \"hsl(var(--chart-1))\" }}\n                    />\n                    <Line\n                      yAxisId=\"right\"\n                      type=\"monotone\"\n                      dataKey=\"hours\"\n                      name={t(\"common.hours\")}\n                      stroke=\"hsl(var(--chart-2))\"\n                      strokeWidth={2}\n                      dot={{ fill: \"hsl(var(--chart-2))\" }}\n                    />\n                  </LineChart>\n                </ResponsiveContainer>\n              ) : (\n                <div className=\"h-[300px] flex items-center justify-center text-muted-foreground\">\n                  {t(\"analytics.noData\")}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":19777,"size_tokens":null},"client/src/pages/Documents.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  FileText,\n  Upload,\n  Search,\n  FolderOpen,\n  Download,\n  Trash2,\n  History,\n  FileImage,\n  FileSpreadsheet,\n  File,\n  Building2,\n} from \"lucide-react\";\nimport type { Site, SiteDocument } from \"@shared/schema\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\nconst DOCUMENT_CATEGORIES = [\n  \"plans\",\n  \"certificates\",\n  \"reports\",\n  \"contracts\",\n  \"safety\",\n] as const;\n\ntype DocumentCategory = typeof DOCUMENT_CATEGORIES[number];\n\nexport default function Documents() {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const { user, isManager } = useAuth();\n  const [search, setSearch] = useState(\"\");\n  const [selectedSite, setSelectedSite] = useState<string>(\"all\");\n  const [selectedCategory, setSelectedCategory] = useState<string>(\"all\");\n  const [showUploadDialog, setShowUploadDialog] = useState(false);\n  const [showVersionsDialog, setShowVersionsDialog] = useState(false);\n  const [selectedDocument, setSelectedDocument] = useState<SiteDocument | null>(null);\n  const [uploadForm, setUploadForm] = useState({\n    siteId: \"\",\n    name: \"\",\n    category: \"plans\" as DocumentCategory,\n    description: \"\",\n    fileUrl: \"\",\n    fileType: \"\",\n    fileSize: 0,\n  });\n\n  const { data: sites, isLoading: sitesLoading } = useQuery<Site[]>({\n    queryKey: [\"/api/sites\"],\n  });\n\n  const { data: documents, isLoading: documentsLoading } = useQuery<SiteDocument[]>({\n    queryKey: [\"/api/sites\", selectedSite, \"documents\"],\n    queryFn: async () => {\n      if (selectedSite === \"all\") {\n        const allDocs: SiteDocument[] = [];\n        if (sites) {\n          for (const site of sites) {\n            const response = await fetch(`/api/sites/${site.id}/documents`, {\n              credentials: \"include\",\n            });\n            if (response.ok) {\n              const siteDocs = await response.json();\n              allDocs.push(...siteDocs);\n            }\n          }\n        }\n        return allDocs;\n      }\n      const response = await fetch(`/api/sites/${selectedSite}/documents`, {\n        credentials: \"include\",\n      });\n      if (!response.ok) throw new Error(\"Failed to fetch documents\");\n      return response.json();\n    },\n    enabled: !!sites && sites.length > 0,\n  });\n\n  const { data: versions, isLoading: versionsLoading } = useQuery<SiteDocument[]>({\n    queryKey: [\"/api/documents\", selectedDocument?.id, \"versions\"],\n    queryFn: async () => {\n      if (!selectedDocument) return [];\n      const response = await fetch(`/api/documents/${selectedDocument.id}/versions`, {\n        credentials: \"include\",\n      });\n      if (!response.ok) throw new Error(\"Failed to fetch versions\");\n      return response.json();\n    },\n    enabled: !!selectedDocument && showVersionsDialog,\n  });\n\n  const uploadMutation = useMutation({\n    mutationFn: async (data: typeof uploadForm) => {\n      return apiRequest(\"POST\", `/api/sites/${data.siteId}/documents`, {\n        ...data,\n        uploadedBy: user?.id,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/sites\"] });\n      toast({ title: t(\"documents.uploadSuccess\") });\n      setShowUploadDialog(false);\n      resetUploadForm();\n    },\n    onError: () => {\n      toast({ title: t(\"documents.uploadError\"), variant: \"destructive\" });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest(\"DELETE\", `/api/documents/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/sites\"] });\n      toast({ title: t(\"documents.deleteSuccess\") });\n    },\n    onError: () => {\n      toast({ title: t(\"documents.deleteError\"), variant: \"destructive\" });\n    },\n  });\n\n  const resetUploadForm = () => {\n    setUploadForm({\n      siteId: \"\",\n      name: \"\",\n      category: \"plans\",\n      description: \"\",\n      fileUrl: \"\",\n      fileType: \"\",\n      fileSize: 0,\n    });\n  };\n\n  const filteredDocuments = documents?.filter((doc) => {\n    const matchesSearch = doc.name.toLowerCase().includes(search.toLowerCase()) ||\n      doc.description?.toLowerCase().includes(search.toLowerCase());\n    const matchesCategory = selectedCategory === \"all\" || doc.category === selectedCategory;\n    return matchesSearch && matchesCategory;\n  });\n\n  const getCategoryBadge = (category: string) => {\n    const colors: Record<string, \"default\" | \"secondary\" | \"outline\"> = {\n      plans: \"default\",\n      certificates: \"secondary\",\n      reports: \"outline\",\n      contracts: \"secondary\",\n      safety: \"default\",\n    };\n    return <Badge variant={colors[category] || \"secondary\"}>{t(`documents.categories.${category}`)}</Badge>;\n  };\n\n  const getFileIcon = (fileType: string | null) => {\n    if (!fileType) return <File className=\"h-8 w-8 text-muted-foreground\" />;\n    if (fileType.includes(\"image\")) return <FileImage className=\"h-8 w-8 text-blue-500\" />;\n    if (fileType.includes(\"spreadsheet\") || fileType.includes(\"excel\")) return <FileSpreadsheet className=\"h-8 w-8 text-green-500\" />;\n    if (fileType.includes(\"pdf\")) return <FileText className=\"h-8 w-8 text-red-500\" />;\n    return <File className=\"h-8 w-8 text-muted-foreground\" />;\n  };\n\n  const formatFileSize = (bytes: number | null) => {\n    if (!bytes) return \"\";\n    if (bytes < 1024) return `${bytes} B`;\n    if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n    return `${(bytes / 1024 / 1024).toFixed(1)} MB`;\n  };\n\n  const getSiteName = (siteId: string) => {\n    return sites?.find((s) => s.id === siteId)?.name || siteId;\n  };\n\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      setUploadForm({\n        ...uploadForm,\n        name: file.name,\n        fileType: file.type,\n        fileSize: file.size,\n        fileUrl: URL.createObjectURL(file),\n      });\n    }\n  };\n\n  const isLoading = sitesLoading || documentsLoading;\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-bold\">{t(\"documents.title\")}</h1>\n          <p className=\"text-muted-foreground\">{t(\"documents.subtitle\")}</p>\n        </div>\n        {isManager && (\n          <Button onClick={() => setShowUploadDialog(true)} data-testid=\"button-upload-document\">\n            <Upload className=\"mr-2 h-4 w-4\" />\n            {t(\"documents.upload\")}\n          </Button>\n        )}\n      </div>\n\n      <div className=\"flex flex-col sm:flex-row gap-4\">\n        <div className=\"relative flex-1\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder={t(\"common.search\")}\n            value={search}\n            onChange={(e) => setSearch(e.target.value)}\n            className=\"pl-9\"\n            data-testid=\"input-search-documents\"\n          />\n        </div>\n        <Select value={selectedSite} onValueChange={setSelectedSite}>\n          <SelectTrigger className=\"w-full sm:w-48\" data-testid=\"select-site-filter\">\n            <SelectValue placeholder={t(\"documents.selectSite\")} />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"all\">{t(\"documents.allSites\")}</SelectItem>\n            {sites?.map((site) => (\n              <SelectItem key={site.id} value={site.id}>{site.name}</SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n        <Select value={selectedCategory} onValueChange={setSelectedCategory}>\n          <SelectTrigger className=\"w-full sm:w-48\" data-testid=\"select-category-filter\">\n            <SelectValue placeholder={t(\"documents.category\")} />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"all\">{t(\"documents.allCategories\")}</SelectItem>\n            {DOCUMENT_CATEGORIES.map((cat) => (\n              <SelectItem key={cat} value={cat}>{t(`documents.categories.${cat}`)}</SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n      </div>\n\n      {isLoading ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {Array.from({ length: 6 }).map((_, i) => (\n            <Card key={i}>\n              <CardContent className=\"p-6\">\n                <Skeleton className=\"h-8 w-8 mb-4\" />\n                <Skeleton className=\"h-5 w-3/4 mb-2\" />\n                <Skeleton className=\"h-4 w-full mb-2\" />\n                <Skeleton className=\"h-4 w-1/2\" />\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : filteredDocuments?.length === 0 ? (\n        <Card>\n          <CardContent className=\"p-12 text-center\">\n            <FolderOpen className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\n            <p className=\"text-muted-foreground\">{t(\"documents.noDocuments\")}</p>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {filteredDocuments?.map((doc) => (\n            <Card key={doc.id} className=\"hover-elevate\" data-testid={`card-document-${doc.id}`}>\n              <CardHeader className=\"pb-2\">\n                <div className=\"flex items-start gap-3\">\n                  {getFileIcon(doc.fileType)}\n                  <div className=\"flex-1 min-w-0\">\n                    <CardTitle className=\"text-base truncate\">{doc.name}</CardTitle>\n                    <CardDescription className=\"flex items-center gap-1 text-xs\">\n                      <Building2 className=\"h-3 w-3\" />\n                      {getSiteName(doc.siteId)}\n                    </CardDescription>\n                  </div>\n                  {getCategoryBadge(doc.category)}\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                {doc.description && (\n                  <p className=\"text-sm text-muted-foreground line-clamp-2\">{doc.description}</p>\n                )}\n                <div className=\"flex items-center justify-between text-xs text-muted-foreground\">\n                  <span>{formatFileSize(doc.fileSize)}</span>\n                  <span>v{doc.version}</span>\n                </div>\n                <div className=\"flex gap-2 flex-wrap\">\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => window.open(doc.fileUrl, \"_blank\")}\n                    data-testid={`button-download-${doc.id}`}\n                  >\n                    <Download className=\"h-3 w-3 mr-1\" />\n                    {t(\"documents.download\")}\n                  </Button>\n                  <Button\n                    size=\"sm\"\n                    variant=\"ghost\"\n                    onClick={() => {\n                      setSelectedDocument(doc);\n                      setShowVersionsDialog(true);\n                    }}\n                    data-testid={`button-versions-${doc.id}`}\n                  >\n                    <History className=\"h-3 w-3 mr-1\" />\n                    {t(\"documents.versions\")}\n                  </Button>\n                  {isManager && (\n                    <Button\n                      size=\"sm\"\n                      variant=\"ghost\"\n                      onClick={() => deleteMutation.mutate(doc.id)}\n                      data-testid={`button-delete-${doc.id}`}\n                    >\n                      <Trash2 className=\"h-3 w-3\" />\n                    </Button>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n\n      <Dialog open={showUploadDialog} onOpenChange={setShowUploadDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>{t(\"documents.uploadDocument\")}</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label>{t(\"documents.selectSite\")}</Label>\n              <Select\n                value={uploadForm.siteId}\n                onValueChange={(v) => setUploadForm({ ...uploadForm, siteId: v })}\n              >\n                <SelectTrigger data-testid=\"select-upload-site\">\n                  <SelectValue placeholder={t(\"documents.selectSite\")} />\n                </SelectTrigger>\n                <SelectContent>\n                  {sites?.map((site) => (\n                    <SelectItem key={site.id} value={site.id}>{site.name}</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>{t(\"documents.category\")}</Label>\n              <Select\n                value={uploadForm.category}\n                onValueChange={(v) => setUploadForm({ ...uploadForm, category: v as DocumentCategory })}\n              >\n                <SelectTrigger data-testid=\"select-upload-category\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  {DOCUMENT_CATEGORIES.map((cat) => (\n                    <SelectItem key={cat} value={cat}>{t(`documents.categories.${cat}`)}</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>{t(\"documents.file\")}</Label>\n              <Input\n                type=\"file\"\n                onChange={handleFileSelect}\n                data-testid=\"input-file-upload\"\n              />\n              {uploadForm.name && (\n                <p className=\"text-sm text-muted-foreground\">\n                  {uploadForm.name} ({formatFileSize(uploadForm.fileSize)})\n                </p>\n              )}\n            </div>\n            <div className=\"space-y-2\">\n              <Label>{t(\"documents.description\")}</Label>\n              <Textarea\n                value={uploadForm.description}\n                onChange={(e) => setUploadForm({ ...uploadForm, description: e.target.value })}\n                placeholder={t(\"documents.descriptionPlaceholder\")}\n                data-testid=\"input-description\"\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowUploadDialog(false)}>\n              {t(\"common.cancel\")}\n            </Button>\n            <Button\n              onClick={() => uploadMutation.mutate(uploadForm)}\n              disabled={!uploadForm.siteId || !uploadForm.name || uploadMutation.isPending}\n              data-testid=\"button-confirm-upload\"\n            >\n              {uploadMutation.isPending ? t(\"common.loading\") : t(\"documents.upload\")}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={showVersionsDialog} onOpenChange={setShowVersionsDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>{t(\"documents.versionHistory\")}</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-3\">\n            {selectedDocument && (\n              <div className=\"flex items-center gap-3 p-3 bg-muted rounded-md\">\n                {getFileIcon(selectedDocument.fileType)}\n                <div>\n                  <p className=\"font-medium\">{selectedDocument.name}</p>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {t(\"documents.currentVersion\")}: v{selectedDocument.version}\n                  </p>\n                </div>\n              </div>\n            )}\n            {versionsLoading ? (\n              <div className=\"space-y-2\">\n                <Skeleton className=\"h-12 w-full\" />\n                <Skeleton className=\"h-12 w-full\" />\n              </div>\n            ) : versions?.length === 0 ? (\n              <p className=\"text-center text-muted-foreground py-4\">\n                {t(\"documents.noVersions\")}\n              </p>\n            ) : (\n              <div className=\"space-y-2\">\n                {versions?.map((ver) => (\n                  <div key={ver.id} className=\"flex items-center justify-between p-3 border rounded-md\">\n                    <div>\n                      <p className=\"text-sm font-medium\">v{ver.version}</p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {new Date(ver.createdAt!).toLocaleDateString()}\n                      </p>\n                    </div>\n                    <Button size=\"sm\" variant=\"ghost\" onClick={() => window.open(ver.fileUrl, \"_blank\")}>\n                      <Download className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":17562,"size_tokens":null},"client/src/pages/Chat.tsx":{"content":"import { useState, useEffect, useRef, useCallback } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { MessageCircle, Send, Users, Building2 } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport type { ChatRoom, ChatMessage, Site, User } from \"@shared/schema\";\n\ninterface MessageWithSender extends ChatMessage {\n  sender?: {\n    id: string;\n    firstName: string | null;\n    lastName: string | null;\n    profileImageUrl: string | null;\n  } | null;\n}\n\nexport default function Chat() {\n  const { t } = useTranslation();\n  const { user } = useAuth();\n  const [selectedRoom, setSelectedRoom] = useState<ChatRoom | null>(null);\n  const [selectedSite, setSelectedSite] = useState<string>(\"\");\n  const [messageInput, setMessageInput] = useState(\"\");\n  const [messages, setMessages] = useState<MessageWithSender[]>([]);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const wsRef = useRef<WebSocket | null>(null);\n\n  const { data: sites, isLoading: sitesLoading } = useQuery<Site[]>({\n    queryKey: [\"/api/sites\"],\n  });\n\n  const { data: rooms, isLoading: roomsLoading } = useQuery<ChatRoom[]>({\n    queryKey: [\"/api/chat/rooms\"],\n  });\n\n  const { data: users } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const { data: roomMessages, isLoading: messagesLoading, refetch: refetchMessages } = useQuery<ChatMessage[]>({\n    queryKey: [\"/api/chat/rooms\", selectedRoom?.id, \"messages\"],\n    enabled: !!selectedRoom,\n  });\n\n  const sendMessageMutation = useMutation({\n    mutationFn: async (content: string) => {\n      if (!selectedRoom) return;\n      return apiRequest(\"POST\", `/api/chat/rooms/${selectedRoom.id}/messages`, { content });\n    },\n    onSuccess: () => {\n      setMessageInput(\"\");\n      refetchMessages();\n    },\n  });\n\n  const joinRoomMutation = useMutation({\n    mutationFn: async (siteId: string) => {\n      const res = await apiRequest(\"POST\", `/api/sites/${siteId}/chat`, {});\n      return res.json();\n    },\n    onSuccess: (room) => {\n      setSelectedRoom(room);\n      queryClient.invalidateQueries({ queryKey: [\"/api/chat/rooms\"] });\n    },\n  });\n\n  const getUserById = useCallback((id: string) => {\n    return users?.find((u) => u.id === id);\n  }, [users]);\n\n  useEffect(() => {\n    if (roomMessages) {\n      const messagesWithSenders = roomMessages.map((msg) => ({\n        ...msg,\n        sender: getUserById(msg.senderId) ? {\n          id: msg.senderId,\n          firstName: getUserById(msg.senderId)?.firstName || null,\n          lastName: getUserById(msg.senderId)?.lastName || null,\n          profileImageUrl: getUserById(msg.senderId)?.profileImageUrl || null,\n        } : null,\n      }));\n      setMessages(messagesWithSenders.reverse());\n    }\n  }, [roomMessages, getUserById]);\n\n  useEffect(() => {\n    if (selectedRoom && user) {\n      const protocol = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n      const ws = new WebSocket(`${protocol}//${window.location.host}/ws/chat`);\n\n      ws.onopen = () => {\n        ws.send(JSON.stringify({ type: \"join\", roomId: selectedRoom.id, odId: user.id }));\n      };\n\n      ws.onmessage = (event) => {\n        const data = JSON.parse(event.data);\n        if (data.type === \"new_message\") {\n          setMessages((prev) => [...prev, data.message]);\n        }\n      };\n\n      wsRef.current = ws;\n\n      return () => {\n        ws.close();\n      };\n    }\n  }, [selectedRoom, user]);\n\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  const handleSendMessage = () => {\n    if (messageInput.trim() && selectedRoom) {\n      sendMessageMutation.mutate(messageInput.trim());\n    }\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\" && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n\n  const handleSiteSelect = (siteId: string) => {\n    setSelectedSite(siteId);\n    const existingRoom = rooms?.find((r) => r.siteId === siteId);\n    if (existingRoom) {\n      setSelectedRoom(existingRoom);\n    } else {\n      joinRoomMutation.mutate(siteId);\n    }\n  };\n\n  const getInitials = (firstName: string | null, lastName: string | null) => {\n    return `${firstName?.[0] || \"\"}${lastName?.[0] || \"\"}`.toUpperCase() || \"U\";\n  };\n\n  const formatMessageTime = (date: Date | string | null) => {\n    if (!date) return \"\";\n    const d = new Date(date);\n    const now = new Date();\n    const isToday = d.toDateString() === now.toDateString();\n    return isToday ? format(d, \"HH:mm\") : format(d, \"MMM d, HH:mm\");\n  };\n\n  return (\n    <div className=\"flex h-full\">\n      <div className=\"w-80 border-r flex flex-col\">\n        <div className=\"p-4 border-b\">\n          <h2 className=\"text-lg font-semibold flex items-center gap-2\">\n            <MessageCircle className=\"h-5 w-5\" />\n            {t(\"chat.title\")}\n          </h2>\n          <p className=\"text-sm text-muted-foreground\">{t(\"chat.subtitle\")}</p>\n        </div>\n\n        <div className=\"p-4 border-b\">\n          <Select value={selectedSite} onValueChange={handleSiteSelect}>\n            <SelectTrigger data-testid=\"select-site-chat\">\n              <SelectValue placeholder={t(\"chat.selectSite\")} />\n            </SelectTrigger>\n            <SelectContent>\n              {sitesLoading ? (\n                <div className=\"p-2\">\n                  <Skeleton className=\"h-8 w-full\" />\n                </div>\n              ) : (\n                sites?.map((site) => (\n                  <SelectItem key={site.id} value={site.id}>\n                    <div className=\"flex items-center gap-2\">\n                      <Building2 className=\"h-4 w-4\" />\n                      {site.name}\n                    </div>\n                  </SelectItem>\n                ))\n              )}\n            </SelectContent>\n          </Select>\n        </div>\n\n        <ScrollArea className=\"flex-1\">\n          <div className=\"p-2\">\n            {roomsLoading ? (\n              <div className=\"space-y-2\">\n                {[1, 2, 3].map((i) => (\n                  <Skeleton key={i} className=\"h-16 w-full\" />\n                ))}\n              </div>\n            ) : rooms?.length === 0 ? (\n              <div className=\"text-center text-muted-foreground py-8\">\n                <MessageCircle className=\"h-12 w-12 mx-auto mb-2 opacity-50\" />\n                <p>{t(\"chat.noRooms\")}</p>\n                <p className=\"text-sm\">{t(\"chat.selectSiteToStart\")}</p>\n              </div>\n            ) : (\n              rooms?.map((room) => (\n                <Button\n                  key={room.id}\n                  variant={selectedRoom?.id === room.id ? \"secondary\" : \"ghost\"}\n                  className=\"w-full justify-start h-auto py-3 px-3 mb-1\"\n                  onClick={() => setSelectedRoom(room)}\n                  data-testid={`button-room-${room.id}`}\n                >\n                  <div className=\"flex items-center gap-3 w-full\">\n                    <div className=\"bg-primary/10 rounded-full p-2\">\n                      <Building2 className=\"h-4 w-4 text-primary\" />\n                    </div>\n                    <div className=\"flex-1 text-left\">\n                      <div className=\"font-medium\">{room.name}</div>\n                      <div className=\"text-xs text-muted-foreground\">{t(\"chat.siteChat\")}</div>\n                    </div>\n                  </div>\n                </Button>\n              ))\n            )}\n          </div>\n        </ScrollArea>\n      </div>\n\n      <div className=\"flex-1 flex flex-col\">\n        {selectedRoom ? (\n          <>\n            <div className=\"p-4 border-b flex items-center justify-between gap-2\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"bg-primary/10 rounded-full p-2\">\n                  <Building2 className=\"h-5 w-5 text-primary\" />\n                </div>\n                <div>\n                  <h3 className=\"font-semibold\">{selectedRoom.name}</h3>\n                  <p className=\"text-sm text-muted-foreground\">{t(\"chat.siteChat\")}</p>\n                </div>\n              </div>\n              <Badge variant=\"outline\" className=\"flex items-center gap-1\">\n                <Users className=\"h-3 w-3\" />\n                {t(\"chat.online\")}\n              </Badge>\n            </div>\n\n            <ScrollArea className=\"flex-1 p-4\">\n              {messagesLoading ? (\n                <div className=\"space-y-4\">\n                  {[1, 2, 3].map((i) => (\n                    <div key={i} className=\"flex items-start gap-3\">\n                      <Skeleton className=\"h-10 w-10 rounded-full\" />\n                      <div className=\"space-y-2\">\n                        <Skeleton className=\"h-4 w-24\" />\n                        <Skeleton className=\"h-16 w-64\" />\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              ) : messages.length === 0 ? (\n                <div className=\"text-center text-muted-foreground py-16\">\n                  <MessageCircle className=\"h-16 w-16 mx-auto mb-4 opacity-50\" />\n                  <p className=\"text-lg\">{t(\"chat.noMessages\")}</p>\n                  <p className=\"text-sm\">{t(\"chat.startConversation\")}</p>\n                </div>\n              ) : (\n                <div className=\"space-y-4\">\n                  {messages.map((msg) => {\n                    const isOwn = msg.senderId === user?.id;\n                    return (\n                      <div\n                        key={msg.id}\n                        className={`flex items-start gap-3 ${isOwn ? \"flex-row-reverse\" : \"\"}`}\n                        data-testid={`message-${msg.id}`}\n                      >\n                        <Avatar className=\"h-8 w-8\">\n                          <AvatarImage src={msg.sender?.profileImageUrl || undefined} />\n                          <AvatarFallback className=\"text-xs\">\n                            {getInitials(msg.sender?.firstName || null, msg.sender?.lastName || null)}\n                          </AvatarFallback>\n                        </Avatar>\n                        <div className={`max-w-[70%] ${isOwn ? \"text-right\" : \"\"}`}>\n                          <div className={`flex items-center gap-2 mb-1 ${isOwn ? \"flex-row-reverse\" : \"\"}`}>\n                            <span className=\"text-sm font-medium\">\n                              {msg.sender ? `${msg.sender.firstName || \"\"} ${msg.sender.lastName || \"\"}`.trim() : t(\"chat.unknownUser\")}\n                            </span>\n                            <span className=\"text-xs text-muted-foreground\">\n                              {formatMessageTime(msg.createdAt)}\n                            </span>\n                          </div>\n                          <div\n                            className={`rounded-lg px-4 py-2 inline-block ${\n                              isOwn\n                                ? \"bg-primary text-primary-foreground\"\n                                : \"bg-muted\"\n                            }`}\n                          >\n                            {msg.content}\n                          </div>\n                        </div>\n                      </div>\n                    );\n                  })}\n                  <div ref={messagesEndRef} />\n                </div>\n              )}\n            </ScrollArea>\n\n            <div className=\"p-4 border-t\">\n              <div className=\"flex gap-2\">\n                <Input\n                  value={messageInput}\n                  onChange={(e) => setMessageInput(e.target.value)}\n                  onKeyPress={handleKeyPress}\n                  placeholder={t(\"chat.typeMessage\")}\n                  data-testid=\"input-message\"\n                  disabled={sendMessageMutation.isPending}\n                />\n                <Button\n                  onClick={handleSendMessage}\n                  disabled={!messageInput.trim() || sendMessageMutation.isPending}\n                  data-testid=\"button-send-message\"\n                >\n                  <Send className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </div>\n          </>\n        ) : (\n          <div className=\"flex-1 flex items-center justify-center\">\n            <div className=\"text-center text-muted-foreground\">\n              <MessageCircle className=\"h-20 w-20 mx-auto mb-4 opacity-30\" />\n              <h3 className=\"text-xl font-medium mb-2\">{t(\"chat.selectRoom\")}</h3>\n              <p className=\"text-sm\">{t(\"chat.selectRoomDescription\")}</p>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":13218,"size_tokens":null},"client/src/components/PWAInstallPrompt.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Download, X, Smartphone, Share, Plus } from \"lucide-react\";\nimport { useTranslation } from \"react-i18next\";\n\ninterface BeforeInstallPromptEvent extends Event {\n  prompt: () => Promise<void>;\n  userChoice: Promise<{ outcome: \"accepted\" | \"dismissed\" }>;\n}\n\nfunction isIOS(): boolean {\n  return /iPad|iPhone|iPod/.test(navigator.userAgent) && !(window as any).MSStream;\n}\n\nfunction isAndroid(): boolean {\n  return /Android/.test(navigator.userAgent);\n}\n\nfunction isStandalone(): boolean {\n  return window.matchMedia(\"(display-mode: standalone)\").matches ||\n    (window.navigator as any).standalone === true;\n}\n\nfunction isMobile(): boolean {\n  return isIOS() || isAndroid() || /Mobile|webOS|BlackBerry|Opera Mini|IEMobile/.test(navigator.userAgent);\n}\n\nexport function PWAInstallPrompt() {\n  const { t } = useTranslation();\n  const [deferredPrompt, setDeferredPrompt] = useState<BeforeInstallPromptEvent | null>(null);\n  const [showPrompt, setShowPrompt] = useState(false);\n  const [showIOSInstructions, setShowIOSInstructions] = useState(false);\n  const [isInstalled, setIsInstalled] = useState(false);\n\n  useEffect(() => {\n    if (isStandalone()) {\n      setIsInstalled(true);\n      return;\n    }\n\n    const dismissed = localStorage.getItem(\"pwa-install-dismissed\");\n    if (dismissed) {\n      const dismissedTime = parseInt(dismissed, 10);\n      if (Date.now() - dismissedTime < 7 * 24 * 60 * 60 * 1000) {\n        return;\n      }\n    }\n\n    if (isIOS()) {\n      setTimeout(() => {\n        setShowIOSInstructions(true);\n        setShowPrompt(true);\n      }, 3000);\n      return;\n    }\n\n    const handler = (e: Event) => {\n      e.preventDefault();\n      setDeferredPrompt(e as BeforeInstallPromptEvent);\n      setShowPrompt(true);\n    };\n\n    window.addEventListener(\"beforeinstallprompt\", handler);\n\n    if (isMobile() && !isIOS()) {\n      setTimeout(() => {\n        if (!deferredPrompt) {\n          setShowPrompt(true);\n        }\n      }, 5000);\n    }\n\n    return () => {\n      window.removeEventListener(\"beforeinstallprompt\", handler);\n    };\n  }, []);\n\n  const handleInstall = async () => {\n    if (!deferredPrompt) return;\n\n    await deferredPrompt.prompt();\n    const { outcome } = await deferredPrompt.userChoice;\n\n    if (outcome === \"accepted\") {\n      setIsInstalled(true);\n    }\n    setDeferredPrompt(null);\n    setShowPrompt(false);\n  };\n\n  const handleDismiss = () => {\n    localStorage.setItem(\"pwa-install-dismissed\", Date.now().toString());\n    setShowPrompt(false);\n    setShowIOSInstructions(false);\n  };\n\n  if (isInstalled || !showPrompt) {\n    return null;\n  }\n\n  if (showIOSInstructions) {\n    return (\n      <div className=\"fixed bottom-4 left-4 right-4 z-50 md:left-auto md:right-4 md:max-w-sm\">\n        <Card className=\"border-primary/20 shadow-lg\">\n          <CardHeader className=\"pb-2\">\n            <div className=\"flex items-start justify-between gap-2\">\n              <div className=\"flex items-center gap-2\">\n                <Smartphone className=\"h-5 w-5 text-primary\" />\n                <CardTitle className=\"text-base\">{t(\"pwa.title\", \"Instalar App\")}</CardTitle>\n              </div>\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                className=\"h-6 w-6 -mt-1 -mr-2\"\n                onClick={handleDismiss}\n                data-testid=\"button-pwa-dismiss\"\n              >\n                <X className=\"h-4 w-4\" />\n              </Button>\n            </div>\n            <CardDescription className=\"text-sm\">\n              {t(\"pwa.iosDescription\", \"Para instalar no iPhone/iPad:\")}\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"pt-2\">\n            <div className=\"space-y-3 text-sm\">\n              <div className=\"flex items-start gap-3\">\n                <div className=\"flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-primary/10 text-primary text-xs font-medium\">\n                  1\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <span>{t(\"pwa.iosStep1\", \"Toque em\")}</span>\n                  <Share className=\"h-4 w-4 text-primary\" />\n                  <span>{t(\"pwa.iosShareButton\", \"(Partilhar)\")}</span>\n                </div>\n              </div>\n              <div className=\"flex items-start gap-3\">\n                <div className=\"flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-primary/10 text-primary text-xs font-medium\">\n                  2\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <span>{t(\"pwa.iosStep2\", \"Escolha\")}</span>\n                  <Plus className=\"h-4 w-4 text-primary\" />\n                  <span>{t(\"pwa.iosAddToHome\", \"'Adicionar ao Ecr Inicial'\")}</span>\n                </div>\n              </div>\n              <div className=\"flex items-start gap-3\">\n                <div className=\"flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-primary/10 text-primary text-xs font-medium\">\n                  3\n                </div>\n                <span>{t(\"pwa.iosStep3\", \"Confirme tocando em 'Adicionar'\")}</span>\n              </div>\n            </div>\n            <Button\n              variant=\"outline\"\n              className=\"w-full mt-4\"\n              onClick={handleDismiss}\n              data-testid=\"button-pwa-understood\"\n            >\n              {t(\"pwa.understood\", \"Entendi\")}\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"fixed bottom-4 left-4 right-4 z-50 md:left-auto md:right-4 md:max-w-sm\">\n      <Card className=\"border-primary/20 shadow-lg\">\n        <CardHeader className=\"pb-2\">\n          <div className=\"flex items-start justify-between gap-2\">\n            <div className=\"flex items-center gap-2\">\n              <Smartphone className=\"h-5 w-5 text-primary\" />\n              <CardTitle className=\"text-base\">{t(\"pwa.title\", \"Instalar App\")}</CardTitle>\n            </div>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"h-6 w-6 -mt-1 -mr-2\"\n              onClick={handleDismiss}\n              data-testid=\"button-pwa-dismiss\"\n            >\n              <X className=\"h-4 w-4\" />\n            </Button>\n          </div>\n          <CardDescription className=\"text-sm\">\n            {t(\"pwa.description\", \"Instale o ConstructTrack no seu celular para acesso rpido\")}\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"pt-2\">\n          {deferredPrompt ? (\n            <Button\n              onClick={handleInstall}\n              className=\"w-full\"\n              data-testid=\"button-pwa-install\"\n            >\n              <Download className=\"h-4 w-4 mr-2\" />\n              {t(\"pwa.install\", \"Instalar\")}\n            </Button>\n          ) : (\n            <div className=\"text-sm text-muted-foreground text-center\">\n              {t(\"pwa.androidInstructions\", \"Use o menu do navegador e selecione 'Instalar app' ou 'Adicionar  tela inicial'\")}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":7324,"size_tokens":null},"client/public/sw.js":{"content":"const CACHE_NAME = 'constructtrack-v1';\nconst STATIC_CACHE = 'constructtrack-static-v1';\nconst DYNAMIC_CACHE = 'constructtrack-dynamic-v1';\n\nconst STATIC_ASSETS = [\n  '/',\n  '/manifest.json',\n  '/favicon.png'\n];\n\nself.addEventListener('install', (event) => {\n  event.waitUntil(\n    caches.open(STATIC_CACHE).then((cache) => {\n      return cache.addAll(STATIC_ASSETS);\n    })\n  );\n  self.skipWaiting();\n});\n\nself.addEventListener('activate', (event) => {\n  event.waitUntil(\n    caches.keys().then((cacheNames) => {\n      return Promise.all(\n        cacheNames\n          .filter((name) => name !== STATIC_CACHE && name !== DYNAMIC_CACHE)\n          .map((name) => caches.delete(name))\n      );\n    })\n  );\n  self.clients.claim();\n});\n\nself.addEventListener('fetch', (event) => {\n  const { request } = event;\n  const url = new URL(request.url);\n\n  if (request.method !== 'GET') {\n    return;\n  }\n\n  if (url.pathname.startsWith('/api/')) {\n    event.respondWith(\n      fetch(request)\n        .then((response) => {\n          return response;\n        })\n        .catch(() => {\n          return new Response(JSON.stringify({ error: 'Offline' }), {\n            status: 503,\n            headers: { 'Content-Type': 'application/json' }\n          });\n        })\n    );\n    return;\n  }\n\n  event.respondWith(\n    caches.match(request).then((cachedResponse) => {\n      if (cachedResponse) {\n        fetch(request).then((response) => {\n          if (response.ok) {\n            caches.open(DYNAMIC_CACHE).then((cache) => {\n              cache.put(request, response.clone());\n            });\n          }\n        });\n        return cachedResponse;\n      }\n\n      return fetch(request).then((response) => {\n        if (response.ok && url.origin === location.origin) {\n          const responseClone = response.clone();\n          caches.open(DYNAMIC_CACHE).then((cache) => {\n            cache.put(request, responseClone);\n          });\n        }\n        return response;\n      }).catch(() => {\n        if (request.headers.get('accept')?.includes('text/html')) {\n          return caches.match('/');\n        }\n        return new Response('Offline', { status: 503 });\n      });\n    })\n  );\n});\n\nself.addEventListener('push', (event) => {\n  if (event.data) {\n    const data = event.data.json();\n    const options = {\n      body: data.body || 'Nova notificao',\n      icon: '/icons/icon-192x192.png',\n      badge: '/icons/icon-72x72.png',\n      vibrate: [100, 50, 100],\n      data: {\n        dateOfArrival: Date.now(),\n        primaryKey: data.primaryKey || 1\n      },\n      actions: data.actions || []\n    };\n    event.waitUntil(\n      self.registration.showNotification(data.title || 'ConstructTrack', options)\n    );\n  }\n});\n\nself.addEventListener('notificationclick', (event) => {\n  event.notification.close();\n  event.waitUntil(\n    clients.matchAll({ type: 'window' }).then((clientList) => {\n      for (const client of clientList) {\n        if (client.url === '/' && 'focus' in client) {\n          return client.focus();\n        }\n      }\n      if (clients.openWindow) {\n        return clients.openWindow('/');\n      }\n    })\n  );\n});\n","path":null,"size_bytes":3117,"size_tokens":null},"client/src/pages/admin/LeaveApprovals.tsx":{"content":"import { useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { ManagerGuard } from \"@/components/RoleGuard\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format } from \"date-fns\";\nimport { \n  Clock, \n  Search, \n  CheckCircle, \n  XCircle,\n  Eye,\n  Calendar,\n  CalendarCheck,\n  CalendarX,\n  Users,\n  Briefcase,\n  Heart,\n  User as UserIcon,\n  DollarSign\n} from \"lucide-react\";\nimport type { LeaveRequest, User } from \"@shared/schema\";\n\nfunction LeaveApprovalsContent() {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\");\n  const [typeFilter, setTypeFilter] = useState<string>(\"all\");\n  const [viewingRequest, setViewingRequest] = useState<LeaveRequest | null>(null);\n  const [rejectingRequest, setRejectingRequest] = useState<LeaveRequest | null>(null);\n  const [rejectReason, setRejectReason] = useState(\"\");\n\n  const { data: leaveRequests = [], isLoading } = useQuery<LeaveRequest[]>({\n    queryKey: [\"/api/leave-requests/team\"],\n  });\n\n  const { data: users = [] } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const approveMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest(\"PATCH\", `/api/leave-requests/${id}/approve`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/leave-requests/team\"] });\n      toast({ title: \"Success\", description: \"Leave request approved\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"Error\", description: \"Failed to approve request\" });\n    },\n  });\n\n  const rejectMutation = useMutation({\n    mutationFn: async ({ id, reason }: { id: string; reason: string }) => {\n      return apiRequest(\"PATCH\", `/api/leave-requests/${id}/reject`, { reason });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/leave-requests/team\"] });\n      setRejectingRequest(null);\n      setRejectReason(\"\");\n      toast({ title: \"Success\", description: \"Leave request rejected\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"Error\", description: \"Failed to reject request\" });\n    },\n  });\n\n  const filteredRequests = leaveRequests.filter((request) => {\n    const user = users.find(u => u.id === request.userId);\n    const userName = user ? `${user.firstName} ${user.lastName}`.toLowerCase() : \"\";\n    \n    const matchesSearch = \n      userName.includes(searchTerm.toLowerCase()) ||\n      (request.reason?.toLowerCase().includes(searchTerm.toLowerCase()) || false);\n    const matchesStatus = statusFilter === \"all\" || request.status === statusFilter;\n    const matchesType = typeFilter === \"all\" || request.type === typeFilter;\n    return matchesSearch && matchesStatus && matchesType;\n  });\n\n  const sortedRequests = [...filteredRequests].sort((a, b) => \n    new Date(b.startDate).getTime() - new Date(a.startDate).getTime()\n  );\n\n  const getUserName = (userId: string | null) => {\n    if (!userId) return \"-\";\n    const user = users.find(u => u.id === userId);\n    return user ? `${user.firstName} ${user.lastName}` : userId;\n  };\n\n  const getStatusBadge = (status: string | null) => {\n    switch (status) {\n      case \"approved\":\n        return <Badge variant=\"default\" className=\"bg-green-600\"><CheckCircle className=\"w-3 h-3 mr-1\" />Approved</Badge>;\n      case \"rejected\":\n        return <Badge variant=\"destructive\"><XCircle className=\"w-3 h-3 mr-1\" />Rejected</Badge>;\n      case \"cancelled\":\n        return <Badge variant=\"outline\"><CalendarX className=\"w-3 h-3 mr-1\" />Cancelled</Badge>;\n      case \"pending\":\n      default:\n        return <Badge variant=\"secondary\"><Clock className=\"w-3 h-3 mr-1\" />Pending</Badge>;\n    }\n  };\n\n  const getTypeBadge = (type: string | null) => {\n    switch (type) {\n      case \"vacation\":\n        return <Badge variant=\"outline\" className=\"border-blue-500 text-blue-600\"><Briefcase className=\"w-3 h-3 mr-1\" />Vacation</Badge>;\n      case \"sick\":\n        return <Badge variant=\"outline\" className=\"border-red-500 text-red-600\"><Heart className=\"w-3 h-3 mr-1\" />Sick</Badge>;\n      case \"personal\":\n        return <Badge variant=\"outline\" className=\"border-purple-500 text-purple-600\"><UserIcon className=\"w-3 h-3 mr-1\" />Personal</Badge>;\n      case \"unpaid\":\n        return <Badge variant=\"outline\" className=\"border-gray-500 text-gray-600\"><DollarSign className=\"w-3 h-3 mr-1\" />Unpaid</Badge>;\n      default:\n        return <Badge variant=\"outline\">{type}</Badge>;\n    }\n  };\n\n  const formatDate = (date: string | Date | null) => {\n    if (!date) return \"-\";\n    return format(new Date(date), \"dd/MM/yyyy\");\n  };\n\n  const requestStats = {\n    total: leaveRequests.length,\n    pending: leaveRequests.filter(r => r.status === \"pending\").length,\n    approved: leaveRequests.filter(r => r.status === \"approved\").length,\n    rejected: leaveRequests.filter(r => r.status === \"rejected\").length,\n    totalDays: leaveRequests.filter(r => r.status === \"approved\").reduce((sum, r) => sum + (r.daysCount || 1), 0),\n  };\n\n  const handleApprove = (request: LeaveRequest) => {\n    approveMutation.mutate(request.id);\n  };\n\n  const handleReject = () => {\n    if (rejectingRequest) {\n      rejectMutation.mutate({ id: rejectingRequest.id, reason: rejectReason });\n    }\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex flex-wrap items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-bold\" data-testid=\"text-page-title\">{t(\"admin.leaveApprovals\")}</h1>\n          <p className=\"text-muted-foreground\">\n            Review and approve employee leave and absence requests\n          </p>\n        </div>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-5\">\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-2\">\n              <Calendar className=\"w-8 h-8 text-muted-foreground\" />\n              <div>\n                <p className=\"text-2xl font-bold\" data-testid=\"text-total-requests\">{requestStats.total}</p>\n                <p className=\"text-sm text-muted-foreground\">Total Requests</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-2\">\n              <Clock className=\"w-8 h-8 text-yellow-600\" />\n              <div>\n                <p className=\"text-2xl font-bold\" data-testid=\"text-pending-count\">{requestStats.pending}</p>\n                <p className=\"text-sm text-muted-foreground\">Pending</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-2\">\n              <CheckCircle className=\"w-8 h-8 text-green-600\" />\n              <div>\n                <p className=\"text-2xl font-bold\" data-testid=\"text-approved-count\">{requestStats.approved}</p>\n                <p className=\"text-sm text-muted-foreground\">Approved</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-2\">\n              <XCircle className=\"w-8 h-8 text-red-600\" />\n              <div>\n                <p className=\"text-2xl font-bold\" data-testid=\"text-rejected-count\">{requestStats.rejected}</p>\n                <p className=\"text-sm text-muted-foreground\">Rejected</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-2\">\n              <CalendarCheck className=\"w-8 h-8 text-blue-600\" />\n              <div>\n                <p className=\"text-2xl font-bold\" data-testid=\"text-total-days\">{requestStats.totalDays}</p>\n                <p className=\"text-sm text-muted-foreground\">Days Approved</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader className=\"flex flex-row items-center justify-between gap-4 space-y-0 pb-4\">\n          <div className=\"flex flex-wrap items-center gap-4\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4\" />\n              <Input\n                placeholder=\"Search by employee or reason...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10 w-64\"\n                data-testid=\"input-search-requests\"\n              />\n            </div>\n            <Select value={statusFilter} onValueChange={setStatusFilter}>\n              <SelectTrigger className=\"w-40\" data-testid=\"select-status-filter\">\n                <SelectValue placeholder=\"Filter by status\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All Status</SelectItem>\n                <SelectItem value=\"pending\">Pending</SelectItem>\n                <SelectItem value=\"approved\">Approved</SelectItem>\n                <SelectItem value=\"rejected\">Rejected</SelectItem>\n                <SelectItem value=\"cancelled\">Cancelled</SelectItem>\n              </SelectContent>\n            </Select>\n            <Select value={typeFilter} onValueChange={setTypeFilter}>\n              <SelectTrigger className=\"w-40\" data-testid=\"select-type-filter\">\n                <SelectValue placeholder=\"Filter by type\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All Types</SelectItem>\n                <SelectItem value=\"vacation\">Vacation</SelectItem>\n                <SelectItem value=\"sick\">Sick</SelectItem>\n                <SelectItem value=\"personal\">Personal</SelectItem>\n                <SelectItem value=\"unpaid\">Unpaid</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"text-center py-8 text-muted-foreground\">Loading leave requests...</div>\n          ) : sortedRequests.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              {searchTerm || statusFilter !== \"all\" || typeFilter !== \"all\" \n                ? \"No requests match your filters\" \n                : \"No leave requests found.\"}\n            </div>\n          ) : (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Employee</TableHead>\n                  <TableHead>Type</TableHead>\n                  <TableHead>Start Date</TableHead>\n                  <TableHead>End Date</TableHead>\n                  <TableHead>Days</TableHead>\n                  <TableHead>Paid</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead className=\"text-right\">Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {sortedRequests.map((request) => (\n                  <TableRow key={request.id} data-testid={`row-request-${request.id}`}>\n                    <TableCell className=\"font-medium\">\n                      <div className=\"flex items-center gap-2\">\n                        <Users className=\"w-4 h-4 text-muted-foreground\" />\n                        {getUserName(request.userId)}\n                      </div>\n                    </TableCell>\n                    <TableCell>{getTypeBadge(request.type)}</TableCell>\n                    <TableCell>{formatDate(request.startDate)}</TableCell>\n                    <TableCell>{formatDate(request.endDate)}</TableCell>\n                    <TableCell>\n                      <span className=\"font-medium\">{request.daysCount || 1}</span>\n                      {request.isPartialDay && (\n                        <Badge variant=\"outline\" className=\"ml-1 text-xs\">Partial</Badge>\n                      )}\n                    </TableCell>\n                    <TableCell>\n                      {request.isPaid ? (\n                        <Badge variant=\"outline\" className=\"border-green-500 text-green-600\">Paid</Badge>\n                      ) : (\n                        <Badge variant=\"outline\" className=\"border-gray-500 text-gray-600\">Unpaid</Badge>\n                      )}\n                    </TableCell>\n                    <TableCell>{getStatusBadge(request.status)}</TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center justify-end gap-1\">\n                        <Button\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          onClick={() => setViewingRequest(request)}\n                          data-testid={`button-view-${request.id}`}\n                        >\n                          <Eye className=\"w-4 h-4\" />\n                        </Button>\n                        {request.status === \"pending\" && (\n                          <>\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              className=\"text-green-600\"\n                              onClick={() => handleApprove(request)}\n                              disabled={approveMutation.isPending}\n                              data-testid={`button-approve-${request.id}`}\n                            >\n                              <CheckCircle className=\"w-4 h-4 mr-1\" />\n                              Approve\n                            </Button>\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              className=\"text-red-600\"\n                              onClick={() => setRejectingRequest(request)}\n                              data-testid={`button-reject-${request.id}`}\n                            >\n                              <XCircle className=\"w-4 h-4 mr-1\" />\n                              Reject\n                            </Button>\n                          </>\n                        )}\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          )}\n        </CardContent>\n      </Card>\n\n      <Dialog open={!!viewingRequest} onOpenChange={(open) => !open && setViewingRequest(null)}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>Leave Request Details</DialogTitle>\n            <DialogDescription>\n              View detailed information about this leave request\n            </DialogDescription>\n          </DialogHeader>\n          {viewingRequest && (\n            <div className=\"space-y-6\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-1\">\n                  <p className=\"text-sm text-muted-foreground flex items-center gap-1\">\n                    <Users className=\"w-4 h-4\" />Employee\n                  </p>\n                  <p className=\"font-medium\" data-testid=\"text-detail-employee\">\n                    {getUserName(viewingRequest.userId)}\n                  </p>\n                </div>\n                <div className=\"space-y-1\">\n                  <p className=\"text-sm text-muted-foreground\">Type</p>\n                  <div data-testid=\"text-detail-type\">\n                    {getTypeBadge(viewingRequest.type)}\n                  </div>\n                </div>\n                <div className=\"space-y-1\">\n                  <p className=\"text-sm text-muted-foreground flex items-center gap-1\">\n                    <Calendar className=\"w-4 h-4\" />Start Date\n                  </p>\n                  <p className=\"font-medium\" data-testid=\"text-detail-start-date\">\n                    {formatDate(viewingRequest.startDate)}\n                  </p>\n                </div>\n                <div className=\"space-y-1\">\n                  <p className=\"text-sm text-muted-foreground flex items-center gap-1\">\n                    <Calendar className=\"w-4 h-4\" />End Date\n                  </p>\n                  <p className=\"font-medium\" data-testid=\"text-detail-end-date\">\n                    {formatDate(viewingRequest.endDate)}\n                  </p>\n                </div>\n                <div className=\"space-y-1\">\n                  <p className=\"text-sm text-muted-foreground\">Status</p>\n                  <div data-testid=\"text-detail-status\">\n                    {getStatusBadge(viewingRequest.status)}\n                  </div>\n                </div>\n                <div className=\"space-y-1\">\n                  <p className=\"text-sm text-muted-foreground\">Duration</p>\n                  <p className=\"font-medium\" data-testid=\"text-detail-days\">\n                    {viewingRequest.daysCount || 1} day{(viewingRequest.daysCount || 1) > 1 ? 's' : ''}\n                    {viewingRequest.isPartialDay && ' (Partial)'}\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4 pt-4 border-t\">\n                <div className=\"space-y-1\">\n                  <p className=\"text-sm text-muted-foreground\">Payment Status</p>\n                  <p className=\"font-medium\" data-testid=\"text-detail-paid\">\n                    {viewingRequest.isPaid ? 'Paid Leave' : 'Unpaid Leave'}\n                  </p>\n                </div>\n                <div className=\"space-y-1\">\n                  <p className=\"text-sm text-muted-foreground\">Submitted</p>\n                  <p className=\"font-medium\" data-testid=\"text-detail-created\">\n                    {viewingRequest.createdAt ? formatDate(viewingRequest.createdAt) : '-'}\n                  </p>\n                </div>\n              </div>\n\n              {viewingRequest.reason && (\n                <div className=\"pt-4 border-t\">\n                  <p className=\"text-sm text-muted-foreground mb-1\">Reason</p>\n                  <p className=\"text-sm bg-muted p-3 rounded-md\" data-testid=\"text-detail-reason\">{viewingRequest.reason}</p>\n                </div>\n              )}\n\n              {viewingRequest.approvedBy && (\n                <div className=\"pt-4 border-t\">\n                  <p className=\"text-sm text-muted-foreground\">\n                    {viewingRequest.status === \"approved\" ? \"Approved\" : \"Reviewed\"} by {getUserName(viewingRequest.approvedBy)}\n                    {viewingRequest.approvedAt && ` on ${formatDate(viewingRequest.approvedAt)}`}\n                  </p>\n                </div>\n              )}\n            </div>\n          )}\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setViewingRequest(null)} data-testid=\"button-close-detail\">\n              Close\n            </Button>\n            {viewingRequest?.status === \"pending\" && (\n              <>\n                <Button\n                  variant=\"outline\"\n                  className=\"text-red-600\"\n                  onClick={() => {\n                    setViewingRequest(null);\n                    setRejectingRequest(viewingRequest);\n                  }}\n                  data-testid=\"button-detail-reject\"\n                >\n                  <XCircle className=\"w-4 h-4 mr-1\" />\n                  Reject\n                </Button>\n                <Button\n                  className=\"bg-green-600\"\n                  onClick={() => {\n                    handleApprove(viewingRequest);\n                    setViewingRequest(null);\n                  }}\n                  disabled={approveMutation.isPending}\n                  data-testid=\"button-detail-approve\"\n                >\n                  <CheckCircle className=\"w-4 h-4 mr-1\" />\n                  Approve\n                </Button>\n              </>\n            )}\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={!!rejectingRequest} onOpenChange={(open) => !open && setRejectingRequest(null)}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Reject Leave Request</DialogTitle>\n            <DialogDescription>\n              Provide a reason for rejecting {rejectingRequest ? getUserName(rejectingRequest.userId) : \"\"}'s leave request\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <Textarea\n              placeholder=\"Enter rejection reason (optional)...\"\n              value={rejectReason}\n              onChange={(e) => setRejectReason(e.target.value)}\n              rows={3}\n              data-testid=\"input-reject-reason\"\n            />\n          </div>\n          <DialogFooter>\n            <Button \n              variant=\"outline\" \n              onClick={() => {\n                setRejectingRequest(null);\n                setRejectReason(\"\");\n              }}\n              data-testid=\"button-cancel-reject\"\n            >\n              Cancel\n            </Button>\n            <Button\n              variant=\"destructive\"\n              onClick={handleReject}\n              disabled={rejectMutation.isPending}\n              data-testid=\"button-confirm-reject\"\n            >\n              {rejectMutation.isPending ? \"Rejecting...\" : \"Reject Request\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n\nexport default function LeaveApprovals() {\n  return (\n    <ManagerGuard>\n      <LeaveApprovalsContent />\n    </ManagerGuard>\n  );\n}\n","path":null,"size_bytes":22363,"size_tokens":null},"client/src/pages/superadmin/Subscriptions.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { SuperAdminGuard } from \"@/components/RoleGuard\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  CreditCard,\n  Building2,\n  Users,\n  TrendingUp,\n  CheckCircle,\n  Clock,\n  XCircle,\n  Shield,\n} from \"lucide-react\";\n\ninterface PlatformStats {\n  totalTenants: number;\n  activeTenants: number;\n  trialTenants: number;\n  suspendedTenants: number;\n  totalUsers: number;\n  usersByRole: {\n    superadmin: number;\n    admin: number;\n    manager: number;\n    employee: number;\n    client: number;\n  };\n  subscriptionsByPlan: {\n    starter: number;\n    professional: number;\n    enterprise: number;\n  };\n}\n\nfunction SubscriptionsContent() {\n  const { t } = useTranslation();\n\n  const { data: stats, isLoading } = useQuery<PlatformStats>({\n    queryKey: [\"/api/superadmin/stats\"],\n  });\n\n  const statCards = [\n    {\n      title: \"Total Tenants\",\n      value: stats?.totalTenants || 0,\n      icon: Building2,\n      description: \"Registered companies\",\n      color: \"text-blue-600\",\n    },\n    {\n      title: \"Active Subscriptions\",\n      value: stats?.activeTenants || 0,\n      icon: CheckCircle,\n      description: \"Paying customers\",\n      color: \"text-green-600\",\n    },\n    {\n      title: \"Trial Accounts\",\n      value: stats?.trialTenants || 0,\n      icon: Clock,\n      description: \"In trial period\",\n      color: \"text-amber-600\",\n    },\n    {\n      title: \"Suspended\",\n      value: stats?.suspendedTenants || 0,\n      icon: XCircle,\n      description: \"Suspended or cancelled\",\n      color: \"text-red-600\",\n    },\n  ];\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div>\n        <h1 className=\"text-2xl font-bold flex items-center gap-2\">\n          <CreditCard className=\"h-6 w-6\" />\n          {t(\"admin.subscriptions\")}\n        </h1>\n        <p className=\"text-muted-foreground\">\n          Platform-wide subscription analytics and management\n        </p>\n      </div>\n\n      {isLoading ? (\n        <div className=\"text-center py-8 text-muted-foreground\">Loading statistics...</div>\n      ) : (\n        <>\n          <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n            {statCards.map((stat) => (\n              <Card key={stat.title} data-testid={`card-stat-${stat.title.toLowerCase().replace(/\\s/g, \"-\")}`}>\n                <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">{stat.title}</CardTitle>\n                  <stat.icon className={`h-4 w-4 ${stat.color}`} />\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">{stat.value}</div>\n                  <p className=\"text-xs text-muted-foreground\">{stat.description}</p>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n\n          <div className=\"grid gap-4 md:grid-cols-2\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <TrendingUp className=\"h-5 w-5\" />\n                  Subscriptions by Plan\n                </CardTitle>\n                <CardDescription>Distribution of subscription tiers</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-2\">\n                      <Badge variant=\"outline\">Starter</Badge>\n                      <span className=\"text-sm text-muted-foreground\">Basic features</span>\n                    </div>\n                    <span className=\"font-bold\">{stats?.subscriptionsByPlan.starter || 0}</span>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-2\">\n                      <Badge variant=\"secondary\">Professional</Badge>\n                      <span className=\"text-sm text-muted-foreground\">Advanced features</span>\n                    </div>\n                    <span className=\"font-bold\">{stats?.subscriptionsByPlan.professional || 0}</span>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-2\">\n                      <Badge variant=\"default\">Enterprise</Badge>\n                      <span className=\"text-sm text-muted-foreground\">Full platform access</span>\n                    </div>\n                    <span className=\"font-bold\">{stats?.subscriptionsByPlan.enterprise || 0}</span>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Users className=\"h-5 w-5\" />\n                  Users by Role\n                </CardTitle>\n                <CardDescription>Platform-wide user distribution</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-2\">\n                      <Shield className=\"h-4 w-4 text-purple-600\" />\n                      <span>Superadmins</span>\n                    </div>\n                    <span className=\"font-bold\">{stats?.usersByRole.superadmin || 0}</span>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-2\">\n                      <Badge variant=\"default\" className=\"text-xs\">Admin</Badge>\n                      <span>Tenant Admins</span>\n                    </div>\n                    <span className=\"font-bold\">{stats?.usersByRole.admin || 0}</span>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-2\">\n                      <Badge variant=\"secondary\" className=\"text-xs\">Manager</Badge>\n                      <span>Managers</span>\n                    </div>\n                    <span className=\"font-bold\">{stats?.usersByRole.manager || 0}</span>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-2\">\n                      <Badge variant=\"outline\" className=\"text-xs\">Employee</Badge>\n                      <span>Employees</span>\n                    </div>\n                    <span className=\"font-bold\">{stats?.usersByRole.employee || 0}</span>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-2\">\n                      <Badge variant=\"outline\" className=\"text-xs\">Client</Badge>\n                      <span>Clients</span>\n                    </div>\n                    <span className=\"font-bold\">{stats?.usersByRole.client || 0}</span>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Total Platform Users</CardTitle>\n              <CardDescription>All users across all tenants</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"flex items-center gap-4\">\n                <Users className=\"h-12 w-12 text-muted-foreground\" />\n                <div>\n                  <div className=\"text-4xl font-bold\">{stats?.totalUsers || 0}</div>\n                  <p className=\"text-muted-foreground\">registered users on the platform</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default function Subscriptions() {\n  return (\n    <SuperAdminGuard>\n      <SubscriptionsContent />\n    </SuperAdminGuard>\n  );\n}\n","path":null,"size_bytes":8195,"size_tokens":null},"client/src/pages/admin/SiteManagement.tsx":{"content":"import { useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { ManagerGuard } from \"@/components/RoleGuard\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage, FormDescription } from \"@/components/ui/form\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Building, Search, Pencil, MapPin, Clock, DollarSign, Users, Plus, Trash2 } from \"lucide-react\";\nimport type { Site, Client, User, SiteAssignment } from \"@shared/schema\";\n\nconst siteFormSchema = z.object({\n  name: z.string().min(1, \"Site name is required\"),\n  address: z.string().min(1, \"Address is required\"),\n  clientId: z.string().min(1, \"Client is required\"),\n  latitude: z.string().optional(),\n  longitude: z.string().optional(),\n  geofenceRadius: z.coerce.number().min(10).max(1000).default(100),\n  workStartTime: z.string().default(\"08:00\"),\n  workEndTime: z.string().default(\"17:00\"),\n  billingType: z.enum([\"hourly\", \"daily\", \"fixed\"]).default(\"hourly\"),\n  hourlyRate: z.string().optional(),\n  status: z.enum([\"active\", \"completed\", \"paused\"]).default(\"active\"),\n});\n\ntype SiteFormData = z.infer<typeof siteFormSchema>;\n\nconst assignmentSchema = z.object({\n  userId: z.string().min(1, \"Employee is required\"),\n  role: z.enum([\"worker\", \"supervisor\"]).default(\"worker\"),\n});\n\ntype AssignmentFormData = z.infer<typeof assignmentSchema>;\n\nfunction SiteManagementContent() {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\");\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n  const [editingSite, setEditingSite] = useState<Site | null>(null);\n  const [assigningSite, setAssigningSite] = useState<Site | null>(null);\n  const [deletingSite, setDeletingSite] = useState<Site | null>(null);\n\n  const { data: sites = [], isLoading } = useQuery<Site[]>({\n    queryKey: [\"/api/sites\"],\n  });\n\n  const { data: clients = [] } = useQuery<Client[]>({\n    queryKey: [\"/api/clients\"],\n  });\n\n  const { data: users = [] } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const { data: assignments = [] } = useQuery<SiteAssignment[]>({\n    queryKey: [\"/api/sites\", assigningSite?.id, \"assignments\"],\n    enabled: !!assigningSite,\n  });\n\n  const form = useForm<SiteFormData>({\n    resolver: zodResolver(siteFormSchema),\n    defaultValues: {\n      name: \"\",\n      address: \"\",\n      clientId: \"\",\n      latitude: \"\",\n      longitude: \"\",\n      geofenceRadius: 100,\n      workStartTime: \"08:00\",\n      workEndTime: \"17:00\",\n      billingType: \"hourly\",\n      hourlyRate: \"\",\n      status: \"active\",\n    },\n  });\n\n  const assignmentForm = useForm<AssignmentFormData>({\n    resolver: zodResolver(assignmentSchema),\n    defaultValues: {\n      userId: \"\",\n      role: \"worker\",\n    },\n  });\n\n  const createSiteMutation = useMutation({\n    mutationFn: async (data: SiteFormData) => {\n      return apiRequest(\"POST\", \"/api/sites\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/sites\"] });\n      setIsAddDialogOpen(false);\n      form.reset();\n      toast({ title: t(\"common.save\"), description: \"Site created successfully\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"Error\", description: \"Failed to create site\" });\n    },\n  });\n\n  const updateSiteMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<SiteFormData> }) => {\n      return apiRequest(\"PATCH\", `/api/sites/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/sites\"] });\n      setEditingSite(null);\n      form.reset();\n      toast({ title: t(\"common.save\"), description: \"Site updated successfully\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"Error\", description: \"Failed to update site\" });\n    },\n  });\n\n  const createAssignmentMutation = useMutation({\n    mutationFn: async (data: AssignmentFormData & { siteId: string }) => {\n      return apiRequest(\"POST\", \"/api/site-assignments\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/sites\", assigningSite?.id, \"assignments\"] });\n      assignmentForm.reset();\n      toast({ title: t(\"common.save\"), description: \"Worker assigned successfully\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"Error\", description: \"Failed to assign worker\" });\n    },\n  });\n\n  const deleteSiteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest(\"DELETE\", `/api/sites/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/sites\"] });\n      setDeletingSite(null);\n      toast({ title: t(\"common.delete\"), description: \"Site deleted successfully\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"Error\", description: \"Failed to delete site\" });\n    },\n  });\n\n  const filteredSites = sites.filter((site) => {\n    const matchesSearch =\n      site.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      site.address.toLowerCase().includes(searchTerm.toLowerCase());\n    const matchesStatus = statusFilter === \"all\" || site.status === statusFilter;\n    return matchesSearch && matchesStatus;\n  });\n\n  const handleSubmit = (data: SiteFormData) => {\n    if (editingSite) {\n      updateSiteMutation.mutate({ id: editingSite.id, data });\n    } else {\n      createSiteMutation.mutate(data);\n    }\n  };\n\n  const handleEdit = (site: Site) => {\n    setEditingSite(site);\n    form.reset({\n      name: site.name,\n      address: site.address,\n      clientId: site.clientId,\n      latitude: site.latitude || \"\",\n      longitude: site.longitude || \"\",\n      geofenceRadius: site.geofenceRadius || 100,\n      workStartTime: site.workStartTime || \"08:00\",\n      workEndTime: site.workEndTime || \"17:00\",\n      billingType: (site.billingType as \"hourly\" | \"daily\" | \"fixed\") || \"hourly\",\n      hourlyRate: site.hourlyRate || \"\",\n      status: (site.status as \"active\" | \"completed\" | \"paused\") || \"active\",\n    });\n  };\n\n  const handleAssignWorker = (data: AssignmentFormData) => {\n    if (!assigningSite) return;\n    createAssignmentMutation.mutate({ ...data, siteId: assigningSite.id });\n  };\n\n  const getStatusBadgeVariant = (status: string) => {\n    switch (status) {\n      case \"active\": return \"default\";\n      case \"completed\": return \"secondary\";\n      case \"paused\": return \"outline\";\n      default: return \"secondary\";\n    }\n  };\n\n  const getBillingTypeLabel = (type: string) => {\n    switch (type) {\n      case \"hourly\": return \"Per Hour\";\n      case \"daily\": return \"Per Day\";\n      case \"fixed\": return \"Fixed Price\";\n      default: return type;\n    }\n  };\n\n  const getClientName = (clientId: string) => {\n    const client = clients.find(c => c.id === clientId);\n    return client?.name || \"Unknown\";\n  };\n\n  const employees = users.filter(u => u.role === \"employee\" || u.role === \"manager\");\n\n  const assignedUserIds = assignments.map(a => a.userId);\n  const availableEmployees = employees.filter(e => !assignedUserIds.includes(e.id));\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-bold\">{t(\"admin.siteManagement\")}</h1>\n          <p className=\"text-muted-foreground\">\n            Manage construction sites, configure billing and worker assignments\n          </p>\n        </div>\n        <Dialog open={isAddDialogOpen || !!editingSite} onOpenChange={(open) => {\n          if (!open) {\n            setIsAddDialogOpen(false);\n            setEditingSite(null);\n            form.reset();\n          }\n        }}>\n          <DialogTrigger asChild>\n            <Button onClick={() => setIsAddDialogOpen(true)} data-testid=\"button-add-site\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add Site\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>\n                {editingSite ? \"Edit Site\" : \"Add New Site\"}\n              </DialogTitle>\n              <DialogDescription>\n                {editingSite ? \"Update site configuration\" : \"Create a new construction site\"}\n              </DialogDescription>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(handleSubmit)} className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"name\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Site Name</FormLabel>\n                      <FormControl>\n                        <Input {...field} placeholder=\"e.g. Downtown Office Building\" data-testid=\"input-site-name\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"clientId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Client</FormLabel>\n                      <Select onValueChange={field.onChange} value={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-client\">\n                            <SelectValue placeholder=\"Select a client\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {clients.map((client) => (\n                            <SelectItem key={client.id} value={client.id}>\n                              {client.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"address\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Address</FormLabel>\n                      <FormControl>\n                        <Input {...field} placeholder=\"Full site address\" data-testid=\"input-address\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"latitude\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Latitude</FormLabel>\n                        <FormControl>\n                          <Input {...field} placeholder=\"e.g. 52.3676\" data-testid=\"input-latitude\" />\n                        </FormControl>\n                        <FormDescription>For GPS geofencing</FormDescription>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"longitude\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Longitude</FormLabel>\n                        <FormControl>\n                          <Input {...field} placeholder=\"e.g. 4.9041\" data-testid=\"input-longitude\" />\n                        </FormControl>\n                        <FormDescription>For GPS geofencing</FormDescription>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"geofenceRadius\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Geofence Radius (meters)</FormLabel>\n                      <FormControl>\n                        <Input type=\"number\" {...field} data-testid=\"input-geofence-radius\" />\n                      </FormControl>\n                      <FormDescription>Maximum distance from site center for valid check-ins</FormDescription>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"workStartTime\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Work Start Time</FormLabel>\n                        <FormControl>\n                          <Input type=\"time\" {...field} data-testid=\"input-work-start\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"workEndTime\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Work End Time</FormLabel>\n                        <FormControl>\n                          <Input type=\"time\" {...field} data-testid=\"input-work-end\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"billingType\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Billing Type</FormLabel>\n                        <Select onValueChange={field.onChange} value={field.value}>\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-billing-type\">\n                              <SelectValue />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            <SelectItem value=\"hourly\">Per Hour</SelectItem>\n                            <SelectItem value=\"daily\">Per Day</SelectItem>\n                            <SelectItem value=\"fixed\">Fixed Price</SelectItem>\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"hourlyRate\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Rate</FormLabel>\n                        <FormControl>\n                          <Input type=\"number\" step=\"0.01\" {...field} placeholder=\"0.00\" data-testid=\"input-rate\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"status\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Status</FormLabel>\n                      <Select onValueChange={field.onChange} value={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-status\">\n                            <SelectValue />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"active\">Active</SelectItem>\n                          <SelectItem value=\"paused\">Paused</SelectItem>\n                          <SelectItem value=\"completed\">Completed</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <DialogFooter>\n                  <Button type=\"submit\" disabled={createSiteMutation.isPending || updateSiteMutation.isPending} data-testid=\"button-save-site\">\n                    {t(\"common.save\")}\n                  </Button>\n                </DialogFooter>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <Dialog open={!!assigningSite} onOpenChange={(open) => {\n        if (!open) {\n          setAssigningSite(null);\n          assignmentForm.reset();\n        }\n      }}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Assign Workers to {assigningSite?.name}</DialogTitle>\n            <DialogDescription>\n              Assign employees to work at this construction site\n            </DialogDescription>\n          </DialogHeader>\n          \n          {assignments.length > 0 && (\n            <div className=\"space-y-2\">\n              <h4 className=\"text-sm font-medium\">Currently Assigned</h4>\n              <div className=\"flex flex-wrap gap-2\">\n                {assignments.map((assignment) => {\n                  const user = users.find(u => u.id === assignment.userId);\n                  return (\n                    <Badge key={assignment.id} variant=\"secondary\">\n                      {user?.firstName} {user?.lastName}\n                      {assignment.role === \"supervisor\" && \" (Supervisor)\"}\n                    </Badge>\n                  );\n                })}\n              </div>\n            </div>\n          )}\n\n          <Form {...assignmentForm}>\n            <form onSubmit={assignmentForm.handleSubmit(handleAssignWorker)} className=\"space-y-4\">\n              <FormField\n                control={assignmentForm.control}\n                name=\"userId\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Employee</FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-employee\">\n                          <SelectValue placeholder=\"Select an employee\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {availableEmployees.map((employee) => (\n                          <SelectItem key={employee.id} value={employee.id}>\n                            {employee.firstName} {employee.lastName} ({employee.role})\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={assignmentForm.control}\n                name=\"role\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Role at Site</FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-assignment-role\">\n                          <SelectValue />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"worker\">Worker</SelectItem>\n                        <SelectItem value=\"supervisor\">Supervisor</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <DialogFooter>\n                <Button type=\"submit\" disabled={createAssignmentMutation.isPending || availableEmployees.length === 0} data-testid=\"button-assign-worker\">\n                  Assign Worker\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center gap-4 flex-wrap\">\n            <div className=\"relative flex-1 min-w-[200px]\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n              <Input\n                placeholder={t(\"common.search\")}\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-9\"\n                data-testid=\"input-search-sites\"\n              />\n            </div>\n            <Select value={statusFilter} onValueChange={setStatusFilter}>\n              <SelectTrigger className=\"w-[150px]\" data-testid=\"select-status-filter\">\n                <SelectValue placeholder=\"Filter by status\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All Status</SelectItem>\n                <SelectItem value=\"active\">Active</SelectItem>\n                <SelectItem value=\"paused\">Paused</SelectItem>\n                <SelectItem value=\"completed\">Completed</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex items-center justify-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\" />\n            </div>\n          ) : filteredSites.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              <Building className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n              <p>No sites found</p>\n              <p className=\"text-sm\">Create your first construction site to get started</p>\n            </div>\n          ) : (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Site</TableHead>\n                  <TableHead>Client</TableHead>\n                  <TableHead>Work Hours</TableHead>\n                  <TableHead>Billing</TableHead>\n                  <TableHead>{t(\"common.status\")}</TableHead>\n                  <TableHead className=\"text-right\">{t(\"common.actions\")}</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {filteredSites.map((site) => (\n                  <TableRow key={site.id} data-testid={`row-site-${site.id}`}>\n                    <TableCell>\n                      <div className=\"space-y-1\">\n                        <div className=\"flex items-center gap-2\">\n                          <Building className=\"h-4 w-4 text-muted-foreground\" />\n                          <span className=\"font-medium\">{site.name}</span>\n                        </div>\n                        <div className=\"flex items-center gap-1 text-sm text-muted-foreground\">\n                          <MapPin className=\"h-3 w-3\" />\n                          <span className=\"truncate max-w-[200px]\">{site.address}</span>\n                        </div>\n                      </div>\n                    </TableCell>\n                    <TableCell>{getClientName(site.clientId)}</TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-1 text-sm\">\n                        <Clock className=\"h-3 w-3 text-muted-foreground\" />\n                        {site.workStartTime || \"08:00\"} - {site.workEndTime || \"17:00\"}\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"space-y-1\">\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          {getBillingTypeLabel(site.billingType || \"hourly\")}\n                        </Badge>\n                        {site.hourlyRate && (\n                          <div className=\"flex items-center gap-1 text-sm text-muted-foreground\">\n                            <DollarSign className=\"h-3 w-3\" />\n                            {site.hourlyRate}\n                          </div>\n                        )}\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <Badge variant={getStatusBadgeVariant(site.status || \"active\")}>\n                        {site.status || \"active\"}\n                      </Badge>\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      <div className=\"flex items-center justify-end gap-2\">\n                        <Button\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          onClick={() => setAssigningSite(site)}\n                          data-testid={`button-assign-site-${site.id}`}\n                        >\n                          <Users className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          onClick={() => handleEdit(site)}\n                          data-testid={`button-edit-site-${site.id}`}\n                        >\n                          <Pencil className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          onClick={() => setDeletingSite(site)}\n                          data-testid={`button-delete-site-${site.id}`}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          )}\n        </CardContent>\n      </Card>\n\n      <AlertDialog open={!!deletingSite} onOpenChange={(open) => !open && setDeletingSite(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Site</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete \"{deletingSite?.name}\"? This action cannot be undone.\n              All associated assignments and records will be affected.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel data-testid=\"button-cancel-delete\">Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => deletingSite && deleteSiteMutation.mutate(deletingSite.id)}\n              disabled={deleteSiteMutation.isPending}\n              data-testid=\"button-confirm-delete\"\n            >\n              {deleteSiteMutation.isPending ? \"Deleting...\" : \"Delete\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n\nexport default function SiteManagement() {\n  return (\n    <ManagerGuard>\n      <SiteManagementContent />\n    </ManagerGuard>\n  );\n}\n","path":null,"size_bytes":28420,"size_tokens":null},"client/src/pages/admin/TimesheetApprovals.tsx":{"content":"import { useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { ManagerGuard } from \"@/components/RoleGuard\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format } from \"date-fns\";\nimport { \n  Clock, \n  Search, \n  CheckCircle, \n  XCircle,\n  AlertTriangle,\n  MapPin,\n  Camera,\n  Eye,\n  Calendar,\n  Timer,\n  Users,\n  Building2\n} from \"lucide-react\";\nimport type { TimeRecord, Site, User } from \"@shared/schema\";\n\nfunction TimesheetApprovalsContent() {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\");\n  const [siteFilter, setSiteFilter] = useState<string>(\"all\");\n  const [viewingRecord, setViewingRecord] = useState<TimeRecord | null>(null);\n  const [rejectingRecord, setRejectingRecord] = useState<TimeRecord | null>(null);\n  const [rejectReason, setRejectReason] = useState(\"\");\n\n  const { data: timeRecords = [], isLoading } = useQuery<TimeRecord[]>({\n    queryKey: [\"/api/time-records\"],\n  });\n\n  const { data: sites = [] } = useQuery<Site[]>({\n    queryKey: [\"/api/sites\"],\n  });\n\n  const { data: users = [] } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const approveMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest(\"PATCH\", `/api/time-records/${id}/approve`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/time-records\"] });\n      toast({ title: \"Success\", description: \"Time record approved\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"Error\", description: \"Failed to approve record\" });\n    },\n  });\n\n  const rejectMutation = useMutation({\n    mutationFn: async ({ id, reason }: { id: string; reason: string }) => {\n      return apiRequest(\"PATCH\", `/api/time-records/${id}/reject`, { reason });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/time-records\"] });\n      setRejectingRecord(null);\n      setRejectReason(\"\");\n      toast({ title: \"Success\", description: \"Time record rejected\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"Error\", description: \"Failed to reject record\" });\n    },\n  });\n\n  const filteredRecords = timeRecords.filter((record) => {\n    const user = users.find(u => u.id === record.userId);\n    const site = sites.find(s => s.id === record.siteId);\n    const userName = user ? `${user.firstName} ${user.lastName}`.toLowerCase() : \"\";\n    const siteName = site?.name?.toLowerCase() || \"\";\n    \n    const matchesSearch = \n      userName.includes(searchTerm.toLowerCase()) ||\n      siteName.includes(searchTerm.toLowerCase());\n    const matchesStatus = statusFilter === \"all\" || record.status === statusFilter;\n    const matchesSite = siteFilter === \"all\" || record.siteId === siteFilter;\n    return matchesSearch && matchesStatus && matchesSite;\n  });\n\n  const sortedRecords = [...filteredRecords].sort((a, b) => \n    new Date(b.checkInTime).getTime() - new Date(a.checkInTime).getTime()\n  );\n\n  const getUserName = (userId: string | null) => {\n    if (!userId) return \"-\";\n    const user = users.find(u => u.id === userId);\n    return user ? `${user.firstName} ${user.lastName}` : userId;\n  };\n\n  const getSiteName = (siteId: string | null) => {\n    if (!siteId) return \"-\";\n    const site = sites.find(s => s.id === siteId);\n    return site?.name || siteId;\n  };\n\n  const getStatusBadge = (status: string | null) => {\n    switch (status) {\n      case \"approved\":\n        return <Badge variant=\"default\" className=\"bg-green-600\"><CheckCircle className=\"w-3 h-3 mr-1\" />Approved</Badge>;\n      case \"rejected\":\n        return <Badge variant=\"destructive\"><XCircle className=\"w-3 h-3 mr-1\" />Rejected</Badge>;\n      case \"contested\":\n        return <Badge variant=\"outline\" className=\"border-orange-500 text-orange-600\"><AlertTriangle className=\"w-3 h-3 mr-1\" />Contested</Badge>;\n      case \"pending\":\n      default:\n        return <Badge variant=\"secondary\"><Clock className=\"w-3 h-3 mr-1\" />Pending</Badge>;\n    }\n  };\n\n  const formatTime = (date: string | Date | null) => {\n    if (!date) return \"-\";\n    return format(new Date(date), \"HH:mm\");\n  };\n\n  const formatDate = (date: string | Date | null) => {\n    if (!date) return \"-\";\n    return format(new Date(date), \"dd/MM/yyyy\");\n  };\n\n  const recordStats = {\n    total: timeRecords.length,\n    pending: timeRecords.filter(r => r.status === \"pending\").length,\n    approved: timeRecords.filter(r => r.status === \"approved\").length,\n    rejected: timeRecords.filter(r => r.status === \"rejected\").length,\n    suspicious: timeRecords.filter(r => r.isSuspicious).length,\n  };\n\n  const handleApprove = (record: TimeRecord) => {\n    approveMutation.mutate(record.id);\n  };\n\n  const handleReject = () => {\n    if (rejectingRecord && rejectReason.trim()) {\n      rejectMutation.mutate({ id: rejectingRecord.id, reason: rejectReason });\n    }\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex flex-wrap items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-bold\" data-testid=\"text-page-title\">{t(\"admin.timesheetApproval\")}</h1>\n          <p className=\"text-muted-foreground\">\n            Review and approve employee time records\n          </p>\n        </div>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-5\">\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-2\">\n              <Calendar className=\"w-8 h-8 text-muted-foreground\" />\n              <div>\n                <p className=\"text-2xl font-bold\" data-testid=\"text-total-records\">{recordStats.total}</p>\n                <p className=\"text-sm text-muted-foreground\">Total Records</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-2\">\n              <Clock className=\"w-8 h-8 text-yellow-600\" />\n              <div>\n                <p className=\"text-2xl font-bold\" data-testid=\"text-pending-count\">{recordStats.pending}</p>\n                <p className=\"text-sm text-muted-foreground\">Pending</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-2\">\n              <CheckCircle className=\"w-8 h-8 text-green-600\" />\n              <div>\n                <p className=\"text-2xl font-bold\" data-testid=\"text-approved-count\">{recordStats.approved}</p>\n                <p className=\"text-sm text-muted-foreground\">Approved</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-2\">\n              <XCircle className=\"w-8 h-8 text-red-600\" />\n              <div>\n                <p className=\"text-2xl font-bold\" data-testid=\"text-rejected-count\">{recordStats.rejected}</p>\n                <p className=\"text-sm text-muted-foreground\">Rejected</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-2\">\n              <AlertTriangle className=\"w-8 h-8 text-orange-600\" />\n              <div>\n                <p className=\"text-2xl font-bold\" data-testid=\"text-suspicious-count\">{recordStats.suspicious}</p>\n                <p className=\"text-sm text-muted-foreground\">Suspicious</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader className=\"flex flex-row items-center justify-between gap-4 space-y-0 pb-4\">\n          <div className=\"flex flex-wrap items-center gap-4\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4\" />\n              <Input\n                placeholder=\"Search by employee or site...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10 w-64\"\n                data-testid=\"input-search-records\"\n              />\n            </div>\n            <Select value={statusFilter} onValueChange={setStatusFilter}>\n              <SelectTrigger className=\"w-40\" data-testid=\"select-status-filter\">\n                <SelectValue placeholder=\"Filter by status\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All Status</SelectItem>\n                <SelectItem value=\"pending\">Pending</SelectItem>\n                <SelectItem value=\"approved\">Approved</SelectItem>\n                <SelectItem value=\"rejected\">Rejected</SelectItem>\n                <SelectItem value=\"contested\">Contested</SelectItem>\n              </SelectContent>\n            </Select>\n            <Select value={siteFilter} onValueChange={setSiteFilter}>\n              <SelectTrigger className=\"w-48\" data-testid=\"select-site-filter\">\n                <SelectValue placeholder=\"Filter by site\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All Sites</SelectItem>\n                {sites.map((site) => (\n                  <SelectItem key={site.id} value={site.id}>{site.name}</SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"text-center py-8 text-muted-foreground\">Loading time records...</div>\n          ) : sortedRecords.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              {searchTerm || statusFilter !== \"all\" || siteFilter !== \"all\" \n                ? \"No records match your filters\" \n                : \"No time records found.\"}\n            </div>\n          ) : (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Date</TableHead>\n                  <TableHead>Employee</TableHead>\n                  <TableHead>Site</TableHead>\n                  <TableHead>Check In</TableHead>\n                  <TableHead>Check Out</TableHead>\n                  <TableHead>Hours</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead>Flags</TableHead>\n                  <TableHead className=\"text-right\">Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {sortedRecords.map((record) => (\n                  <TableRow key={record.id} data-testid={`row-record-${record.id}`}>\n                    <TableCell className=\"font-medium\">{formatDate(record.checkInTime)}</TableCell>\n                    <TableCell>{getUserName(record.userId)}</TableCell>\n                    <TableCell>{getSiteName(record.siteId)}</TableCell>\n                    <TableCell>{formatTime(record.checkInTime)}</TableCell>\n                    <TableCell>{formatTime(record.checkOutTime)}</TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-1\">\n                        <Timer className=\"w-3 h-3 text-muted-foreground\" />\n                        {record.totalHours || \"-\"}\n                        {record.overtimeHours && parseFloat(record.overtimeHours) > 0 && (\n                          <Badge variant=\"outline\" className=\"ml-1 text-xs\">\n                            +{record.overtimeHours}h OT\n                          </Badge>\n                        )}\n                      </div>\n                    </TableCell>\n                    <TableCell>{getStatusBadge(record.status)}</TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-1\">\n                        {record.isSuspicious && (\n                          <Badge variant=\"destructive\" className=\"text-xs\">\n                            <AlertTriangle className=\"w-3 h-3 mr-1\" />\n                            Suspicious\n                          </Badge>\n                        )}\n                        {!record.isWithinGeofence && (\n                          <Badge variant=\"outline\" className=\"text-xs border-orange-500 text-orange-600\">\n                            <MapPin className=\"w-3 h-3 mr-1\" />\n                            Outside\n                          </Badge>\n                        )}\n                        {record.isOffline && (\n                          <Badge variant=\"outline\" className=\"text-xs\">\n                            Offline\n                          </Badge>\n                        )}\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center justify-end gap-1\">\n                        <Button\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          onClick={() => setViewingRecord(record)}\n                          data-testid={`button-view-${record.id}`}\n                        >\n                          <Eye className=\"w-4 h-4\" />\n                        </Button>\n                        {record.status === \"pending\" && (\n                          <>\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              className=\"text-green-600\"\n                              onClick={() => handleApprove(record)}\n                              disabled={approveMutation.isPending}\n                              data-testid={`button-approve-${record.id}`}\n                            >\n                              <CheckCircle className=\"w-4 h-4 mr-1\" />\n                              Approve\n                            </Button>\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              className=\"text-red-600\"\n                              onClick={() => setRejectingRecord(record)}\n                              data-testid={`button-reject-${record.id}`}\n                            >\n                              <XCircle className=\"w-4 h-4 mr-1\" />\n                              Reject\n                            </Button>\n                          </>\n                        )}\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          )}\n        </CardContent>\n      </Card>\n\n      <Dialog open={!!viewingRecord} onOpenChange={(open) => !open && setViewingRecord(null)}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Time Record Details</DialogTitle>\n            <DialogDescription>\n              View detailed information about this time record\n            </DialogDescription>\n          </DialogHeader>\n          {viewingRecord && (\n            <div className=\"space-y-6\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-1\">\n                  <p className=\"text-sm text-muted-foreground flex items-center gap-1\">\n                    <Users className=\"w-4 h-4\" />Employee\n                  </p>\n                  <p className=\"font-medium\" data-testid=\"text-detail-employee\">\n                    {getUserName(viewingRecord.userId)}\n                  </p>\n                </div>\n                <div className=\"space-y-1\">\n                  <p className=\"text-sm text-muted-foreground flex items-center gap-1\">\n                    <Building2 className=\"w-4 h-4\" />Site\n                  </p>\n                  <p className=\"font-medium\" data-testid=\"text-detail-site\">\n                    {getSiteName(viewingRecord.siteId)}\n                  </p>\n                </div>\n                <div className=\"space-y-1\">\n                  <p className=\"text-sm text-muted-foreground flex items-center gap-1\">\n                    <Calendar className=\"w-4 h-4\" />Date\n                  </p>\n                  <p className=\"font-medium\" data-testid=\"text-detail-date\">\n                    {formatDate(viewingRecord.checkInTime)}\n                  </p>\n                </div>\n                <div className=\"space-y-1\">\n                  <p className=\"text-sm text-muted-foreground\">Status</p>\n                  <div data-testid=\"text-detail-status\">\n                    {getStatusBadge(viewingRecord.status)}\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4 pt-4 border-t\">\n                <div className=\"space-y-2\">\n                  <h4 className=\"font-medium text-green-600 flex items-center gap-1\">\n                    <Clock className=\"w-4 h-4\" />Check In\n                  </h4>\n                  <p className=\"text-lg font-bold\" data-testid=\"text-detail-checkin-time\">\n                    {formatTime(viewingRecord.checkInTime)}\n                  </p>\n                  {viewingRecord.checkInLatitude && viewingRecord.checkInLongitude && (\n                    <p className=\"text-sm text-muted-foreground flex items-center gap-1\">\n                      <MapPin className=\"w-3 h-3\" />\n                      {viewingRecord.checkInLatitude}, {viewingRecord.checkInLongitude}\n                    </p>\n                  )}\n                  {viewingRecord.checkInPhoto && (\n                    <div className=\"mt-2\">\n                      <p className=\"text-sm text-muted-foreground flex items-center gap-1 mb-1\">\n                        <Camera className=\"w-3 h-3\" />Photo\n                      </p>\n                      <img \n                        src={viewingRecord.checkInPhoto} \n                        alt=\"Check-in\" \n                        className=\"w-32 h-32 object-cover rounded-md border\"\n                        data-testid=\"img-checkin-photo\"\n                      />\n                    </div>\n                  )}\n                </div>\n                <div className=\"space-y-2\">\n                  <h4 className=\"font-medium text-red-600 flex items-center gap-1\">\n                    <Clock className=\"w-4 h-4\" />Check Out\n                  </h4>\n                  <p className=\"text-lg font-bold\" data-testid=\"text-detail-checkout-time\">\n                    {viewingRecord.checkOutTime ? formatTime(viewingRecord.checkOutTime) : \"Not checked out\"}\n                  </p>\n                  {viewingRecord.checkOutLatitude && viewingRecord.checkOutLongitude && (\n                    <p className=\"text-sm text-muted-foreground flex items-center gap-1\">\n                      <MapPin className=\"w-3 h-3\" />\n                      {viewingRecord.checkOutLatitude}, {viewingRecord.checkOutLongitude}\n                    </p>\n                  )}\n                  {viewingRecord.checkOutPhoto && (\n                    <div className=\"mt-2\">\n                      <p className=\"text-sm text-muted-foreground flex items-center gap-1 mb-1\">\n                        <Camera className=\"w-3 h-3\" />Photo\n                      </p>\n                      <img \n                        src={viewingRecord.checkOutPhoto} \n                        alt=\"Check-out\" \n                        className=\"w-32 h-32 object-cover rounded-md border\"\n                        data-testid=\"img-checkout-photo\"\n                      />\n                    </div>\n                  )}\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-3 gap-4 pt-4 border-t\">\n                <div className=\"space-y-1\">\n                  <p className=\"text-sm text-muted-foreground\">Total Hours</p>\n                  <p className=\"text-xl font-bold\" data-testid=\"text-detail-total-hours\">\n                    {viewingRecord.totalHours || \"-\"}\n                  </p>\n                </div>\n                <div className=\"space-y-1\">\n                  <p className=\"text-sm text-muted-foreground\">Overtime Hours</p>\n                  <p className=\"text-xl font-bold text-orange-600\" data-testid=\"text-detail-overtime\">\n                    {viewingRecord.overtimeHours || \"0\"}\n                  </p>\n                </div>\n                <div className=\"space-y-1\">\n                  <p className=\"text-sm text-muted-foreground\">Break Minutes</p>\n                  <p className=\"text-xl font-bold\" data-testid=\"text-detail-break\">\n                    {viewingRecord.breakMinutes || 0}\n                  </p>\n                </div>\n              </div>\n\n              {(viewingRecord.isSuspicious || !viewingRecord.isWithinGeofence) && (\n                <div className=\"pt-4 border-t space-y-2\">\n                  <h4 className=\"font-medium text-orange-600 flex items-center gap-1\">\n                    <AlertTriangle className=\"w-4 h-4\" />Warnings\n                  </h4>\n                  {viewingRecord.isSuspicious && (\n                    <div className=\"p-3 bg-orange-50 dark:bg-orange-950 rounded-md\">\n                      <p className=\"text-sm font-medium text-orange-800 dark:text-orange-200\">\n                        Suspicious Activity Detected\n                      </p>\n                      <p className=\"text-sm text-orange-700 dark:text-orange-300\">\n                        {viewingRecord.suspiciousReason || \"No reason provided\"}\n                      </p>\n                    </div>\n                  )}\n                  {!viewingRecord.isWithinGeofence && (\n                    <div className=\"p-3 bg-orange-50 dark:bg-orange-950 rounded-md\">\n                      <p className=\"text-sm font-medium text-orange-800 dark:text-orange-200\">\n                        Outside Geofence\n                      </p>\n                      <p className=\"text-sm text-orange-700 dark:text-orange-300\">\n                        The employee was not within the site boundaries when clocking in/out.\n                      </p>\n                    </div>\n                  )}\n                </div>\n              )}\n\n              {viewingRecord.notes && (\n                <div className=\"pt-4 border-t\">\n                  <p className=\"text-sm text-muted-foreground mb-1\">Notes</p>\n                  <p className=\"text-sm\" data-testid=\"text-detail-notes\">{viewingRecord.notes}</p>\n                </div>\n              )}\n\n              {viewingRecord.approvedBy && (\n                <div className=\"pt-4 border-t\">\n                  <p className=\"text-sm text-muted-foreground\">\n                    {viewingRecord.status === \"approved\" ? \"Approved\" : \"Reviewed\"} by {getUserName(viewingRecord.approvedBy)}\n                    {viewingRecord.approvedAt && ` on ${format(new Date(viewingRecord.approvedAt), \"dd/MM/yyyy HH:mm\")}`}\n                  </p>\n                </div>\n              )}\n            </div>\n          )}\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setViewingRecord(null)}>\n              Close\n            </Button>\n            {viewingRecord?.status === \"pending\" && (\n              <>\n                <Button\n                  variant=\"outline\"\n                  className=\"text-red-600\"\n                  onClick={() => {\n                    setRejectingRecord(viewingRecord);\n                    setViewingRecord(null);\n                  }}\n                >\n                  <XCircle className=\"w-4 h-4 mr-1\" />\n                  Reject\n                </Button>\n                <Button\n                  onClick={() => {\n                    handleApprove(viewingRecord);\n                    setViewingRecord(null);\n                  }}\n                  disabled={approveMutation.isPending}\n                >\n                  <CheckCircle className=\"w-4 h-4 mr-1\" />\n                  Approve\n                </Button>\n              </>\n            )}\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={!!rejectingRecord} onOpenChange={(open) => {\n        if (!open) {\n          setRejectingRecord(null);\n          setRejectReason(\"\");\n        }\n      }}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Reject Time Record</DialogTitle>\n            <DialogDescription>\n              Provide a reason for rejecting this time record. The employee will be notified.\n            </DialogDescription>\n          </DialogHeader>\n          {rejectingRecord && (\n            <div className=\"space-y-4\">\n              <div className=\"p-3 bg-muted rounded-md\">\n                <p className=\"text-sm\">\n                  <strong>Employee:</strong> {getUserName(rejectingRecord.userId)}\n                </p>\n                <p className=\"text-sm\">\n                  <strong>Date:</strong> {formatDate(rejectingRecord.checkInTime)}\n                </p>\n                <p className=\"text-sm\">\n                  <strong>Hours:</strong> {rejectingRecord.totalHours || \"N/A\"}\n                </p>\n              </div>\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium\">Rejection Reason</label>\n                <Textarea\n                  placeholder=\"Enter the reason for rejection...\"\n                  value={rejectReason}\n                  onChange={(e) => setRejectReason(e.target.value)}\n                  rows={3}\n                  data-testid=\"textarea-reject-reason\"\n                />\n              </div>\n            </div>\n          )}\n          <DialogFooter>\n            <Button \n              variant=\"outline\" \n              onClick={() => {\n                setRejectingRecord(null);\n                setRejectReason(\"\");\n              }}\n            >\n              {t(\"common.cancel\")}\n            </Button>\n            <Button\n              variant=\"destructive\"\n              onClick={handleReject}\n              disabled={rejectMutation.isPending || !rejectReason.trim()}\n              data-testid=\"button-confirm-reject\"\n            >\n              {rejectMutation.isPending ? \"Rejecting...\" : \"Reject Record\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n\nexport default function TimesheetApprovals() {\n  return (\n    <ManagerGuard>\n      <TimesheetApprovalsContent />\n    </ManagerGuard>\n  );\n}\n","path":null,"size_bytes":27155,"size_tokens":null},"client/src/pages/admin/ClientManagement.tsx":{"content":"import { useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { ManagerGuard } from \"@/components/RoleGuard\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Building2, Search, Pencil, Phone, Mail, MapPin, Plus, Trash2, User } from \"lucide-react\";\nimport type { Client, Site } from \"@shared/schema\";\n\nconst clientFormSchema = z.object({\n  name: z.string().min(1, \"Client name is required\"),\n  taxId: z.string().optional(),\n  address: z.string().optional(),\n  phone: z.string().optional(),\n  email: z.string().email(\"Invalid email\").optional().or(z.literal(\"\")),\n  contactPerson: z.string().optional(),\n  type: z.enum([\"company\", \"residential\"]).default(\"company\"),\n});\n\ntype ClientFormData = z.infer<typeof clientFormSchema>;\n\nfunction ClientManagementContent() {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [typeFilter, setTypeFilter] = useState<string>(\"all\");\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n  const [editingClient, setEditingClient] = useState<Client | null>(null);\n  const [deletingClient, setDeletingClient] = useState<Client | null>(null);\n\n  const { data: clients = [], isLoading } = useQuery<Client[]>({\n    queryKey: [\"/api/clients\"],\n  });\n\n  const { data: sites = [] } = useQuery<Site[]>({\n    queryKey: [\"/api/sites\"],\n  });\n\n  const form = useForm<ClientFormData>({\n    resolver: zodResolver(clientFormSchema),\n    defaultValues: {\n      name: \"\",\n      taxId: \"\",\n      address: \"\",\n      phone: \"\",\n      email: \"\",\n      contactPerson: \"\",\n      type: \"company\",\n    },\n  });\n\n  const createClientMutation = useMutation({\n    mutationFn: async (data: ClientFormData) => {\n      return apiRequest(\"POST\", \"/api/clients\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/clients\"] });\n      setIsAddDialogOpen(false);\n      form.reset();\n      toast({ title: t(\"common.save\"), description: \"Client created successfully\" });\n    },\n    onError: (error: any) => {\n      const message = error?.message === \"No tenant context\" \n        ? \"Please select a tenant first (use impersonation from Tenant Management)\"\n        : \"Failed to create client\";\n      toast({ variant: \"destructive\", title: \"Error\", description: message });\n    },\n  });\n\n  const updateClientMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<ClientFormData> }) => {\n      return apiRequest(\"PATCH\", `/api/clients/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/clients\"] });\n      setEditingClient(null);\n      form.reset();\n      toast({ title: t(\"common.save\"), description: \"Client updated successfully\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"Error\", description: \"Failed to update client\" });\n    },\n  });\n\n  const deleteClientMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest(\"DELETE\", `/api/clients/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/clients\"] });\n      setDeletingClient(null);\n      toast({ title: t(\"common.delete\"), description: \"Client deleted successfully\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"Error\", description: \"Failed to delete client\" });\n    },\n  });\n\n  const filteredClients = clients.filter((client) => {\n    const matchesSearch =\n      client.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      (client.email?.toLowerCase().includes(searchTerm.toLowerCase())) ||\n      (client.contactPerson?.toLowerCase().includes(searchTerm.toLowerCase()));\n    const matchesType = typeFilter === \"all\" || client.type === typeFilter;\n    return matchesSearch && matchesType;\n  });\n\n  const handleSubmit = (data: ClientFormData) => {\n    if (editingClient) {\n      updateClientMutation.mutate({ id: editingClient.id, data });\n    } else {\n      createClientMutation.mutate(data);\n    }\n  };\n\n  const handleEdit = (client: Client) => {\n    setEditingClient(client);\n    form.reset({\n      name: client.name,\n      taxId: client.taxId || \"\",\n      address: client.address || \"\",\n      phone: client.phone || \"\",\n      email: client.email || \"\",\n      contactPerson: client.contactPerson || \"\",\n      type: (client.type as \"company\" | \"residential\") || \"company\",\n    });\n  };\n\n  const getTypeBadgeVariant = (type: string) => {\n    switch (type) {\n      case \"company\": return \"default\";\n      case \"residential\": return \"secondary\";\n      default: return \"secondary\";\n    }\n  };\n\n  const getSiteCount = (clientId: string) => {\n    return sites.filter(s => s.clientId === clientId).length;\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-bold\">{t(\"admin.clientManagement\")}</h1>\n          <p className=\"text-muted-foreground\">\n            Manage clients, their contact information and view associated sites\n          </p>\n        </div>\n        <Dialog open={isAddDialogOpen || !!editingClient} onOpenChange={(open) => {\n          if (!open) {\n            setIsAddDialogOpen(false);\n            setEditingClient(null);\n            form.reset();\n          }\n        }}>\n          <DialogTrigger asChild>\n            <Button onClick={() => setIsAddDialogOpen(true)} data-testid=\"button-add-client\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add Client\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-lg\">\n            <DialogHeader>\n              <DialogTitle>\n                {editingClient ? \"Edit Client\" : \"Add New Client\"}\n              </DialogTitle>\n              <DialogDescription>\n                {editingClient ? \"Update client information\" : \"Register a new client\"}\n              </DialogDescription>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(handleSubmit)} className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"name\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Client Name</FormLabel>\n                      <FormControl>\n                        <Input {...field} placeholder=\"e.g. ABC Construction Ltd\" data-testid=\"input-client-name\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"type\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Client Type</FormLabel>\n                      <Select onValueChange={field.onChange} value={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-client-type\">\n                            <SelectValue />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"company\">Company</SelectItem>\n                          <SelectItem value=\"residential\">Residential</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"taxId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Tax ID / VAT Number</FormLabel>\n                      <FormControl>\n                        <Input {...field} placeholder=\"e.g. NL123456789B01\" data-testid=\"input-tax-id\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"contactPerson\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Contact Person</FormLabel>\n                      <FormControl>\n                        <Input {...field} placeholder=\"Full name\" data-testid=\"input-contact-person\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Email</FormLabel>\n                      <FormControl>\n                        <Input {...field} type=\"email\" placeholder=\"contact@company.com\" data-testid=\"input-email\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"phone\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Phone</FormLabel>\n                      <FormControl>\n                        <Input {...field} placeholder=\"+31 6 1234 5678\" data-testid=\"input-phone\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"address\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Address</FormLabel>\n                      <FormControl>\n                        <Input {...field} placeholder=\"Street, City, Country\" data-testid=\"input-address\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <DialogFooter>\n                  <Button type=\"submit\" disabled={createClientMutation.isPending || updateClientMutation.isPending} data-testid=\"button-save-client\">\n                    {t(\"common.save\")}\n                  </Button>\n                </DialogFooter>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <AlertDialog open={!!deletingClient} onOpenChange={(open) => !open && setDeletingClient(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Client</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete \"{deletingClient?.name}\"? This action cannot be undone.\n              {getSiteCount(deletingClient?.id || \"\") > 0 && (\n                <span className=\"block mt-2 text-destructive font-medium\">\n                  Warning: This client has {getSiteCount(deletingClient?.id || \"\")} associated site(s).\n                </span>\n              )}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => deletingClient && deleteClientMutation.mutate(deletingClient.id)}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n              data-testid=\"button-confirm-delete\"\n            >\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center gap-4 flex-wrap\">\n            <div className=\"relative flex-1 min-w-[200px]\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n              <Input\n                placeholder={t(\"common.search\")}\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-9\"\n                data-testid=\"input-search-clients\"\n              />\n            </div>\n            <Select value={typeFilter} onValueChange={setTypeFilter}>\n              <SelectTrigger className=\"w-[150px]\" data-testid=\"select-type-filter\">\n                <SelectValue placeholder=\"Filter by type\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All Types</SelectItem>\n                <SelectItem value=\"company\">Company</SelectItem>\n                <SelectItem value=\"residential\">Residential</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex items-center justify-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\" />\n            </div>\n          ) : filteredClients.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n              <Building2 className=\"h-12 w-12 text-muted-foreground mb-4\" />\n              <h3 className=\"text-lg font-medium\">No clients found</h3>\n              <p className=\"text-muted-foreground\">\n                {searchTerm || typeFilter !== \"all\"\n                  ? \"Try adjusting your search or filters\"\n                  : \"Add your first client to get started\"}\n              </p>\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Client</TableHead>\n                    <TableHead>Type</TableHead>\n                    <TableHead>Contact</TableHead>\n                    <TableHead>Sites</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredClients.map((client) => (\n                    <TableRow key={client.id} data-testid={`row-client-${client.id}`}>\n                      <TableCell>\n                        <div className=\"flex flex-col\">\n                          <span className=\"font-medium\" data-testid={`text-client-name-${client.id}`}>{client.name}</span>\n                          {client.taxId && (\n                            <span className=\"text-xs text-muted-foreground\">Tax ID: {client.taxId}</span>\n                          )}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant={getTypeBadgeVariant(client.type || \"company\")}>\n                          {client.type === \"residential\" ? \"Residential\" : \"Company\"}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex flex-col gap-1 text-sm\">\n                          {client.contactPerson && (\n                            <div className=\"flex items-center gap-1\">\n                              <User className=\"h-3 w-3 text-muted-foreground\" />\n                              <span>{client.contactPerson}</span>\n                            </div>\n                          )}\n                          {client.email && (\n                            <div className=\"flex items-center gap-1\">\n                              <Mail className=\"h-3 w-3 text-muted-foreground\" />\n                              <span className=\"text-muted-foreground\">{client.email}</span>\n                            </div>\n                          )}\n                          {client.phone && (\n                            <div className=\"flex items-center gap-1\">\n                              <Phone className=\"h-3 w-3 text-muted-foreground\" />\n                              <span className=\"text-muted-foreground\">{client.phone}</span>\n                            </div>\n                          )}\n                          {client.address && (\n                            <div className=\"flex items-center gap-1\">\n                              <MapPin className=\"h-3 w-3 text-muted-foreground\" />\n                              <span className=\"text-muted-foreground truncate max-w-[200px]\">{client.address}</span>\n                            </div>\n                          )}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant=\"outline\">\n                          {getSiteCount(client.id)} site(s)\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <div className=\"flex items-center justify-end gap-2\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => handleEdit(client)}\n                            data-testid={`button-edit-client-${client.id}`}\n                          >\n                            <Pencil className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => setDeletingClient(client)}\n                            data-testid={`button-delete-client-${client.id}`}\n                          >\n                            <Trash2 className=\"h-4 w-4 text-destructive\" />\n                          </Button>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nexport default function ClientManagement() {\n  return (\n    <ManagerGuard>\n      <ClientManagementContent />\n    </ManagerGuard>\n  );\n}\n","path":null,"size_bytes":19344,"size_tokens":null},"client/src/pages/admin/UserManagement.tsx":{"content":"import { useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { ManagerGuard } from \"@/components/RoleGuard\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Plus, Search, Pencil, Trash2, UserPlus } from \"lucide-react\";\nimport type { User } from \"@shared/schema\";\n\nconst userFormSchema = z.object({\n  firstName: z.string().min(1, \"First name is required\"),\n  lastName: z.string().min(1, \"Last name is required\"),\n  email: z.string().email(\"Valid email is required\"),\n  role: z.enum([\"admin\", \"manager\", \"employee\", \"client\"]),\n  phone: z.string().optional(),\n  hourlyRate: z.string().optional(),\n});\n\ntype UserFormData = z.infer<typeof userFormSchema>;\n\nfunction UserManagementContent() {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [roleFilter, setRoleFilter] = useState<string>(\"all\");\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n  const [editingUser, setEditingUser] = useState<User | null>(null);\n\n  const { data: users = [], isLoading } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const form = useForm<UserFormData>({\n    resolver: zodResolver(userFormSchema),\n    defaultValues: {\n      firstName: \"\",\n      lastName: \"\",\n      email: \"\",\n      role: \"employee\",\n      phone: \"\",\n      hourlyRate: \"\",\n    },\n  });\n\n  const createUserMutation = useMutation({\n    mutationFn: async (data: UserFormData) => {\n      return apiRequest(\"POST\", \"/api/users\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      setIsAddDialogOpen(false);\n      form.reset();\n      toast({ title: t(\"common.save\"), description: \"User created successfully\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"Error\", description: \"Failed to create user\" });\n    },\n  });\n\n  const updateUserMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<UserFormData> }) => {\n      return apiRequest(\"PATCH\", `/api/users/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      setEditingUser(null);\n      form.reset();\n      toast({ title: t(\"common.save\"), description: \"User updated successfully\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"Error\", description: \"Failed to update user\" });\n    },\n  });\n\n  const deleteUserMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest(\"DELETE\", `/api/users/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      toast({ title: t(\"common.delete\"), description: \"User deleted successfully\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"Error\", description: \"Failed to delete user\" });\n    },\n  });\n\n  const filteredUsers = users.filter((user) => {\n    const matchesSearch =\n      user.firstName?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      user.lastName?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      user.email?.toLowerCase().includes(searchTerm.toLowerCase());\n    const matchesRole = roleFilter === \"all\" || user.role === roleFilter;\n    return matchesSearch && matchesRole;\n  });\n\n  const handleSubmit = (data: UserFormData) => {\n    if (editingUser) {\n      updateUserMutation.mutate({ id: editingUser.id, data });\n    } else {\n      createUserMutation.mutate(data);\n    }\n  };\n\n  const handleEdit = (user: User) => {\n    setEditingUser(user);\n    form.reset({\n      firstName: user.firstName || \"\",\n      lastName: user.lastName || \"\",\n      email: user.email || \"\",\n      role: user.role as \"admin\" | \"manager\" | \"employee\" | \"client\",\n      phone: user.phone || \"\",\n      hourlyRate: user.hourlyRate || \"\",\n    });\n  };\n\n  const getRoleBadgeVariant = (role: string) => {\n    switch (role) {\n      case \"admin\": return \"destructive\";\n      case \"manager\": return \"default\";\n      case \"employee\": return \"secondary\";\n      case \"client\": return \"outline\";\n      default: return \"secondary\";\n    }\n  };\n\n  const getInitials = (user: User) => {\n    return `${user.firstName?.[0] || \"\"}${user.lastName?.[0] || \"\"}`.toUpperCase() || \"U\";\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-bold\">{t(\"admin.userManagement\")}</h1>\n          <p className=\"text-muted-foreground\">\n            {t(\"employees.addEmployee\", \"Manage users and their roles\")}\n          </p>\n        </div>\n        <Dialog open={isAddDialogOpen || !!editingUser} onOpenChange={(open) => {\n          if (!open) {\n            setIsAddDialogOpen(false);\n            setEditingUser(null);\n            form.reset();\n          }\n        }}>\n          <DialogTrigger asChild>\n            <Button onClick={() => setIsAddDialogOpen(true)} data-testid=\"button-add-user\">\n              <UserPlus className=\"h-4 w-4 mr-2\" />\n              {t(\"admin.addUser\")}\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>\n                {editingUser ? t(\"common.edit\") : t(\"admin.addUser\")}\n              </DialogTitle>\n              <DialogDescription>\n                {editingUser ? \"Update user information\" : \"Add a new user to the system\"}\n              </DialogDescription>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(handleSubmit)} className=\"space-y-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"firstName\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>First Name</FormLabel>\n                        <FormControl>\n                          <Input {...field} data-testid=\"input-first-name\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"lastName\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Last Name</FormLabel>\n                        <FormControl>\n                          <Input {...field} data-testid=\"input-last-name\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n                <FormField\n                  control={form.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Email</FormLabel>\n                      <FormControl>\n                        <Input type=\"email\" {...field} data-testid=\"input-email\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"role\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{t(\"employees.role\")}</FormLabel>\n                      <Select onValueChange={field.onChange} value={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-role\">\n                            <SelectValue />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"admin\">{t(\"roles.admin\")}</SelectItem>\n                          <SelectItem value=\"manager\">{t(\"roles.manager\")}</SelectItem>\n                          <SelectItem value=\"employee\">{t(\"roles.employee\")}</SelectItem>\n                          <SelectItem value=\"client\">{t(\"roles.client\")}</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"phone\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Phone</FormLabel>\n                      <FormControl>\n                        <Input {...field} data-testid=\"input-phone\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"hourlyRate\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{t(\"employees.hourlyRate\")}</FormLabel>\n                      <FormControl>\n                        <Input type=\"number\" step=\"0.01\" {...field} data-testid=\"input-hourly-rate\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <DialogFooter>\n                  <Button type=\"submit\" disabled={createUserMutation.isPending || updateUserMutation.isPending} data-testid=\"button-save-user\">\n                    {t(\"common.save\")}\n                  </Button>\n                </DialogFooter>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center gap-4 flex-wrap\">\n            <div className=\"relative flex-1 min-w-[200px]\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n              <Input\n                placeholder={t(\"common.search\")}\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-9\"\n                data-testid=\"input-search-users\"\n              />\n            </div>\n            <Select value={roleFilter} onValueChange={setRoleFilter}>\n              <SelectTrigger className=\"w-[150px]\" data-testid=\"select-role-filter\">\n                <SelectValue placeholder={t(\"common.filter\")} />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All Roles</SelectItem>\n                <SelectItem value=\"admin\">{t(\"roles.admin\")}</SelectItem>\n                <SelectItem value=\"manager\">{t(\"roles.manager\")}</SelectItem>\n                <SelectItem value=\"employee\">{t(\"roles.employee\")}</SelectItem>\n                <SelectItem value=\"client\">{t(\"roles.client\")}</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex items-center justify-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\" />\n            </div>\n          ) : filteredUsers.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              No users found\n            </div>\n          ) : (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>User</TableHead>\n                  <TableHead>Email</TableHead>\n                  <TableHead>{t(\"employees.role\")}</TableHead>\n                  <TableHead>{t(\"employees.hourlyRate\")}</TableHead>\n                  <TableHead>{t(\"common.status\")}</TableHead>\n                  <TableHead className=\"text-right\">{t(\"common.actions\")}</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {filteredUsers.map((user) => (\n                  <TableRow key={user.id} data-testid={`row-user-${user.id}`}>\n                    <TableCell>\n                      <div className=\"flex items-center gap-3\">\n                        <Avatar className=\"h-8 w-8\">\n                          <AvatarImage src={user.profileImageUrl || undefined} />\n                          <AvatarFallback className=\"text-xs\">{getInitials(user)}</AvatarFallback>\n                        </Avatar>\n                        <span className=\"font-medium\">\n                          {user.firstName} {user.lastName}\n                        </span>\n                      </div>\n                    </TableCell>\n                    <TableCell>{user.email}</TableCell>\n                    <TableCell>\n                      <Badge variant={getRoleBadgeVariant(user.role)}>\n                        {t(`roles.${user.role}`)}\n                      </Badge>\n                    </TableCell>\n                    <TableCell>\n                      {user.hourlyRate ? `$${user.hourlyRate}/h` : \"-\"}\n                    </TableCell>\n                    <TableCell>\n                      <Badge variant={user.isActive ? \"default\" : \"secondary\"}>\n                        {user.isActive ? \"Active\" : \"Inactive\"}\n                      </Badge>\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      <div className=\"flex items-center justify-end gap-2\">\n                        <Button\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          onClick={() => handleEdit(user)}\n                          data-testid={`button-edit-user-${user.id}`}\n                        >\n                          <Pencil className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          onClick={() => {\n                            if (confirm(\"Are you sure you want to delete this user?\")) {\n                              deleteUserMutation.mutate(user.id);\n                            }\n                          }}\n                          data-testid={`button-delete-user-${user.id}`}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nexport default function UserManagement() {\n  return (\n    <ManagerGuard>\n      <UserManagementContent />\n    </ManagerGuard>\n  );\n}\n","path":null,"size_bytes":15775,"size_tokens":null},"client/src/pages/admin/CompanySettings.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { ManagerGuard } from \"@/components/RoleGuard\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { \n  Building2, \n  MapPin, \n  Phone, \n  Mail, \n  Shield, \n  Camera, \n  Lock,\n  Globe,\n  Save,\n  Loader2,\n  Target\n} from \"lucide-react\";\nimport type { Tenant } from \"@shared/schema\";\n\nfunction CompanySettingsContent() {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  \n  const [formData, setFormData] = useState<{\n    name: string;\n    address: string;\n    phone: string;\n    email: string;\n    settings: {\n      geofenceRadius: number;\n      requireSelfie: boolean;\n      requirePin: boolean;\n      defaultLanguage: string;\n    };\n  }>({\n    name: \"\",\n    address: \"\",\n    phone: \"\",\n    email: \"\",\n    settings: {\n      geofenceRadius: 100,\n      requireSelfie: false,\n      requirePin: false,\n      defaultLanguage: \"pt\",\n    },\n  });\n\n  const { data: tenant, isLoading } = useQuery<Tenant>({\n    queryKey: [\"/api/tenant\"],\n  });\n\n  // Sync form data when tenant loads\n  useEffect(() => {\n    if (tenant) {\n      setFormData({\n        name: tenant.name || \"\",\n        address: tenant.address || \"\",\n        phone: tenant.phone || \"\",\n        email: tenant.email || \"\",\n        settings: {\n          geofenceRadius: tenant.settings?.geofenceRadius ?? 100,\n          requireSelfie: tenant.settings?.requireSelfie ?? false,\n          requirePin: tenant.settings?.requirePin ?? false,\n          defaultLanguage: tenant.settings?.defaultLanguage ?? \"pt\",\n        },\n      });\n    }\n  }, [tenant]);\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: Partial<Tenant>) => {\n      return apiRequest(\"PATCH\", \"/api/tenant\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/tenant\"] });\n      toast({ title: t(\"common.success\"), description: \"Company settings updated successfully\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: t(\"common.error\"), description: \"Failed to update settings\" });\n    },\n  });\n\n  const handleSave = () => {\n    updateMutation.mutate({\n      name: formData.name,\n      address: formData.address,\n      phone: formData.phone,\n      email: formData.email,\n      settings: formData.settings,\n    });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <div>\n          <Skeleton className=\"h-8 w-48 mb-2\" />\n          <Skeleton className=\"h-4 w-64\" />\n        </div>\n        <div className=\"grid gap-6 md:grid-cols-2\">\n          <Skeleton className=\"h-64\" />\n          <Skeleton className=\"h-64\" />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-bold\" data-testid=\"text-page-title\">{t(\"admin.companySettings\")}</h1>\n          <p className=\"text-muted-foreground\">\n            Configure company profile, security policies, and system settings\n          </p>\n        </div>\n        <Button \n          onClick={handleSave} \n          disabled={updateMutation.isPending}\n          data-testid=\"button-save-settings\"\n        >\n          {updateMutation.isPending ? (\n            <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n          ) : (\n            <Save className=\"h-4 w-4 mr-2\" />\n          )}\n          {t(\"common.save\")}\n        </Button>\n      </div>\n\n      <div className=\"grid gap-6 md:grid-cols-2\">\n        {/* Company Profile Card */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Building2 className=\"h-5 w-5\" />\n              Company Profile\n            </CardTitle>\n            <CardDescription>\n              Basic information about your company\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"companyName\">Company Name</Label>\n              <Input\n                id=\"companyName\"\n                value={formData.name}\n                onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                placeholder=\"Enter company name\"\n                data-testid=\"input-company-name\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"address\" className=\"flex items-center gap-2\">\n                <MapPin className=\"h-4 w-4\" />\n                Address\n              </Label>\n              <Input\n                id=\"address\"\n                value={formData.address}\n                onChange={(e) => setFormData({ ...formData, address: e.target.value })}\n                placeholder=\"Enter company address\"\n                data-testid=\"input-address\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"phone\" className=\"flex items-center gap-2\">\n                <Phone className=\"h-4 w-4\" />\n                Phone\n              </Label>\n              <Input\n                id=\"phone\"\n                value={formData.phone}\n                onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\n                placeholder=\"+1 (555) 000-0000\"\n                data-testid=\"input-phone\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\" className=\"flex items-center gap-2\">\n                <Mail className=\"h-4 w-4\" />\n                Email\n              </Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                value={formData.email}\n                onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n                placeholder=\"company@example.com\"\n                data-testid=\"input-email\"\n              />\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Security & Verification Card */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Shield className=\"h-5 w-5\" />\n              Security & Verification\n            </CardTitle>\n            <CardDescription>\n              Configure time tracking security policies\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"geofenceRadius\" className=\"flex items-center gap-2\">\n                <Target className=\"h-4 w-4\" />\n                Geofence Radius (meters)\n              </Label>\n              <Input\n                id=\"geofenceRadius\"\n                type=\"number\"\n                min={10}\n                max={1000}\n                value={formData.settings.geofenceRadius}\n                onChange={(e) => setFormData({\n                  ...formData,\n                  settings: { ...formData.settings, geofenceRadius: parseInt(e.target.value) || 100 }\n                })}\n                data-testid=\"input-geofence-radius\"\n              />\n              <p className=\"text-xs text-muted-foreground\">\n                Workers must be within this distance from the site to clock in/out\n              </p>\n            </div>\n\n            <Separator />\n\n            <div className=\"flex items-center justify-between\">\n              <div className=\"space-y-0.5\">\n                <Label htmlFor=\"requireSelfie\" className=\"flex items-center gap-2\">\n                  <Camera className=\"h-4 w-4\" />\n                  Require Selfie on Clock In/Out\n                </Label>\n                <p className=\"text-xs text-muted-foreground\">\n                  Workers must take a photo when clocking in or out\n                </p>\n              </div>\n              <Switch\n                id=\"requireSelfie\"\n                checked={formData.settings.requireSelfie}\n                onCheckedChange={(checked) => setFormData({\n                  ...formData,\n                  settings: { ...formData.settings, requireSelfie: checked }\n                })}\n                data-testid=\"switch-require-selfie\"\n              />\n            </div>\n\n            <Separator />\n\n            <div className=\"flex items-center justify-between\">\n              <div className=\"space-y-0.5\">\n                <Label htmlFor=\"requirePin\" className=\"flex items-center gap-2\">\n                  <Lock className=\"h-4 w-4\" />\n                  Require PIN Verification\n                </Label>\n                <p className=\"text-xs text-muted-foreground\">\n                  Workers must enter their PIN to clock in/out\n                </p>\n              </div>\n              <Switch\n                id=\"requirePin\"\n                checked={formData.settings.requirePin}\n                onCheckedChange={(checked) => setFormData({\n                  ...formData,\n                  settings: { ...formData.settings, requirePin: checked }\n                })}\n                data-testid=\"switch-require-pin\"\n              />\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Regional Settings Card */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Globe className=\"h-5 w-5\" />\n              Regional Settings\n            </CardTitle>\n            <CardDescription>\n              Language and localization preferences\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"defaultLanguage\">Default Language</Label>\n              <Select\n                value={formData.settings.defaultLanguage}\n                onValueChange={(value) => setFormData({\n                  ...formData,\n                  settings: { ...formData.settings, defaultLanguage: value }\n                })}\n              >\n                <SelectTrigger id=\"defaultLanguage\" data-testid=\"select-default-language\">\n                  <SelectValue placeholder=\"Select language\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"pt\">Portuguese</SelectItem>\n                  <SelectItem value=\"en\">English</SelectItem>\n                  <SelectItem value=\"nl\">Dutch</SelectItem>\n                  <SelectItem value=\"fr\">French</SelectItem>\n                </SelectContent>\n              </Select>\n              <p className=\"text-xs text-muted-foreground\">\n                Default language for new employees\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Subscription Info Card */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Building2 className=\"h-5 w-5\" />\n              Subscription\n            </CardTitle>\n            <CardDescription>\n              Your current plan and subscription status\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-sm text-muted-foreground\">Plan</span>\n              <span className=\"font-medium capitalize\" data-testid=\"text-subscription-plan\">\n                {tenant?.subscriptionPlan || \"Starter\"}\n              </span>\n            </div>\n            <Separator />\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-sm text-muted-foreground\">Status</span>\n              <span \n                className={`font-medium capitalize ${tenant?.subscriptionStatus === \"active\" ? \"text-green-600\" : \"text-yellow-600\"}`}\n                data-testid=\"text-subscription-status\"\n              >\n                {tenant?.subscriptionStatus || \"Active\"}\n              </span>\n            </div>\n            {tenant?.stripeCustomerId && (\n              <>\n                <Separator />\n                <p className=\"text-xs text-muted-foreground\">\n                  Contact support to upgrade or modify your subscription\n                </p>\n              </>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n\nexport default function CompanySettings() {\n  return (\n    <ManagerGuard>\n      <CompanySettingsContent />\n    </ManagerGuard>\n  );\n}\n","path":null,"size_bytes":13015,"size_tokens":null},"client/src/pages/superadmin/TenantManagement.tsx":{"content":"import { useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { SuperAdminGuard } from \"@/components/RoleGuard\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Shield, Building2, Users, Search, Edit, CheckCircle, XCircle, Clock, AlertTriangle, UserCheck, Plus, UserPlus } from \"lucide-react\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { format } from \"date-fns\";\nimport type { Tenant, User } from \"@shared/schema\";\n\ninterface EnrichedTenant extends Tenant {\n  userCount: number;\n  adminCount: number;\n  managerCount: number;\n  employeeCount: number;\n}\n\ninterface TenantUser extends User {\n  tenantName?: string;\n}\n\nconst initialCreateForm = {\n  name: \"\",\n  email: \"\",\n  phone: \"\",\n  address: \"\",\n  subscriptionPlan: \"basic\",\n  subscriptionStatus: \"active\",\n  adminEmail: \"\",\n  adminPassword: \"\",\n  adminFirstName: \"\",\n  adminLastName: \"\",\n};\n\nconst initialUserForm = {\n  email: \"\",\n  password: \"\",\n  firstName: \"\",\n  lastName: \"\",\n  role: \"employee\",\n};\n\nfunction TenantManagementContent() {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const { impersonate, isImpersonatePending, isImpersonating, impersonatedTenantName, impersonatedTenantId } = useAuth();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [editingTenant, setEditingTenant] = useState<EnrichedTenant | null>(null);\n  const [isCreateDialogOpen, setIsCreateDialogOpen] = useState(false);\n  const [createForm, setCreateForm] = useState(initialCreateForm);\n  const [editForm, setEditForm] = useState({\n    subscriptionPlan: \"\",\n    subscriptionStatus: \"\",\n  });\n  const [managingUsersTenant, setManagingUsersTenant] = useState<EnrichedTenant | null>(null);\n  const [isAddUserDialogOpen, setIsAddUserDialogOpen] = useState(false);\n  const [userForm, setUserForm] = useState(initialUserForm);\n\n  const { data: tenants = [], isLoading } = useQuery<EnrichedTenant[]>({\n    queryKey: [\"/api/superadmin/tenants\"],\n  });\n\n  const { data: allUsers = [] } = useQuery<TenantUser[]>({\n    queryKey: [\"/api/superadmin/users\"],\n  });\n\n  const tenantUsers = managingUsersTenant\n    ? allUsers.filter(u => u.tenantId === managingUsersTenant.id)\n    : [];\n\n  const updateTenantMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<Tenant> }) => {\n      return apiRequest(\"PATCH\", `/api/superadmin/tenants/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/superadmin/tenants\"] });\n      setEditingTenant(null);\n      toast({\n        title: \"Tenant updated\",\n        description: \"Subscription settings have been updated successfully.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update tenant.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const createTenantMutation = useMutation({\n    mutationFn: async (data: typeof initialCreateForm) => {\n      return apiRequest(\"POST\", \"/api/superadmin/tenants\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/superadmin/tenants\"] });\n      setIsCreateDialogOpen(false);\n      setCreateForm(initialCreateForm);\n      toast({\n        title: \"Tenant created\",\n        description: \"New company and admin user created successfully.\",\n      });\n    },\n    onError: () => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: \"Failed to create tenant.\",\n      });\n    },\n  });\n\n  const createUserMutation = useMutation({\n    mutationFn: async (data: typeof initialUserForm & { tenantId: string }) => {\n      return apiRequest(\"POST\", \"/api/superadmin/users\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/superadmin/users\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/superadmin/tenants\"] });\n      setIsAddUserDialogOpen(false);\n      setUserForm(initialUserForm);\n      toast({\n        title: \"User created\",\n        description: \"New user has been added to the company.\",\n      });\n    },\n    onError: () => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: \"Failed to create user.\",\n      });\n    },\n  });\n\n  const handleCreateTenant = () => {\n    if (!createForm.name) {\n      toast({\n        variant: \"destructive\",\n        title: \"Validation Error\",\n        description: \"Company name is required.\",\n      });\n      return;\n    }\n    createTenantMutation.mutate(createForm);\n  };\n\n  const handleCreateUser = () => {\n    if (!userForm.email || !userForm.password) {\n      toast({\n        variant: \"destructive\",\n        title: \"Validation Error\",\n        description: \"Email and password are required.\",\n      });\n      return;\n    }\n    if (!managingUsersTenant) return;\n    createUserMutation.mutate({ ...userForm, tenantId: managingUsersTenant.id });\n  };\n\n  const filteredTenants = tenants.filter(\n    (tenant) =>\n      tenant.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      tenant.email?.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  const getStatusBadge = (status: string | null) => {\n    switch (status) {\n      case \"active\":\n        return <Badge variant=\"default\" className=\"bg-green-600\"><CheckCircle className=\"h-3 w-3 mr-1\" />Active</Badge>;\n      case \"trial\":\n        return <Badge variant=\"secondary\"><Clock className=\"h-3 w-3 mr-1\" />Trial</Badge>;\n      case \"suspended\":\n        return <Badge variant=\"destructive\"><XCircle className=\"h-3 w-3 mr-1\" />Suspended</Badge>;\n      case \"cancelled\":\n        return <Badge variant=\"outline\"><AlertTriangle className=\"h-3 w-3 mr-1\" />Cancelled</Badge>;\n      default:\n        return <Badge variant=\"outline\">{status || \"Unknown\"}</Badge>;\n    }\n  };\n\n  const getPlanBadge = (plan: string | null) => {\n    switch (plan) {\n      case \"basic\":\n        return <Badge variant=\"outline\">Basic</Badge>;\n      case \"professional\":\n        return <Badge variant=\"secondary\">Professional</Badge>;\n      case \"enterprise\":\n        return <Badge variant=\"default\">Enterprise</Badge>;\n      default:\n        return <Badge variant=\"outline\">{plan || \"None\"}</Badge>;\n    }\n  };\n\n  const handleEdit = (tenant: EnrichedTenant) => {\n    setEditingTenant(tenant);\n    setEditForm({\n      subscriptionPlan: tenant.subscriptionPlan || \"basic\",\n      subscriptionStatus: tenant.subscriptionStatus || \"active\",\n    });\n  };\n\n  const handleSave = () => {\n    if (!editingTenant) return;\n    updateTenantMutation.mutate({\n      id: editingTenant.id,\n      data: editForm,\n    });\n  };\n\n  const handleImpersonate = (tenant: EnrichedTenant) => {\n    impersonate(tenant.id, {\n      onSuccess: () => {\n        toast({\n          title: \"Impersonation Started\",\n          description: `You are now viewing data as ${tenant.name}. Go to Dashboard to see their data.`,\n        });\n      },\n      onError: () => {\n        toast({\n          title: \"Error\",\n          description: \"Failed to start impersonation.\",\n          variant: \"destructive\",\n        });\n      },\n    });\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div>\n        <h1 className=\"text-2xl font-bold flex items-center gap-2\">\n          <Shield className=\"h-6 w-6\" />\n          Tenant Management\n        </h1>\n        <p className=\"text-muted-foreground\">\n          View and manage all registered companies and their subscriptions\n        </p>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n            <div>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Building2 className=\"h-5 w-5\" />\n                All Tenants ({tenants.length})\n              </CardTitle>\n              <CardDescription>\n                Manage subscription plans and status for all registered companies\n              </CardDescription>\n            </div>\n            <div className=\"flex items-center gap-2 flex-wrap\">\n              <div className=\"relative w-full max-w-sm\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  placeholder=\"Search tenants...\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  className=\"pl-10\"\n                  data-testid=\"input-search-tenants\"\n                />\n              </div>\n              <Button\n                onClick={() => setIsCreateDialogOpen(true)}\n                data-testid=\"button-add-tenant\"\n              >\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Add Tenant\n              </Button>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"text-center py-8 text-muted-foreground\">Loading tenants...</div>\n          ) : filteredTenants.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              {searchQuery ? \"No tenants match your search\" : \"No tenants registered yet\"}\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Company</TableHead>\n                    <TableHead>Plan</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Users</TableHead>\n                    <TableHead>Created</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredTenants.map((tenant) => (\n                    <TableRow key={tenant.id} data-testid={`row-tenant-${tenant.id}`}>\n                      <TableCell>\n                        <div>\n                          <div className=\"font-medium\">{tenant.name}</div>\n                          <div className=\"text-sm text-muted-foreground\">{tenant.email || \"No email\"}</div>\n                        </div>\n                      </TableCell>\n                      <TableCell>{getPlanBadge(tenant.subscriptionPlan)}</TableCell>\n                      <TableCell>{getStatusBadge(tenant.subscriptionStatus)}</TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-1\">\n                          <Users className=\"h-4 w-4 text-muted-foreground\" />\n                          <span>{tenant.userCount}</span>\n                        </div>\n                        <div className=\"text-xs text-muted-foreground\">\n                          {tenant.adminCount}A / {tenant.managerCount}M / {tenant.employeeCount}E\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        {tenant.createdAt\n                          ? format(new Date(tenant.createdAt), \"MMM d, yyyy\")\n                          : \"N/A\"}\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <div className=\"flex items-center justify-end gap-1\">\n                          <Button\n                            size=\"icon\"\n                            variant=\"ghost\"\n                            onClick={() => setManagingUsersTenant(tenant)}\n                            title=\"Manage users\"\n                            data-testid={`button-manage-users-${tenant.id}`}\n                          >\n                            <Users className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            size=\"icon\"\n                            variant=\"ghost\"\n                            onClick={() => handleImpersonate(tenant)}\n                            disabled={isImpersonatePending || impersonatedTenantId === tenant.id}\n                            title=\"Impersonate this tenant\"\n                            data-testid={`button-impersonate-tenant-${tenant.id}`}\n                          >\n                            <UserCheck className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            size=\"icon\"\n                            variant=\"ghost\"\n                            onClick={() => handleEdit(tenant)}\n                            data-testid={`button-edit-tenant-${tenant.id}`}\n                          >\n                            <Edit className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      <Dialog open={!!editingTenant} onOpenChange={() => setEditingTenant(null)}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Edit Tenant Subscription</DialogTitle>\n            <DialogDescription>\n              Update subscription plan and status for {editingTenant?.name}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label>Subscription Plan</Label>\n              <Select\n                value={editForm.subscriptionPlan}\n                onValueChange={(value) => setEditForm({ ...editForm, subscriptionPlan: value })}\n              >\n                <SelectTrigger data-testid=\"select-subscription-plan\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"basic\">Basic</SelectItem>\n                  <SelectItem value=\"professional\">Professional</SelectItem>\n                  <SelectItem value=\"enterprise\">Enterprise</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Subscription Status</Label>\n              <Select\n                value={editForm.subscriptionStatus}\n                onValueChange={(value) => setEditForm({ ...editForm, subscriptionStatus: value })}\n              >\n                <SelectTrigger data-testid=\"select-subscription-status\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"active\">Active</SelectItem>\n                  <SelectItem value=\"trial\">Trial</SelectItem>\n                  <SelectItem value=\"suspended\">Suspended</SelectItem>\n                  <SelectItem value=\"cancelled\">Cancelled</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n          <div className=\"flex justify-end gap-2\">\n            <Button variant=\"outline\" onClick={() => setEditingTenant(null)}>\n              Cancel\n            </Button>\n            <Button\n              onClick={handleSave}\n              disabled={updateTenantMutation.isPending}\n              data-testid=\"button-save-tenant\"\n            >\n              {updateTenantMutation.isPending ? \"Saving...\" : \"Save Changes\"}\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isCreateDialogOpen} onOpenChange={setIsCreateDialogOpen}>\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Create New Tenant</DialogTitle>\n            <DialogDescription>\n              Add a new company and optionally create an admin user for it\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-6 py-4\">\n            <div className=\"space-y-4\">\n              <h3 className=\"font-medium\">Company Information</h3>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"create-name\">Company Name *</Label>\n                  <Input\n                    id=\"create-name\"\n                    value={createForm.name}\n                    onChange={(e) => setCreateForm({ ...createForm, name: e.target.value })}\n                    placeholder=\"Acme Construction\"\n                    data-testid=\"input-create-tenant-name\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"create-email\">Email</Label>\n                  <Input\n                    id=\"create-email\"\n                    type=\"email\"\n                    value={createForm.email}\n                    onChange={(e) => setCreateForm({ ...createForm, email: e.target.value })}\n                    placeholder=\"contact@acme.com\"\n                    data-testid=\"input-create-tenant-email\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"create-phone\">Phone</Label>\n                  <Input\n                    id=\"create-phone\"\n                    value={createForm.phone}\n                    onChange={(e) => setCreateForm({ ...createForm, phone: e.target.value })}\n                    placeholder=\"+1 234 567 890\"\n                    data-testid=\"input-create-tenant-phone\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"create-address\">Address</Label>\n                  <Input\n                    id=\"create-address\"\n                    value={createForm.address}\n                    onChange={(e) => setCreateForm({ ...createForm, address: e.target.value })}\n                    placeholder=\"123 Main St\"\n                    data-testid=\"input-create-tenant-address\"\n                  />\n                </div>\n              </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label>Subscription Plan</Label>\n                  <Select\n                    value={createForm.subscriptionPlan}\n                    onValueChange={(value) => setCreateForm({ ...createForm, subscriptionPlan: value })}\n                  >\n                    <SelectTrigger data-testid=\"select-create-subscription-plan\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"starter\">Starter</SelectItem>\n                      <SelectItem value=\"professional\">Professional</SelectItem>\n                      <SelectItem value=\"enterprise\">Enterprise</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>Subscription Status</Label>\n                  <Select\n                    value={createForm.subscriptionStatus}\n                    onValueChange={(value) => setCreateForm({ ...createForm, subscriptionStatus: value })}\n                  >\n                    <SelectTrigger data-testid=\"select-create-subscription-status\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"active\">Active</SelectItem>\n                      <SelectItem value=\"trial\">Trial</SelectItem>\n                      <SelectItem value=\"suspended\">Suspended</SelectItem>\n                      <SelectItem value=\"cancelled\">Cancelled</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"space-y-4\">\n              <h3 className=\"font-medium\">Admin User (Optional)</h3>\n              <p className=\"text-sm text-muted-foreground\">\n                Create an admin user for this company. Leave blank to create without admin.\n              </p>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"create-admin-first-name\">First Name</Label>\n                  <Input\n                    id=\"create-admin-first-name\"\n                    value={createForm.adminFirstName}\n                    onChange={(e) => setCreateForm({ ...createForm, adminFirstName: e.target.value })}\n                    placeholder=\"John\"\n                    data-testid=\"input-create-admin-first-name\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"create-admin-last-name\">Last Name</Label>\n                  <Input\n                    id=\"create-admin-last-name\"\n                    value={createForm.adminLastName}\n                    onChange={(e) => setCreateForm({ ...createForm, adminLastName: e.target.value })}\n                    placeholder=\"Doe\"\n                    data-testid=\"input-create-admin-last-name\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"create-admin-email\">Admin Email / Username</Label>\n                  <Input\n                    id=\"create-admin-email\"\n                    value={createForm.adminEmail}\n                    onChange={(e) => setCreateForm({ ...createForm, adminEmail: e.target.value })}\n                    placeholder=\"john@acme.com\"\n                    data-testid=\"input-create-admin-email\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"create-admin-password\">Password</Label>\n                  <Input\n                    id=\"create-admin-password\"\n                    type=\"password\"\n                    value={createForm.adminPassword}\n                    onChange={(e) => setCreateForm({ ...createForm, adminPassword: e.target.value })}\n                    placeholder=\"Secure password\"\n                    data-testid=\"input-create-admin-password\"\n                  />\n                </div>\n              </div>\n            </div>\n          </div>\n          <div className=\"flex justify-end gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsCreateDialogOpen(false);\n                setCreateForm(initialCreateForm);\n              }}\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={handleCreateTenant}\n              disabled={createTenantMutation.isPending}\n              data-testid=\"button-create-tenant-submit\"\n            >\n              {createTenantMutation.isPending ? \"Creating...\" : \"Create Tenant\"}\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={!!managingUsersTenant} onOpenChange={() => setManagingUsersTenant(null)}>\n        <DialogContent className=\"max-w-3xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Manage Users - {managingUsersTenant?.name}</DialogTitle>\n            <DialogDescription>\n              View and add users for this company\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"flex items-center justify-between gap-2\">\n              <h3 className=\"font-medium\">Users ({tenantUsers.length})</h3>\n              <Button\n                size=\"sm\"\n                onClick={() => setIsAddUserDialogOpen(true)}\n                data-testid=\"button-add-user\"\n              >\n                <UserPlus className=\"h-4 w-4 mr-2\" />\n                Add User\n              </Button>\n            </div>\n            {tenantUsers.length === 0 ? (\n              <div className=\"text-center py-4 text-muted-foreground\">\n                No users in this company yet\n              </div>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Name</TableHead>\n                    <TableHead>Email</TableHead>\n                    <TableHead>Role</TableHead>\n                    <TableHead>Status</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {tenantUsers.map((user) => (\n                    <TableRow key={user.id} data-testid={`row-user-${user.id}`}>\n                      <TableCell>\n                        {user.firstName} {user.lastName}\n                      </TableCell>\n                      <TableCell>{user.email}</TableCell>\n                      <TableCell>\n                        <Badge variant=\"outline\">{user.role}</Badge>\n                      </TableCell>\n                      <TableCell>\n                        {user.isActive ? (\n                          <Badge variant=\"default\" className=\"bg-green-600\">Active</Badge>\n                        ) : (\n                          <Badge variant=\"destructive\">Inactive</Badge>\n                        )}\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            )}\n          </div>\n          <div className=\"flex justify-end\">\n            <Button variant=\"outline\" onClick={() => setManagingUsersTenant(null)}>\n              Close\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isAddUserDialogOpen} onOpenChange={setIsAddUserDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Add User to {managingUsersTenant?.name}</DialogTitle>\n            <DialogDescription>\n              Create a new user for this company\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"user-first-name\">First Name</Label>\n                <Input\n                  id=\"user-first-name\"\n                  value={userForm.firstName}\n                  onChange={(e) => setUserForm({ ...userForm, firstName: e.target.value })}\n                  placeholder=\"John\"\n                  data-testid=\"input-user-first-name\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"user-last-name\">Last Name</Label>\n                <Input\n                  id=\"user-last-name\"\n                  value={userForm.lastName}\n                  onChange={(e) => setUserForm({ ...userForm, lastName: e.target.value })}\n                  placeholder=\"Doe\"\n                  data-testid=\"input-user-last-name\"\n                />\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"user-email\">Email / Username *</Label>\n              <Input\n                id=\"user-email\"\n                value={userForm.email}\n                onChange={(e) => setUserForm({ ...userForm, email: e.target.value })}\n                placeholder=\"john@company.com\"\n                data-testid=\"input-user-email\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"user-password\">Password *</Label>\n              <Input\n                id=\"user-password\"\n                type=\"password\"\n                value={userForm.password}\n                onChange={(e) => setUserForm({ ...userForm, password: e.target.value })}\n                placeholder=\"Secure password\"\n                data-testid=\"input-user-password\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Role</Label>\n              <Select\n                value={userForm.role}\n                onValueChange={(value) => setUserForm({ ...userForm, role: value })}\n              >\n                <SelectTrigger data-testid=\"select-user-role\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"admin\">Admin</SelectItem>\n                  <SelectItem value=\"manager\">Manager</SelectItem>\n                  <SelectItem value=\"employee\">Employee</SelectItem>\n                  <SelectItem value=\"client\">Client</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n          <div className=\"flex justify-end gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsAddUserDialogOpen(false);\n                setUserForm(initialUserForm);\n              }}\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={handleCreateUser}\n              disabled={createUserMutation.isPending}\n              data-testid=\"button-create-user-submit\"\n            >\n              {createUserMutation.isPending ? \"Creating...\" : \"Create User\"}\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n\nexport default function TenantManagement() {\n  return (\n    <SuperAdminGuard>\n      <TenantManagementContent />\n    </SuperAdminGuard>\n  );\n}\n","path":null,"size_bytes":29747,"size_tokens":null},"client/src/pages/admin/ServiceOrders.tsx":{"content":"import { useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { ManagerGuard } from \"@/components/RoleGuard\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Label } from \"@/components/ui/label\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format, startOfMonth, endOfMonth } from \"date-fns\";\nimport { \n  FileText, \n  Calculator,\n  Calendar,\n  Building2,\n  Clock,\n  DollarSign,\n  Download,\n  Eye,\n  Users,\n  MapPin,\n  CheckCircle,\n  AlertCircle,\n  TrendingUp\n} from \"lucide-react\";\nimport type { Site, Client } from \"@shared/schema\";\n\ninterface ServiceOrder {\n  siteId: string;\n  siteName: string;\n  clientId: string;\n  clientName: string;\n  billingType: string;\n  hourlyRate: number;\n  totalHours: number;\n  overtimeHours: number;\n  regularHours: number;\n  approvedRecords: number;\n  pendingRecords: number;\n  regularCost: number;\n  overtimeCost: number;\n  totalCost: number;\n  workers: string[];\n  workerIds: string[];\n  workDays: number;\n}\n\ninterface ServiceOrdersResponse {\n  orders: ServiceOrder[];\n  totals: {\n    totalHours: number;\n    overtimeHours: number;\n    totalCost: number;\n    approvedRecords: number;\n    pendingRecords: number;\n  };\n  period: {\n    startDate: string;\n    endDate: string;\n  };\n  overtimeMultiplier: number;\n}\n\nfunction ServiceOrdersContent() {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  \n  const currentDate = new Date();\n  const [periodStart, setPeriodStart] = useState(format(startOfMonth(currentDate), \"yyyy-MM-dd\"));\n  const [periodEnd, setPeriodEnd] = useState(format(endOfMonth(currentDate), \"yyyy-MM-dd\"));\n  const [selectedSite, setSelectedSite] = useState<string>(\"all\");\n  const [selectedClient, setSelectedClient] = useState<string>(\"all\");\n  const [viewingOrder, setViewingOrder] = useState<ServiceOrder | null>(null);\n\n  const { data: sites = [] } = useQuery<Site[]>({\n    queryKey: [\"/api/sites\"],\n  });\n\n  const { data: clients = [] } = useQuery<Client[]>({\n    queryKey: [\"/api/clients\"],\n  });\n\n  const { data: serviceOrdersData, isLoading } = useQuery<ServiceOrdersResponse>({\n    queryKey: [\"/api/service-orders/calculate\", periodStart, periodEnd, selectedSite, selectedClient],\n    queryFn: async () => {\n      const params = new URLSearchParams({\n        startDate: periodStart,\n        endDate: periodEnd,\n        siteId: selectedSite,\n        clientId: selectedClient,\n      });\n      const res = await fetch(`/api/service-orders/calculate?${params}`, {\n        credentials: \"include\",\n      });\n      if (!res.ok) throw new Error(\"Failed to calculate service orders\");\n      return res.json();\n    },\n  });\n\n  const serviceOrders = serviceOrdersData?.orders || [];\n  const totals = serviceOrdersData?.totals || {\n    totalHours: 0,\n    overtimeHours: 0,\n    totalCost: 0,\n    approvedRecords: 0,\n    pendingRecords: 0,\n  };\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat(\"en-US\", {\n      style: \"currency\",\n      currency: \"EUR\",\n    }).format(amount);\n  };\n\n  const formatHours = (hours: number) => {\n    return hours.toFixed(1) + \"h\";\n  };\n\n  const getBillingTypeBadge = (type: string) => {\n    switch (type) {\n      case \"hourly\":\n        return <Badge variant=\"outline\" className=\"border-blue-500 text-blue-600\"><Clock className=\"w-3 h-3 mr-1\" />Hourly</Badge>;\n      case \"daily\":\n        return <Badge variant=\"outline\" className=\"border-green-500 text-green-600\"><Calendar className=\"w-3 h-3 mr-1\" />Daily</Badge>;\n      case \"fixed\":\n        return <Badge variant=\"outline\" className=\"border-purple-500 text-purple-600\"><DollarSign className=\"w-3 h-3 mr-1\" />Fixed</Badge>;\n      default:\n        return <Badge variant=\"outline\">{type}</Badge>;\n    }\n  };\n\n  const overtimeMultiplier = serviceOrdersData?.overtimeMultiplier || 1.5;\n\n  const handleExportOrder = (order: ServiceOrder) => {\n    const content = `\nSERVICE ORDER\n=============\n\nSite: ${order.siteName}\nClient: ${order.clientName}\nPeriod: ${format(new Date(periodStart), \"dd/MM/yyyy\")} - ${format(new Date(periodEnd), \"dd/MM/yyyy\")}\n\nSUMMARY\n-------\nBilling Type: ${order.billingType.charAt(0).toUpperCase() + order.billingType.slice(1)}\nRate: ${formatCurrency(order.hourlyRate)}${order.billingType === \"hourly\" ? \"/hour\" : order.billingType === \"daily\" ? \"/day\" : \"\"}\n\nHours Worked:\n  Regular Hours: ${formatHours(order.regularHours)}\n  Overtime Hours: ${formatHours(order.overtimeHours)}\n  Total Hours: ${formatHours(order.totalHours)}\n\nWork Days: ${order.workDays}\nWorkers: ${order.workers.length}\nTime Records: ${order.approvedRecords} approved, ${order.pendingRecords} pending\n\nCOSTS\n-----\nRegular Cost: ${formatCurrency(order.regularCost)}\nOvertime Cost (${overtimeMultiplier}x): ${formatCurrency(order.overtimeCost)}\n----------------------\nTOTAL: ${formatCurrency(order.totalCost)}\n\nWorkers:\n${order.workers.map(w => `  - ${w}`).join(\"\\n\")}\n\nGenerated: ${format(new Date(), \"dd/MM/yyyy HH:mm\")}\n    `.trim();\n\n    const blob = new Blob([content], { type: \"text/plain\" });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = `service-order-${order.siteName.replace(/\\s+/g, \"-\").toLowerCase()}-${periodStart}-${periodEnd}.txt`;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n\n    toast({\n      title: \"Service Order Exported\",\n      description: `Service order for ${order.siteName} has been downloaded.`,\n    });\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex flex-wrap items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-bold\" data-testid=\"text-page-title\">{t(\"admin.serviceOrders\")}</h1>\n          <p className=\"text-muted-foreground\">\n            Calculate and generate service orders based on worked hours\n          </p>\n        </div>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-5\">\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-2\">\n              <Clock className=\"w-8 h-8 text-blue-600\" />\n              <div>\n                {isLoading ? (\n                  <Skeleton className=\"h-8 w-16\" />\n                ) : (\n                  <p className=\"text-2xl font-bold\" data-testid=\"text-total-hours\">{formatHours(totals.totalHours)}</p>\n                )}\n                <p className=\"text-sm text-muted-foreground\">Total Hours</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-2\">\n              <TrendingUp className=\"w-8 h-8 text-orange-600\" />\n              <div>\n                {isLoading ? (\n                  <Skeleton className=\"h-8 w-16\" />\n                ) : (\n                  <p className=\"text-2xl font-bold\" data-testid=\"text-overtime-hours\">{formatHours(totals.overtimeHours)}</p>\n                )}\n                <p className=\"text-sm text-muted-foreground\">Overtime</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-2\">\n              <DollarSign className=\"w-8 h-8 text-green-600\" />\n              <div>\n                {isLoading ? (\n                  <Skeleton className=\"h-8 w-20\" />\n                ) : (\n                  <p className=\"text-2xl font-bold\" data-testid=\"text-total-cost\">{formatCurrency(totals.totalCost)}</p>\n                )}\n                <p className=\"text-sm text-muted-foreground\">Total Value</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-2\">\n              <CheckCircle className=\"w-8 h-8 text-green-600\" />\n              <div>\n                {isLoading ? (\n                  <Skeleton className=\"h-8 w-12\" />\n                ) : (\n                  <p className=\"text-2xl font-bold\" data-testid=\"text-approved-records\">{totals.approvedRecords}</p>\n                )}\n                <p className=\"text-sm text-muted-foreground\">Approved Records</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-2\">\n              <AlertCircle className=\"w-8 h-8 text-yellow-600\" />\n              <div>\n                {isLoading ? (\n                  <Skeleton className=\"h-8 w-12\" />\n                ) : (\n                  <p className=\"text-2xl font-bold\" data-testid=\"text-pending-records\">{totals.pendingRecords}</p>\n                )}\n                <p className=\"text-sm text-muted-foreground\">Pending</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader className=\"pb-4\">\n          <CardTitle className=\"flex items-center gap-2\">\n            <Calculator className=\"w-5 h-5\" />\n            Service Order Calculator\n          </CardTitle>\n          <CardDescription>\n            Select a period and filter by site or client to calculate service orders\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex flex-wrap items-end gap-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"period-start\">Period Start</Label>\n              <Input\n                id=\"period-start\"\n                type=\"date\"\n                value={periodStart}\n                onChange={(e) => setPeriodStart(e.target.value)}\n                className=\"w-44\"\n                data-testid=\"input-period-start\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"period-end\">Period End</Label>\n              <Input\n                id=\"period-end\"\n                type=\"date\"\n                value={periodEnd}\n                onChange={(e) => setPeriodEnd(e.target.value)}\n                className=\"w-44\"\n                data-testid=\"input-period-end\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"client-filter\">Client</Label>\n              <Select value={selectedClient} onValueChange={setSelectedClient}>\n                <SelectTrigger id=\"client-filter\" className=\"w-48\" data-testid=\"select-client-filter\">\n                  <SelectValue placeholder=\"All clients\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Clients</SelectItem>\n                  {clients.map((client) => (\n                    <SelectItem key={client.id} value={client.id}>\n                      {client.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"site-filter\">Site</Label>\n              <Select value={selectedSite} onValueChange={setSelectedSite}>\n                <SelectTrigger id=\"site-filter\" className=\"w-48\" data-testid=\"select-site-filter\">\n                  <SelectValue placeholder=\"All sites\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Sites</SelectItem>\n                  {sites.map((site) => (\n                    <SelectItem key={site.id} value={site.id}>\n                      {site.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader className=\"pb-4\">\n          <CardTitle className=\"flex items-center gap-2\">\n            <FileText className=\"w-5 h-5\" />\n            Service Orders\n          </CardTitle>\n          <CardDescription>\n            Calculated service orders for the selected period\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"space-y-4\">\n              {[1, 2, 3].map((i) => (\n                <div key={i} className=\"flex items-center gap-4\">\n                  <Skeleton className=\"h-12 w-full\" />\n                </div>\n              ))}\n            </div>\n          ) : serviceOrders.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\" data-testid=\"text-no-orders\">\n              <FileText className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n              <p>No approved time records found for the selected period.</p>\n              <p className=\"text-sm mt-2\">Adjust the date range or filters to see service orders.</p>\n            </div>\n          ) : (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Site</TableHead>\n                  <TableHead>Client</TableHead>\n                  <TableHead>Billing</TableHead>\n                  <TableHead className=\"text-right\">Hours</TableHead>\n                  <TableHead className=\"text-right\">Overtime</TableHead>\n                  <TableHead className=\"text-right\">Workers</TableHead>\n                  <TableHead className=\"text-right\">Records</TableHead>\n                  <TableHead className=\"text-right\">Total Cost</TableHead>\n                  <TableHead className=\"text-right\">Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {serviceOrders.map((order) => (\n                  <TableRow key={order.siteId} data-testid={`row-order-${order.siteId}`}>\n                    <TableCell className=\"font-medium\">\n                      <div className=\"flex items-center gap-2\">\n                        <MapPin className=\"w-4 h-4 text-muted-foreground\" />\n                        <span data-testid={`text-site-name-${order.siteId}`}>{order.siteName}</span>\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-2\">\n                        <Building2 className=\"w-4 h-4 text-muted-foreground\" />\n                        <span data-testid={`text-client-name-${order.siteId}`}>{order.clientName}</span>\n                      </div>\n                    </TableCell>\n                    <TableCell>{getBillingTypeBadge(order.billingType)}</TableCell>\n                    <TableCell className=\"text-right font-medium\" data-testid={`text-hours-${order.siteId}`}>\n                      {formatHours(order.totalHours)}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {order.overtimeHours > 0 ? (\n                        <Badge variant=\"outline\" className=\"border-orange-500 text-orange-600\">\n                          +{formatHours(order.overtimeHours)}\n                        </Badge>\n                      ) : (\n                        <span className=\"text-muted-foreground\">-</span>\n                      )}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      <div className=\"flex items-center justify-end gap-1\">\n                        <Users className=\"w-4 h-4 text-muted-foreground\" />\n                        <span data-testid={`text-workers-${order.siteId}`}>{order.workers.length}</span>\n                      </div>\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      <div className=\"flex items-center justify-end gap-2\">\n                        <Badge variant=\"default\" className=\"bg-green-600\" data-testid={`badge-approved-${order.siteId}`}>\n                          {order.approvedRecords}\n                        </Badge>\n                        {order.pendingRecords > 0 && (\n                          <Badge variant=\"secondary\" data-testid={`badge-pending-${order.siteId}`}>\n                            {order.pendingRecords}\n                          </Badge>\n                        )}\n                      </div>\n                    </TableCell>\n                    <TableCell className=\"text-right font-bold text-green-600\" data-testid={`text-cost-${order.siteId}`}>\n                      {formatCurrency(order.totalCost)}\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center justify-end gap-1\">\n                        <Button\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          onClick={() => setViewingOrder(order)}\n                          data-testid={`button-view-${order.siteId}`}\n                        >\n                          <Eye className=\"w-4 h-4\" />\n                        </Button>\n                        <Button\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          onClick={() => handleExportOrder(order)}\n                          data-testid={`button-export-${order.siteId}`}\n                        >\n                          <Download className=\"w-4 h-4\" />\n                        </Button>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          )}\n        </CardContent>\n      </Card>\n\n      <Dialog open={!!viewingOrder} onOpenChange={(open) => !open && setViewingOrder(null)}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <FileText className=\"w-5 h-5\" />\n              Service Order Details\n            </DialogTitle>\n            <DialogDescription>\n              Detailed breakdown for {viewingOrder?.siteName}\n            </DialogDescription>\n          </DialogHeader>\n          {viewingOrder && (\n            <div className=\"space-y-6\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-1\">\n                  <p className=\"text-sm text-muted-foreground flex items-center gap-1\">\n                    <MapPin className=\"w-4 h-4\" />Site\n                  </p>\n                  <p className=\"font-medium\" data-testid=\"text-detail-site\">\n                    {viewingOrder.siteName}\n                  </p>\n                </div>\n                <div className=\"space-y-1\">\n                  <p className=\"text-sm text-muted-foreground flex items-center gap-1\">\n                    <Building2 className=\"w-4 h-4\" />Client\n                  </p>\n                  <p className=\"font-medium\" data-testid=\"text-detail-client\">\n                    {viewingOrder.clientName}\n                  </p>\n                </div>\n                <div className=\"space-y-1\">\n                  <p className=\"text-sm text-muted-foreground\">Period</p>\n                  <p className=\"font-medium\" data-testid=\"text-detail-period\">\n                    {format(new Date(periodStart), \"dd/MM/yyyy\")} - {format(new Date(periodEnd), \"dd/MM/yyyy\")}\n                  </p>\n                </div>\n                <div className=\"space-y-1\">\n                  <p className=\"text-sm text-muted-foreground\">Billing Type</p>\n                  <div data-testid=\"text-detail-billing\">\n                    {getBillingTypeBadge(viewingOrder.billingType)}\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"border-t pt-4\">\n                <h4 className=\"font-medium mb-3\">Hours Summary</h4>\n                <div className=\"grid grid-cols-3 gap-4\">\n                  <div className=\"bg-muted p-3 rounded-md text-center\">\n                    <p className=\"text-2xl font-bold\" data-testid=\"text-detail-regular-hours\">\n                      {formatHours(viewingOrder.regularHours)}\n                    </p>\n                    <p className=\"text-sm text-muted-foreground\">Regular</p>\n                  </div>\n                  <div className=\"bg-muted p-3 rounded-md text-center\">\n                    <p className=\"text-2xl font-bold text-orange-600\" data-testid=\"text-detail-overtime-hours\">\n                      {formatHours(viewingOrder.overtimeHours)}\n                    </p>\n                    <p className=\"text-sm text-muted-foreground\">Overtime</p>\n                  </div>\n                  <div className=\"bg-muted p-3 rounded-md text-center\">\n                    <p className=\"text-2xl font-bold\" data-testid=\"text-detail-total-hours\">\n                      {formatHours(viewingOrder.totalHours)}\n                    </p>\n                    <p className=\"text-sm text-muted-foreground\">Total</p>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"border-t pt-4\">\n                <h4 className=\"font-medium mb-3\">Cost Breakdown</h4>\n                <div className=\"space-y-2\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Rate:</span>\n                    <span className=\"font-medium\" data-testid=\"text-detail-rate\">\n                      {formatCurrency(viewingOrder.hourlyRate)}\n                      {viewingOrder.billingType === \"hourly\" ? \"/hour\" : viewingOrder.billingType === \"daily\" ? \"/day\" : \"\"}\n                    </span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Regular Cost:</span>\n                    <span data-testid=\"text-detail-regular-cost\">{formatCurrency(viewingOrder.regularCost)}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Overtime Cost ({overtimeMultiplier}x):</span>\n                    <span data-testid=\"text-detail-overtime-cost\">{formatCurrency(viewingOrder.overtimeCost)}</span>\n                  </div>\n                  <div className=\"flex justify-between border-t pt-2\">\n                    <span className=\"font-medium\">Total:</span>\n                    <span className=\"font-bold text-lg text-green-600\" data-testid=\"text-detail-total-cost\">\n                      {formatCurrency(viewingOrder.totalCost)}\n                    </span>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"border-t pt-4\">\n                <h4 className=\"font-medium mb-3\">Additional Info</h4>\n                <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                  <div>\n                    <span className=\"text-muted-foreground\">Work Days: </span>\n                    <span className=\"font-medium\" data-testid=\"text-detail-work-days\">{viewingOrder.workDays}</span>\n                  </div>\n                  <div>\n                    <span className=\"text-muted-foreground\">Workers: </span>\n                    <span className=\"font-medium\" data-testid=\"text-detail-worker-count\">{viewingOrder.workers.length}</span>\n                  </div>\n                  <div>\n                    <span className=\"text-muted-foreground\">Approved Records: </span>\n                    <span className=\"font-medium\" data-testid=\"text-detail-approved\">{viewingOrder.approvedRecords}</span>\n                  </div>\n                  <div>\n                    <span className=\"text-muted-foreground\">Pending Records: </span>\n                    <span className=\"font-medium\" data-testid=\"text-detail-pending\">{viewingOrder.pendingRecords}</span>\n                  </div>\n                </div>\n              </div>\n\n              {viewingOrder.workers.length > 0 && (\n                <div className=\"border-t pt-4\">\n                  <h4 className=\"font-medium mb-2\">Workers</h4>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {viewingOrder.workers.map((workerName, index) => (\n                      <Badge key={index} variant=\"secondary\" data-testid={`badge-worker-${index}`}>\n                        <Users className=\"w-3 h-3 mr-1\" />\n                        {workerName}\n                      </Badge>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n          <DialogFooter className=\"gap-2\">\n            <Button variant=\"outline\" onClick={() => setViewingOrder(null)} data-testid=\"button-close-detail\">\n              Close\n            </Button>\n            {viewingOrder && (\n              <Button onClick={() => handleExportOrder(viewingOrder)} data-testid=\"button-detail-export\">\n                <Download className=\"w-4 h-4 mr-2\" />\n                Export\n              </Button>\n            )}\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n\nexport default function ServiceOrders() {\n  return (\n    <ManagerGuard>\n      <ServiceOrdersContent />\n    </ManagerGuard>\n  );\n}\n","path":null,"size_bytes":25608,"size_tokens":null},"client/src/components/RoleGuard.tsx":{"content":"import { useAuth, type UserRole } from \"@/hooks/useAuth\";\nimport { useLocation } from \"wouter\";\nimport { useTranslation } from \"react-i18next\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { ShieldAlert, ArrowLeft } from \"lucide-react\";\n\ninterface RoleGuardProps {\n  children: React.ReactNode;\n  allowedRoles?: UserRole[];\n  requiredRole?: UserRole;\n  fallback?: React.ReactNode;\n}\n\nfunction AccessDenied() {\n  const { t } = useTranslation();\n  const [, setLocation] = useLocation();\n\n  return (\n    <div className=\"flex items-center justify-center min-h-[60vh] p-4\">\n      <Card className=\"max-w-md w-full\">\n        <CardHeader className=\"text-center\">\n          <div className=\"mx-auto w-12 h-12 rounded-full bg-destructive/10 flex items-center justify-center mb-4\">\n            <ShieldAlert className=\"h-6 w-6 text-destructive\" />\n          </div>\n          <CardTitle>{t(\"access.denied\", \"Acesso Negado\")}</CardTitle>\n          <CardDescription>\n            {t(\"access.noPermission\", \"No tem permisso para aceder a esta pgina.\")}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Button\n            variant=\"outline\"\n            className=\"w-full\"\n            onClick={() => setLocation(\"/dashboard\")}\n            data-testid=\"button-go-dashboard\"\n          >\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            {t(\"access.goToDashboard\", \"Voltar ao Painel\")}\n          </Button>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nexport function RoleGuard({\n  children,\n  allowedRoles,\n  requiredRole,\n  fallback,\n}: RoleGuardProps) {\n  const { user, isLoading, hasRole, hasAnyRole } = useAuth();\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[60vh]\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n      </div>\n    );\n  }\n\n  if (!user) {\n    return fallback || <AccessDenied />;\n  }\n\n  if (requiredRole && !hasRole(requiredRole)) {\n    return fallback || <AccessDenied />;\n  }\n\n  if (allowedRoles && !hasAnyRole(allowedRoles)) {\n    return fallback || <AccessDenied />;\n  }\n\n  return <>{children}</>;\n}\n\nexport function ManagerGuard({ children }: { children: React.ReactNode }) {\n  return <RoleGuard requiredRole=\"manager\">{children}</RoleGuard>;\n}\n\nexport function AdminGuard({ children }: { children: React.ReactNode }) {\n  return <RoleGuard requiredRole=\"admin\">{children}</RoleGuard>;\n}\n\nexport function SuperAdminGuard({ children }: { children: React.ReactNode }) {\n  return <RoleGuard requiredRole=\"superadmin\">{children}</RoleGuard>;\n}\n","path":null,"size_bytes":2707,"size_tokens":null},"client/src/pages/admin/ToolManagement.tsx":{"content":"import { useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { ManagerGuard } from \"@/components/RoleGuard\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { \n  Wrench, \n  Search, \n  Pencil, \n  Plus, \n  Trash2, \n  QrCode,\n  Package,\n  ArrowRightLeft,\n  CheckCircle,\n  XCircle,\n  Clock,\n  AlertTriangle\n} from \"lucide-react\";\nimport type { Tool, Site, User } from \"@shared/schema\";\n\nconst toolFormSchema = z.object({\n  name: z.string().min(1, \"Tool name is required\"),\n  category: z.string().optional(),\n  serialNumber: z.string().optional(),\n  estimatedValue: z.string().optional(),\n  status: z.enum([\"available\", \"in_use\", \"maintenance\", \"lost\", \"stolen\"]).default(\"available\"),\n});\n\ntype ToolFormData = z.infer<typeof toolFormSchema>;\n\nconst checkoutSchema = z.object({\n  siteId: z.string().optional(),\n  notes: z.string().optional(),\n  condition: z.enum([\"good\", \"damaged\"]).default(\"good\"),\n});\n\ntype CheckoutFormData = z.infer<typeof checkoutSchema>;\n\ninterface ToolTransaction {\n  id: string;\n  toolId: string;\n  userId: string;\n  siteId: string | null;\n  type: string;\n  notes: string | null;\n  condition: string | null;\n  createdAt: string;\n}\n\nfunction ToolManagementContent() {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const { canManageTools, user } = useAuth();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\");\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n  const [editingTool, setEditingTool] = useState<Tool | null>(null);\n  const [deletingTool, setDeletingTool] = useState<Tool | null>(null);\n  const [checkoutTool, setCheckoutTool] = useState<Tool | null>(null);\n  const [checkinTool, setCheckinTool] = useState<Tool | null>(null);\n  const [viewingTransactions, setViewingTransactions] = useState<Tool | null>(null);\n\n  const { data: tools = [], isLoading } = useQuery<Tool[]>({\n    queryKey: [\"/api/tools\"],\n  });\n\n  const { data: sites = [] } = useQuery<Site[]>({\n    queryKey: [\"/api/sites\"],\n  });\n\n  const { data: users = [] } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const { data: transactions = [] } = useQuery<ToolTransaction[]>({\n    queryKey: [\"/api/tools\", viewingTransactions?.id, \"transactions\"],\n    enabled: !!viewingTransactions,\n  });\n\n  const form = useForm<ToolFormData>({\n    resolver: zodResolver(toolFormSchema),\n    defaultValues: {\n      name: \"\",\n      category: \"\",\n      serialNumber: \"\",\n      estimatedValue: \"\",\n      status: \"available\",\n    },\n  });\n\n  const checkoutForm = useForm<CheckoutFormData>({\n    resolver: zodResolver(checkoutSchema),\n    defaultValues: {\n      siteId: \"\",\n      notes: \"\",\n      condition: \"good\",\n    },\n  });\n\n  const checkinForm = useForm<CheckoutFormData>({\n    resolver: zodResolver(checkoutSchema),\n    defaultValues: {\n      siteId: \"\",\n      notes: \"\",\n      condition: \"good\",\n    },\n  });\n\n  const createToolMutation = useMutation({\n    mutationFn: async (data: ToolFormData) => {\n      return apiRequest(\"POST\", \"/api/tools\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/tools\"] });\n      setIsAddDialogOpen(false);\n      form.reset();\n      toast({ title: t(\"common.save\"), description: \"Tool created successfully\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"Error\", description: \"Failed to create tool\" });\n    },\n  });\n\n  const updateToolMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<ToolFormData> }) => {\n      return apiRequest(\"PATCH\", `/api/tools/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/tools\"] });\n      setEditingTool(null);\n      form.reset();\n      toast({ title: t(\"common.save\"), description: \"Tool updated successfully\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"Error\", description: \"Failed to update tool\" });\n    },\n  });\n\n  const deleteToolMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest(\"DELETE\", `/api/tools/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/tools\"] });\n      setDeletingTool(null);\n      toast({ title: t(\"common.delete\"), description: \"Tool deleted successfully\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"Error\", description: \"Failed to delete tool\" });\n    },\n  });\n\n  const checkoutMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: CheckoutFormData }) => {\n      return apiRequest(\"POST\", `/api/tools/${id}/checkout`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/tools\"] });\n      setCheckoutTool(null);\n      checkoutForm.reset();\n      toast({ title: \"Success\", description: \"Tool checked out successfully\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"Error\", description: \"Failed to checkout tool\" });\n    },\n  });\n\n  const checkinMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: CheckoutFormData }) => {\n      return apiRequest(\"POST\", `/api/tools/${id}/checkin`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/tools\"] });\n      setCheckinTool(null);\n      checkinForm.reset();\n      toast({ title: \"Success\", description: \"Tool returned successfully\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"Error\", description: \"Failed to return tool\" });\n    },\n  });\n\n  const filteredTools = tools.filter((tool) => {\n    const matchesSearch = \n      tool.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      tool.category?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      tool.serialNumber?.toLowerCase().includes(searchTerm.toLowerCase());\n    const matchesStatus = statusFilter === \"all\" || tool.status === statusFilter;\n    return matchesSearch && matchesStatus;\n  });\n\n  const handleSubmit = (data: ToolFormData) => {\n    if (editingTool) {\n      updateToolMutation.mutate({ id: editingTool.id, data });\n    } else {\n      createToolMutation.mutate(data);\n    }\n  };\n\n  const handleEdit = (tool: Tool) => {\n    setEditingTool(tool);\n    form.reset({\n      name: tool.name,\n      category: tool.category || \"\",\n      serialNumber: tool.serialNumber || \"\",\n      estimatedValue: tool.estimatedValue || \"\",\n      status: tool.status as \"available\" | \"in_use\" | \"maintenance\" | \"lost\" | \"stolen\" || \"available\",\n    });\n  };\n\n  const handleCheckout = (data: CheckoutFormData) => {\n    if (checkoutTool) {\n      checkoutMutation.mutate({ id: checkoutTool.id, data });\n    }\n  };\n\n  const handleCheckin = (data: CheckoutFormData) => {\n    if (checkinTool) {\n      checkinMutation.mutate({ id: checkinTool.id, data });\n    }\n  };\n\n  const getStatusBadge = (status: string | null) => {\n    switch (status) {\n      case \"available\":\n        return <Badge variant=\"default\" className=\"bg-green-600\"><CheckCircle className=\"w-3 h-3 mr-1\" />Available</Badge>;\n      case \"in_use\":\n        return <Badge variant=\"secondary\"><Clock className=\"w-3 h-3 mr-1\" />In Use</Badge>;\n      case \"maintenance\":\n        return <Badge variant=\"outline\"><Wrench className=\"w-3 h-3 mr-1\" />Maintenance</Badge>;\n      case \"lost\":\n        return <Badge variant=\"destructive\"><XCircle className=\"w-3 h-3 mr-1\" />Lost</Badge>;\n      case \"stolen\":\n        return <Badge variant=\"destructive\"><AlertTriangle className=\"w-3 h-3 mr-1\" />Stolen</Badge>;\n      default:\n        return <Badge variant=\"outline\">{status}</Badge>;\n    }\n  };\n\n  const getCurrentUser = (userId: string | null) => {\n    if (!userId) return \"-\";\n    const currentUser = users.find(u => u.id === userId);\n    return currentUser ? `${currentUser.firstName} ${currentUser.lastName}` : userId;\n  };\n\n  const getCurrentSite = (siteId: string | null) => {\n    if (!siteId) return \"-\";\n    const site = sites.find(s => s.id === siteId);\n    return site?.name || siteId;\n  };\n\n  const toolStats = {\n    total: tools.length,\n    available: tools.filter(t => t.status === \"available\").length,\n    inUse: tools.filter(t => t.status === \"in_use\").length,\n    maintenance: tools.filter(t => t.status === \"maintenance\").length,\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex flex-wrap items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-bold\" data-testid=\"text-page-title\">{t(\"admin.toolManagement\")}</h1>\n          <p className=\"text-muted-foreground\">\n            Manage company tools and track check-in/check-out\n          </p>\n        </div>\n        {canManageTools && (\n          <Button onClick={() => setIsAddDialogOpen(true)} data-testid=\"button-add-tool\">\n            <Plus className=\"w-4 h-4 mr-2\" />\n            Add Tool\n          </Button>\n        )}\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-4\">\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-2\">\n              <Package className=\"w-8 h-8 text-muted-foreground\" />\n              <div>\n                <p className=\"text-2xl font-bold\">{toolStats.total}</p>\n                <p className=\"text-sm text-muted-foreground\">Total Tools</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-2\">\n              <CheckCircle className=\"w-8 h-8 text-green-600\" />\n              <div>\n                <p className=\"text-2xl font-bold\">{toolStats.available}</p>\n                <p className=\"text-sm text-muted-foreground\">Available</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-2\">\n              <Clock className=\"w-8 h-8 text-blue-600\" />\n              <div>\n                <p className=\"text-2xl font-bold\">{toolStats.inUse}</p>\n                <p className=\"text-sm text-muted-foreground\">In Use</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-2\">\n              <Wrench className=\"w-8 h-8 text-orange-600\" />\n              <div>\n                <p className=\"text-2xl font-bold\">{toolStats.maintenance}</p>\n                <p className=\"text-sm text-muted-foreground\">Maintenance</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader className=\"flex flex-row items-center justify-between gap-4 space-y-0 pb-4\">\n          <div className=\"flex flex-wrap items-center gap-4\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4\" />\n              <Input\n                placeholder=\"Search tools...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10 w-64\"\n                data-testid=\"input-search-tools\"\n              />\n            </div>\n            <Select value={statusFilter} onValueChange={setStatusFilter}>\n              <SelectTrigger className=\"w-40\" data-testid=\"select-status-filter\">\n                <SelectValue placeholder=\"Filter by status\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All Status</SelectItem>\n                <SelectItem value=\"available\">Available</SelectItem>\n                <SelectItem value=\"in_use\">In Use</SelectItem>\n                <SelectItem value=\"maintenance\">Maintenance</SelectItem>\n                <SelectItem value=\"lost\">Lost</SelectItem>\n                <SelectItem value=\"stolen\">Stolen</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"text-center py-8 text-muted-foreground\">Loading tools...</div>\n          ) : filteredTools.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              {searchTerm || statusFilter !== \"all\" ? \"No tools match your search\" : \"No tools found. Add your first tool to get started.\"}\n            </div>\n          ) : (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Name</TableHead>\n                  <TableHead>Category</TableHead>\n                  <TableHead>Serial Number</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead>Current User</TableHead>\n                  <TableHead>Site</TableHead>\n                  <TableHead className=\"text-right\">Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {filteredTools.map((tool) => (\n                  <TableRow key={tool.id} data-testid={`row-tool-${tool.id}`}>\n                    <TableCell className=\"font-medium\">{tool.name}</TableCell>\n                    <TableCell>{tool.category || \"-\"}</TableCell>\n                    <TableCell className=\"font-mono text-sm\">{tool.serialNumber || \"-\"}</TableCell>\n                    <TableCell>{getStatusBadge(tool.status)}</TableCell>\n                    <TableCell>{getCurrentUser(tool.currentUserId)}</TableCell>\n                    <TableCell>{getCurrentSite(tool.currentSiteId)}</TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center justify-end gap-1\">\n                        {tool.status === \"available\" && (\n                          <Button\n                            size=\"sm\"\n                            variant=\"outline\"\n                            onClick={() => {\n                              setCheckoutTool(tool);\n                              checkoutForm.reset();\n                            }}\n                            data-testid={`button-checkout-${tool.id}`}\n                          >\n                            <ArrowRightLeft className=\"w-4 h-4 mr-1\" />\n                            Borrow\n                          </Button>\n                        )}\n                        {tool.status === \"in_use\" && tool.currentUserId === user?.id && (\n                          <Button\n                            size=\"sm\"\n                            variant=\"outline\"\n                            onClick={() => {\n                              setCheckinTool(tool);\n                              checkinForm.reset();\n                            }}\n                            data-testid={`button-checkin-${tool.id}`}\n                          >\n                            <CheckCircle className=\"w-4 h-4 mr-1\" />\n                            Return\n                          </Button>\n                        )}\n                        <Button\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          onClick={() => setViewingTransactions(tool)}\n                          data-testid={`button-history-${tool.id}`}\n                        >\n                          <QrCode className=\"w-4 h-4\" />\n                        </Button>\n                        {canManageTools && (\n                          <>\n                            <Button\n                              size=\"icon\"\n                              variant=\"ghost\"\n                              onClick={() => handleEdit(tool)}\n                              data-testid={`button-edit-${tool.id}`}\n                            >\n                              <Pencil className=\"w-4 h-4\" />\n                            </Button>\n                            <Button\n                              size=\"icon\"\n                              variant=\"ghost\"\n                              onClick={() => setDeletingTool(tool)}\n                              data-testid={`button-delete-${tool.id}`}\n                            >\n                              <Trash2 className=\"w-4 h-4\" />\n                            </Button>\n                          </>\n                        )}\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          )}\n        </CardContent>\n      </Card>\n\n      <Dialog open={isAddDialogOpen || !!editingTool} onOpenChange={(open) => {\n        if (!open) {\n          setIsAddDialogOpen(false);\n          setEditingTool(null);\n          form.reset();\n        }\n      }}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>{editingTool ? \"Edit Tool\" : \"Add New Tool\"}</DialogTitle>\n            <DialogDescription>\n              {editingTool ? \"Update tool information\" : \"Add a new tool to the inventory\"}\n            </DialogDescription>\n          </DialogHeader>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(handleSubmit)} className=\"space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"name\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Tool Name</FormLabel>\n                    <FormControl>\n                      <Input {...field} placeholder=\"e.g. Power Drill\" data-testid=\"input-tool-name\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"category\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Category</FormLabel>\n                    <FormControl>\n                      <Input {...field} placeholder=\"e.g. Power Tools\" data-testid=\"input-tool-category\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"serialNumber\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Serial Number</FormLabel>\n                    <FormControl>\n                      <Input {...field} placeholder=\"e.g. SN-12345\" data-testid=\"input-tool-serial\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"estimatedValue\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Estimated Value</FormLabel>\n                    <FormControl>\n                      <Input {...field} type=\"number\" step=\"0.01\" placeholder=\"0.00\" data-testid=\"input-tool-value\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              {editingTool && (\n                <FormField\n                  control={form.control}\n                  name=\"status\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Status</FormLabel>\n                      <Select onValueChange={field.onChange} value={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-tool-status\">\n                            <SelectValue placeholder=\"Select status\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"available\">Available</SelectItem>\n                          <SelectItem value=\"in_use\">In Use</SelectItem>\n                          <SelectItem value=\"maintenance\">Maintenance</SelectItem>\n                          <SelectItem value=\"lost\">Lost</SelectItem>\n                          <SelectItem value=\"stolen\">Stolen</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              )}\n              <DialogFooter>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => {\n                    setIsAddDialogOpen(false);\n                    setEditingTool(null);\n                    form.reset();\n                  }}\n                >\n                  {t(\"common.cancel\")}\n                </Button>\n                <Button \n                  type=\"submit\" \n                  disabled={createToolMutation.isPending || updateToolMutation.isPending}\n                  data-testid=\"button-save-tool\"\n                >\n                  {createToolMutation.isPending || updateToolMutation.isPending ? \"Saving...\" : t(\"common.save\")}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={!!checkoutTool} onOpenChange={(open) => {\n        if (!open) {\n          setCheckoutTool(null);\n          checkoutForm.reset();\n        }\n      }}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Borrow Tool</DialogTitle>\n            <DialogDescription>\n              Checking out: {checkoutTool?.name}\n            </DialogDescription>\n          </DialogHeader>\n          <Form {...checkoutForm}>\n            <form onSubmit={checkoutForm.handleSubmit(handleCheckout)} className=\"space-y-4\">\n              <FormField\n                control={checkoutForm.control}\n                name=\"siteId\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Site (Optional)</FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-checkout-site\">\n                          <SelectValue placeholder=\"Select a site\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {sites.map((site) => (\n                          <SelectItem key={site.id} value={site.id}>{site.name}</SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={checkoutForm.control}\n                name=\"condition\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Tool Condition</FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-checkout-condition\">\n                          <SelectValue />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"good\">Good</SelectItem>\n                        <SelectItem value=\"damaged\">Damaged</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={checkoutForm.control}\n                name=\"notes\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Notes (Optional)</FormLabel>\n                    <FormControl>\n                      <Input {...field} placeholder=\"Any notes...\" data-testid=\"input-checkout-notes\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <DialogFooter>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => {\n                    setCheckoutTool(null);\n                    checkoutForm.reset();\n                  }}\n                >\n                  {t(\"common.cancel\")}\n                </Button>\n                <Button \n                  type=\"submit\" \n                  disabled={checkoutMutation.isPending}\n                  data-testid=\"button-confirm-checkout\"\n                >\n                  {checkoutMutation.isPending ? \"Processing...\" : \"Borrow Tool\"}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={!!checkinTool} onOpenChange={(open) => {\n        if (!open) {\n          setCheckinTool(null);\n          checkinForm.reset();\n        }\n      }}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Return Tool</DialogTitle>\n            <DialogDescription>\n              Returning: {checkinTool?.name}\n            </DialogDescription>\n          </DialogHeader>\n          <Form {...checkinForm}>\n            <form onSubmit={checkinForm.handleSubmit(handleCheckin)} className=\"space-y-4\">\n              <FormField\n                control={checkinForm.control}\n                name=\"condition\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Tool Condition on Return</FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-checkin-condition\">\n                          <SelectValue />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"good\">Good</SelectItem>\n                        <SelectItem value=\"damaged\">Damaged</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={checkinForm.control}\n                name=\"notes\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Notes (Optional)</FormLabel>\n                    <FormControl>\n                      <Input {...field} placeholder=\"Any notes about the return...\" data-testid=\"input-checkin-notes\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <DialogFooter>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => {\n                    setCheckinTool(null);\n                    checkinForm.reset();\n                  }}\n                >\n                  {t(\"common.cancel\")}\n                </Button>\n                <Button \n                  type=\"submit\" \n                  disabled={checkinMutation.isPending}\n                  data-testid=\"button-confirm-checkin\"\n                >\n                  {checkinMutation.isPending ? \"Processing...\" : \"Return Tool\"}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={!!viewingTransactions} onOpenChange={(open) => {\n        if (!open) setViewingTransactions(null);\n      }}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Tool History: {viewingTransactions?.name}</DialogTitle>\n            <DialogDescription>\n              Check-in/check-out transaction history\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"max-h-96 overflow-y-auto\">\n            {transactions.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                No transactions found for this tool\n              </div>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Date</TableHead>\n                    <TableHead>Type</TableHead>\n                    <TableHead>User</TableHead>\n                    <TableHead>Condition</TableHead>\n                    <TableHead>Notes</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {transactions.map((tx) => (\n                    <TableRow key={tx.id}>\n                      <TableCell className=\"text-sm\">\n                        {new Date(tx.createdAt).toLocaleDateString()}\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant={tx.type === \"checkout\" ? \"secondary\" : \"default\"}>\n                          {tx.type === \"checkout\" ? \"Borrowed\" : \"Returned\"}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>{getCurrentUser(tx.userId)}</TableCell>\n                      <TableCell>\n                        <Badge variant={tx.condition === \"good\" ? \"outline\" : \"destructive\"}>\n                          {tx.condition || \"-\"}\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"text-sm text-muted-foreground\">\n                        {tx.notes || \"-\"}\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            )}\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setViewingTransactions(null)}>\n              Close\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <AlertDialog open={!!deletingTool} onOpenChange={(open) => !open && setDeletingTool(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Tool</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete \"{deletingTool?.name}\"? This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>{t(\"common.cancel\")}</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => deletingTool && deleteToolMutation.mutate(deletingTool.id)}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n              data-testid=\"button-confirm-delete\"\n            >\n              {deleteToolMutation.isPending ? \"Deleting...\" : t(\"common.delete\")}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n\nexport default function ToolManagement() {\n  return (\n    <ManagerGuard>\n      <ToolManagementContent />\n    </ManagerGuard>\n  );\n}\n","path":null,"size_bytes":32448,"size_tokens":null},"client/src/pages/Login.tsx":{"content":"import { useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { Link, useLocation } from \"wouter\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { ThemeToggle } from \"@/components/ThemeToggle\";\nimport { LanguageSelector } from \"@/components/LanguageSelector\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { HardHat, LogIn, UserPlus, ArrowLeft } from \"lucide-react\";\n\nconst loginSchema = z.object({\n  username: z.string().min(1, \"Username is required\"),\n  password: z.string().min(1, \"Password is required\"),\n});\n\nconst registerSchema = z.object({\n  username: z.string().min(3, \"Username must be at least 3 characters\"),\n  email: z.string().email(\"Invalid email address\"),\n  password: z.string().min(6, \"Password must be at least 6 characters\"),\n  confirmPassword: z.string().min(1, \"Please confirm your password\"),\n  firstName: z.string().min(1, \"First name is required\"),\n  lastName: z.string().min(1, \"Last name is required\"),\n  companyName: z.string().min(2, \"Company name is required\"),\n  subscriptionPlan: z.enum([\"basic\", \"professional\", \"enterprise\"]),\n}).refine((data) => data.password === data.confirmPassword, {\n  message: \"Passwords don't match\",\n  path: [\"confirmPassword\"],\n});\n\ntype LoginFormData = z.infer<typeof loginSchema>;\ntype RegisterFormData = z.infer<typeof registerSchema>;\n\nexport default function Login() {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const [, setLocation] = useLocation();\n  const [activeTab, setActiveTab] = useState<\"login\" | \"register\">(\"login\");\n\n  const loginForm = useForm<LoginFormData>({\n    resolver: zodResolver(loginSchema),\n    defaultValues: {\n      username: \"\",\n      password: \"\",\n    },\n  });\n\n  const registerForm = useForm<RegisterFormData>({\n    resolver: zodResolver(registerSchema),\n    defaultValues: {\n      username: \"\",\n      email: \"\",\n      password: \"\",\n      confirmPassword: \"\",\n      firstName: \"\",\n      lastName: \"\",\n      companyName: \"\",\n      subscriptionPlan: \"basic\",\n    },\n  });\n\n  const loginMutation = useMutation({\n    mutationFn: async (data: LoginFormData) => {\n      const response = await apiRequest(\"POST\", \"/api/auth/local-login\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n      toast({\n        title: t(\"auth.loginSuccess\", \"Login successful\"),\n        description: t(\"auth.welcomeBack\", \"Welcome back!\"),\n      });\n      setLocation(\"/dashboard\");\n    },\n    onError: (error: Error) => {\n      toast({\n        title: t(\"auth.loginError\", \"Login failed\"),\n        description: error.message || t(\"auth.invalidCredentials\", \"Invalid username or password\"),\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const registerMutation = useMutation({\n    mutationFn: async (data: RegisterFormData) => {\n      const { confirmPassword, ...registerData } = data;\n      const response = await apiRequest(\"POST\", \"/api/auth/register\", registerData);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n      toast({\n        title: t(\"auth.registerSuccess\", \"Registration successful\"),\n        description: t(\"auth.accountCreated\", \"Your account has been created. You are now logged in.\"),\n      });\n      setLocation(\"/dashboard\");\n    },\n    onError: (error: Error) => {\n      toast({\n        title: t(\"auth.registerError\", \"Registration failed\"),\n        description: error.message || t(\"auth.registrationFailed\", \"Could not create account\"),\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleLogin = (data: LoginFormData) => {\n    loginMutation.mutate(data);\n  };\n\n  const handleRegister = (data: RegisterFormData) => {\n    registerMutation.mutate(data);\n  };\n\n  const handleReplitAuth = () => {\n    window.location.href = \"/api/login\";\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background flex flex-col\">\n      <header className=\"border-b bg-background/95 backdrop-blur sticky top-0 z-50\">\n        <div className=\"container mx-auto flex h-16 items-center justify-between gap-4 px-4\">\n          <Link href=\"/\" className=\"flex items-center gap-2\">\n            <HardHat className=\"h-8 w-8 text-primary\" />\n            <span className=\"text-xl font-bold\">ConstructTrack</span>\n          </Link>\n          <div className=\"flex items-center gap-2\">\n            <LanguageSelector />\n            <ThemeToggle />\n          </div>\n        </div>\n      </header>\n\n      <main className=\"flex-1 flex items-center justify-center p-4\">\n        <Card className=\"w-full max-w-md\">\n          <CardHeader className=\"text-center\">\n            <CardTitle className=\"text-2xl\">{t(\"auth.welcome\", \"Welcome\")}</CardTitle>\n            <CardDescription>\n              {t(\"auth.signInOrCreate\", \"Sign in to your account or create a new one\")}\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Tabs value={activeTab} onValueChange={(v) => setActiveTab(v as \"login\" | \"register\")}>\n              <TabsList className=\"grid w-full grid-cols-2 mb-6\">\n                <TabsTrigger value=\"login\" data-testid=\"tab-login\">\n                  <LogIn className=\"w-4 h-4 mr-2\" />\n                  {t(\"auth.login\", \"Login\")}\n                </TabsTrigger>\n                <TabsTrigger value=\"register\" data-testid=\"tab-register\">\n                  <UserPlus className=\"w-4 h-4 mr-2\" />\n                  {t(\"auth.register\", \"Register\")}\n                </TabsTrigger>\n              </TabsList>\n\n              <TabsContent value=\"login\">\n                <Form {...loginForm}>\n                  <form onSubmit={loginForm.handleSubmit(handleLogin)} className=\"space-y-4\">\n                    <FormField\n                      control={loginForm.control}\n                      name=\"username\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t(\"auth.username\", \"Username\")}</FormLabel>\n                          <FormControl>\n                            <Input\n                              placeholder={t(\"auth.enterUsername\", \"Enter your username\")}\n                              data-testid=\"input-login-username\"\n                              {...field}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={loginForm.control}\n                      name=\"password\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t(\"auth.password\", \"Password\")}</FormLabel>\n                          <FormControl>\n                            <Input\n                              type=\"password\"\n                              placeholder={t(\"auth.enterPassword\", \"Enter your password\")}\n                              data-testid=\"input-login-password\"\n                              {...field}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <Button\n                      type=\"submit\"\n                      className=\"w-full\"\n                      disabled={loginMutation.isPending}\n                      data-testid=\"button-login-submit\"\n                    >\n                      {loginMutation.isPending ? t(\"auth.loggingIn\", \"Logging in...\") : t(\"auth.login\", \"Login\")}\n                    </Button>\n                  </form>\n                </Form>\n              </TabsContent>\n\n              <TabsContent value=\"register\">\n                <Form {...registerForm}>\n                  <form onSubmit={registerForm.handleSubmit(handleRegister)} className=\"space-y-4\">\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <FormField\n                        control={registerForm.control}\n                        name=\"firstName\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>{t(\"auth.firstName\", \"First Name\")}</FormLabel>\n                            <FormControl>\n                              <Input\n                                placeholder={t(\"auth.enterFirstName\", \"First name\")}\n                                data-testid=\"input-register-firstname\"\n                                {...field}\n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={registerForm.control}\n                        name=\"lastName\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>{t(\"auth.lastName\", \"Last Name\")}</FormLabel>\n                            <FormControl>\n                              <Input\n                                placeholder={t(\"auth.enterLastName\", \"Last name\")}\n                                data-testid=\"input-register-lastname\"\n                                {...field}\n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n                    <FormField\n                      control={registerForm.control}\n                      name=\"companyName\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t(\"auth.companyName\", \"Company Name\")}</FormLabel>\n                          <FormControl>\n                            <Input\n                              placeholder={t(\"auth.enterCompanyName\", \"Enter your company name\")}\n                              data-testid=\"input-register-company\"\n                              {...field}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={registerForm.control}\n                      name=\"subscriptionPlan\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t(\"auth.subscriptionPlan\", \"Subscription Plan\")}</FormLabel>\n                          <Select onValueChange={field.onChange} defaultValue={field.value}>\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-register-plan\">\n                                <SelectValue placeholder={t(\"auth.selectPlan\", \"Select a plan\")} />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              <SelectItem value=\"basic\">{t(\"plans.basic\", \"Basic\")} - {t(\"plans.basicDesc\", \"Essential features\")}</SelectItem>\n                              <SelectItem value=\"professional\">{t(\"plans.professional\", \"Professional\")} - {t(\"plans.professionalDesc\", \"Advanced features\")}</SelectItem>\n                              <SelectItem value=\"enterprise\">{t(\"plans.enterprise\", \"Enterprise\")} - {t(\"plans.enterpriseDesc\", \"Full access\")}</SelectItem>\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={registerForm.control}\n                      name=\"username\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t(\"auth.username\", \"Username\")}</FormLabel>\n                          <FormControl>\n                            <Input\n                              placeholder={t(\"auth.chooseUsername\", \"Choose a username\")}\n                              data-testid=\"input-register-username\"\n                              {...field}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={registerForm.control}\n                      name=\"email\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t(\"auth.email\", \"Email\")}</FormLabel>\n                          <FormControl>\n                            <Input\n                              type=\"email\"\n                              placeholder={t(\"auth.enterEmail\", \"Enter your email\")}\n                              data-testid=\"input-register-email\"\n                              {...field}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={registerForm.control}\n                      name=\"password\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t(\"auth.password\", \"Password\")}</FormLabel>\n                          <FormControl>\n                            <Input\n                              type=\"password\"\n                              placeholder={t(\"auth.createPassword\", \"Create a password\")}\n                              data-testid=\"input-register-password\"\n                              {...field}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={registerForm.control}\n                      name=\"confirmPassword\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t(\"auth.confirmPassword\", \"Confirm Password\")}</FormLabel>\n                          <FormControl>\n                            <Input\n                              type=\"password\"\n                              placeholder={t(\"auth.confirmYourPassword\", \"Confirm your password\")}\n                              data-testid=\"input-register-confirm-password\"\n                              {...field}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <Button\n                      type=\"submit\"\n                      className=\"w-full\"\n                      disabled={registerMutation.isPending}\n                      data-testid=\"button-register-submit\"\n                    >\n                      {registerMutation.isPending ? t(\"auth.creating\", \"Creating account...\") : t(\"auth.createAccount\", \"Create Account\")}\n                    </Button>\n                  </form>\n                </Form>\n              </TabsContent>\n            </Tabs>\n\n            <div className=\"relative my-6\">\n              <div className=\"absolute inset-0 flex items-center\">\n                <span className=\"w-full border-t\" />\n              </div>\n              <div className=\"relative flex justify-center text-xs uppercase\">\n                <span className=\"bg-card px-2 text-muted-foreground\">\n                  {t(\"auth.orContinueWith\", \"Or continue with\")}\n                </span>\n              </div>\n            </div>\n\n            <Button\n              variant=\"outline\"\n              className=\"w-full\"\n              onClick={handleReplitAuth}\n              data-testid=\"button-replit-auth\"\n            >\n              <svg className=\"w-4 h-4 mr-2\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                <path d=\"M2 2h20v20H2V2zm2 2v16h16V4H4zm2 2h12v12H6V6z\"/>\n              </svg>\n              {t(\"auth.signInWithReplit\", \"Sign in with Replit\")}\n            </Button>\n\n            <div className=\"mt-6 text-center\">\n              <Link href=\"/\" className=\"text-sm text-muted-foreground hover:text-foreground inline-flex items-center gap-1\">\n                <ArrowLeft className=\"w-3 h-3\" />\n                {t(\"auth.backToHome\", \"Back to home\")}\n              </Link>\n            </div>\n          </CardContent>\n        </Card>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":17553,"size_tokens":null},"client/src/components/ImpersonationBanner.tsx":{"content":"import { useAuth } from \"@/hooks/useAuth\";\nimport { Button } from \"@/components/ui/button\";\nimport { XCircle, Building2 } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport function ImpersonationBanner() {\n  const { \n    isImpersonating, \n    impersonatedTenantName, \n    stopImpersonation, \n    isStopImpersonationPending \n  } = useAuth();\n  const { toast } = useToast();\n\n  if (!isImpersonating) {\n    return null;\n  }\n\n  const handleStopImpersonation = () => {\n    stopImpersonation(undefined, {\n      onSuccess: () => {\n        toast({\n          title: \"Impersonation Ended\",\n          description: \"You are now back to your superadmin view.\",\n        });\n      },\n      onError: () => {\n        toast({\n          title: \"Error\",\n          description: \"Failed to stop impersonation.\",\n          variant: \"destructive\",\n        });\n      },\n    });\n  };\n\n  return (\n    <div \n      className=\"bg-amber-500 dark:bg-amber-600 text-white px-4 py-2 flex items-center justify-between gap-4 z-50\"\n      data-testid=\"impersonation-banner\"\n    >\n      <div className=\"flex items-center gap-2\">\n        <Building2 className=\"h-4 w-4\" />\n        <span className=\"text-sm font-medium\">\n          Viewing as: <strong>{impersonatedTenantName}</strong>\n        </span>\n      </div>\n      <Button\n        size=\"sm\"\n        variant=\"outline\"\n        onClick={handleStopImpersonation}\n        disabled={isStopImpersonationPending}\n        className=\"bg-transparent border-white text-white hover:bg-white/20\"\n        data-testid=\"button-stop-impersonation\"\n      >\n        <XCircle className=\"h-4 w-4 mr-1\" />\n        {isStopImpersonationPending ? \"Stopping...\" : \"Stop Impersonating\"}\n      </Button>\n    </div>\n  );\n}\n","path":null,"size_bytes":1730,"size_tokens":null}},"version":2}